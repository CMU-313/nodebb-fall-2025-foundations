"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,83436,86198,99127],{13118:(k,p,c)=>{c.r(p),c.d(p,{init:()=>v});var s=c(70106),C=c(65348),b=c.n(C);s.t1.register(s.ZT,s.PP,s.kc,s.No,s.FN,s.m_,s.dN);function v(){C.init($('[component="category-selector"]'),{onSelect:function(e){ajaxify.go("admin/manage/categories/"+e.cid+"/analytics")},showLinks:!0,template:"admin/partials/category/selector-dropdown-right"});const w=document.getElementById("pageviews:hourly"),m=document.getElementById("pageviews:daily"),i=document.getElementById("topics:daily"),t=document.getElementById("posts:daily"),n=utils.getHoursArray().map(function(e,a){return a%3?"":e}),f=utils.getDaysArray().map(function(e,a){return a%3?"":e});utils.isMobile()&&(s.t1.defaults.plugins.tooltip.enabled=!1);const o={label:"",fill:!0,tension:.25,pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff"},u={"pageviews:hourly":{labels:n,datasets:[{...o,backgroundColor:"rgba(186,139,175,0.2)",borderColor:"rgba(186,139,175,1)",pointBackgroundColor:"rgba(186,139,175,1)",pointHoverBorderColor:"rgba(186,139,175,1)",data:ajaxify.data.analytics["pageviews:hourly"]}]},"pageviews:daily":{labels:f,datasets:[{...o,backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBorderColor:"rgba(151,187,205,1)",data:ajaxify.data.analytics["pageviews:daily"]}]},"topics:daily":{labels:f.slice(-7),datasets:[{...o,backgroundColor:"rgba(171,70,66,0.2)",borderColor:"rgba(171,70,66,1)",pointBackgroundColor:"rgba(171,70,66,1)",pointHoverBorderColor:"rgba(171,70,66,1)",data:ajaxify.data.analytics["topics:daily"]}]},"posts:daily":{labels:f.slice(-7),datasets:[{...o,backgroundColor:"rgba(161,181,108,0.2)",borderColor:"rgba(161,181,108,1)",pointBackgroundColor:"rgba(161,181,108,1)",pointHoverBorderColor:"rgba(161,181,108,1)",data:ajaxify.data.analytics["posts:daily"]}]}};w.width=$(w).parent().width(),m.width=$(m).parent().width(),i.width=$(i).parent().width(),t.width=$(t).parent().width();const d={responsive:!0,animation:!1,scales:{y:{beginAtZero:!0}}};new s.t1(w.getContext("2d"),{type:"line",data:u["pageviews:hourly"],options:d}),new s.t1(m.getContext("2d"),{type:"line",data:u["pageviews:daily"],options:d}),new s.t1(i.getContext("2d"),{type:"line",data:u["topics:daily"],options:d}),new s.t1(t.getContext("2d"),{type:"line",data:u["posts:daily"],options:d})}},49897:(k,p,c)=>{c.r(p),c.d(p,{del:()=>d,get:()=>t,head:()=>n,patch:()=>o,post:()=>f,put:()=>u});var s=c(91749),C=c.n(s),b=c(33530),v=c.n(b);const w=config.relative_path+"/api/v3";async function m(e,a){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:w+e.url,typeof a=="function"){i(e).then(r=>a(null,r),r=>{let l=r;r instanceof Error||(l=new Error(String(r)));const g=l.message||String(l);if(g&&!g.startsWith("[[error:")&&(g.toLowerCase()==="fetch failed"||g.toLowerCase()==="failed to fetch"||g.toLowerCase().includes("networkerror")||g.toLowerCase().includes("network")&&g.toLowerCase().includes("failed"))){const h=new Error("[[error:no-connection]]");h.originalError=l,l=h}a(l)});return}try{return await i(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:l}=await(0,s.fire)("filter:admin.reauth",{url:"login"});return(0,b.confirm)("[[error:api.reauth-required]]",g=>{g&&ajaxify.go(l)})}throw r}}async function i(e){const{url:a}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,s.fire)("filter:api.options",{options:e}))}catch(y){console.error("[API] Error in filter:api.options hook:",y)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(a,e)}catch(y){const E=y.message||y.toString()||String(y),L=y.name||"Error";if(L==="TypeError"&&(E.toLowerCase().includes("fetch")||E.toLowerCase().includes("network")||E.toLowerCase().includes("failed to fetch")||E.toLowerCase().includes("load failed"))||E.toLowerCase().includes("cors")||E.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:a,method:e.method||"GET",error:E,name:L});const P=new Error("[[error:no-connection]]");throw P.originalError=y,P}throw console.error("[API] Unexpected fetch error:",{url:a,method:e.method||"GET",error:E,name:L}),y}const{headers:l}=r;if(l.get("x-redirect"))return i({url:l.get("x-redirect"),...e});const g=l.get("content-type"),A=g&&g.startsWith("application/json");let h;if(e.method!=="HEAD")try{A?h=await r.json():h=await r.text()}catch(y){throw console.error("[API] Error parsing response:",{url:a,status:r.status,statusText:r.statusText,contentType:g,error:y.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let y;throw h?A&&h.status&&h.status.message?y=h.status.message:typeof h=="string"?y=h:y=r.statusText||"Request failed":y=r.statusText||"Request failed",new Error(y)}return A&&h&&h.hasOwnProperty("status")&&h.hasOwnProperty("response")?h.response:h}function t(e,a,r){return m({url:e+(a&&Object.keys(a).length?"?"+$.param(a):"")},r)}function n(e,a,r){return m({url:e+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},r)}function f(e,a,r){return m({url:e,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}function o(e,a,r){return m({url:e,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}function u(e,a,r){return m({url:e,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}function d(e,a,r){return m({url:e,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}},65348:(k,p,c)=>{var s,C;s=[c(96349),c(33530),c(91749),c(17459)],C=function(b,v,w,m){const i={};return i.init=function(t,n){if(!t||!t.length)return;n=n||{};const f=n.onSelect||function(){};n.states=n.states||["watching","tracking","notwatching","ignoring"],n.template=n.template||"partials/category/selector-dropdown-left",w.fire("action:category.selector.options",{el:t,options:n}),b.init(t,n);const o={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const d=$(this);return d.hasClass("disabled")?!1:(o.selectCategory(d.attr("data-cid")),f(o.selectedCategory))});let u=o.el.find('[component="category-selector-selected"]').html();return m.translate(u,d=>{u=d}),o.selectCategory=function(d){const e=o.el.find('[data-cid="'+d+'"]');o.selectedCategory={cid:d,name:e.attr("data-name")},e.length?o.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):o.el.find('[component="category-selector-selected"]').html(u)},o.getSelectedCategory=function(){return o.selectedCategory},o.getSelectedCid=function(){return o.selectedCategory?o.selectedCategory.cid:0},n.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(n.template,{selectedCategory:n.selectedCategory},function(d){o.el.find('[component="category-selector-selected"]').html(d.find('[component="category-selector-selected"]').html())}),o},i.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(n){const f=v.dialog({title:t.title||"[[modules:composer.select-category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),o=i.init(f.find('[component="category-selector"]'),t);function u(d){return d.preventDefault(),o.selectedCategory&&(t.onSubmit(o.selectedCategory),f.modal("hide")),!1}t.openOnLoad&&f.on("shown.bs.modal",function(){f.find(".dropdown-toggle").dropdown("toggle")}),f.find("form").on("submit",u)})},i}.apply(p,s),C!==void 0&&(k.exports=C)},96349:(k,p,c)=>{var s,C;s=[c(29930),c(89336),c(49897)],C=function(b,v,w){const m={};return m.init=function(i,t){let n=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let f=[];Array.isArray(t.localCategories)&&(f=t.localCategories.map(a=>({...a})),n&&(n=[...f,...n])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const o=i.find('[component="category-selector-search"]');if(!o.length)return;const u=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;i.on("show.bs.dropdown",function(){u&&o.removeClass("hidden");function a(){const r=o.find("input").val();r.length>1||!r&&!n?d(r,function(l){n=t.cacheList&&(n||l),e(l)}):!r&&n&&e(n)}o.on("click",function(r){r.preventDefault(),r.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),i.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),i.on("hide.bs.dropdown",function(){u&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function d(a,r){w.get("/search/categories",{search:a,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(l,{categories:g}){if(l)return b.error(l);r(f.concat(g))})}function e(a){const r=t.selectedCids.map(String);a.forEach(function(l){l.selected=r.includes(String(l.cid))}),app.parseAndTranslate(t.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(l){i.find('[component="category/list"]').html(l.find('[component="category/list"]').html()),i.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const g=v.Dropdown.getInstance(i.find(".dropdown-toggle").get(0));g&&g.update()})}},m}.apply(p,s),C!==void 0&&(k.exports=C)}}]);
