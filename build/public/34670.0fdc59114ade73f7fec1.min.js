(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,34670,36159,49897,62441,88189,98463,99127],{24187:(b,x,a)=>{"use strict";var v,w;v=[a(64061)],w=function(){const p={};p.show=function(e,n){const o=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:o,title:e.title||"[[global:upload-file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(r){r.modal("show"),r.on("hidden.bs.modal",function(){r.remove()});const l=r.find("#uploadForm");l.attr("action",e.route),l.find("#params").val(JSON.stringify(e.params)),r.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),l.submit()}),l.submit(function(){return A(r,o,n),!1})})},p.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function A(e,n,o){d(e,"status","[[uploads:uploading-file]]"),e.find("#upload-progress-bar").css("width","0%"),e.find("#upload-progress-box").show().removeClass("hide");const r=e.find("#fileInput");if(!r.val())return d(e,"error","[[uploads:select-file-to-upload]]");if(!i(r[0],n))return d(e,"error","[[error:file-too-big, "+n+"]]");p.ajaxSubmit(e,o)}function d(e,n,o){p.hideAlerts(e),n==="error"&&e.find("#fileUploadSubmitBtn").removeClass("disabled"),o=o.replace(/&amp;#44/g,"&#44"),e.find("#alert-"+n).translateText(o).removeClass("hide")}p.ajaxSubmit=function(e,n){e.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(r){r=f(r),d(e,"error",r.responseJSON?.status?.message||r.responseJSON?.error||`[[error:upload-error-fallback, ${r.status} ${r.statusText}]]`)},uploadProgress:function(r,l,u,t){e.find("#upload-progress-bar").css("width",t+"%")},success:function(r){let l=f(r);r.hasOwnProperty("response")&&r.hasOwnProperty("status")&&r.status.code==="ok"&&(l=r.response.images),n(l[0].url),d(e,"success","[[uploads:upload-success]]"),setTimeout(function(){p.hideAlerts(e),e.modal("hide")},750)}})};function f(e){if(typeof e=="string")try{return JSON.parse(e)}catch(n){return console.error(n),{error:"[[error:parse-error]]"}}return e}function i(e,n){return window.FileReader&&n?e.files[0].size<=n*1e3:!0}return p}.apply(x,v),w!==void 0&&(b.exports=w)},26940:(b,x,a)=>{b.exports=a(94510)},36159:(b,x,a)=>{"use strict";var v,w;v=[a(49897),a(33530),a(29930),a(24187),a(81335),a(17459),a(65285)],w=function(p,A,d,f,i,e){const n={};return n.get=o=>p.get(`/topics/${o}/thumbs`,{thumbsOnly:1}),n.getByPid=o=>p.get(`/posts/${encodeURIComponent(o)}`,{}).then(r=>n.get(r.tid)),n.delete=(o,r)=>p.del(`/topics/${o}/thumbs`,{path:r}),n.deleteAll=o=>{n.get(o).then(r=>{Promise.all(r.map(l=>n.delete(o,l.url)))})},n.upload=o=>new Promise(r=>{f.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${o}/thumbs`},function(l){r(l)})}),n.modal={},n.modal.open=function(o){const{id:r,pid:l}=o;let{modal:u}=o,t;return new Promise(c=>{Promise.all([n.get(r),l?n.getByPid(l):[]]).then(s=>new Promise(h=>{const m=s.reduce((S,g)=>S.concat(g));t=m.length,h(m)})).then(s=>i.render("modals/topic-thumbs",{thumbs:s})).then(s=>{u?e.translate(s,function(h){u.find(".bootbox-body").html(h),n.modal.handleSort({modal:u,numThumbs:t})}):(u=A.dialog({title:"[[modules:thumbs.modal.title]]",message:s,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(n.upload(r).then(()=>{n.modal.open({...o,modal:u}),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var h=[a(71431)];(m=>{m.updateThumbCount(r,$(`[component="composer"][data-uuid="${r}"]`)),c()}).apply(null,h)}).catch(a.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),n.modal.handleDelete({...o,modal:u}),n.modal.handleSort({modal:u,numThumbs:t}))})})},n.modal.handleDelete=o=>{const r=o.modal.get(0),{id:l}=o;r.addEventListener("click",u=>{u.target.closest('button[data-action="remove"]')&&A.confirm("[[modules:thumbs.modal.confirm-remove]]",t=>{if(!t)return;const c=u.target.closest("[data-id]").getAttribute("data-id"),s=u.target.closest("[data-path]").getAttribute("data-path");p.del(`/topics/${c}/thumbs`,{path:s}).then(()=>{n.modal.open(o),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var h=[a(71431)];(m=>{m.updateThumbCount(l,$(`[component="composer"][data-uuid="${l}"]`))}).apply(null,h)}).catch(a.oe)}).catch(d.error)})})},n.modal.handleSort=({modal:o,numThumbs:r})=>{if(r>1){const l=o.find(".topic-thumbs-modal");l.sortable({items:"[data-id]"}),l.on("sortupdate",n.modal.handleSortChange)}},n.modal.handleSortChange=(o,r)=>{const l=r.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(l).forEach((u,t)=>{const c=u.getAttribute("data-id");let s=u.getAttribute("data-path");s=s.replace(new RegExp(`^${config.upload_url}`),""),p.put(`/topics/${c}/thumbs/order`,{path:s,order:t}).catch(d.error)})},n}.apply(x,v),w!==void 0&&(b.exports=w)},49897:(b,x,a)=>{"use strict";a.r(x),a.d(x,{del:()=>u,get:()=>e,head:()=>n,patch:()=>r,post:()=>o,put:()=>l});var v=a(91749),w=a.n(v),p=a(33530),A=a.n(p);const d=config.relative_path+"/api/v3";async function f(t,c){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:d+t.url,typeof c=="function"){i(t).then(s=>c(null,s),s=>{let h=s;s instanceof Error||(h=new Error(String(s)));const m=h.message||String(h);if(m&&!m.startsWith("[[error:")&&(m.toLowerCase()==="fetch failed"||m.toLowerCase()==="failed to fetch"||m.toLowerCase().includes("networkerror")||m.toLowerCase().includes("network")&&m.toLowerCase().includes("failed"))){const g=new Error("[[error:no-connection]]");g.originalError=h,h=g}c(h)});return}try{return await i(t)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again."){const{url:h}=await(0,v.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go(h)})}throw s}}async function i(t){const{url:c}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,v.fire)("filter:api.options",{options:t}))}catch(E){console.error("[API] Error in filter:api.options hook:",E)}t.data&&(t.body=t.data,delete t.data);let s;try{s=await fetch(c,t)}catch(E){const P=E.message||E.toString()||String(E),y=E.name||"Error";if(y==="TypeError"&&(P.toLowerCase().includes("fetch")||P.toLowerCase().includes("network")||P.toLowerCase().includes("failed to fetch")||P.toLowerCase().includes("load failed"))||P.toLowerCase().includes("cors")||P.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:c,method:t.method||"GET",error:P,name:y});const C=new Error("[[error:no-connection]]");throw C.originalError=E,C}throw console.error("[API] Unexpected fetch error:",{url:c,method:t.method||"GET",error:P,name:y}),E}const{headers:h}=s;if(h.get("x-redirect"))return i({url:h.get("x-redirect"),...t});const m=h.get("content-type"),S=m&&m.startsWith("application/json");let g;if(t.method!=="HEAD")try{S?g=await s.json():g=await s.text()}catch(E){throw console.error("[API] Error parsing response:",{url:c,status:s.status,statusText:s.statusText,contentType:m,error:E.message}),new Error("[[error:invalid-json]]")}if(!s.ok){let E;throw g?S&&g.status&&g.status.message?E=g.status.message:typeof g=="string"?E=g:E=s.statusText||"Request failed":E=s.statusText||"Request failed",new Error(E)}return S&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function e(t,c,s){return f({url:t+(c&&Object.keys(c).length?"?"+$.param(c):"")},s)}function n(t,c,s){return f({url:t+(c&&Object.keys(c).length?"?"+$.param(c):""),method:"HEAD"},s)}function o(t,c,s){return f({url:t,method:"POST",data:c,headers:{"x-csrf-token":config.csrf_token}},s)}function r(t,c,s){return f({url:t,method:"PATCH",data:c,headers:{"x-csrf-token":config.csrf_token}},s)}function l(t,c,s){return f({url:t,method:"PUT",data:c,headers:{"x-csrf-token":config.csrf_token}},s)}function u(t,c,s){return f({url:t,method:"DELETE",data:c,headers:{"x-csrf-token":config.csrf_token}},s)}},94510:(b,x,a)=>{"use strict";var v,w;v=[a(89596)],w=function(p){var A={};return A.insertIntoTextarea=function(d,f){var i={context:this,textarea:d,value:f,preventDefault:!1};if($(window).trigger("action:composer.insertIntoTextarea",i),!i.preventDefault){var e=$(i.textarea),n=e.val(),o=e.parents('[component="composer"]');e.val(n.slice(0,i.textarea.selectionStart)+i.value+n.slice(i.textarea.selectionStart)),p.render(o)}},A.replaceSelectionInTextareaWith=function(d,f){var i={context:this,textarea:d,value:f,preventDefault:!1};if($(window).trigger("action:composer.replaceSelectionInTextareaWith",i),!i.preventDefault){var e=$(i.textarea),n=e.val(),o=e.parents('[component="composer"]');e.val(n.slice(0,i.textarea.selectionStart)+i.value+n.slice(i.textarea.selectionEnd)),p.render(o)}},A.wrapSelectionInTextareaWith=function(d,f,i){var e={context:this,textarea:d,leading:f,trailing:i,preventDefault:!1};if($(window).trigger("action:composer.wrapSelectionInTextareaWith",e),!e.preventDefault){i===void 0&&(i=f);var n=$(d),o=n.val(),r=/^(\s*)([\s\S]*?)(\s*)$/.exec(o.slice(d.selectionStart,d.selectionEnd));return r[2]||(r=[null,"",o.slice(d.selectionStart,d.selectionEnd),""]),n.val(o.slice(0,d.selectionStart)+r[1]+f+r[2]+i+r[3]+o.slice(d.selectionEnd)),[r[1].length,r[3].length]}},A.updateTextareaSelection=function(d,f,i){var e={context:this,textarea:d,start:f,end:i,preventDefault:!1};$(window).trigger("action:composer.updateTextareaSelection",e),!e.preventDefault&&(d.setSelectionRange(e.start,e.end),$(e.textarea).focus())},A.getBlockData=function(d,f,i){var e=d.value;f=f.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");var n=new RegExp(f,"g"),o,r=[],l;for(e=e.split(`
`).reduce(function(u,t){return u!==null||(u=i<=t.length?t:null,u===null&&(i-=t.length+1)),u},null);(o=n.exec(e))!==null;)r.push(o.index);return l={in:!!(r.reduce(function(u,t){return i>=t+2&&(u+=1),u},0)%2),atEnd:r.reduce(function(u,t){return u||i===t},!1)},l.atEnd=l.in?l.atEnd:!1,l},A}.apply(x,v),w!==void 0&&(b.exports=w)}}]);
