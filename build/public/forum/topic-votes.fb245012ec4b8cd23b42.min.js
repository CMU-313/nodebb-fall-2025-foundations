"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,63154,99127],{34342:(k,C,c)=>{var p,T;p=[c(52473),c(17459),c(49897),c(91749),c(33530),c(29930),c(89336)],T=function(f,x,g,d,m,E,y){const h={};let w={};h.addVoteHandler=function(){w={},v()&&(f.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',a),f.get("topic").on("mouseleave",'[data-pid] [component="post/vote-count"]',t)),f.get("topic").on("mouseenter",'[data-pid] [component="post/announce-count"]',a),f.get("topic").on("mouseleave",'[data-pid] [component="post/announce-count"]',t)};function v(){const{upvoteVisibility:o,privileges:r}=ajaxify.data;return r.isAdminOrMod||o==="all"||o==="loggedin"&&config.loggedIn}function A(){const{upvoteVisibility:o,downvoteVisibility:r,privileges:i}=ajaxify.data;return i.isAdminOrMod||o==="all"||r==="all"||(o==="loggedin"||r==="loggedin")&&config.loggedIn}function t(){const o=$(this),r=o.parents("[data-pid]").attr("data-pid"),i=y.Tooltip.getInstance(this);i&&(i.dispose(),o.attr("title","")),w[r]=!1}function a(){const o=$(this),i=o.parent().parents("[data-pid]").attr("data-pid");w[i]=!0;const e=y.Tooltip.getInstance(this);e&&(e.dispose(),o.attr("title",""));const s=o.attr("component")==="post/vote-count"?`/posts/${encodeURIComponent(i)}/upvoters`:`/posts/${encodeURIComponent(i)}/announcers/tooltip`;g.get(s,{},function(l,u){if(l)return E.error(l);w[i]&&u&&n(o,u)})}function n(o,r){function i(s){o.attr("title",s),new y.Tooltip(o,{container:"#content",html:!0}).show()}let e=r.usernames.filter(s=>s!=="[[global:former-user]]");e.length&&(e.length+r.otherCount>r.cutoff?(e=e.join(", ").replace(/,/g,"|"),x.translate("[[topic:users-and-others, "+e+", "+r.otherCount+"]]",function(s){s=s.replace(/\|/g,","),i(s)})):(e=e.join(", "),i(e)))}return h.toggleVote=function(o,r,i){const e=o.closest("[data-pid]"),l=e.find(r).length?"del":"put",u=e.attr("data-pid");return g[l](`/posts/${encodeURIComponent(u)}/vote`,{delta:i},function(P){if(P){if(!app.user.uid){ajaxify.go("login");return}return E.error(P)}d.fire("action:post.toggleVote",{pid:u,delta:i,unvote:l==="del"})}),!1},h.showVotes=function(o){A()&&g.get(`/posts/${encodeURIComponent(o)}/voters`,{},function(r,i){if(r)return E.error(r);app.parseAndTranslate("modals/votes",i,function(e){const s=m.dialog({title:"[[global:voters]]",message:e,className:"vote-modal",show:!0,onEscape:!0,backdrop:!0});s.on("click",function(){s.modal("hide")})})})},h.showAnnouncers=async function(o){const r=await g.get(`/posts/${encodeURIComponent(o)}/announcers`,{}).catch(s=>E.error(s)),i=await app.parseAndTranslate("modals/announcers",r),e=m.dialog({title:`[[topic:announcers-x, ${r.announceCount}]]`,message:i,className:"announce-modal",show:!0,onEscape:!0,backdrop:!0});e.on("click",function(){e.modal("hide")})},h}.apply(C,p),T!==void 0&&(k.exports=T)},49897:(k,C,c)=>{c.r(C),c.d(C,{del:()=>A,get:()=>E,head:()=>y,patch:()=>w,post:()=>h,put:()=>v});var p=c(91749),T=c.n(p),f=c(33530),x=c.n(f);const g=config.relative_path+"/api/v3";async function d(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:g+t.url,typeof a=="function"){m(t).then(n=>a(null,n),n=>{let o=n;n instanceof Error||(o=new Error(String(n)));const r=o.message||String(o);if(r&&!r.startsWith("[[error:")&&(r.toLowerCase()==="fetch failed"||r.toLowerCase()==="failed to fetch"||r.toLowerCase().includes("networkerror")||r.toLowerCase().includes("network")&&r.toLowerCase().includes("failed"))){const e=new Error("[[error:no-connection]]");e.originalError=o,o=e}a(o)});return}try{return await m(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:o}=await(0,p.fire)("filter:admin.reauth",{url:"login"});return(0,f.confirm)("[[error:api.reauth-required]]",r=>{r&&ajaxify.go(o)})}throw n}}async function m(t){const{url:a}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,p.fire)("filter:api.options",{options:t}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}t.data&&(t.body=t.data,delete t.data);let n;try{n=await fetch(a,t)}catch(s){const l=s.message||s.toString()||String(s),u=s.name||"Error";if(u==="TypeError"&&(l.toLowerCase().includes("fetch")||l.toLowerCase().includes("network")||l.toLowerCase().includes("failed to fetch")||l.toLowerCase().includes("load failed"))||l.toLowerCase().includes("cors")||l.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:a,method:t.method||"GET",error:l,name:u});const I=new Error("[[error:no-connection]]");throw I.originalError=s,I}throw console.error("[API] Unexpected fetch error:",{url:a,method:t.method||"GET",error:l,name:u}),s}const{headers:o}=n;if(o.get("x-redirect"))return m({url:o.get("x-redirect"),...t});const r=o.get("content-type"),i=r&&r.startsWith("application/json");let e;if(t.method!=="HEAD")try{i?e=await n.json():e=await n.text()}catch(s){throw console.error("[API] Error parsing response:",{url:a,status:n.status,statusText:n.statusText,contentType:r,error:s.message}),new Error("[[error:invalid-json]]")}if(!n.ok){let s;throw e?i&&e.status&&e.status.message?s=e.status.message:typeof e=="string"?s=e:s=n.statusText||"Request failed":s=n.statusText||"Request failed",new Error(s)}return i&&e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e}function E(t,a,n){return d({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},n)}function y(t,a,n){return d({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},n)}function h(t,a,n){return d({url:t,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function w(t,a,n){return d({url:t,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function v(t,a,n){return d({url:t,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function A(t,a,n){return d({url:t,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
