(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,16554,18470,97082],{18675:()=>{(function(m){var A=m(window),r=function(a,f,o,c){if(arguments.length===3||c){if(o<a)return a;if(o>f)return f}return o},y=function(a){a.clientX=a.originalEvent.touches[0].clientX,a.clientY=a.originalEvent.touches[0].clientY},h=function(a){var f=(a.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(f){var o={width:0,height:0},c=new Image;return c.onload=function(){if(a.css("background-size")=="cover"){var u=a.innerWidth(),s=a.innerHeight(),t=u/s,n=c.width/c.height,e=1;n>=t?e=s/c.height:e=u/c.width,o.width=c.width*e,o.height=c.height*e}else o.width=c.width,o.height=c.height},c.src=f,o}};function x(a,f){this.element=a,this.options=f,this.init()}x.prototype.init=function(){var a=m(this.element),f=(a.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],o=this.options;if(f){var c={width:0,height:0};(o.bound||o.units=="percent")&&(c=h(a)),m(window).on("keydown.dbg",u=>{var s=a.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],t=parseInt(s[1])||0,n=parseInt(s[2])||0;o.units=="percent"&&(t=Math.round(t/-200*c.width),n=Math.round(n/-200*c.height));var e=0,i=0;return u.which===37?e=-5:u.which===39?e=5:u.which===38?i=-5:u.which===40&&(i=5),o.units==="percent"?(t=o.axis==="y"?t:r(-c.width/2,0,t+e,o.bound),n=o.axis==="x"?n:r(-c.height/2,0,n+i,o.bound),a.css("background-position",t/c.width*-200+"% "+n/c.height*-200+"%")):(t=o.axis==="y"?t:r(a.innerWidth()-c.width,0,t+e,o.bound),n=o.axis==="x"?n:r(a.innerHeight()-c.height,0,n+i,o.bound)),[37,38,39,40].includes(u.which)?!1:void 0}),a.on("mousedown.dbg touchstart.dbg",function(u){if(u.target===a[0]){if(u.preventDefault(),u.originalEvent.touches)y(u);else if(u.which!==1)return;var s=u.clientX,t=u.clientY,n=a.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],e=parseInt(n[1])||0,i=parseInt(n[2])||0;o.units=="percent"&&(e=Math.round(e/-200*c.width),i=Math.round(i/-200*c.height)),A.on("mousemove.dbg touchmove.dbg",function(d){d.preventDefault(),d.originalEvent.touches&&y(d);var l=d.clientX,p=d.clientY;o.units=="percent"?(e=o.axis==="y"?e:r(-c.width/2,0,e+l-s,o.bound),i=o.axis==="x"?i:r(-c.height/2,0,i+p-t,o.bound),a.css("background-position",e/c.width*-200+"% "+i/c.height*-200+"%")):(e=o.axis==="y"?e:r(a.innerWidth()-c.width,0,e+l-s,o.bound),i=o.axis==="x"?i:r(a.innerHeight()-c.height,0,i+p-t,o.bound),a.css("background-position",e+"px "+i+"px")),s=l,t=p}),A.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){o.done&&o.done(),A.off("mousemove.dbg touchmove.dbg"),A.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},x.prototype.disable=function(){var a=m(this.element);a.off("mousedown.dbg touchstart.dbg"),A.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},m.fn.backgroundDraggable=function(a){var f=Array.prototype.slice.call(arguments,1);return this.each(function(){var o=m(this),c;typeof a>"u"||typeof a=="object"?(a=m.extend({},m.fn.backgroundDraggable.defaults,a),c=new x(this,a),o.data("dbg",c)):typeof a=="string"&&o.data("dbg")&&(c=o.data("dbg"),x.prototype[a].apply(c,f))})},m.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(m,A,r)=>{"use strict";var y,h;y=[r(81335),r(49897),r(33530),r(29930)],h=function(x,a,f,o){const c={};c.banAccount=function(s,t){s=s||ajaxify.data.theirid,u({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(n){const e=n.length>0?Date.now()+n.length*1e3*60*60*(parseInt(n.unit,10)?24:1):0;a.put("/users/"+s+"/ban",{until:e,reason:n.reason||""}).then(()=>{if(typeof t=="function")return t();ajaxify.refresh()}).catch(o.error)}})},c.unbanAccount=function(s){u({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(t){a.del("/users/"+s+"/ban",{reason:t.reason||""}).then(()=>{ajaxify.refresh()}).catch(o.error)}})},c.muteAccount=function(s,t){s=s||ajaxify.data.theirid,u({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(n){const e=n.length>0?Date.now()+n.length*1e3*60*60*(parseInt(n.unit,10)?24:1):0;a.put("/users/"+s+"/mute",{until:e,reason:n.reason||""}).then(()=>{if(typeof t=="function")return t();ajaxify.refresh()}).catch(o.error)}})},c.unmuteAccount=function(s){u({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(t){a.del("/users/"+s+"/mute",{reason:t.reason||""}).then(()=>{ajaxify.refresh()}).catch(o.error)}})};function u(s){x.render(s.tpl,{}).then(function(t){const n=f.dialog({title:s.title,message:t,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:s.title,callback:function(){const e=n.find("form").serializeArray().reduce(function(i,d){return i[d.name]=d.value,i},{});s.onSubmit(e)}}}})})}return c}.apply(A,y),h!==void 0&&(m.exports=h)},36684:(m,A,r)=>{"use strict";var y,h;y=[r(29930),r(18675)],h=function(x){const a={coverEl:null,saveFn:null};a.init=function(o,c,u,s){a.coverEl=o,a.saveFn=c,o.find(".upload").on("click",u),o.find(".resize").on("click",function(){f(o)}),o.find(".remove").on("click",s),o.on("dragover",a.onDragOver).on("drop",a.onDrop),o.find(".save").on("click",a.save),o.addClass("initialised")},a.onDragOver=function(o){o.stopPropagation(),o.preventDefault(),o.originalEvent.dataTransfer.dropEffect="copy"},a.onDrop=function(o){o.stopPropagation(),o.preventDefault();const c=o.originalEvent.dataTransfer.files,u=new FileReader;c.length&&c[0].type.match("image.*")&&(u.onload=function(s){a.coverEl.css("background-image","url("+s.target.result+")"),a.newCover=s.target.result},u.readAsDataURL(c[0]),f(a.coverEl))};function f(o){o.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),x.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return a.save=function(){a.coverEl.addClass("saving"),a.saveFn(a.newCover||void 0,a.coverEl.css("background-position"),function(o){o?x.error(o):(a.coverEl.toggleClass("active",0),a.coverEl.backgroundDraggable("disable"),a.coverEl.off("dragover",a.onDragOver),a.coverEl.off("drop",a.onDrop),x.success("[[modules:cover.saved]]")),a.coverEl.removeClass("saving")})},a}.apply(A,y),h!==void 0&&(m.exports=h)},47283:(m,A,r)=>{"use strict";var y,h;y=[r(49897),r(33530),r(29930)],h=function(x,a,f){const o={};o.account=function(u,s){c(u,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",s)},o.content=function(u,s){c(u,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",s)},o.purge=function(u,s){c(u,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",s)};function c(u,s,t,n,e){a.confirm(s,function(i){i&&x.del(`/users/${encodeURIComponent(u)}${t}`,{}).then(()=>{if(f.success(n),typeof e=="function")return e()}).catch(f.error)})}return o}.apply(A,y),h!==void 0&&(m.exports=h)},66934:(m,A,r)=>{m.exports=r(72961)},67910:(m,A,r)=>{"use strict";var y,h;y=[r(36684),r(72254),r(52473),r(17459),r(47283),r(28061),r(7524),r(49897),r(33530),r(29930)],h=function(x,a,f,o,c,u,s,t,n,e){const i={};let d;i.init=function(){d=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,l(),p(),d&&v(),f.get("account/follow").on("click",()=>E("follow")),f.get("account/unfollow").on("click",()=>E("unfollow")),f.get("account/chat").on("click",async function(){const{roomId:g}=await t.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),C=await app.require("chat");g?C.openChat(g):C.newChat(ajaxify.data.uid)}),f.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){f.get("account/chat").parent().removeClass("hidden")})}),f.get("account/ban").on("click",()=>u.banAccount(ajaxify.data.theirid)),f.get("account/mute").on("click",()=>u.muteAccount(ajaxify.data.theirid)),f.get("account/unban").on("click",()=>u.unbanAccount(ajaxify.data.theirid)),f.get("account/unmute").on("click",()=>u.unmuteAccount(ajaxify.data.theirid)),f.get("account/delete-account").on("click",()=>c.account(ajaxify.data.theirid)),f.get("account/delete-content").on("click",()=>c.content(ajaxify.data.theirid)),f.get("account/delete-all").on("click",()=>c.purge(ajaxify.data.theirid)),f.get("account/flag").on("click",b),f.get("account/already-flagged").on("click",D),f.get("account/block").on("click",()=>k("block")),f.get("account/unblock").on("click",()=>k("unblock"))};function l(){$(".account-sub-links li a").removeClass("active").each(function(){const g=$(this).attr("href");if(decodeURIComponent(g)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function p(){$('[component="profile/change/picture"]').on("click",function(){return s.openChangeModal(),!1})}function v(){x.init(f.get("account/cover"),function(g,C,R){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:g,position:C},R)},function(){a.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(g){g=(g.startsWith("http")?"":config.relative_path)+g+"?"+Date.now(),f.get("account/cover").css("background-image","url("+g+")")})},j)}function E(g){const C=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return t[g==="follow"?"put":"del"]("/users/"+C+"/follow",void 0,function(R){if(R)return e.error(R);f.get("account/follow").toggleClass("hide",g==="follow"),f.get("account/unfollow").toggleClass("hide",g==="unfollow"),e.success("[[global:alert."+g+", "+ajaxify.data.username+"]]")}),!1}function b(){r.e(6574).then(function(){var g=[r(6574)];(function(C){C.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,g)}).catch(r.oe)}function D(){const g=$(this).data("flag-id");r.e(6574).then(function(){var C=[r(6574)];(function(R){n.confirm("[[flags:modal-confirm-rescind]]",function(w){w&&R.rescind(g)})}).apply(null,C)}).catch(r.oe)}function k(g){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:g},function(C,R){if(C)return e.error(C);f.get("account/block").toggleClass("hidden",R),f.get("account/unblock").toggleClass("hidden",!R)}),!1}function j(){o.translate("[[user:remove-cover-picture-confirm]]",function(g){n.confirm(g,function(C){C&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(R){R?e.error(R):ajaxify.refresh()})})})}return i}.apply(A,y),h!==void 0&&(m.exports=h)},70012:(m,A,r)=>{"use strict";var y,h;y=[r(91749),r(29930)],h=function(x,a){let f=[],o=0;function c(t,n){typeof t!="string"&&(t=$(t),t=t.data("type")||t.attr("type")||t.prop("tagName"));const e=s.plugins[t.toLowerCase()];if(e==null)return;const i=e[n];return typeof i=="function"?i:null}const u={deepClone:function(t){return typeof t=="object"?JSON.parse(JSON.stringify(t)):t},createElement:function(t,n,e){const i=document.createElement(t);for(const[d,l]of Object.entries(n))i.setAttribute(d,l);return e&&i.appendChild(document.createTextNode(e)),i},initElement:function(t){const n=c(t,"init");n?.call(s,$(t))},destructElement:function(t){const n=c(t,"destruct");n?.call(s,$(t))},createElementOfType:function(t,n,e){let i;const d=c(t,"create");return d!=null?i=$(d.call(s,t,n,e)):(e==null&&(e={}),t!=null&&(e.type=t),i=$(u.createElement(n||"input",e))),i.data("type",t),u.initElement(i),i},cleanArray:function(t,n,e){const i=[];if(!n&&e)return t;for(let d=0;d<t.length;d+=1){let l=t[d];n&&(l===!!l?l=+l:l&&typeof l.trim=="function"&&(l=l.trim())),(e||l!=null&&l.length)&&i.push(l)}return i},isTrue:function(t){return t==="true"||+t==1},isFalse:function(t){return t==="false"||+t==0},readValue:function(t){let n=!u.isFalse(t.data("empty"));const e=!u.isFalse(t.data("trim")),i=t.data("split"),d=c(t,"get");let l;if(d!=null)return d.call(s,t,e,n);if(i!=null){n=u.isTrue(t.data("empty")),l=t.val();const p=l!=null&&l.split(i||",")||[];return u.cleanArray(p,e,n)}if(l=t.val(),e&&l!=null&&typeof l.trim=="function"&&(l=l.trim()),n||l!==void 0&&(l==null||l.length!==0))return l},fillField:function(t,n){const e=c(t,"set");let i=t.data("trim");if(i=i!=="false"&&+i!=0,e!=null)return e.call(s,t,n,i);n instanceof Array&&(n=n.join(t.data("split")||(i?", ":","))),i&&n&&typeof n.trim=="function"?(n=n.trim(),typeof n.toString=="function"&&(n=n.toString())):n!=null?(typeof n.toString=="function"&&(n=n.toString()),i&&(n=n.trim())):n="",n!==void 0&&t.val(n)},initFields:function(t){$("[data-key]",t).each(function(n,e){e=$(e);const i=c(e,"init"),d=e.data("key").split(".");let l=s.get();i?.call(s,e);for(let p=0;p<d.length;p+=1){const v=d[p];v&&l!=null&&(l=l[v])}u.fillField(e,l)})},registerReadyJobs:function(t){return o+=t,o},beforeReadyJobsDecreased:function(t){if(t==null&&(t=1),o>0&&(o-=t,o<=0)){for(let n=0;n<f.length;n+=1)f[n]();f=[]}},whenReady:function(t){o<=0?t():f.push(t)},serializeForm:function(t){const n=t.serializeObject();return t.find('input[type="checkbox"]').each(function(e,i){i=$(i),i.is(":checked")||(n[i.attr("name")]="off")}),t.find("select[multiple]").each(function(e,i){i=$(i),n[i.attr("name")]=JSON.stringify(i.val())}),n},persistSettings:function(t,n,e,i){n!=null&&n._!=null&&typeof n._!="string"&&(n=u.deepClone(n),n._=JSON.stringify(n._)),socket.emit("admin.settings.set",{hash:t,values:n},function(d){e&&(d?a.alert({title:"[[admin/admin:changes-not-saved]]",type:"danger",message:`[[admin/admin/changes-not-saved-message, ${d.message}]]`,timeout:5e3}):a.alert({title:"[[admin/admin:changes-saved]]",type:"success",message:"[[admin/admin:changes-saved-message]]",timeout:2500})),typeof i=="function"&&i(d)})},use:function(t){try{t._=JSON.parse(t._)}catch(n){console.error(n)}s.cfg=t}},s={helper:u,plugins:{},cfg:{},get:function(){return s.cfg!=null&&s.cfg._!==void 0?s.cfg._:s.cfg},registerPlugin:function(t,n){n==null?n=t.types:t.types=n,typeof t.use=="function"&&t.use.call(s);for(let e=0;e<n.length;e+=1){const i=n[e].toLowerCase();s.plugins[i]==null&&(s.plugins[i]=t)}},set:function(t,n,e,i,d){d==null&&(d=!0),u.whenReady(function(){u.use(n),u.initFields(e||"form"),u.persistSettings(t,n,d,i)})},sync:function(t,n,e){socket.emit("admin.settings.get",{hash:t},function(i,d){i?typeof e=="function"&&e(i):u.whenReady(function(){u.use(d),u.initFields(n||"form"),typeof e=="function"&&e()})})},persist:function(t,n,e,i){const d=[],l=$("[data-key]",n||"form").toArray();i==null&&(i=!0);for(let p=0;p<l.length;p+=1){const v=$(l[p]),E=u.readValue(v);let b=s.get();const D=v.data("key").split("."),k=D[D.length-1];if(D.length>1)for(let j=0;j<D.length-1;j+=1){const g=D[j];g&&b!=null&&(b=b[g])}b!=null?E!=null?b[k]=E:delete b[k]:d.push(v.data("key"))}d.length&&a.alert({title:"Attributes Not Saved",message:"'"+d.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3}),u.persistSettings(t,s.cfg,i,e)},load:function(t,n,e){e=e||function(){};const i=n.attr("data-socket-get");socket.emit(i||"admin.settings.get",{hash:t},function(d,l){if(d)return e(d);$(n).find("select[multiple]").each(function(v,E){const b=$(E).attr("name");if(b&&l.hasOwnProperty(b))try{l[b]=JSON.parse(l[b])}catch(D){console.error(D)}}),ajaxify.data[i?t:"settings"]=l,u.whenReady(function(){$(n).find("[data-sorted-list]").each(function(v,E){c(E,"get").call(s,$(E),t)})}),$(n).deserialize(l),x.fire("action:admin.settingsLoaded"),$(n).on("change","input, select, textarea",function(){app.flags=app.flags||{},app.flags._unsaved=!0});const p=document.getElementById("save");p&&r.e(6411).then(function(){var v=[r(6411)];(function(E){E.bind("ctrl+s",function(b){p.click(),b.preventDefault()})}).apply(null,v)}).catch(r.oe),e(null,l)})},save:function(t,n,e){n=$(n);const i=n.get(0).elements;if(s.check(i)&&n.length){const l=u.serializeForm(n);u.whenReady(function(){const v=n.find("[data-sorted-list]");v.length&&v.each((E,b)=>{c(b,"set").call(s,$(b),l)})});const p=n.attr("data-socket-set");socket.emit(p||"admin.settings.set",{hash:t,values:l},function(v){if(app.flags._unsaved=!1,ajaxify.data[p?t:"settings"]=l,typeof e=="function")e(v);else if(v)a.alert({title:"[[admin/admin:changes-not-saved]]",message:`[[admin/admin:changes-not-saved-message, ${v.message}]]`,type:"error",timeout:2500});else{const E=document.getElementById("save");E.classList.toggle("saved",!0),setTimeout(()=>{E.classList.toggle("saved",!1)},1500)}})}},check:function(t){const n=e=>{const i=e.target.closest(".form-group");i&&i.classList.add("has-error"),e.target.removeEventListener("invalid",n)};return Array.prototype.map.call(t,e=>{const i=e.closest(".form-group");return i&&i.classList.remove("has-error"),e.addEventListener("invalid",n),e.reportValidity()}).every(Boolean)}};return u.registerReadyJobs(1),Promise.all([r.e(23662),r.e(65285),r.e(19308)]).then(function(){var t=[r(75210),r(474),r(50397),r(71575),r(40054),r(17708),r(46700),r(59175)];(function(){for(let n=0;n<arguments.length;n+=1)s.registerPlugin(arguments[n]);u.beforeReadyJobsDecreased()}).apply(null,t)}).catch(r.oe),s}.apply(A,y),h!==void 0&&(m.exports=h)},72961:(m,A,r)=>{"use strict";var y,h;y=[r(67910),r(49897),r(70012),r(29930)],h=function(x,a,f,o){const c={};return c.init=()=>{x.init(),c.setupForm()},c.setupForm=()=>{const u=document.getElementById("save");if(u){const s=document.getElementById("theme-settings");u.addEventListener("click",async()=>{const t=f.helper.serializeForm($(s));await a.put(`/users/${ajaxify.data.uid}/settings`,{settings:{...t}}),ajaxify.data.isSelf&&(config.theme=(await a.get("/api/config")).theme),o.success("[[success:settings-saved]]")})}},c}.apply(A,y),h!==void 0&&(m.exports=h)}}]);
