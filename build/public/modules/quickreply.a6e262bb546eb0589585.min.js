"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,18314,33085,34271,34405,49897,87212,99127],{34405:(A,x,p)=>{var v,E;v=[p(49897),p(29930),p(36e3),p(9787),p(35786)],E=function(f,d,{Textcomplete:t},{TextareaEditor:a},{ContenteditableEditor:g}){const o={},s={delay:200,appendTo:null};o.init=c=>{const l={...s,...c},{input:i,onSelect:e}=l;app.loadJQueryUI(function(){i.autocomplete({...l,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(n,r){y(i,e,n,r)}})})},o.user=function(c,l,i){typeof l=="function"&&(i=l,l={}),l=l||{},o.init({input:c,onSelect:i,source:(e,n)=>{l.query=e.term,f.get("/api/users",l,function(r,w){if(r)return d.error(r);if(w&&w.users){const u=w.users.map(function(m){const h=$("<div></div>").html(m.username).text();return m&&{label:h,value:h,user:{uid:m.uid,name:m.username,slug:m.userslug,username:m.username,userslug:m.userslug,displayname:m.displayname,picture:m.picture,banned:m.banned,"icon:text":m["icon:text"],"icon:bgColor":m["icon:bgColor"]}}});n(u)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},o.group=function(c,l){o.init({input:c,onSelect:l,source:(i,e)=>{socket.emit("groups.search",{query:i.term},function(n,r){if(n)return d.error(n);if(r&&r.length){const w=r.map(function(u){return u&&{label:u.name,value:u.name,group:u}});e(w)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},o.tag=function(c,l){o.init({input:c,onSelect:l,delay:100,source:(i,e)=>{socket.emit("topics.autocompleteTags",{query:i.term,cid:ajaxify.data.cid||0},function(n,r){if(n)return d.error(n);r&&e(r),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function y(c,l,i,e){l=l||function(){};const n=jQuery.Event("keypress");n.which=13,n.keyCode=13,setTimeout(function(){c.trigger(n)},100),l(i,e)}return o.setup=function({element:c,strategies:l,options:i}){const e=c.get(0);if(e){var n;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?n=new a(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(n=new g(e)),!n)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var r=new t(n,l,{dropdown:i});return r.on("rendered",function(){r.dropdown.items.length&&r.dropdown.items[0].activate()}),r}},o}.apply(x,v),E!==void 0&&(A.exports=E)},43103:(A,x,p)=>{var v,E;v=[p(29930)],E=function(f){const d={};return d.init=function(t){const a=t.uploadFormEl;if(a.length&&(a.attr("action",config.relative_path+t.route),t.dragDropAreaEl&&d.handleDragDrop({container:t.dragDropAreaEl,callback:function(g){d.ajaxSubmit({uploadForm:a,upload:g,callback:t.callback})}}),t.pasteEl&&d.handlePaste({container:t.pasteEl,callback:function(g){d.ajaxSubmit({uploadForm:a,upload:g,callback:t.callback})}}),t.uploadBtnEl)){const g=a.find('input[name="files[]"]');t.uploadBtnEl.on("click",function(){return g.trigger("click"),!1}),g.on("change",function(o){const s=(o.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);s&&d.ajaxSubmit({uploadForm:a,upload:{files:s,fileNames:Array.from(s).map(y=>y.name)},callback:t.callback})})}},d.handleDragDrop=function(t){let a=!1;const g=t.container,o=t.container.find(".imagedrop");g.on("dragenter",function(){a||(o.css("top","0px"),o.css("height",g.height()+"px"),o.css("line-height",g.height()+"px"),o.show(),o.on("dragleave",function(){o.hide(),o.off("dragleave")}))}),o.on("drop",function(c){c.preventDefault();const l=c.originalEvent.dataTransfer.files;if(l.length){let e;if(window.FormData){e=new FormData;for(var i=0;i<l.length;++i)e.append("files[]",l[i],l[i].name)}t.callback({files:l,formData:e})}return o.hide(),!1});function s(y){return y.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){a=!0}).off("dragend").on("dragend, mouseup",function(){a=!1}),o.on("dragover",s),o.on("dragenter",s)},d.handlePaste=function(t){t.container.on("paste",function(g){const o=(g.clipboardData||g.originalEvent.clipboardData||{}).items,s=[],y=[];let c=null;window.FormData&&(c=new FormData),[].forEach.call(o,function(l){const i=l.getAsFile();if(i){const e=utils.generateUUID()+"-"+i.name;c&&c.append("files[]",i,e),s.push(i),y.push(e)}}),s.length&&t.callback({files:s,fileNames:y,formData:c})})},d.ajaxSubmit=function(t){const a=[...t.upload.files];for(let o=0;o<a.length;++o){const s=a[o].type.match(/image./);if(s&&!app.user.privileges["upload:post:image"]||!s&&!app.user.privileges["upload:post:file"])return f.error("[[error:no-privileges]]");if(!app.user.isAdmin&&a[o].size>parseInt(config.maximumFileSize,10)*1024)return t.uploadForm[0].reset(),f.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const g=Date.now();t.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:t.upload.formData,error:function(o){let s=o.responseJSON&&(o.responseJSON.error||o.responseJSON.status&&o.responseJSON.status.message)||"[[error:parse-error]]";o&&o.status===413&&(s=o.statusText||"Request Entity Too Large"),f.error(s),f.remove(g)},uploadProgress:function(o,s,y,c){f.alert({alert_id:g,message:"[[modules:composer.uploading, "+c+"%]]"})},success:function(o){const s=o.response.images;if(s&&s.length)for(var y=0;y<s.length;++y)s[y].filename=a[y].name,s[y].isImage=/image./.test(a[y].type);t.callback(s)},complete:function(){t.uploadForm[0].reset(),setTimeout(f.remove,100,g)}}),!1}),t.uploadForm.submit()},d}.apply(x,v),E!==void 0&&(A.exports=E)},49897:(A,x,p)=>{p.r(x),p.d(x,{del:()=>i,get:()=>o,head:()=>s,patch:()=>c,post:()=>y,put:()=>l});var v=p(91749),E=p.n(v),f=p(33530),d=p.n(f);const t=config.relative_path+"/api/v3";async function a(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:t+e.url,typeof n=="function"){g(e).then(r=>n(null,r),r=>{let w=r;r instanceof Error||(w=new Error(String(r)));const u=w.message||String(w);if(u&&!u.startsWith("[[error:")&&(u.toLowerCase()==="fetch failed"||u.toLowerCase()==="failed to fetch"||u.toLowerCase().includes("networkerror")||u.toLowerCase().includes("network")&&u.toLowerCase().includes("failed"))){const h=new Error("[[error:no-connection]]");h.originalError=w,w=h}n(w)});return}try{return await g(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:w}=await(0,v.fire)("filter:admin.reauth",{url:"login"});return(0,f.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go(w)})}throw r}}async function g(e){const{url:n}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,v.fire)("filter:api.options",{options:e}))}catch(D){console.error("[API] Error in filter:api.options hook:",D)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(n,e)}catch(D){const k=D.message||D.toString()||String(D),b=D.name||"Error";if(b==="TypeError"&&(k.toLowerCase().includes("fetch")||k.toLowerCase().includes("network")||k.toLowerCase().includes("failed to fetch")||k.toLowerCase().includes("load failed"))||k.toLowerCase().includes("cors")||k.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:n,method:e.method||"GET",error:k,name:b});const I=new Error("[[error:no-connection]]");throw I.originalError=D,I}throw console.error("[API] Unexpected fetch error:",{url:n,method:e.method||"GET",error:k,name:b}),D}const{headers:w}=r;if(w.get("x-redirect"))return g({url:w.get("x-redirect"),...e});const u=w.get("content-type"),m=u&&u.startsWith("application/json");let h;if(e.method!=="HEAD")try{m?h=await r.json():h=await r.text()}catch(D){throw console.error("[API] Error parsing response:",{url:n,status:r.status,statusText:r.statusText,contentType:u,error:D.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let D;throw h?m&&h.status&&h.status.message?D=h.status.message:typeof h=="string"?D=h:D=r.statusText||"Request failed":D=r.statusText||"Request failed",new Error(D)}return m&&h&&h.hasOwnProperty("status")&&h.hasOwnProperty("response")?h.response:h}function o(e,n,r){return a({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},r)}function s(e,n,r){return a({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},r)}function y(e,n,r){return a({url:e,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function c(e,n,r){return a({url:e,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function l(e,n,r){return a({url:e,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function i(e,n,r){return a({url:e,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}},68636:(A,x,p)=>{var v;v=function(){function E(){this._store={},this._keys=[]}E.prototype.isMock=!0,E.prototype.setItem=function(t,a){t=String(t),this._keys.indexOf(t)===-1&&this._keys.push(t),this._store[t]=a},E.prototype.getItem=function(t){return t=String(t),this._keys.indexOf(t)===-1?null:this._store[t]},E.prototype.removeItem=function(t){t=String(t),this._keys=this._keys.filter(function(a){return a!==t}),this._store[t]=null},E.prototype.clear=function(){this._keys=[],this._store={}},E.prototype.key=function(t){return t=parseInt(t,10)||0,this._keys[t]},Object.defineProperty&&Object.defineProperty(E.prototype,"length",{get:function(){return this._keys.length}});let f;const d=Date.now().toString();try{if(f=window.localStorage,f.setItem(d,d),f.getItem(d)!==d)throw Error("localStorage behaved unexpectedly");return f.removeItem(d),f}catch(t){console.warn(t),console.warn("localStorage failed, falling back on sessionStorage");try{if(f=window.sessionStorage,f.setItem(d,d),f.getItem(d)!==d)throw Error("sessionStorage behaved unexpectedly");return f.removeItem(d),f}catch(a){return console.warn(a),console.warn("sessionStorage failed, falling back on memory storage"),new E}}}.call(x,p,x,A),v!==void 0&&(A.exports=v)},95692:(A,x,p)=>{var v,E;v=[p(52473),p(34405),p(49897),p(29930),p(43103),p(6411),p(68636),p(91749)],E=function(f,d,t,a,g,o,s,y){const c={_autocomplete:null};c.init=function(){const i=f.get("topic/quickreply/text"),e=`qr:draft:tid:${ajaxify.data.tid}`,n={element:i,strategies:[],options:{style:{"z-index":100}}};l(),$(window).one("action:ajaxify.start",()=>{l()}),$(window).trigger("composer:autocomplete:init",n),c._autocomplete=d.setup(n),o.bind("ctrl+return",u=>{u.target===i.get(0)&&f.get("topic/quickreply/button").get(0).click()}),g.init({uploadBtnEl:$('[component="topic/quickreply/upload/button"]'),dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:i,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:i,route:"/api/post/upload",callback:function(u){let m=i.val();u.forEach(h=>{m=m+(m?`
`:"")+(h.isImage?"!":"")+`[${h.filename}](${h.url})`}),i.val(m)}});let r=!0;f.get("topic/quickreply/button").on("click",function(u){if(u.preventDefault(),!r)return;const m=f.get("topic/quickreply/text").val(),h={tid:ajaxify.data.tid,handle:void 0,content:m},D=m.length;if(D<parseInt(config.minimumPostLength,10))return a.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(D>parseInt(config.maximumPostLength,10))return a.error("[[error:content-too-long, "+config.maximumPostLength+"]]");r=!1,t.post(`/topics/${ajaxify.data.tid}`,h,function(k,b){if(r=!0,k)return a.error(k);b&&b.queued&&a.alert({type:"success",title:"[[global:alert.success]]",message:b.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${b.id}`)}}),f.get("topic/quickreply/text").val(""),s.removeItem(e),c._autocomplete.hide(),y.fire("action:quickreply.success",{data:b})})});const w=s.getItem(e);w&&i.val(w),i.on("keyup",utils.debounce(function(){const u=i.val();u?s.setItem(e,u):s.removeItem(e)},1e3)),f.get("topic/quickreply/expand").on("click",u=>{u.preventDefault(),s.removeItem(e);const m=f.get("topic/quickreply/text");y.fire("action:composer.post.new",{tid:ajaxify.data.tid,title:ajaxify.data.titleRaw,body:m.val()}),m.val("")})};function l(){c._autocomplete&&(c._autocomplete.destroy(),c._autocomplete=null)}return c}.apply(x,v),E!==void 0&&(A.exports=E)}}]);
