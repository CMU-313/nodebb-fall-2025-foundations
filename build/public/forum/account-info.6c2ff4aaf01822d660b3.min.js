(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,50723,62648,97082],{18675:()=>{(function(g){var p=g(window),c=function(n,r,t,e){if(arguments.length===3||e){if(t<n)return n;if(t>r)return r}return t},h=function(n){n.clientX=n.originalEvent.touches[0].clientX,n.clientY=n.originalEvent.touches[0].clientY},s=function(n){var r=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(r){var t={width:0,height:0},e=new Image;return e.onload=function(){if(n.css("background-size")=="cover"){var o=n.innerWidth(),a=n.innerHeight(),i=o/a,u=e.width/e.height,d=1;u>=i?d=a/e.height:d=o/e.width,t.width=e.width*d,t.height=e.height*d}else t.width=e.width,t.height=e.height},e.src=r,t}};function m(n,r){this.element=n,this.options=r,this.init()}m.prototype.init=function(){var n=g(this.element),r=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t=this.options;if(r){var e={width:0,height:0};(t.bound||t.units=="percent")&&(e=s(n)),g(window).on("keydown.dbg",o=>{var a=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],i=parseInt(a[1])||0,u=parseInt(a[2])||0;t.units=="percent"&&(i=Math.round(i/-200*e.width),u=Math.round(u/-200*e.height));var d=0,l=0;return o.which===37?d=-5:o.which===39?d=5:o.which===38?l=-5:o.which===40&&(l=5),t.units==="percent"?(i=t.axis==="y"?i:c(-e.width/2,0,i+d,t.bound),u=t.axis==="x"?u:c(-e.height/2,0,u+l,t.bound),n.css("background-position",i/e.width*-200+"% "+u/e.height*-200+"%")):(i=t.axis==="y"?i:c(n.innerWidth()-e.width,0,i+d,t.bound),u=t.axis==="x"?u:c(n.innerHeight()-e.height,0,u+l,t.bound)),[37,38,39,40].includes(o.which)?!1:void 0}),n.on("mousedown.dbg touchstart.dbg",function(o){if(o.target===n[0]){if(o.preventDefault(),o.originalEvent.touches)h(o);else if(o.which!==1)return;var a=o.clientX,i=o.clientY,u=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],d=parseInt(u[1])||0,l=parseInt(u[2])||0;t.units=="percent"&&(d=Math.round(d/-200*e.width),l=Math.round(l/-200*e.height)),p.on("mousemove.dbg touchmove.dbg",function(y){y.preventDefault(),y.originalEvent.touches&&h(y);var x=y.clientX,A=y.clientY;t.units=="percent"?(d=t.axis==="y"?d:c(-e.width/2,0,d+x-a,t.bound),l=t.axis==="x"?l:c(-e.height/2,0,l+A-i,t.bound),n.css("background-position",d/e.width*-200+"% "+l/e.height*-200+"%")):(d=t.axis==="y"?d:c(n.innerWidth()-e.width,0,d+x-a,t.bound),l=t.axis==="x"?l:c(n.innerHeight()-e.height,0,l+A-i,t.bound),n.css("background-position",d+"px "+l+"px")),a=x,i=A}),p.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){t.done&&t.done(),p.off("mousemove.dbg touchmove.dbg"),p.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},m.prototype.disable=function(){var n=g(this.element);n.off("mousedown.dbg touchstart.dbg"),p.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},g.fn.backgroundDraggable=function(n){var r=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=g(this),e;typeof n>"u"||typeof n=="object"?(n=g.extend({},g.fn.backgroundDraggable.defaults,n),e=new m(this,n),t.data("dbg",e)):typeof n=="string"&&t.data("dbg")&&(e=t.data("dbg"),m.prototype[n].apply(e,r))})},g.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(g,p,c)=>{"use strict";var h,s;h=[c(81335),c(49897),c(33530),c(29930)],s=function(m,n,r,t){const e={};e.banAccount=function(a,i){a=a||ajaxify.data.theirid,o({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(u){const d=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;n.put("/users/"+a+"/ban",{until:d,reason:u.reason||""}).then(()=>{if(typeof i=="function")return i();ajaxify.refresh()}).catch(t.error)}})},e.unbanAccount=function(a){o({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(i){n.del("/users/"+a+"/ban",{reason:i.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})},e.muteAccount=function(a,i){a=a||ajaxify.data.theirid,o({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(u){const d=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;n.put("/users/"+a+"/mute",{until:d,reason:u.reason||""}).then(()=>{if(typeof i=="function")return i();ajaxify.refresh()}).catch(t.error)}})},e.unmuteAccount=function(a){o({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(i){n.del("/users/"+a+"/mute",{reason:i.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})};function o(a){m.render(a.tpl,{}).then(function(i){const u=r.dialog({title:a.title,message:i,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:a.title,callback:function(){const d=u.find("form").serializeArray().reduce(function(l,y){return l[y.name]=y.value,l},{});a.onSubmit(d)}}}})})}return e}.apply(p,h),s!==void 0&&(g.exports=s)},36684:(g,p,c)=>{"use strict";var h,s;h=[c(29930),c(18675)],s=function(m){const n={coverEl:null,saveFn:null};n.init=function(t,e,o,a){n.coverEl=t,n.saveFn=e,t.find(".upload").on("click",o),t.find(".resize").on("click",function(){r(t)}),t.find(".remove").on("click",a),t.on("dragover",n.onDragOver).on("drop",n.onDrop),t.find(".save").on("click",n.save),t.addClass("initialised")},n.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},n.onDrop=function(t){t.stopPropagation(),t.preventDefault();const e=t.originalEvent.dataTransfer.files,o=new FileReader;e.length&&e[0].type.match("image.*")&&(o.onload=function(a){n.coverEl.css("background-image","url("+a.target.result+")"),n.newCover=a.target.result},o.readAsDataURL(e[0]),r(n.coverEl))};function r(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),m.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return n.save=function(){n.coverEl.addClass("saving"),n.saveFn(n.newCover||void 0,n.coverEl.css("background-position"),function(t){t?m.error(t):(n.coverEl.toggleClass("active",0),n.coverEl.backgroundDraggable("disable"),n.coverEl.off("dragover",n.onDragOver),n.coverEl.off("drop",n.onDrop),m.success("[[modules:cover.saved]]")),n.coverEl.removeClass("saving")})},n}.apply(p,h),s!==void 0&&(g.exports=s)},41326:(g,p,c)=>{"use strict";var h,s;h=[c(67910),c(52473),c(49897),c(29930)],s=function(m,n,r,t){const e={};return e.init=function(){m.init(),e.prepareSessionRevocation()},e.prepareSessionRevocation=function(){n.get("user/sessions").on("click","[data-action]",function(){const o=$(this).parents("[data-uuid]"),a=o.attr("data-uuid");a&&r.del(`/users/${ajaxify.data.uid}/sessions/${a}`,{}).then(()=>{o.remove()}).catch(i=>{try{const u=JSON.parse(i.responseText);u.loggedIn===!1&&(window.location.href=config.relative_path+"/login?error="+u.title),t.error(u.title)}catch(u){console.error(u),t.error("[[error:invalid-data]]")}})})},e}.apply(p,h),s!==void 0&&(g.exports=s)},47283:(g,p,c)=>{"use strict";var h,s;h=[c(49897),c(33530),c(29930)],s=function(m,n,r){const t={};t.account=function(o,a){e(o,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",a)},t.content=function(o,a){e(o,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",a)},t.purge=function(o,a){e(o,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",a)};function e(o,a,i,u,d){n.confirm(a,function(l){l&&m.del(`/users/${encodeURIComponent(o)}${i}`,{}).then(()=>{if(r.success(u),typeof d=="function")return d()}).catch(r.error)})}return t}.apply(p,h),s!==void 0&&(g.exports=s)},48435:(g,p,c)=>{"use strict";var h,s;h=[c(67910),c(29930),c(41326)],s=function(m,n,r){const t={};t.init=function(){m.init(),e(),r.prepareSessionRevocation()};function e(){$('[component="account/save-moderation-note"]').on("click",function(){const o=$('[component="account/moderation-note"]'),a=o.val();socket.emit("user.setModerationNote",{uid:ajaxify.data.uid,note:a},function(i,u){if(i)return n.error(i);o.val(""),app.parseAndTranslate("account/info","moderationNotes",{moderationNotes:u},function(d){$('[component="account/moderation-note/list"]').prepend(d),d.find(".timeago").timeago()})})}),$('[component="account/moderation-note/edit"]').on("click",function(){const o=$(this).parents("[data-id]"),a=o.find('[component="account/moderation-note/content-area"]'),i=o.find('[component="account/moderation-note/edit-area"]');a.addClass("hidden"),i.removeClass("hidden"),i.find("textarea").trigger("focus").putCursorAtEnd()}),$('[component="account/moderation-note/save-edit"]').on("click",function(){const o=$(this).parents("[data-id]"),a=o.find('[component="account/moderation-note/content-area"]'),i=o.find('[component="account/moderation-note/edit-area"]');a.removeClass("hidden");const u=i.find("textarea");socket.emit("user.editModerationNote",{uid:ajaxify.data.uid,id:o.attr("data-id"),note:u.val()},function(d,l){if(d)return n.error(d);u.css({height:u.prop("scrollHeight")+"px"}),i.addClass("hidden"),a.find(".content").html(l[0].note)})}),$('[component="account/moderation-note/cancel-edit"]').on("click",function(){const o=$(this).parents("[data-id]"),a=o.find('[component="account/moderation-note/content-area"]'),i=o.find('[component="account/moderation-note/edit-area"]');a.removeClass("hidden"),i.addClass("hidden")}),$('[component="account/moderation-note/edit-area"] textarea').each((o,a)=>{const i=$(a);i.css({height:i.prop("scrollHeight")+"px"}).parent().addClass("hidden")})}return t}.apply(p,h),s!==void 0&&(g.exports=s)},67910:(g,p,c)=>{"use strict";var h,s;h=[c(36684),c(72254),c(52473),c(17459),c(47283),c(28061),c(7524),c(49897),c(33530),c(29930)],s=function(m,n,r,t,e,o,a,i,u,d){const l={};let y;l.init=function(){y=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,x(),A(),y&&D(),r.get("account/follow").on("click",()=>E("follow")),r.get("account/unfollow").on("click",()=>E("unfollow")),r.get("account/chat").on("click",async function(){const{roomId:f}=await i.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),v=await app.require("chat");f?v.openChat(f):v.newChat(ajaxify.data.uid)}),r.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){r.get("account/chat").parent().removeClass("hidden")})}),r.get("account/ban").on("click",()=>o.banAccount(ajaxify.data.theirid)),r.get("account/mute").on("click",()=>o.muteAccount(ajaxify.data.theirid)),r.get("account/unban").on("click",()=>o.unbanAccount(ajaxify.data.theirid)),r.get("account/unmute").on("click",()=>o.unmuteAccount(ajaxify.data.theirid)),r.get("account/delete-account").on("click",()=>e.account(ajaxify.data.theirid)),r.get("account/delete-content").on("click",()=>e.content(ajaxify.data.theirid)),r.get("account/delete-all").on("click",()=>e.purge(ajaxify.data.theirid)),r.get("account/flag").on("click",w),r.get("account/already-flagged").on("click",k),r.get("account/block").on("click",()=>C("block")),r.get("account/unblock").on("click",()=>C("unblock"))};function x(){$(".account-sub-links li a").removeClass("active").each(function(){const f=$(this).attr("href");if(decodeURIComponent(f)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function A(){$('[component="profile/change/picture"]').on("click",function(){return a.openChangeModal(),!1})}function D(){m.init(r.get("account/cover"),function(f,v,b){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:f,position:v},b)},function(){n.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(f){f=(f.startsWith("http")?"":config.relative_path)+f+"?"+Date.now(),r.get("account/cover").css("background-image","url("+f+")")})},R)}function E(f){const v=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return i[f==="follow"?"put":"del"]("/users/"+v+"/follow",void 0,function(b){if(b)return d.error(b);r.get("account/follow").toggleClass("hide",f==="follow"),r.get("account/unfollow").toggleClass("hide",f==="unfollow"),d.success("[[global:alert."+f+", "+ajaxify.data.username+"]]")}),!1}function w(){c.e(6574).then(function(){var f=[c(6574)];(function(v){v.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,f)}).catch(c.oe)}function k(){const f=$(this).data("flag-id");c.e(6574).then(function(){var v=[c(6574)];(function(b){u.confirm("[[flags:modal-confirm-rescind]]",function(j){j&&b.rescind(f)})}).apply(null,v)}).catch(c.oe)}function C(f){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:f},function(v,b){if(v)return d.error(v);r.get("account/block").toggleClass("hidden",b),r.get("account/unblock").toggleClass("hidden",!b)}),!1}function R(){t.translate("[[user:remove-cover-picture-confirm]]",function(f){u.confirm(f,function(v){v&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(b){b?d.error(b):ajaxify.refresh()})})})}return l}.apply(p,h),s!==void 0&&(g.exports=s)}}]);
