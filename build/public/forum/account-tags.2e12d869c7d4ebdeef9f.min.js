(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1852,4884,34405,97082],{18675:()=>{(function(p){var b=p(window),a=function(t,r,n,e){if(arguments.length===3||e){if(n<t)return t;if(n>r)return r}return n},v=function(t){t.clientX=t.originalEvent.touches[0].clientX,t.clientY=t.originalEvent.touches[0].clientY},f=function(t){var r=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(r){var n={width:0,height:0},e=new Image;return e.onload=function(){if(t.css("background-size")=="cover"){var i=t.innerWidth(),c=t.innerHeight(),s=i/c,u=e.width/e.height,o=1;u>=s?o=c/e.height:o=i/e.width,n.width=e.width*o,n.height=e.height*o}else n.width=e.width,n.height=e.height},e.src=r,n}};function y(t,r){this.element=t,this.options=r,this.init()}y.prototype.init=function(){var t=p(this.element),r=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],n=this.options;if(r){var e={width:0,height:0};(n.bound||n.units=="percent")&&(e=f(t)),p(window).on("keydown.dbg",i=>{var c=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],s=parseInt(c[1])||0,u=parseInt(c[2])||0;n.units=="percent"&&(s=Math.round(s/-200*e.width),u=Math.round(u/-200*e.height));var o=0,d=0;return i.which===37?o=-5:i.which===39?o=5:i.which===38?d=-5:i.which===40&&(d=5),n.units==="percent"?(s=n.axis==="y"?s:a(-e.width/2,0,s+o,n.bound),u=n.axis==="x"?u:a(-e.height/2,0,u+d,n.bound),t.css("background-position",s/e.width*-200+"% "+u/e.height*-200+"%")):(s=n.axis==="y"?s:a(t.innerWidth()-e.width,0,s+o,n.bound),u=n.axis==="x"?u:a(t.innerHeight()-e.height,0,u+d,n.bound)),[37,38,39,40].includes(i.which)?!1:void 0}),t.on("mousedown.dbg touchstart.dbg",function(i){if(i.target===t[0]){if(i.preventDefault(),i.originalEvent.touches)v(i);else if(i.which!==1)return;var c=i.clientX,s=i.clientY,u=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],o=parseInt(u[1])||0,d=parseInt(u[2])||0;n.units=="percent"&&(o=Math.round(o/-200*e.width),d=Math.round(d/-200*e.height)),b.on("mousemove.dbg touchmove.dbg",function(l){l.preventDefault(),l.originalEvent.touches&&v(l);var h=l.clientX,m=l.clientY;n.units=="percent"?(o=n.axis==="y"?o:a(-e.width/2,0,o+h-c,n.bound),d=n.axis==="x"?d:a(-e.height/2,0,d+m-s,n.bound),t.css("background-position",o/e.width*-200+"% "+d/e.height*-200+"%")):(o=n.axis==="y"?o:a(t.innerWidth()-e.width,0,o+h-c,n.bound),d=n.axis==="x"?d:a(t.innerHeight()-e.height,0,d+m-s,n.bound),t.css("background-position",o+"px "+d+"px")),c=h,s=m}),b.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){n.done&&n.done(),b.off("mousemove.dbg touchmove.dbg"),b.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},y.prototype.disable=function(){var t=p(this.element);t.off("mousedown.dbg touchstart.dbg"),b.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},p.fn.backgroundDraggable=function(t){var r=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=p(this),e;typeof t>"u"||typeof t=="object"?(t=p.extend({},p.fn.backgroundDraggable.defaults,t),e=new y(this,t),n.data("dbg",e)):typeof t=="string"&&n.data("dbg")&&(e=n.data("dbg"),y.prototype[t].apply(e,r))})},p.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(p,b,a)=>{"use strict";var v,f;v=[a(81335),a(49897),a(33530),a(29930)],f=function(y,t,r,n){const e={};e.banAccount=function(c,s){c=c||ajaxify.data.theirid,i({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(u){const o=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;t.put("/users/"+c+"/ban",{until:o,reason:u.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(n.error)}})},e.unbanAccount=function(c){i({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(s){t.del("/users/"+c+"/ban",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})},e.muteAccount=function(c,s){c=c||ajaxify.data.theirid,i({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(u){const o=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;t.put("/users/"+c+"/mute",{until:o,reason:u.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(n.error)}})},e.unmuteAccount=function(c){i({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(s){t.del("/users/"+c+"/mute",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})};function i(c){y.render(c.tpl,{}).then(function(s){const u=r.dialog({title:c.title,message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:c.title,callback:function(){const o=u.find("form").serializeArray().reduce(function(d,l){return d[l.name]=l.value,d},{});c.onSubmit(o)}}}})})}return e}.apply(b,v),f!==void 0&&(p.exports=f)},34405:(p,b,a)=>{"use strict";var v,f;v=[a(49897),a(29930),a(36e3),a(9787),a(35786)],f=function(y,t,{Textcomplete:r},{TextareaEditor:n},{ContenteditableEditor:e}){const i={},c={delay:200,appendTo:null};i.init=u=>{const o={...c,...u},{input:d,onSelect:l}=o;app.loadJQueryUI(function(){d.autocomplete({...o,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(h,m){s(d,l,h,m)}})})},i.user=function(u,o,d){typeof o=="function"&&(d=o,o={}),o=o||{},i.init({input:u,onSelect:d,source:(l,h)=>{o.query=l.term,y.get("/api/users",o,function(m,C){if(m)return t.error(m);if(C&&C.users){const w=C.users.map(function(E){const D=$("<div></div>").html(E.username).text();return E&&{label:D,value:D,user:{uid:E.uid,name:E.username,slug:E.userslug,username:E.username,userslug:E.userslug,displayname:E.displayname,picture:E.picture,banned:E.banned,"icon:text":E["icon:text"],"icon:bgColor":E["icon:bgColor"]}}});h(w)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},i.group=function(u,o){i.init({input:u,onSelect:o,source:(d,l)=>{socket.emit("groups.search",{query:d.term},function(h,m){if(h)return t.error(h);if(m&&m.length){const C=m.map(function(w){return w&&{label:w.name,value:w.name,group:w}});l(C)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},i.tag=function(u,o){i.init({input:u,onSelect:o,delay:100,source:(d,l)=>{socket.emit("topics.autocompleteTags",{query:d.term,cid:ajaxify.data.cid||0},function(h,m){if(h)return t.error(h);m&&l(m),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function s(u,o,d,l){o=o||function(){};const h=jQuery.Event("keypress");h.which=13,h.keyCode=13,setTimeout(function(){u.trigger(h)},100),o(d,l)}return i.setup=function({element:u,strategies:o,options:d}){const l=u.get(0);if(l){var h;if(l.nodeName==="TEXTAREA"||l.nodeName==="INPUT"?h=new n(l):l.nodeName==="DIV"&&l.getAttribute("contenteditable")==="true"&&(h=new e(l)),!h)throw new Error("unknown target element type");l.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var m=new r(h,o,{dropdown:d});return m.on("rendered",function(){m.dropdown.items.length&&m.dropdown.items[0].activate()}),m}},i}.apply(b,v),f!==void 0&&(p.exports=f)},36684:(p,b,a)=>{"use strict";var v,f;v=[a(29930),a(18675)],f=function(y){const t={coverEl:null,saveFn:null};t.init=function(n,e,i,c){t.coverEl=n,t.saveFn=e,n.find(".upload").on("click",i),n.find(".resize").on("click",function(){r(n)}),n.find(".remove").on("click",c),n.on("dragover",t.onDragOver).on("drop",t.onDrop),n.find(".save").on("click",t.save),n.addClass("initialised")},t.onDragOver=function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"},t.onDrop=function(n){n.stopPropagation(),n.preventDefault();const e=n.originalEvent.dataTransfer.files,i=new FileReader;e.length&&e[0].type.match("image.*")&&(i.onload=function(c){t.coverEl.css("background-image","url("+c.target.result+")"),t.newCover=c.target.result},i.readAsDataURL(e[0]),r(t.coverEl))};function r(n){n.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),y.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return t.save=function(){t.coverEl.addClass("saving"),t.saveFn(t.newCover||void 0,t.coverEl.css("background-position"),function(n){n?y.error(n):(t.coverEl.toggleClass("active",0),t.coverEl.backgroundDraggable("disable"),t.coverEl.off("dragover",t.onDragOver),t.coverEl.off("drop",t.onDrop),y.success("[[modules:cover.saved]]")),t.coverEl.removeClass("saving")})},t}.apply(b,v),f!==void 0&&(p.exports=f)},43930:(p,b,a)=>{"use strict";var v,f;v=[a(67910),a(29930),a(49897),a(91749),a(34405)],f=function(y,t,r,n,e){const i={};return i.init=function(){y.init();const c=$('[component="tags/watch"]');c.tagsinput({tagClass:"badge text-bg-info",confirmKeys:[13,44],trimValue:!0});const s=c.siblings(".bootstrap-tagsinput").find("input");s.translateAttr("aria-label","[[aria:user-watched-tags]]"),e.tag(s),ajaxify.data.tags.forEach(function(u){c.tagsinput("add",u)}),c.on("itemAdded",function(u){s.length&&s.autocomplete("close"),r.put(`/tags/${u.item}/follow`,{}).then(()=>{t.alert({alert_id:"follow_tag",message:"[[tags:following-tag.message]]",type:"success",timeout:5e3}),n.fire("action:tags.changeWatching",{tag:ajaxify.data.tag,type:"follow"})}).catch(o=>t.error(o))}),c.on("itemRemoved",function(u){r.del(`/tags/${u.item}/follow`,{}).then(()=>{t.alert({alert_id:"follow_tag",message:"[[tags:not-following-tag.message]]",type:"info",timeout:5e3}),n.fire("action:tags.changeWatching",{tag:ajaxify.data.tag,type:"unfollow"})}).catch(o=>t.error(o))})},i}.apply(b,v),f!==void 0&&(p.exports=f)},47283:(p,b,a)=>{"use strict";var v,f;v=[a(49897),a(33530),a(29930)],f=function(y,t,r){const n={};n.account=function(i,c){e(i,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",c)},n.content=function(i,c){e(i,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",c)},n.purge=function(i,c){e(i,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",c)};function e(i,c,s,u,o){t.confirm(c,function(d){d&&y.del(`/users/${encodeURIComponent(i)}${s}`,{}).then(()=>{if(r.success(u),typeof o=="function")return o()}).catch(r.error)})}return n}.apply(b,v),f!==void 0&&(p.exports=f)},67910:(p,b,a)=>{"use strict";var v,f;v=[a(36684),a(72254),a(52473),a(17459),a(47283),a(28061),a(7524),a(49897),a(33530),a(29930)],f=function(y,t,r,n,e,i,c,s,u,o){const d={};let l;d.init=function(){l=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,h(),m(),l&&C(),r.get("account/follow").on("click",()=>w("follow")),r.get("account/unfollow").on("click",()=>w("unfollow")),r.get("account/chat").on("click",async function(){const{roomId:g}=await s.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),x=await app.require("chat");g?x.openChat(g):x.newChat(ajaxify.data.uid)}),r.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){r.get("account/chat").parent().removeClass("hidden")})}),r.get("account/ban").on("click",()=>i.banAccount(ajaxify.data.theirid)),r.get("account/mute").on("click",()=>i.muteAccount(ajaxify.data.theirid)),r.get("account/unban").on("click",()=>i.unbanAccount(ajaxify.data.theirid)),r.get("account/unmute").on("click",()=>i.unmuteAccount(ajaxify.data.theirid)),r.get("account/delete-account").on("click",()=>e.account(ajaxify.data.theirid)),r.get("account/delete-content").on("click",()=>e.content(ajaxify.data.theirid)),r.get("account/delete-all").on("click",()=>e.purge(ajaxify.data.theirid)),r.get("account/flag").on("click",E),r.get("account/already-flagged").on("click",D),r.get("account/block").on("click",()=>j("block")),r.get("account/unblock").on("click",()=>j("unblock"))};function h(){$(".account-sub-links li a").removeClass("active").each(function(){const g=$(this).attr("href");if(decodeURIComponent(g)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function m(){$('[component="profile/change/picture"]').on("click",function(){return c.openChangeModal(),!1})}function C(){y.init(r.get("account/cover"),function(g,x,A){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:g,position:x},A)},function(){t.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(g){g=(g.startsWith("http")?"":config.relative_path)+g+"?"+Date.now(),r.get("account/cover").css("background-image","url("+g+")")})},R)}function w(g){const x=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return s[g==="follow"?"put":"del"]("/users/"+x+"/follow",void 0,function(A){if(A)return o.error(A);r.get("account/follow").toggleClass("hide",g==="follow"),r.get("account/unfollow").toggleClass("hide",g==="unfollow"),o.success("[[global:alert."+g+", "+ajaxify.data.username+"]]")}),!1}function E(){a.e(6574).then(function(){var g=[a(6574)];(function(x){x.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,g)}).catch(a.oe)}function D(){const g=$(this).data("flag-id");a.e(6574).then(function(){var x=[a(6574)];(function(A){u.confirm("[[flags:modal-confirm-rescind]]",function(k){k&&A.rescind(g)})}).apply(null,x)}).catch(a.oe)}function j(g){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:g},function(x,A){if(x)return o.error(x);r.get("account/block").toggleClass("hidden",A),r.get("account/unblock").toggleClass("hidden",!A)}),!1}function R(){n.translate("[[user:remove-cover-picture-confirm]]",function(g){u.confirm(g,function(x){x&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(A){A?o.error(A):ajaxify.refresh()})})})}return d}.apply(b,v),f!==void 0&&(p.exports=f)}}]);
