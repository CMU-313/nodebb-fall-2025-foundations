"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,37147,49897,99127],{49897:(T,E,u)=>{u.r(E),u.d(E,{del:()=>o,get:()=>w,head:()=>k,patch:()=>P,post:()=>p,put:()=>s});var f=u(91749),m=u.n(f),g=u(33530),L=u.n(g);const C=config.relative_path+"/api/v3";async function l(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:C+e.url,typeof t=="function"){d(e).then(r=>t(null,r),r=>{let i=r;r instanceof Error||(i=new Error(String(r)));const c=i.message||String(i);if(c&&!c.startsWith("[[error:")&&(c.toLowerCase()==="fetch failed"||c.toLowerCase()==="failed to fetch"||c.toLowerCase().includes("networkerror")||c.toLowerCase().includes("network")&&c.toLowerCase().includes("failed"))){const n=new Error("[[error:no-connection]]");n.originalError=i,i=n}t(i)});return}try{return await d(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,g.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(i)})}throw r}}async function d(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,f.fire)("filter:api.options",{options:e}))}catch(a){console.error("[API] Error in filter:api.options hook:",a)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(a){const h=a.message||a.toString()||String(a),A=a.name||"Error";if(A==="TypeError"&&(h.toLowerCase().includes("fetch")||h.toLowerCase().includes("network")||h.toLowerCase().includes("failed to fetch")||h.toLowerCase().includes("load failed"))||h.toLowerCase().includes("cors")||h.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:h,name:A});const v=new Error("[[error:no-connection]]");throw v.originalError=a,v}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:h,name:A}),a}const{headers:i}=r;if(i.get("x-redirect"))return d({url:i.get("x-redirect"),...e});const c=i.get("content-type"),y=c&&c.startsWith("application/json");let n;if(e.method!=="HEAD")try{y?n=await r.json():n=await r.text()}catch(a){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:c,error:a.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let a;throw n?y&&n.status&&n.status.message?a=n.status.message:typeof n=="string"?a=n:a=r.statusText||"Request failed":a=r.statusText||"Request failed",new Error(a)}return y&&n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n}function w(e,t,r){return l({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function k(e,t,r){return l({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function p(e,t,r){return l({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function P(e,t,r){return l({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function s(e,t,r){return l({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function o(e,t,r){return l({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}},53309:(T,E,u)=>{var f,m;f=[u(52473),u(49897),u(29930)],m=function(g,L,C){const l={};let d=[];l.init=function(s){s=s||{},d.length=0,g.get("chat/search").on("keyup",utils.debounce(k,250));const o=$('[component="chat/search/list"]');o.on("click","[data-uid]",function(){s.onSelect&&s.onSelect(d.find(e=>String(e.uid)===String($(this).attr("data-uid")))),w(o)})};function w(s){g.get("chat/search").val(""),p(s),s.find('[component="chat/search/no-users"]').addClass("hidden"),s.find('[component="chat/search/start-typing"]').removeClass("hidden")}function k(){const s=$('[component="chat/search/list"]'),o=g.get("chat/search").val();if(!o)return w(s);s.find('[component="chat/search/start-typing"]').addClass("hidden"),L.get("/api/users",{query:o,searchBy:"username",paginate:!1}).then(P).catch(C.error)}function p(s){d.length=0,s.find("[data-uid]").remove()}async function P(s){const o=$('[component="chat/search/list"]');if(p(o),s.users=s.users.filter(function(t){return parseInt(t.uid,10)!==parseInt(app.user.uid,10)}),d=s.users,!s.users.length)return o.find('[component="chat/search/no-users"]').removeClass("hidden");o.find('[component="chat/search/no-users"]').addClass("hidden");const e=await app.parseAndTranslate("modals/create-room","searchUsers",{searchUsers:s.users});o.append(e),o.parent().toggleClass("show",!0)}return l}.apply(E,f),m!==void 0&&(T.exports=m)}}]);
