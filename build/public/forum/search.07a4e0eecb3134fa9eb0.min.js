"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,26174,26874,34271,48201,49897,51831,69185,69749,87212,92717,99127],{13230:(I,k,g)=>{var E,m,v;(function(w){m=[g(53050)],E=w,v=typeof E=="function"?E.apply(k,m):E,v!==void 0&&(I.exports=v)})(function(w){const d=w("[^\\p{L}\\s\\d\\-_@.]","g"),x=/[^\w\s\d\-_@.]/g,b=/^\s+|\s+$/g,r=/\s+/g,o=/-+/g,f=/-$/g,n=/^-/g,l=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(b,""),l.test(e)?e=e.replace(x,"-"):e=w.replace(e,d,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(r,"-"),e=e.replace(o,"-"),e=e.replace(f,""),e=e.replace(n,""),e):""}})},39259:(I,k,g)=>{var E,m;E=[g(96349),g(49897),g(91749)],m=function(v,w,d){const x={};x.init=function(r,o){if(!r||!r.length)return;o=o||{},o.states=o.states||["watching","tracking","notwatching","ignoring"],o.template=o.template||"partials/category/filter-dropdown-left",d.fire("action:category.filter.options",{el:r,options:o}),v.init(r,o);let f=[],n=[];Array.isArray(o.selectedCids)?f=o.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(f=ajaxify.data.selectedCids.map(String)),n=f.slice(),r.on("hidden.bs.dropdown",function(){let l=n.length!==f.length;if(n.forEach(function(i,e){i!==f[e]&&(l=!0)}),n=f.slice(),l&&(o.updateButton?o.updateButton({el:r,changed:l,selectedCids:f.slice()}):o.updateButton!==!1&&b(r,f)),o.onHidden){o.onHidden({changed:l,selectedCids:f.slice()});return}if(l){let i=window.location.pathname;const e=utils.params();f.length?e.cid=f:delete e.cid,delete e.page,Object.keys(e).length&&(i+="?"+$.param(e)),ajaxify.go(i)}}),r.on("click",'[component="category/list"] [data-cid]',function(l){const i=r.find('[component="category/list"]'),e=$(this),t=e.find("a").attr("href");if(t&&t!=="#"&&t.length){l.stopPropagation();return}const s=e.attr("data-cid"),u=e.find('[component="category/select/icon"]');return s!=="all"?(f.includes(s)?f.splice(f.indexOf(s),1):f.push(s),f.sort(function(h,A){return h-A}),u.toggleClass("invisible"),i.find('[data-cid="all"] i').toggleClass("invisible",!!f.length)):(r.find('[component="category/select/icon"]').addClass("invisible"),i.find('[data-cid="all"] i').removeClass("invisible"),f=[]),o.selectedCids=f,o.onSelect&&o.onSelect({cid:s,selectedCids:f.slice()}),!1})};function b(r,o){o.length>1?f({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):o.length===1?w.get(`/categories/${o[0]}`,{}).then(f):f();function f(n){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:n},function(l){r.find("button").replaceWith($("<div/>").html(l).find("button"))})}}return x}.apply(k,E),m!==void 0&&(I.exports=m)},49897:(I,k,g)=>{g.r(k),g.d(k,{del:()=>i,get:()=>r,head:()=>o,patch:()=>n,post:()=>f,put:()=>l});var E=g(91749),m=g.n(E),v=g(33530),w=g.n(v);const d=config.relative_path+"/api/v3";async function x(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:d+e.url,typeof t=="function"){b(e).then(s=>t(null,s),s=>{let u=s;s instanceof Error||(u=new Error(String(s)));const h=u.message||String(u);if(h&&!h.startsWith("[[error:")&&(h.toLowerCase()==="fetch failed"||h.toLowerCase()==="failed to fetch"||h.toLowerCase().includes("networkerror")||h.toLowerCase().includes("network")&&h.toLowerCase().includes("failed"))){const y=new Error("[[error:no-connection]]");y.originalError=u,u=y}t(u)});return}try{return await b(e)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again."){const{url:u}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",h=>{h&&ajaxify.go(u)})}throw s}}async function b(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(C){console.error("[API] Error in filter:api.options hook:",C)}e.data&&(e.body=e.data,delete e.data);let s;try{s=await fetch(t,e)}catch(C){const O=C.message||C.toString()||String(C),S=C.name||"Error";if(S==="TypeError"&&(O.toLowerCase().includes("fetch")||O.toLowerCase().includes("network")||O.toLowerCase().includes("failed to fetch")||O.toLowerCase().includes("load failed"))||O.toLowerCase().includes("cors")||O.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:O,name:S});const P=new Error("[[error:no-connection]]");throw P.originalError=C,P}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:O,name:S}),C}const{headers:u}=s;if(u.get("x-redirect"))return b({url:u.get("x-redirect"),...e});const h=u.get("content-type"),A=h&&h.startsWith("application/json");let y;if(e.method!=="HEAD")try{A?y=await s.json():y=await s.text()}catch(C){throw console.error("[API] Error parsing response:",{url:t,status:s.status,statusText:s.statusText,contentType:h,error:C.message}),new Error("[[error:invalid-json]]")}if(!s.ok){let C;throw y?A&&y.status&&y.status.message?C=y.status.message:typeof y=="string"?C=y:C=s.statusText||"Request failed":C=s.statusText||"Request failed",new Error(C)}return A&&y&&y.hasOwnProperty("status")&&y.hasOwnProperty("response")?y.response:y}function r(e,t,s){return x({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},s)}function o(e,t,s){return x({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},s)}function f(e,t,s){return x({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},s)}function n(e,t,s){return x({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},s)}function l(e,t,s){return x({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},s)}function i(e,t,s){return x({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},s)}},64308:(I,k,g)=>{var E,m;E=[g(49897),g(91749),g(13230),g(81335)],m=function(v,w,d,x){const b={};return b.init=function(r,o){if(!r||!r.length)return;o=o||{};let f,n=[];o.selectedUsers&&(n=o.selectedUsers.map(t=>({...t}))),w.fire("action:user.filter.options",{el:r,options:o});async function l(){const t=o.selectedBlock||"userFilterSelected",s={};if(t.indexOf(".")!==-1){const h=t.split(".");s[h[0]]={},s[h[0]][h[1]]=n}else s[t]=n;const u=await app.parseAndTranslate(o.template,t,s);r.find('[component="user/filter/selected"]').html(u)}async function i(){await l(),o.onSelect&&o.onSelect(n)}async function e(){let t={users:[]};const s=r.find('[component="user/filter/search"]').val();if(s&&s.length>1)if(app.user.privileges["search:users"])t=await v.get("/api/users",{query:s});else try{const A=await v.get(`/api/user/${d(s)}`);t.users.push(A)}catch(A){console.error(A)}if(!t.users.length){r.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}t.users=t.users.slice(0,20);const u={};t.users.forEach(A=>{u[A.uid]=A});const h=await app.parseAndTranslate(o.template,"userFilterResults",{userFilterResults:t.users});r.find('[component="user/filter/results"]').html(h),r.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const A=parseInt($(this).attr("data-uid"),10);n.find(y=>y.uid===A)||(n.push(u[A]),await i())})}r.find('[component="user/filter/search"]').on("keyup",()=>{r.find('[component="user/filter/results"]').html(f)}),r.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),r.on("click",'[component="user/filter/delete"]',async function(){const t=$(this).attr("data-uid");n=n.filter(s=>parseInt(s.uid,10)!==parseInt(t,10)),await i()}),r.find('[component="user/filter/search"]').on("keyup",t=>{t.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),r.on("shown.bs.dropdown",function(){r.find('[component="user/filter/search"]').trigger("focus")}),r.on("hidden.bs.dropdown",function(){o.onHidden&&o.onHidden(n)}),x.render(o.placeholderTemplate||"partials/userFilter-placeholders").then(t=>{f=t})},b}.apply(k,E),m!==void 0&&(I.exports=m)},68636:(I,k,g)=>{var E;E=function(){function m(){this._store={},this._keys=[]}m.prototype.isMock=!0,m.prototype.setItem=function(d,x){d=String(d),this._keys.indexOf(d)===-1&&this._keys.push(d),this._store[d]=x},m.prototype.getItem=function(d){return d=String(d),this._keys.indexOf(d)===-1?null:this._store[d]},m.prototype.removeItem=function(d){d=String(d),this._keys=this._keys.filter(function(x){return x!==d}),this._store[d]=null},m.prototype.clear=function(){this._keys=[],this._store={}},m.prototype.key=function(d){return d=parseInt(d,10)||0,this._keys[d]},Object.defineProperty&&Object.defineProperty(m.prototype,"length",{get:function(){return this._keys.length}});let v;const w=Date.now().toString();try{if(v=window.localStorage,v.setItem(w,w),v.getItem(w)!==w)throw Error("localStorage behaved unexpectedly");return v.removeItem(w),v}catch(d){console.warn(d),console.warn("localStorage failed, falling back on sessionStorage");try{if(v=window.sessionStorage,v.setItem(w,w),v.getItem(w)!==w)throw Error("sessionStorage behaved unexpectedly");return v.removeItem(w),v}catch(x){return console.warn(x),console.warn("sessionStorage failed, falling back on memory storage"),new m}}}.call(k,g,k,I),E!==void 0&&(I.exports=E)},69749:(I,k,g)=>{var E,m;E=[g(17459),g(68636),g(91749),g(29930),g(89336)],m=function(v,w,d,x,b){const r={current:{}};r.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((i,e)=>{o($(e),n)})};function o(n,l){const i=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),s=e.find("#quick-search-container"),u=e.hasClass("hidden"),h=/^(@|acct:)?[\w-]+@.+$/;u&&e.off("focusout").on("focusout",function(){setTimeout(function(){e.find(":focus").length||(e.addClass("hidden"),i.removeClass("hidden"))},200)}),t.off("focus");const A={inputEl:t,resultEl:s};r.enableQuickSearch({searchOptions:l,searchElements:A}),i.off("click").on("click",function(y){return!config.loggedIn&&!app.user.privileges["search:content"]?(x.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(y.stopPropagation(),r.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const y=$(this).find('input[name="query"]'),C=r.getSearchPreferences();return C.term=y.val(),C.in=l.in,h.test(C.term)&&(C.in="users"),d.fire("action:search.submit",{searchOptions:C,searchElements:A}),r.query(C,function(){y.val(""),t.trigger("blur")}),!1})}r.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const l=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),i=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const s=i.find(".filter-category");function u(){ajaxify.data.template.category&&ajaxify.data.cid&&v.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(S){const T=$("<div></div>").html(S).text();s.find(".name").text(T)}),s.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function h(){n.searchOptions=Object.assign({},l),n.searchOptions.term=e.val(),u(),ajaxify.data.template.category&&ajaxify.data.cid&&s.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(i.removeClass("hidden").find(".quick-search-results-container").html(""),i.find(".loading-indicator").removeClass("hidden")),d.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,r.api(n.searchOptions,function(S){if(i.find(".loading-indicator").addClass("hidden"),n.searchOptions.in==="categories"){if(!S.categories||n.hideOnNoMatches&&!S.categories.length)return i.addClass("hidden").find(".quick-search-results-container").html("");S.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-category-search-results",S,T=>{T.length&&T.find(".timeago").timeago(),i.toggleClass("hidden",!T.length||!e.is(":focus")).find(".quick-search-results-container").html(T.length?T:""),d.fire("action:search.quick.complete",{data:S,options:n})})}else{if(!S.posts||n.hideOnNoMatches&&!S.posts.length)return i.addClass("hidden").find(".quick-search-results-container").html("");S.posts.forEach(function(T){const P=$("<div>"+T.content+"</div>").text(),R=e.val().toLowerCase().replace(/^in:topic-\d+/,""),c=Math.max(0,P.toLowerCase().indexOf(R)-40);T.snippet=utils.escapeHTML((c>0?"...":"")+P.slice(c,c+80)+(P.length-c>80?"...":""))}),S.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-search-results",S,function(T){T.length&&T.find(".timeago").timeago(),i.toggleClass("hidden",!T.length||!e.is(":focus")).find(".quick-search-results-container").html(T.length?T:"");const P=i.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");r.highlightMatches(n.searchOptions.term,P),d.fire("action:search.quick.complete",{data:S,options:n})})}})}i.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),h()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){i.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return i.addClass("hidden");h()}},500)),i.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){i.addClass("hidden")})});const A=e.parent(),y=i.parent();A.on("focusout",C),y.on("focusout",C);function C(){setTimeout(function(){!A.find(":focus").length&&!y.find(":focus").length&&!i.hasClass("hidden")&&i.addClass("hidden")},200)}let O=!1;d.on("action:ajaxify.end",function(){ajaxify.isCold()||(O=!0),i.addClass("hidden")}),e.on("focus",function(){const S=e.val();t=S,S&&i.find("#quick-search-results").children().length&&(u(),O?(h(),O=!1):i.removeClass("hidden"),e[0].setSelectionRange(S.startsWith("in:topic")?S.indexOf(" ")+1:0,S.length))}),e.off("refresh").on("refresh",function(){h()})},r.showAndFocusInput=function(n){const l=n.parents(".dropdown-menu");if(l.length){const i=l.siblings("[data-bs-toggle]"),e=b.Dropdown.getOrCreateInstance(i[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},r.query=function(n,l){l=l||function(){},ajaxify.go("search?"+f(n),l)},r.api=function(n,l){const i=config.relative_path+"/api/search?"+f(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+f(n);$.get(i,function(t){t.url=e,l(t)})};function f(n){const l=n.in||"titles",i=n.term.replace(/^[ ?#]*/,""),e={...n,term:i,in:l};return d.fire("action:search.createQueryString",{query:e,data:n}),$.param(e)}return r.getSearchPreferences=function(){try{return JSON.parse(w.getItem("search-preferences")||"{}")}catch(n){return console.error(n),{}}},r.highlightMatches=function(n,l){if(!n||!l.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const i=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+i+")","gi");l.each(function(){const t=$(this),s=[];t.find("*").each(function(){$(this).after("<!-- "+s.length+" -->"),s.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(u,h){return'<strong class="search-match fw-bold text-decoration-underline">'+h+"</strong>"})),s.forEach(function(u,h){t.html(t.html().replace("<!-- "+h+" -->",function(){return u.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},r}.apply(k,E),m!==void 0&&(I.exports=m)},70187:(I,k,g)=>{var E,m;E=[g(69749),g(68636),g(91749),g(29930),g(49897),g(17459),g(39259),g(64308)],m=function(v,w,d,x,b,r,o,f){const n={};let l=[],i=[],e=[],t={};n.init=function(){const c=$("#search-in");c.on("change",function(){C(c.val())});const p=$("#results").attr("data-search-query");v.highlightMatches(p,$(".search-results .content p, .search-results .topic-title")),$("#advanced-search form").off("submit").on("submit",function(a){return a.preventDefault(),v.query(y()),!1}),S(),T(ajaxify.data.selectedCids),P($('[component="user/filter"]'),ajaxify.data.userFilterSelected),R($('[component="tag/filter"]'),ajaxify.data.tagFilterSelected),$('[component="search/filters"]').on("hidden.bs.dropdown",".dropdown",function(){const a={replies:A,time:u,sort:h,tag:s};a[$(this).attr("data-filter-name")]&&a[$(this).attr("data-filter-name")]();const F=y();JSON.stringify(t)!==JSON.stringify(F)&&(t=F,v.query(t))}),O(),u(),A(),h(),t=y()};function s(){const c=i.length>0;let p="[[search:tags]]";i.length&&(p=r.compile("search:tags-x",i.map(a=>a.value).join(", "))),$('[component="tag/filter/button"]').toggleClass("active-filter",c).find(".filter-label").translateHtml(p)}function u(){const c=$("#post-time-range").val()>0;$("#post-time-button").toggleClass("active-filter",c).find(".filter-label").translateText(c?`[[search:time-${$("#post-time-filter").val()}-than-${$("#post-time-range").val()}]]`:"[[search:time]]")}function h(){const c=$("#post-sort-by").val()!=="relevance"||$("#post-sort-direction").val()!=="desc";$("#sort-by-button").toggleClass("active-filter",c).find(".filter-label").translateText(c?`[[search:sort-by-${$("#post-sort-by").val()}-${$("#post-sort-direction").val()}]]`:"[[search:sort]]")}function A(){const c=$("#reply-count").val()>0;$("#reply-count-button").toggleClass("active-filter",c).find(".filter-label").translateText(c?`[[search:replies-${$("#reply-count-filter").val()}-count, ${$("#reply-count").val()}]]`:"[[search:replies]]")}function y(){const c=$("#advanced-search"),p={in:$("#search-in").val()};return p.term=$("#search-input").val(),["posts","titlesposts","titles","bookmarks"].includes(p.in)&&(p.matchWords=c.find("#match-words-filter").val(),p.by=l.length?l.map(a=>a.username):void 0,p.categories=e.length?e:void 0,p.searchChildren=c.find("#search-children").is(":checked"),p.hasTags=i.length?i.map(a=>a.value):void 0,p.replies=c.find("#reply-count").val(),p.repliesFilter=c.find("#reply-count-filter").val(),p.timeFilter=c.find("#post-time-filter").val(),p.timeRange=c.find("#post-time-range").val(),p.sortBy=c.find("#post-sort-by").val(),p.sortDirection=c.find("#post-sort-direction").val(),p.showAs=c.find("#show-results-as").val()),d.fire("action:search.getSearchDataFromDOM",{form:c,data:p}),p}function C(c){const p=!["posts","titles","bookmarks"].some(a=>c.includes(a));$(".post-search-item").toggleClass("hidden",p)}function O(){const c=utils.params({disableToType:!0}),p=v.getSearchPreferences(),a=utils.merge(p,c);a&&(ajaxify.data.term&&$("#search-input").val(ajaxify.data.term),a.in=a.in||ajaxify.data.searchDefaultIn,$("#search-in").val(a.in),C(a.in),a.matchWords&&$("#match-words-filter").val(a.matchWords),a.showAs&&$("#show-results-as").val(a.showAs),a.by&&(a.by=Array.isArray(a.by)?a.by:[a.by],a.by.forEach(function(F){$("#posted-by-user").tagsinput("add",F)})),a.categories&&$("#posted-in-categories").val(a.categories),a.searchChildren&&$("#search-children").prop("checked",!0),a.hasTags&&(a.hasTags=Array.isArray(a.hasTags)?a.hasTags:[a.hasTags],a.hasTags.forEach(function(F){$("#has-tags").tagsinput("add",F)})),a.replies&&($("#reply-count").val(a.replies),$("#reply-count-filter").val(a.repliesFilter)),a.timeRange&&($("#post-time-range").val(a.timeRange),$("#post-time-filter").val(a.timeFilter)),(a.sortBy||ajaxify.data.searchDefaultSortBy)&&$("#post-sort-by").val(a.sortBy||ajaxify.data.searchDefaultSortBy),$("#post-sort-direction").val(a.sortDirection||"desc"),d.fire("action:search.fillOutForm",{form:a}))}function S(){$("#save-preferences").on("click",function(){const c=y(),p=["matchWords","in","showAs","replies","repliesFilter","timeFilter","timeRange","sortBy","sortDirection"],a={};return p.forEach(F=>{a[F]=c[F]}),w.setItem("search-preferences",JSON.stringify(a)),x.success("[[search:search-preferences-saved]]"),!1}),$("#clear-preferences").on("click",async function(){w.removeItem("search-preferences");const c=await app.parseAndTranslate("partials/search-filters",{});return $('[component="search/filters"]').replaceWith(c),$("#search-in").val(ajaxify.data.searchDefaultIn),$("#post-sort-by").val(ajaxify.data.searchDefaultSortBy),$("#match-words-filter").val("all"),$("#show-results-as").val("posts"),P($('[component="user/filter"]'),[]),R($('[component="tag/filter"]'),[]),T([]),x.success("[[search:search-preferences-cleared]]"),!1})}function T(c){ajaxify.data.allCategoriesUrl="",e=c||[];const p=$('[component="category/filter"]');o.init(p,{selectedCids:c,updateButton:!1,onHidden:async function(a){const F=a.selectedCids.length>0&&a.selectedCids[0]!=="all";let L="[[search:categories]]";if(ajaxify.data.selectedCids=a.selectedCids,e=a.selectedCids,a.selectedCids.length===1&&a.selectedCids[0]==="watched")ajaxify.data.selectedCategory={cid:"watched"},L="[[search:categories-watched-categories]]";else if(a.selectedCids.length===1&&a.selectedCids[0]==="all")ajaxify.data.selectedCategory=null;else if(a.selectedCids.length>0){const D=await b.get(`/categories/${a.selectedCids[0]}`);ajaxify.data.selectedCategory=D,L=`[[search:categories-x, ${D.name}]]`}a.selectedCids.length>1&&(L=`[[search:categories-x, ${a.selectedCids.length}]]`),$('[component="category/filter/button"]').toggleClass("active-filter",F).find(".filter-label").translateText(L)},localCategories:[{cid:"watched",name:"[[category:watched-categories]]",icon:""}]})}function P(c,p){l=p||[],f.init(c,{selectedUsers:p,template:"partials/search-filters",onSelect:function(a){l=a},onHidden:function(a){const F=a.length>0;let L="[[search:posted-by]]";F&&(L=r.compile("search:posted-by-usernames",l.map(D=>D.username).join(", "))),c.find('[component="user/filter/button"]').toggleClass("active-filter",F).find(".filter-label").translateText(L)}})}function R(c,p){i=p;async function a(){const D=await app.parseAndTranslate("partials/search-filters","tagFilterSelected",{tagFilterSelected:i});c.find('[component="tag/filter/selected"]').html(D)}function F(D){const j=utils.escapeHTML(D);return{value:D,valueEscaped:j,valueEncoded:encodeURIComponent(D),class:j.replace(/\s/g,"-")}}async function L(){let D={tags:[]};const j=c.find('[component="tag/filter/search"]').val();if(j&&j.length>1&&(app.user.privileges["search:tags"]?D=await socket.emit("topics.searchAndLoadTags",{query:j}):D={tags:[F(j)]}),!D.tags.length){c.find('[component="tag/filter/results"]').translateHtml("[[tags:no-tags-found]]");return}D.tags=D.tags.slice(0,20);const M={};D.tags.forEach(B=>{M[B.value]=B});const _=await app.parseAndTranslate("partials/search-filters","tagFilterResults",{tagFilterResults:D.tags});c.find('[component="tag/filter/results"]').html(_),c.find('[component="tag/filter/results"] [data-tag]').on("click",async function(){i.push(M[$(this).attr("data-tag")]),a()})}c.find('[component="tag/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:tags"]&&L()},1e3)),c.on("click",'[component="tag/filter/delete"]',function(){const D=$(this).attr("data-tag");i=i.filter(j=>j.value!==D),a()}),c.find('[component="tag/filter/search"]').on("keyup",D=>{if(D.key==="Enter"&&!app.user.privileges["search:tags"]){const j=c.find('[component="tag/filter/search"]').val();j&&i.every(M=>M.value!==j)&&(i.push(F(j)),a()),c.find('[component="tag/filter/search"]').val("")}}),c.on("shown.bs.dropdown",function(){c.find('[component="tag/filter/search"]').trigger("focus")})}return n}.apply(k,E),m!==void 0&&(I.exports=m)},96349:(I,k,g)=>{var E,m;E=[g(29930),g(89336),g(49897)],m=function(v,w,d){const x={};return x.init=function(b,r){let o=r.defaultCategories||null;r=r||{},r.privilege=r.privilege||"topics:read",r.states=r.states||["watching","tracking","notwatching","ignoring"],r.cacheList=r.hasOwnProperty("cacheList")?r.cacheList:!0;let f=[];Array.isArray(r.localCategories)&&(f=r.localCategories.map(t=>({...t})),o&&(o=[...f,...o])),r.selectedCids=r.selectedCids||ajaxify.data.selectedCids||[];const n=b.find('[component="category-selector-search"]');if(!n.length)return;const l=n.parents('[component="category/dropdown"]').length>0||n.parents('[component="category-selector"]').length>0;b.on("show.bs.dropdown",function(){l&&n.removeClass("hidden");function t(){const s=n.find("input").val();s.length>1||!s&&!o?i(s,function(u){o=r.cacheList&&(o||u),e(u)}):!s&&o&&e(o)}n.on("click",function(s){s.preventDefault(),s.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),b.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),b.on("hide.bs.dropdown",function(){l&&n.addClass("hidden"),n.off("click"),n.find("input").off("keyup")});function i(t,s){d.get("/search/categories",{search:t,query:utils.params(),parentCid:r.parentCid||0,selectedCids:r.selectedCids,privilege:r.privilege,states:r.states,showLinks:r.showLinks},function(u,{categories:h}){if(u)return v.error(u);s(f.concat(h))})}function e(t){const s=r.selectedCids.map(String);t.forEach(function(u){u.selected=s.includes(String(u.cid))}),app.parseAndTranslate(r.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(u){b.find('[component="category/list"]').html(u.find('[component="category/list"]').html()),b.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const h=w.Dropdown.getInstance(b.find(".dropdown-toggle").get(0));h&&h.update()})}},x}.apply(k,E),m!==void 0&&(I.exports=m)}}]);
