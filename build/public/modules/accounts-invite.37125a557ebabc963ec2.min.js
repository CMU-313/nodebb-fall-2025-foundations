"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,95737,99127],{30637:(T,p,i)=>{var d,v;d=[i(49897),i(81335),i(33530),i(29930)],v=function(m,x,P,l){const c={};function h(){return ajaxify.data.template.name.startsWith("admin/")}return c.handle=function(){$('[component="user/invite"]').on("click",function(g){g.preventDefault(),m.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(E=>{x.parse("modals/invite",{groups:E},function(f){P.dialog({message:f,title:`[[${h()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${h()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${h()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:c.send}}})})}).catch(l.error)})},c.send=function(){const g=$("#invite-modal-emails"),E=$("#invite-modal-groups"),f={emails:g.val().split(",").map(w=>w.trim()).filter(Boolean).filter((w,k,e)=>k===e.indexOf(w)).join(","),groupsToJoin:E.val()};f.emails&&m.post(`/users/${app.user.uid}/invites`,f).then(()=>{l.success(`[[${h()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${f.emails.replace(/,/g,"&#44; ")}]]`)}).catch(l.error)},c}.apply(p,d),v!==void 0&&(T.exports=v)},49897:(T,p,i)=>{i.r(p),i.d(p,{del:()=>k,get:()=>h,head:()=>g,patch:()=>f,post:()=>E,put:()=>w});var d=i(91749),v=i.n(d),m=i(33530),x=i.n(m);const P=config.relative_path+"/api/v3";async function l(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:P+e.url,typeof t=="function"){c(e).then(r=>t(null,r),r=>{let a=r;r instanceof Error||(a=new Error(String(r)));const o=a.message||String(a);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const n=new Error("[[error:no-connection]]");n.originalError=a,a=n}t(a)});return}try{return await c(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:a}=await(0,d.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(a)})}throw r}}async function c(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,d.fire)("filter:api.options",{options:e}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(s){const u=s.message||s.toString()||String(s),C=s.name||"Error";if(C==="TypeError"&&(u.toLowerCase().includes("fetch")||u.toLowerCase().includes("network")||u.toLowerCase().includes("failed to fetch")||u.toLowerCase().includes("load failed"))||u.toLowerCase().includes("cors")||u.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:u,name:C});const A=new Error("[[error:no-connection]]");throw A.originalError=s,A}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:u,name:C}),s}const{headers:a}=r;if(a.get("x-redirect"))return c({url:a.get("x-redirect"),...e});const o=a.get("content-type"),y=o&&o.startsWith("application/json");let n;if(e.method!=="HEAD")try{y?n=await r.json():n=await r.text()}catch(s){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:o,error:s.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let s;throw n?y&&n.status&&n.status.message?s=n.status.message:typeof n=="string"?s=n:s=r.statusText||"Request failed":s=r.statusText||"Request failed",new Error(s)}return y&&n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n}function h(e,t,r){return l({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function g(e,t,r){return l({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function E(e,t,r){return l({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function f(e,t,r){return l({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function w(e,t,r){return l({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function k(e,t,r){return l({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}}}]);
