"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,34271,34405,49897,99127],{34405:(P,w,f)=>{var g,y;g=[f(49897),f(29930),f(36e3),f(9787),f(35786)],y=function(p,x,{Textcomplete:T},{TextareaEditor:h},{ContenteditableEditor:E}){const d={},k={delay:200,appendTo:null};d.init=l=>{const n={...k,...l},{input:u,onSelect:e}=n;app.loadJQueryUI(function(){u.autocomplete({...n,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(r,t){A(u,e,r,t)}})})},d.user=function(l,n,u){typeof n=="function"&&(u=n,n={}),n=n||{},d.init({input:l,onSelect:u,source:(e,r)=>{n.query=e.term,p.get("/api/users",n,function(t,s){if(t)return x.error(t);if(s&&s.users){const o=s.users.map(function(i){const a=$("<div></div>").html(i.username).text();return i&&{label:a,value:a,user:{uid:i.uid,name:i.username,slug:i.userslug,username:i.username,userslug:i.userslug,displayname:i.displayname,picture:i.picture,banned:i.banned,"icon:text":i["icon:text"],"icon:bgColor":i["icon:bgColor"]}}});r(o)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},d.group=function(l,n){d.init({input:l,onSelect:n,source:(u,e)=>{socket.emit("groups.search",{query:u.term},function(r,t){if(r)return x.error(r);if(t&&t.length){const s=t.map(function(o){return o&&{label:o.name,value:o.name,group:o}});e(s)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},d.tag=function(l,n){d.init({input:l,onSelect:n,delay:100,source:(u,e)=>{socket.emit("topics.autocompleteTags",{query:u.term,cid:ajaxify.data.cid||0},function(r,t){if(r)return x.error(r);t&&e(t),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function A(l,n,u,e){n=n||function(){};const r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){l.trigger(r)},100),n(u,e)}return d.setup=function({element:l,strategies:n,options:u}){const e=l.get(0);if(e){var r;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?r=new h(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(r=new E(e)),!r)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var t=new T(r,n,{dropdown:u});return t.on("rendered",function(){t.dropdown.items.length&&t.dropdown.items[0].activate()}),t}},d}.apply(w,g),y!==void 0&&(P.exports=y)},49897:(P,w,f)=>{f.r(w),f.d(w,{del:()=>u,get:()=>d,head:()=>k,patch:()=>l,post:()=>A,put:()=>n});var g=f(91749),y=f.n(g),p=f(33530),x=f.n(p);const T=config.relative_path+"/api/v3";async function h(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:T+e.url,typeof r=="function"){E(e).then(t=>r(null,t),t=>{let s=t;t instanceof Error||(s=new Error(String(t)));const o=s.message||String(s);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const a=new Error("[[error:no-connection]]");a.originalError=s,s=a}r(s)});return}try{return await E(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(s)})}throw t}}async function E(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,g.fire)("filter:api.options",{options:e}))}catch(c){console.error("[API] Error in filter:api.options hook:",c)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(c){const m=c.message||c.toString()||String(c),C=c.name||"Error";if(C==="TypeError"&&(m.toLowerCase().includes("fetch")||m.toLowerCase().includes("network")||m.toLowerCase().includes("failed to fetch")||m.toLowerCase().includes("load failed"))||m.toLowerCase().includes("cors")||m.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:m,name:C});const v=new Error("[[error:no-connection]]");throw v.originalError=c,v}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:m,name:C}),c}const{headers:s}=t;if(s.get("x-redirect"))return E({url:s.get("x-redirect"),...e});const o=s.get("content-type"),i=o&&o.startsWith("application/json");let a;if(e.method!=="HEAD")try{i?a=await t.json():a=await t.text()}catch(c){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:o,error:c.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let c;throw a?i&&a.status&&a.status.message?c=a.status.message:typeof a=="string"?c=a:c=t.statusText||"Request failed":c=t.statusText||"Request failed",new Error(c)}return i&&a&&a.hasOwnProperty("status")&&a.hasOwnProperty("response")?a.response:a}function d(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function k(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function A(e,r,t){return h({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function l(e,r,t){return h({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function n(e,r,t){return h({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function u(e,r,t){return h({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
