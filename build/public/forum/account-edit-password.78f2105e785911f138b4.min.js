(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,66123,97082],{6043:(h,p,o)=>{"use strict";var m,f;m=[o(67910),o(17459),o(7065),o(49897),o(29930)],f=function(v,t,a,n,e){const s={};s.init=function(){v.init(),i()};function i(){const c=$("#inputCurrentPassword"),d=$("#password-notify"),g=$("#password-confirm-notify"),y=$("#inputNewPassword"),x=$("#inputNewPasswordAgain");let E=!1,C=!1;function D(){E=!1;try{if(utils.assertPasswordValidity(y.val(),a),y.val()===ajaxify.data.username)throw new Error("[[user:password-same-as-username]]");if(y.val()===ajaxify.data.email)throw new Error("[[user:password-same-as-email]]");u(d),E=!0}catch(A){r(d,A.message)}}function j(){y.val()!==x.val()?(r(g,"[[user:change-password-error-match]]"),C=!1):(y.val()?u(g):(g.parent().removeClass("alert-success alert-danger"),g.children().show(),g.find(".msg").html("")),C=!0)}y.on("input",D),x.on("input",j),$("#changePasswordBtn").on("click",function(){D(),j();const A=$(this);return E&&C?(A.addClass("disabled").find("i").removeClass("hide"),n.put("/users/"+ajaxify.data.theirid+"/password",{currentPassword:c.val(),newPassword:y.val()}).then(()=>{parseInt(app.user.uid,10)===parseInt(ajaxify.data.uid,10)?window.location.href=config.relative_path+"/login":ajaxify.go("user/"+ajaxify.data.userslug+"/edit")}).catch(e.error).finally(()=>{A.removeClass("disabled").find("i").addClass("hide"),c.val(""),y.val(""),x.val(""),d.parent().removeClass("show-success show-danger"),g.parent().removeClass("show-success show-danger"),C=!1,E=!1})):(C||e.error("[[user:change-password-error-match]]"),E||e.error("[[user:change-password-error]]")),!1})}function r(c,d){t.translate(d,function(g){c.html(g).removeClass("text-success").addClass("text-danger")})}function u(c){c.html("").removeClass("text-danger").addClass("text-success")}return s}.apply(p,m),f!==void 0&&(h.exports=f)},18675:()=>{(function(h){var p=h(window),o=function(t,a,n,e){if(arguments.length===3||e){if(n<t)return t;if(n>a)return a}return n},m=function(t){t.clientX=t.originalEvent.touches[0].clientX,t.clientY=t.originalEvent.touches[0].clientY},f=function(t){var a=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(a){var n={width:0,height:0},e=new Image;return e.onload=function(){if(t.css("background-size")=="cover"){var s=t.innerWidth(),i=t.innerHeight(),r=s/i,u=e.width/e.height,c=1;u>=r?c=i/e.height:c=s/e.width,n.width=e.width*c,n.height=e.height*c}else n.width=e.width,n.height=e.height},e.src=a,n}};function v(t,a){this.element=t,this.options=a,this.init()}v.prototype.init=function(){var t=h(this.element),a=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],n=this.options;if(a){var e={width:0,height:0};(n.bound||n.units=="percent")&&(e=f(t)),h(window).on("keydown.dbg",s=>{var i=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],r=parseInt(i[1])||0,u=parseInt(i[2])||0;n.units=="percent"&&(r=Math.round(r/-200*e.width),u=Math.round(u/-200*e.height));var c=0,d=0;return s.which===37?c=-5:s.which===39?c=5:s.which===38?d=-5:s.which===40&&(d=5),n.units==="percent"?(r=n.axis==="y"?r:o(-e.width/2,0,r+c,n.bound),u=n.axis==="x"?u:o(-e.height/2,0,u+d,n.bound),t.css("background-position",r/e.width*-200+"% "+u/e.height*-200+"%")):(r=n.axis==="y"?r:o(t.innerWidth()-e.width,0,r+c,n.bound),u=n.axis==="x"?u:o(t.innerHeight()-e.height,0,u+d,n.bound)),[37,38,39,40].includes(s.which)?!1:void 0}),t.on("mousedown.dbg touchstart.dbg",function(s){if(s.target===t[0]){if(s.preventDefault(),s.originalEvent.touches)m(s);else if(s.which!==1)return;var i=s.clientX,r=s.clientY,u=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],c=parseInt(u[1])||0,d=parseInt(u[2])||0;n.units=="percent"&&(c=Math.round(c/-200*e.width),d=Math.round(d/-200*e.height)),p.on("mousemove.dbg touchmove.dbg",function(g){g.preventDefault(),g.originalEvent.touches&&m(g);var y=g.clientX,x=g.clientY;n.units=="percent"?(c=n.axis==="y"?c:o(-e.width/2,0,c+y-i,n.bound),d=n.axis==="x"?d:o(-e.height/2,0,d+x-r,n.bound),t.css("background-position",c/e.width*-200+"% "+d/e.height*-200+"%")):(c=n.axis==="y"?c:o(t.innerWidth()-e.width,0,c+y-i,n.bound),d=n.axis==="x"?d:o(t.innerHeight()-e.height,0,d+x-r,n.bound),t.css("background-position",c+"px "+d+"px")),i=y,r=x}),p.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){n.done&&n.done(),p.off("mousemove.dbg touchmove.dbg"),p.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},v.prototype.disable=function(){var t=h(this.element);t.off("mousedown.dbg touchstart.dbg"),p.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},h.fn.backgroundDraggable=function(t){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=h(this),e;typeof t>"u"||typeof t=="object"?(t=h.extend({},h.fn.backgroundDraggable.defaults,t),e=new v(this,t),n.data("dbg",e)):typeof t=="string"&&n.data("dbg")&&(e=n.data("dbg"),v.prototype[t].apply(e,a))})},h.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(h,p,o)=>{"use strict";var m,f;m=[o(81335),o(49897),o(33530),o(29930)],f=function(v,t,a,n){const e={};e.banAccount=function(i,r){i=i||ajaxify.data.theirid,s({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(u){const c=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;t.put("/users/"+i+"/ban",{until:c,reason:u.reason||""}).then(()=>{if(typeof r=="function")return r();ajaxify.refresh()}).catch(n.error)}})},e.unbanAccount=function(i){s({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(r){t.del("/users/"+i+"/ban",{reason:r.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})},e.muteAccount=function(i,r){i=i||ajaxify.data.theirid,s({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(u){const c=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;t.put("/users/"+i+"/mute",{until:c,reason:u.reason||""}).then(()=>{if(typeof r=="function")return r();ajaxify.refresh()}).catch(n.error)}})},e.unmuteAccount=function(i){s({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(r){t.del("/users/"+i+"/mute",{reason:r.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})};function s(i){v.render(i.tpl,{}).then(function(r){const u=a.dialog({title:i.title,message:r,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:i.title,callback:function(){const c=u.find("form").serializeArray().reduce(function(d,g){return d[g.name]=g.value,d},{});i.onSubmit(c)}}}})})}return e}.apply(p,m),f!==void 0&&(h.exports=f)},36684:(h,p,o)=>{"use strict";var m,f;m=[o(29930),o(18675)],f=function(v){const t={coverEl:null,saveFn:null};t.init=function(n,e,s,i){t.coverEl=n,t.saveFn=e,n.find(".upload").on("click",s),n.find(".resize").on("click",function(){a(n)}),n.find(".remove").on("click",i),n.on("dragover",t.onDragOver).on("drop",t.onDrop),n.find(".save").on("click",t.save),n.addClass("initialised")},t.onDragOver=function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"},t.onDrop=function(n){n.stopPropagation(),n.preventDefault();const e=n.originalEvent.dataTransfer.files,s=new FileReader;e.length&&e[0].type.match("image.*")&&(s.onload=function(i){t.coverEl.css("background-image","url("+i.target.result+")"),t.newCover=i.target.result},s.readAsDataURL(e[0]),a(t.coverEl))};function a(n){n.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),v.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return t.save=function(){t.coverEl.addClass("saving"),t.saveFn(t.newCover||void 0,t.coverEl.css("background-position"),function(n){n?v.error(n):(t.coverEl.toggleClass("active",0),t.coverEl.backgroundDraggable("disable"),t.coverEl.off("dragover",t.onDragOver),t.coverEl.off("drop",t.onDrop),v.success("[[modules:cover.saved]]")),t.coverEl.removeClass("saving")})},t}.apply(p,m),f!==void 0&&(h.exports=f)},47283:(h,p,o)=>{"use strict";var m,f;m=[o(49897),o(33530),o(29930)],f=function(v,t,a){const n={};n.account=function(s,i){e(s,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",i)},n.content=function(s,i){e(s,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",i)},n.purge=function(s,i){e(s,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",i)};function e(s,i,r,u,c){t.confirm(i,function(d){d&&v.del(`/users/${encodeURIComponent(s)}${r}`,{}).then(()=>{if(a.success(u),typeof c=="function")return c()}).catch(a.error)})}return n}.apply(p,m),f!==void 0&&(h.exports=f)},67910:(h,p,o)=>{"use strict";var m,f;m=[o(36684),o(72254),o(52473),o(17459),o(47283),o(28061),o(7524),o(49897),o(33530),o(29930)],f=function(v,t,a,n,e,s,i,r,u,c){const d={};let g;d.init=function(){g=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,y(),x(),g&&E(),a.get("account/follow").on("click",()=>C("follow")),a.get("account/unfollow").on("click",()=>C("unfollow")),a.get("account/chat").on("click",async function(){const{roomId:l}=await r.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),w=await app.require("chat");l?w.openChat(l):w.newChat(ajaxify.data.uid)}),a.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){a.get("account/chat").parent().removeClass("hidden")})}),a.get("account/ban").on("click",()=>s.banAccount(ajaxify.data.theirid)),a.get("account/mute").on("click",()=>s.muteAccount(ajaxify.data.theirid)),a.get("account/unban").on("click",()=>s.unbanAccount(ajaxify.data.theirid)),a.get("account/unmute").on("click",()=>s.unmuteAccount(ajaxify.data.theirid)),a.get("account/delete-account").on("click",()=>e.account(ajaxify.data.theirid)),a.get("account/delete-content").on("click",()=>e.content(ajaxify.data.theirid)),a.get("account/delete-all").on("click",()=>e.purge(ajaxify.data.theirid)),a.get("account/flag").on("click",D),a.get("account/already-flagged").on("click",j),a.get("account/block").on("click",()=>A("block")),a.get("account/unblock").on("click",()=>A("unblock"))};function y(){$(".account-sub-links li a").removeClass("active").each(function(){const l=$(this).attr("href");if(decodeURIComponent(l)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function x(){$('[component="profile/change/picture"]').on("click",function(){return i.openChangeModal(),!1})}function E(){v.init(a.get("account/cover"),function(l,w,b){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:l,position:w},b)},function(){t.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(l){l=(l.startsWith("http")?"":config.relative_path)+l+"?"+Date.now(),a.get("account/cover").css("background-image","url("+l+")")})},k)}function C(l){const w=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return r[l==="follow"?"put":"del"]("/users/"+w+"/follow",void 0,function(b){if(b)return c.error(b);a.get("account/follow").toggleClass("hide",l==="follow"),a.get("account/unfollow").toggleClass("hide",l==="unfollow"),c.success("[[global:alert."+l+", "+ajaxify.data.username+"]]")}),!1}function D(){o.e(6574).then(function(){var l=[o(6574)];(function(w){w.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,l)}).catch(o.oe)}function j(){const l=$(this).data("flag-id");o.e(6574).then(function(){var w=[o(6574)];(function(b){u.confirm("[[flags:modal-confirm-rescind]]",function(P){P&&b.rescind(l)})}).apply(null,w)}).catch(o.oe)}function A(l){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:l},function(w,b){if(w)return c.error(w);a.get("account/block").toggleClass("hidden",b),a.get("account/unblock").toggleClass("hidden",!b)}),!1}function k(){n.translate("[[user:remove-cover-picture-confirm]]",function(l){u.confirm(l,function(w){w&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(b){b?c.error(b):ajaxify.refresh()})})})}return d}.apply(p,m),f!==void 0&&(h.exports=f)}}]);
