"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,82858,95738,99127],{22410:(A,C,d)=>{var E,m;E=[d(91749),d(29930),d(49897)],m=function(p,x,w){const l={};let f,c=0,a=!1,u,T=0;l.init=function(e,r){const t=$("body");typeof e=="function"?(f=e,u=t):(f=r,u=e||t),c=$(window).scrollTop(),$(window).off("scroll",_).on("scroll",_),t.height()<=$(window).height()&&(!ajaxify.data.hasOwnProperty("pageCount")||ajaxify.data.pageCount>1)&&f(1)};function _(){T&&clearTimeout(T),T=setTimeout(function(){T=0,v()},60)}function v(){const e=utils.findBootstrapEnvironment(),r=(e==="xs"||e==="sm")&&$("html").hasClass("composing");if(a||r||app.flags._glance)return;const t=$(window).scrollTop(),o=$(window).height(),n=u.height()-o,h=u.offset()?u.offset().top:0,s=100*(t-h)/(n<=0?o:n),i=15,g=85,y=t>c?1:-1;(s<i&&t<c||s>g&&t>c||s<0&&y>0&&n<0)&&f(y),c=t}return l.loadMore=function(e,r,t){if(a)return;a=!0;const o={method:e,data:r};p.fire("action:infinitescroll.loadmore",o),(o.method.startsWith("/")?w.get:socket.emit)(o.method,o.data,function(h,s){if(h)return a=!1,x.error(h);t(s,function(){a=!1})})},l.loadMoreXhr=function(e,r){if(a)return;a=!0;const t=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),o={url:t,data:e};p.fire("action:infinitescroll.loadmore.xhr",o),$.get(t,e,function(n){r(n,function(){a=!1})}).fail(function(n){a=!1,x.error(String(n.responseJSON||"[[error:no-connection]]"))})},l.removeExtra=function(e,r,t){let o=$();if(e.length<=t)return o;const n=e.length-t;if(r>0){const h=$(document).height(),s=$(window).scrollTop();o=e.slice(0,n).remove(),$(window).scrollTop(s+($(document).height()-h))}else o=e.slice(e.length-n).remove();return o},l}.apply(C,E),m!==void 0&&(A.exports=m)},31042:(A,C,d)=>{var E,m;E=[d(22410),d(29930)],m=function(p,x){const w={};w.init=function(){app.enterRoom("tags"),$("#tag-search").on("input propertychange",utils.debounce(function(){if(!$("#tag-search").val().length)return l();socket.emit("topics.searchAndLoadTags",{query:$("#tag-search").val()},function(c,a){if(c)return x.error(c);f(a.tags,!0)})},250)),p.init(w.loadMoreTags)},w.loadMoreTags=function(c){c<0||!$(".tag-list").length||$("#tag-search").val()||p.loadMore("topics.loadMoreTags",{after:$(".tag-list").attr("data-nextstart")},function(a,u){a&&a.tags&&a.tags.length?(f(a.tags,!1,u),$(".tag-list").attr("data-nextstart",a.nextStart)):u()})};function l(){socket.emit("topics.loadMoreTags",{after:0},function(c,a){if(c)return x.error(c);f(a.tags,!0)})}function f(c,a,u){u=u||function(){},app.parseAndTranslate("tags","tags",{tags:c},function(T){$(".tag-list")[a?"html":"append"](T),u()})}return w}.apply(C,E),m!==void 0&&(A.exports=m)},49897:(A,C,d)=>{d.r(C),d.d(C,{del:()=>v,get:()=>c,head:()=>a,patch:()=>T,post:()=>u,put:()=>_});var E=d(91749),m=d.n(E),p=d(33530),x=d.n(p);const w=config.relative_path+"/api/v3";async function l(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:w+e.url,typeof r=="function"){f(e).then(t=>r(null,t),t=>{let o=t;t instanceof Error||(o=new Error(String(t)));const n=o.message||String(o);if(n&&!n.startsWith("[[error:")&&(n.toLowerCase()==="fetch failed"||n.toLowerCase()==="failed to fetch"||n.toLowerCase().includes("networkerror")||n.toLowerCase().includes("network")&&n.toLowerCase().includes("failed"))){const s=new Error("[[error:no-connection]]");s.originalError=o,o=s}r(o)});return}try{return await f(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:o}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",n=>{n&&ajaxify.go(o)})}throw t}}async function f(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(i){console.error("[API] Error in filter:api.options hook:",i)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(i){const g=i.message||i.toString()||String(i),y=i.name||"Error";if(y==="TypeError"&&(g.toLowerCase().includes("fetch")||g.toLowerCase().includes("network")||g.toLowerCase().includes("failed to fetch")||g.toLowerCase().includes("load failed"))||g.toLowerCase().includes("cors")||g.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:g,name:y});const P=new Error("[[error:no-connection]]");throw P.originalError=i,P}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:g,name:y}),i}const{headers:o}=t;if(o.get("x-redirect"))return f({url:o.get("x-redirect"),...e});const n=o.get("content-type"),h=n&&n.startsWith("application/json");let s;if(e.method!=="HEAD")try{h?s=await t.json():s=await t.text()}catch(i){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:n,error:i.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let i;throw s?h&&s.status&&s.status.message?i=s.status.message:typeof s=="string"?i=s:i=t.statusText||"Request failed":i=t.statusText||"Request failed",new Error(i)}return h&&s&&s.hasOwnProperty("status")&&s.hasOwnProperty("response")?s.response:s}function c(e,r,t){return l({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function a(e,r,t){return l({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function u(e,r,t){return l({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function T(e,r,t){return l({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function _(e,r,t){return l({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function v(e,r,t){return l({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
