(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,67109,69185,86198,93806,99127],{49897:(P,b,l)=>{"use strict";l.r(b),l.d(b,{del:()=>d,get:()=>t,head:()=>r,patch:()=>a,post:()=>s,put:()=>u});var h=l(91749),y=l.n(h),A=l(33530),E=l.n(A);const C=config.relative_path+"/api/v3";async function p(n,o){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:C+n.url,typeof o=="function"){i(n).then(e=>o(null,e),e=>o(e));return}try{return await i(n)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:c}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,A.confirm)("[[error:api.reauth-required]]",g=>{g&&ajaxify.go(c)})}throw e}}async function i(n){const{url:o}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,h.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const e=await fetch(o,n),{headers:c}=e;if(c.get("x-redirect"))return i({url:c.get("x-redirect"),...n});const g=c.get("content-type"),f=g&&g.startsWith("application/json");let m;if(n.method!=="HEAD"&&(f?m=await e.json():m=await e.text()),!e.ok)throw m?new Error(f?m.status.message:m):new Error(e.statusText);return f&&m&&m.hasOwnProperty("status")&&m.hasOwnProperty("response")?m.response:m}function t(n,o,e){return p({url:n+(o&&Object.keys(o).length?"?"+$.param(o):"")},e)}function r(n,o,e){return p({url:n+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"HEAD"},e)}function s(n,o,e){return p({url:n,method:"POST",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}function a(n,o,e){return p({url:n,method:"PATCH",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}function u(n,o,e){return p({url:n,method:"PUT",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}function d(n,o,e){return p({url:n,method:"DELETE",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}},65348:(P,b,l)=>{"use strict";var h,y;h=[l(96349),l(33530),l(91749),l(17459)],y=function(A,E,C,p){const i={};return i.init=function(t,r){if(!t||!t.length)return;r=r||{};const s=r.onSelect||function(){};r.states=r.states||["watching","tracking","notwatching","ignoring"],r.template=r.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:t,options:r}),A.init(t,r);const a={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const d=$(this);return d.hasClass("disabled")?!1:(a.selectCategory(d.attr("data-cid")),s(a.selectedCategory))});let u=a.el.find('[component="category-selector-selected"]').html();return p.translate(u,d=>{u=d}),a.selectCategory=function(d){const n=a.el.find('[data-cid="'+d+'"]');a.selectedCategory={cid:d,name:n.attr("data-name")},n.length?a.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):a.el.find('[component="category-selector-selected"]').html(u)},a.getSelectedCategory=function(){return a.selectedCategory},a.getSelectedCid=function(){return a.selectedCategory?a.selectedCategory.cid:0},r.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(r.template,{selectedCategory:r.selectedCategory},function(d){a.el.find('[component="category-selector-selected"]').html(d.find('[component="category-selector-selected"]').html())}),a},i.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(r){const s=E.dialog({title:t.title||"[[modules:composer.select-category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),a=i.init(s.find('[component="category-selector"]'),t);function u(d){return d.preventDefault(),a.selectedCategory&&(t.onSubmit(a.selectedCategory),s.modal("hide")),!1}t.openOnLoad&&s.on("shown.bs.modal",function(){s.find(".dropdown-toggle").dropdown("toggle")}),s.find("form").on("submit",u)})},i}.apply(b,h),y!==void 0&&(P.exports=y)},78048:(P,b,l)=>{"use strict";var h,y;h=[l(33530),l(49897),l(29930),l(17459)],y=function(A,E,C,p){const i={};return i.init=function(){$(document).on("click",".edit-category-btn",function(t){t.preventDefault(),t.stopPropagation();const r=$(this),s=r.data("cid"),a=r.data("name")||"";i.showEditModal(s,a)})},i.showEditModal=function(t,r){A.dialog({title:"Edit Category",message:`
				<form id="edit-category-form">
					<div class="mb-3">
						<label for="category-name" class="form-label">Category Name</label>
						<input type="text" class="form-control" id="category-name" name="name" value="${p.escape(r)}" required>
					</div>
				</form>
			`,buttons:{cancel:{label:"Cancel",className:"btn-secondary"},save:{label:"Save Changes",className:"btn-primary",callback:function(){const s=document.getElementById("edit-category-form"),u=new FormData(s).get("name"),d=i.validateCategoryName(u);if(d)return C.alert({type:"danger",title:"Invalid Category Name",message:d,timeout:5e3}),!1;const n={name:u};return i.updateCategory(t,n),!1}}}})},i.validateCategoryName=function(t){if(!t||t.trim()==="")return"Category name cannot be empty.";if(typeof t!="string")return"Category name must be text.";if(t.length>50)return"Category name cannot be longer than 50 characters.";if(t.includes("/")||t.includes(":"))return'Category name cannot contain "/" or ":" characters.';const r=[];return $(".edit-category-btn").each(function(){const s=$(this).data("name");s&&s.toLowerCase()===t.toLowerCase()&&r.push(s)}),r.length>0?"A category with this name already exists.":null},i.updateCategory=function(t,r){E.put(`/categories/${t}`,r).then(function(){C.alert({type:"success",title:"Success",message:"Category updated successfully!",timeout:3e3}),$(".bootbox").modal("hide");const s=$(`.edit-category-btn[data-cid="${t}"]`);s.data("name",r.name);const a=s.closest('[component="categories/category"]'),u=a.find(".title");if(u.length){const n=u.find("a");n.length?n.text(r.name):u.text(r.name)}const d=a.find('meta[itemprop="name"]');d.length&&d.attr("content",r.name)}).catch(function(s){C.alert({type:"danger",title:"Error",message:s.message||"Failed to update category",timeout:5e3})})},i}.apply(b,h),y!==void 0&&(P.exports=y)},89067:(P,b,l)=>{var h,y;h=[l(65348),l(49897),l(33530),l(17459),l(29930),l(81335),l(78048)],y=function(A,E,C,p,i,t,r){const s={};function a(){$("body").off("click.purge").on("click.purge",'[data-action="purge"][data-cid]',function(d){d.preventDefault();const n=$(this),o=n.closest("li[data-cid]"),e=n.attr("data-cid")||o.length&&o.attr("data-cid"),c=o.length&&o.find(".title").text().trim()||"";E.get(`/categories/${encodeURIComponent(e)}/count`).then(function(g){const f=g&&g.count?g.count:0;t.render("admin/partials/categories/purge",{name:c,topic_count:f}).then(function(m){const x=C.dialog({title:"[[admin/manage/categories:purge]]",message:m,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){x.find(".modal-footer button").prop("disabled",!0);const w=setInterval(async function(){try{const{count:v}=await E.get(`/categories/${encodeURIComponent(e)}/count`);let D=0;f>0&&(D=Math.max(0,1-v/f)*100),x.find(".progress-bar").css({width:D+"%"})}catch(v){clearInterval(w),i.error(v)}},1e3);return E.del("/categories/"+e).then(function(){w&&clearInterval(w),x.modal("hide"),i.success("[[admin/manage/categories:alert.purge-success]]"),o.remove()}).catch(function(v){clearInterval(w),i.error(v)}),!1}}}})}).catch(i.error)}).catch(i.error)})}return s.init=function(){app.enterRoom("categories"),A.init($('[component="category-selector"]'),{privilege:"find",onSelect:function(e){ajaxify.go("/category/"+e.cid)}}),r.init();const u=$("#btn-new-category");if(!u.length)return;u.on("click",function(){C.prompt({title:p.translate("[[categories:create-prompt]]")||"Enter category name:",callback:function(e){e&&E.post("/categories",{name:e}).then(c=>{C.alert(`Category "${c.name}" created!`,function(){ajaxify.refresh()})}).catch(c=>{C.alert(`Error creating category: ${c.message||c}`)})}})});try{a()}catch(e){console.error("bindPurgeHandlers error",e)}function d(){document.querySelectorAll('li[component="categories/category"]').forEach(function(e){if(e.querySelector('[data-action="purge"]'))return;const c=e.getAttribute("data-cid")||e.dataset.cid;if(!c)return;const g=e.querySelector(".d-flex.align-items-start.justify-content-end")||e.querySelector(".d-flex.align-items-start")||e,f=document.createElement("button");f.className="btn btn-danger btn-sm ms-2",f.setAttribute("data-action","purge"),f.setAttribute("data-cid",c),f.title="[[admin/manage/categories:purge]]",f.innerHTML='<i class="fa fa-fw fa-trash"></i>',g.appendChild(f)})}async function n(){try{if(typeof window<"u"&&window.app&&app.user)try{if(app.user.isAdmin||app.user.isGlobalModerator||app.user.allowPurge){d();return}}catch{}if(typeof ajaxify<"u"&&ajaxify.data){if(ajaxify.data.isAdmin||ajaxify.data.isGlobalModerator||ajaxify.data.allowPurge){d();return}if(ajaxify.data.loggedIn&&ajaxify.data.loggedInUser&&ajaxify.data.loggedInUser.uid){const e=ajaxify.data.loggedInUser.uid;try{const c=await E.get(`/users/${encodeURIComponent(e)}`);c&&(c.isAdmin||c.isGlobalModerator||c.allowPurge)&&d()}catch{}}}}catch(e){console.error("ensurePurgeButtonsForAdmin error",e)}}try{n()}catch(e){console.error("ensurePurgeButtonsForAdmin init error",e)}try{setTimeout(()=>{try{n()}catch{}},50)}catch{}try{setTimeout(()=>{try{n()}catch{}},150)}catch{}try{$(window).off("action:ajaxify.end.ensurePurge").on("action:ajaxify.end.ensurePurge",function(){try{a()}catch(e){console.error("bindPurgeHandlers error (ajaxify)",e)}try{n()}catch(e){console.error("ensurePurgeButtonsForAdmin error (ajaxify)",e)}});try{$(window).off("action:ajaxify.dataLoaded.ensurePurge").on("action:ajaxify.dataLoaded.ensurePurge",function(){try{a()}catch(e){console.error("bindPurgeHandlers error (dataLoaded)",e)}try{n()}catch(e){console.error("ensurePurgeButtonsForAdmin error (dataLoaded)",e)}}),$(window).off("action:ajaxify.coldLoad.ensurePurge").on("action:ajaxify.coldLoad.ensurePurge",function(){try{a()}catch(e){console.error("bindPurgeHandlers error (coldLoad)",e)}try{n()}catch(e){console.error("ensurePurgeButtonsForAdmin error (coldLoad)",e)}})}catch(e){console.error("ajaxify data/cold hook attach error",e)}}catch(e){console.error("ajaxify hook attach error",e)}try{if(document.querySelectorAll&&document.querySelectorAll('li[component="categories/category"]').length){try{n()}catch(e){console.error("ensurePurgeButtonsForAdmin fast-path error",e)}try{a()}catch(e){console.error("bindPurgeHandlers fast-path error",e)}}}catch{}try{let c=function(){e||(e=new MutationObserver(function(g){let f=!1;for(const m of g)if(m.addedNodes)for(const x of m.addedNodes)x instanceof Element&&(x.matches&&x.matches('li[component="categories/category"]')&&(f=!0),x.querySelector&&x.querySelector('li[component="categories/category"]')&&(f=!0));if(f){try{d()}catch{}try{a()}catch{}}}),e.observe(document.documentElement||document.body,{childList:!0,subtree:!0}))};var o=c;let e;c()}catch{}},s}.apply(b,h),y!==void 0&&(P.exports=y)},96349:(P,b,l)=>{"use strict";var h,y;h=[l(29930),l(89336),l(49897)],y=function(A,E,C){const p={};return p.init=function(i,t){let r=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let s=[];Array.isArray(t.localCategories)&&(s=t.localCategories.map(o=>({...o})),r&&(r=[...s,...r])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const a=i.find('[component="category-selector-search"]');if(!a.length)return;const u=a.parents('[component="category/dropdown"]').length>0||a.parents('[component="category-selector"]').length>0;i.on("show.bs.dropdown",function(){u&&a.removeClass("hidden");function o(){const e=a.find("input").val();e.length>1||!e&&!r?d(e,function(c){r=t.cacheList&&(r||c),n(c)}):!e&&r&&n(r)}a.on("click",function(e){e.preventDefault(),e.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(o,300)),o()}),i.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||a.find("input").focus()}),i.on("hide.bs.dropdown",function(){u&&a.addClass("hidden"),a.off("click"),a.find("input").off("keyup")});function d(o,e){C.get("/search/categories",{search:o,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(c,{categories:g}){if(c)return A.error(c);e(s.concat(g))})}function n(o){const e=t.selectedCids.map(String);o.forEach(function(c){c.selected=e.includes(String(c.cid))}),app.parseAndTranslate(t.template,{categoryItems:o.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(c){i.find('[component="category/list"]').html(c.find('[component="category/list"]').html()),i.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!o.length);const g=E.Dropdown.getInstance(i.find(".dropdown-toggle").get(0));g&&g.update()})}},p}.apply(b,h),y!==void 0&&(P.exports=y)}}]);
