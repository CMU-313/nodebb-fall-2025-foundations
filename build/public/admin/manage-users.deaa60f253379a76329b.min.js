"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,15794,25432,26174,34271,34405,49897,53020,78289,95737,99127],{13230:(B,S,d)=>{var h,y,P;(function(k){y=[d(53050)],h=k,P=typeof h=="function"?h.apply(S,y):h,P!==void 0&&(B.exports=P)})(function(k){const L=k("[^\\p{L}\\s\\d\\-_@.]","g"),b=/[^\w\s\d\-_@.]/g,I=/^\s+|\s+$/g,f=/\s+/g,u=/-+/g,U=/-$/g,w=/^-/g,p=/^[\w\d\s.,\-@]+$/;return function(t,l){return t?(t=String(t).replace(I,""),p.test(t)?t=t.replace(b,"-"):t=k.replace(t,L,"-"),t=l?t:t.toLocaleLowerCase(),t=t.replace(f,"-"),t=t.replace(u,"-"),t=t.replace(U,""),t=t.replace(w,""),t):""}})},29869:B=>{B.exports=function(S,d,h){d.setGlobal("true",!0),d.setGlobal("false",!1);const y=24*60*60*1e3,P={displayMenuItem:L,buildMetaTag:b,buildLinkTag:I,stringify:f,escape:u,stripTags:U,buildCategoryIcon:w,buildCategoryLabel:p,generateCategoryBackground:v,generateChildrenCategories:t,generateTopicClass:l,membershipBtn:o,spawnPrivilegeStates:E,localeToHTML:x,renderTopicImage:C,renderDigestAvatar:A,userAgentIcons:s,buildAvatar:c,increment:D,generateWroteReplied:R,generateRepliedTo:N,generateWrote:_,encodeURIComponent:G,isoTimeToLocaleString:J,shouldHideReplyContainer:z,humanReadableNumber:Y,formattedNumber:V,txEscape:a,generatePlaceholderWave:i,register:m,__escape:k};function k(e){return e}function L(e,n){const r=e.navigation[n];return!(!r||r.route.match("/users")&&e.user&&!e.user.privileges["view:users"]||r.route.match("/tags")&&e.user&&!e.user.privileges["view:tags"]||r.route.match("/groups")&&e.user&&!e.user.privileges["view:groups"])}function b(e){const n=e.name?'name="'+e.name+'" ':"",r=e.property?'property="'+e.property+'" ':"",g=e.content?'content="'+e.content.replace(/\n/g," ")+'" ':"";return"<meta "+n+r+g+`/>
	`}function I(e){const n=["link","rel","as","type","href","sizes","title","crossorigin"],[r,g,M,T,F,H,j,K]=n.map(W=>e[W]?`${W}="${e[W]}" `:"");return"<link "+r+g+M+T+H+j+F+K+`/>
	`}function f(e){return JSON.stringify(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/g,"&quot;")}function u(e){return S.escapeHTML(e)}function U(e){return S.stripHTMLTags(e)}function w(e,n,r){return e?`<span class="icon d-inline-flex justify-content-center align-items-center align-middle ${r}" style="${v(e)} width:${n}; height: ${n}; font-size: ${parseInt(n,10)/2}px;">${e.icon?`<i class="fa fa-fw ${e.icon}"></i>`:""}</span>`:""}function p(e,n="a",r=""){if(!e)return"";const g=n==="a"?`href="${h}/category/${e.slug}"`:"";return`<${n} ${g} class="badge px-1 text-truncate text-decoration-none ${r}" style="color: ${e.color};background-color: ${e.bgColor};border-color: ${e.bgColor}!important; max-width: 70vw;">
			${e.icon&&e.icon!=="fa-nbb-none"?`<i class="fa fa-fw ${e.icon}"></i>`:""}
			${e.name}
		</${n}>`}function v(e){if(!e)return"";const n=[];return e.bgColor&&(n.push("background-color: "+e.bgColor),n.push(`border-color: ${e.bgColor}!important`)),e.color&&n.push("color: "+e.color),e.backgroundImage&&(n.push("background-image: url("+e.backgroundImage+")"),e.imageClass&&n.push("background-size: "+e.imageClass)),n.join("; ")+";"}function t(e){let n="";return!e||!e.children||!e.children.length||(e.children.forEach(function(r){if(r&&!r.isSection){const g=r.link?r.link:h+"/category/"+r.slug;n+='<span class="category-children-item float-start"><div role="presentation" class="icon float-start" style="'+v(r)+'"><i class="fa fa-fw '+r.icon+'"></i></div><a href="'+g+'"><small>'+r.name+"</small></a></span>"}}),n=n&&'<span class="category-children">'+n+"</span>"),n}function l(e){return["locked","pinned","deleted","unread","scheduled"].filter(r=>!!e[r]).join(" ")}function o(e,n=""){return e.isMember&&e.name!=="administrators"?`<button class="btn btn-danger ${n}" data-action="leave" data-group="${e.displayName}" ${e.disableLeave?" disabled":""}><i class="fa fa-times"></i> [[groups:membership.leave-group]]</button>`:e.isPending&&e.name!=="administrators"?`<button class="btn btn-warning disabled ${n}"><i class="fa fa-clock-o"></i> [[groups:membership.invitation-pending]]</button>`:e.isInvited?`<button class="btn btn-warning" data-action="rejectInvite" data-group="${e.displayName}">[[groups:membership.reject]]</button><button class="btn btn-success" data-action="acceptInvite" data-group="${e.name}"><i class="fa fa-plus"></i> [[groups:membership.accept-invitation]]</button>`:!e.disableJoinRequests&&e.name!=="administrators"?`<button class="btn btn-success ${n}" data-action="join" data-group="${e.displayName}"><i class="fa fa-plus"></i> [[groups:membership.join-group]]</button>`:""}function E(e,n,r,g){const M=[];for(const[T,F]of Object.entries(r))M.push({name:T,state:F,type:g[T]});return M.map(function(T){const F=["groups:moderate","groups:posts:upvote","groups:posts:downvote","groups:local:login","groups:group:create"],H=["groups:find","groups:read","groups:topics:read","groups:view:users","groups:view:tags","groups:view:groups"],j=["groups:moderate"];let K=["groups:view:users","groups:find","groups:read","groups:topics:read","groups:topics:create","groups:topics:reply","groups:topics:tag","groups:posts:edit","groups:posts:history","groups:posts:delete","groups:posts:upvote","groups:posts:downvote","groups:topics:delete"];e===-1&&(K=K.slice(3));const W=n==="guests"&&(F.includes(T.name)||T.name.startsWith("groups:admin:"))||n==="spiders"&&!H.includes(T.name)||n==="fediverse"&&!K.includes(T.name)||n==="Global Moderators"&&j.includes(T.name);return`
				<td data-privilege="${T.name}" data-value="${T.state}" data-type="${T.type}">
					<div class="form-check text-center">
						<input class="form-check-input float-none${W?' d-none"':""}" autocomplete="off" type="checkbox"${T.state?" checked":""}${W?' disabled="disabled" aria-diabled="true"':""} />
					</div>
				</td>
			`}).join("")}function x(e,n){return e=e||n||"en-GB",e.replace("_","-")}function C(e){return e.thumb?'<img src="'+e.thumb+'" class="img-circle user-img" title="'+e.user.displayname+'" />':'<img component="user/picture" data-uid="'+e.user.uid+'" src="'+e.user.picture+'" class="user-img" title="'+e.user.displayname+'" />'}function A(e){return e.teaser?e.teaser.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.teaser.user.picture+'" title="'+e.teaser.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.teaser.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.teaser.user["icon:text"]+"</div>":e.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.user.picture+'" title="'+e.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.user["icon:text"]+"</div>"}function s(e){let n="";switch(e.platform){case"Linux":n+='<i class="fa fa-fw fa-linux"></i>';break;case"Microsoft Windows":n+='<i class="fa fa-fw fa-windows"></i>';break;case"Apple Mac":n+='<i class="fa fa-fw fa-apple"></i>';break;case"Android":n+='<i class="fa fa-fw fa-android"></i>';break;case"iPad":n+='<i class="fa fa-fw fa-tablet"></i>';break;case"iPod":case"iPhone":n+='<i class="fa fa-fw fa-mobile"></i>';break;default:n+='<i class="fa fa-fw fa-question-circle"></i>';break}switch(e.browser){case"Chrome":n+='<i class="fa fa-fw fa-chrome"></i>';break;case"Firefox":n+='<i class="fa fa-fw fa-firefox"></i>';break;case"Safari":n+='<i class="fa fa-fw fa-safari"></i>';break;case"IE":n+='<i class="fa fa-fw fa-internet-explorer"></i>';break;case"Edge":n+='<i class="fa fa-fw fa-edge"></i>';break;default:n+='<i class="fa fa-fw fa-question-circle"></i>';break}return n}function c(e,n,r,g,M){e||(e=this),g=g||"";const T=new Map([["title",e.displayname],["data-uid",e.uid],["class",`avatar ${g}${r?" avatar-rounded":""}`]]),F=[`--avatar-size: ${n};`],H=K=>Array.from(K).reduce((W,[Q,O])=>(W+=` ${Q}="${O}"`,W),"");let j="";return e.picture&&(j+=`<img${H(T)} alt="${e.displayname}" loading="lazy" component="${M||"avatar/picture"}" src="${e.picture}" style="${F.join(" ")}" onError="this.remove()" itemprop="image" />`),j+=`<span${H(T)} component="${M||"avatar/icon"}" style="${F.join(" ")} background-color: ${e["icon:bgColor"]}">${e["icon:text"]}</span>`,j}function D(e,n){return String(e+parseInt(n,10))}function R(e,n){return e.toPid?N(e,n):_(e,n)}function N(e,n){const r=e.parent&&e.parent.displayname?e.parent.displayname:"[[global:guest]]";return`[[topic:replied-to-user-${e.timestamp<Date.now()-n*y?"on":"ago"}, ${e.toPid}, ${h}/post/${encodeURIComponent(e.toPid)}, ${r}, ${h}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function _(e,n){return`[[topic:wrote-${e.timestamp<Date.now()-n*y?"on":"ago"}, ${h}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function G(e){return encodeURIComponent(e)}function J(e,n="en-GB"){return new Date(e).toLocaleString([n],{dateStyle:"short",timeStyle:"short"}).replace(/,/g,"&#44;")}function z(e){return!!(e.replies.count<=0||e.replies.hasSingleImmediateReply)}function Y(e,n=1){return S.makeNumberHumanReadable(e,n)}function V(e){return S.addCommas(e)}function a(e){return String(e).replace(/%/g,"&#37;").replace(/,/g,"&#44;")}function i(e){return e.map(r=>r==="divider"?'<li class="dropdown-divider"></li>':`
			<li class="dropdown-item placeholder-wave">
				<div class="placeholder" style="width: 20px;"></div>
				<div class="placeholder col-${r}"></div>
			</li>`).join("")}function m(){Object.keys(P).forEach(function(e){d.registerHelper(e,P[e])})}return P}},30076:(B,S,d)=>{var h,y;const P=d(29869);h=[d(77918),d(81335)],y=function(k,L){return P(k,L,config.relative_path)}.apply(S,h),y!==void 0&&(B.exports=y)},30637:(B,S,d)=>{var h,y;h=[d(49897),d(81335),d(33530),d(29930)],y=function(P,k,L,b){const I={};function f(){return ajaxify.data.template.name.startsWith("admin/")}return I.handle=function(){$('[component="user/invite"]').on("click",function(u){u.preventDefault(),P.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(U=>{k.parse("modals/invite",{groups:U},function(w){L.dialog({message:w,title:`[[${f()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${f()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${f()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:I.send}}})})}).catch(b.error)})},I.send=function(){const u=$("#invite-modal-emails"),U=$("#invite-modal-groups"),w={emails:u.val().split(",").map(p=>p.trim()).filter(Boolean).filter((p,v,t)=>v===t.indexOf(p)).join(","),groupsToJoin:U.val()};w.emails&&P.post(`/users/${app.user.uid}/invites`,w).then(()=>{b.success(`[[${f()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${w.emails.replace(/,/g,"&#44; ")}]]`)}).catch(b.error)},I}.apply(S,h),y!==void 0&&(B.exports=y)},34405:(B,S,d)=>{var h,y;h=[d(49897),d(29930),d(36e3),d(9787),d(35786)],y=function(P,k,{Textcomplete:L},{TextareaEditor:b},{ContenteditableEditor:I}){const f={},u={delay:200,appendTo:null};f.init=w=>{const p={...u,...w},{input:v,onSelect:t}=p;app.loadJQueryUI(function(){v.autocomplete({...p,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(l,o){U(v,t,l,o)}})})},f.user=function(w,p,v){typeof p=="function"&&(v=p,p={}),p=p||{},f.init({input:w,onSelect:v,source:(t,l)=>{p.query=t.term,P.get("/api/users",p,function(o,E){if(o)return k.error(o);if(E&&E.users){const x=E.users.map(function(C){const A=$("<div></div>").html(C.username).text();return C&&{label:A,value:A,user:{uid:C.uid,name:C.username,slug:C.userslug,username:C.username,userslug:C.userslug,displayname:C.displayname,picture:C.picture,banned:C.banned,"icon:text":C["icon:text"],"icon:bgColor":C["icon:bgColor"]}}});l(x)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.group=function(w,p){f.init({input:w,onSelect:p,source:(v,t)=>{socket.emit("groups.search",{query:v.term},function(l,o){if(l)return k.error(l);if(o&&o.length){const E=o.map(function(x){return x&&{label:x.name,value:x.name,group:x}});t(E)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.tag=function(w,p){f.init({input:w,onSelect:p,delay:100,source:(v,t)=>{socket.emit("topics.autocompleteTags",{query:v.term,cid:ajaxify.data.cid||0},function(l,o){if(l)return k.error(l);o&&t(o),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function U(w,p,v,t){p=p||function(){};const l=jQuery.Event("keypress");l.which=13,l.keyCode=13,setTimeout(function(){w.trigger(l)},100),p(v,t)}return f.setup=function({element:w,strategies:p,options:v}){const t=w.get(0);if(t){var l;if(t.nodeName==="TEXTAREA"||t.nodeName==="INPUT"?l=new b(t):t.nodeName==="DIV"&&t.getAttribute("contenteditable")==="true"&&(l=new I(t)),!l)throw new Error("unknown target element type");t.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var o=new L(l,p,{dropdown:v});return o.on("rendered",function(){o.dropdown.items.length&&o.dropdown.items[0].activate()}),o}},f}.apply(S,h),y!==void 0&&(B.exports=y)},49897:(B,S,d)=>{d.r(S),d.d(S,{del:()=>v,get:()=>f,head:()=>u,patch:()=>w,post:()=>U,put:()=>p});var h=d(91749),y=d.n(h),P=d(33530),k=d.n(P);const L=config.relative_path+"/api/v3";async function b(t,l){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:L+t.url,typeof l=="function"){I(t).then(o=>l(null,o),o=>{let E=o;o instanceof Error||(E=new Error(String(o)));const x=E.message||String(E);if(x&&!x.startsWith("[[error:")&&(x.toLowerCase()==="fetch failed"||x.toLowerCase()==="failed to fetch"||x.toLowerCase().includes("networkerror")||x.toLowerCase().includes("network")&&x.toLowerCase().includes("failed"))){const A=new Error("[[error:no-connection]]");A.originalError=E,E=A}l(E)});return}try{return await I(t)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:E}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,P.confirm)("[[error:api.reauth-required]]",x=>{x&&ajaxify.go(E)})}throw o}}async function I(t){const{url:l}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,h.fire)("filter:api.options",{options:t}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}t.data&&(t.body=t.data,delete t.data);let o;try{o=await fetch(l,t)}catch(s){const c=s.message||s.toString()||String(s),D=s.name||"Error";if(D==="TypeError"&&(c.toLowerCase().includes("fetch")||c.toLowerCase().includes("network")||c.toLowerCase().includes("failed to fetch")||c.toLowerCase().includes("load failed"))||c.toLowerCase().includes("cors")||c.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:l,method:t.method||"GET",error:c,name:D});const N=new Error("[[error:no-connection]]");throw N.originalError=s,N}throw console.error("[API] Unexpected fetch error:",{url:l,method:t.method||"GET",error:c,name:D}),s}const{headers:E}=o;if(E.get("x-redirect"))return I({url:E.get("x-redirect"),...t});const x=E.get("content-type"),C=x&&x.startsWith("application/json");let A;if(t.method!=="HEAD")try{C?A=await o.json():A=await o.text()}catch(s){throw console.error("[API] Error parsing response:",{url:l,status:o.status,statusText:o.statusText,contentType:x,error:s.message}),new Error("[[error:invalid-json]]")}if(!o.ok){let s;throw A?C&&A.status&&A.status.message?s=A.status.message:typeof A=="string"?s=A:s=o.statusText||"Request failed":s=o.statusText||"Request failed",new Error(s)}return C&&A&&A.hasOwnProperty("status")&&A.hasOwnProperty("response")?A.response:A}function f(t,l,o){return b({url:t+(l&&Object.keys(l).length?"?"+$.param(l):"")},o)}function u(t,l,o){return b({url:t+(l&&Object.keys(l).length?"?"+$.param(l):""),method:"HEAD"},o)}function U(t,l,o){return b({url:t,method:"POST",data:l,headers:{"x-csrf-token":config.csrf_token}},o)}function w(t,l,o){return b({url:t,method:"PATCH",data:l,headers:{"x-csrf-token":config.csrf_token}},o)}function p(t,l,o){return b({url:t,method:"PUT",data:l,headers:{"x-csrf-token":config.csrf_token}},o)}function v(t,l,o){return b({url:t,method:"DELETE",data:l,headers:{"x-csrf-token":config.csrf_token}},o)}},86296:(B,S,d)=>{var h,y;h=[d(49897),d(33530),d(29930)],y=function(P,k,L){const b={};return b.init=function(I){const f=k.dialog({message:`
				<label class="form-label">[[admin/manage/users:new-email]]</label>
				<input id="newEmail" class="form-control" type="text" value="${utils.escapeHTML(I.email||"")}">
			`,title:"[[admin/manage/users:change-email]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){const u=f.find("#newEmail").val();return P.post("/users/"+I.uid+"/emails",{skipConfirmation:!0,email:u}).then(()=>{f.modal("hide"),I.onSuccess(u)}).catch(L.error),!1}}}})},b}.apply(S,h),y!==void 0&&(B.exports=y)},91847:(B,S,d)=>{var h,y;h=[d(17459),d(81335),d(34405),d(49897),d(13230),d(33530),d(29930),d(30637),d(30076),d(86296)],y=function(P,k,L,b,I,f,u,U,w,p){const v={};v.init=function(){$("#results-per-page").val(ajaxify.data.resultsPerPage).on("change",function(){const a=utils.params();a.resultsPerPage=$("#results-per-page").val();const i=E(a);ajaxify.go(window.location.pathname+"?"+i)}),$(".export-csv").on("click",function(){socket.once("event:export-users-csv",function(){u.remove("export-users-start"),u.alert({alert_id:"export-users",type:"success",title:"[[global:alert.success]]",message:"[[admin/manage/users:export-users-completed]]",clickfn:function(){window.location.href=config.relative_path+"/api/admin/users/csv"},timeout:0})});const i=[{label:"[[admin/manage/users:export-field-email]]",field:"email",selected:!0},{label:"[[admin/manage/users:export-field-username]]",field:"username",selected:!0},{label:"[[admin/manage/users:export-field-uid]]",field:"uid",selected:!0},{label:"[[admin/manage/users:export-field-ip]]",field:"ip",selected:!0},{label:"[[admin/manage/users:export-field-joindate]]",field:"joindate",selected:!1},{label:"[[admin/manage/users:export-field-lastonline]]",field:"lastonline",selected:!1},{label:"[[admin/manage/users:export-field-lastposttime]]",field:"lastposttime",selected:!1},{label:"[[admin/manage/users:export-field-reputation]]",field:"reputation",selected:!1},{label:"[[admin/manage/users:export-field-postcount]]",field:"postcount",selected:!1},{label:"[[admin/manage/users:export-field-topiccount]]",field:"topiccount",selected:!1},{label:"[[admin/manage/users:export-field-profileviews]]",field:"profileviews",selected:!1},{label:"[[admin/manage/users:export-field-followercount]]",field:"followerCount",selected:!1},{label:"[[admin/manage/users:export-field-followingcount]]",field:"followingCount",selected:!1},{label:"[[admin/manage/users:export-field-fullname]]",field:"fullname",selected:!1},{label:"[[admin/manage/users:export-field-birthday]]",field:"birthday",selected:!1},{label:"[[admin/manage/users:export-field-signature]]",field:"signature",selected:!1},{label:"[[admin/manage/users:export-field-aboutme]]",field:"aboutme",selected:!1}].concat(ajaxify.data.customUserFields.map(e=>({label:e.name,field:e.key,selected:!1}))).map((e,n)=>`
				<div class="form-check mb-2">
					<input data-field="${e.field}" class="form-check-input" type="checkbox" id="option-${n}" ${e.selected?"checked":""}>
					<label class="form-check-label" for="option-${n}">
						${e.label}
					</label>
				</div>`).join(""),m=f.dialog({message:i,title:"[[admin/manage/users:export-users-fields-title]]",buttons:{submit:{label:"[[admin/manage/users:export]]",callback:function(){const e=m.find("[data-field]").filter((n,r)=>$(r).is(":checked")).map((n,r)=>$(r).attr("data-field")).get();socket.emit("admin.user.exportUsersCSV",{fields:e},function(n){if(n)return u.error(n);u.alert({alert_id:"export-users-start",message:"[[admin/manage/users:export-users-started]]",timeout:Math.max(5e3,ajaxify.data.userCount/5e3*500)})})}}}});return!1});function s(){const a=[];return $('.users-table [component="user/select/single"]').each(function(){$(this).is(":checked")&&a.push($(this).attr("data-uid"))}),a}function c(a,i){$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(a).each(function(){$(this).toggleClass("hidden",!i)})}function D(){$('.users-table [component="user/select/single"]').prop("checked",!1),$('.users-table [component="user/select/all"]').prop("checked",!1)}function R(a){const i=document.querySelector(`.users-table [component="user/select/single"][data-uid="${a}"]`);if(i){const m=i.closest(".user-row");m.parentNode.removeChild(m)}}function N(a,i,m){return function(e){if(e)return u.error(e);u.success(a),i&&c(i,m),D()}}function _(a,i,m){u.success(a),i&&c(i,m),D()}$('[component="user/select/all"]').on("click",function(){$('.users-table [component="user/select/single"]').prop("checked",$(this).is(":checked"))}),$(".manage-groups").on("click",function(){const a=s();if(!a.length)return u.error("[[error:no-users-selected]]"),!1;socket.emit("admin.user.loadGroups",a,function(i,m){if(i)return u.error(i);k.render("admin/partials/manage_user_groups",m).then(function(e){const n=f.dialog({message:e,title:"[[admin/manage/users:manage-groups]]",onEscape:!0});n.on("shown.bs.modal",function(){L.group(n.find(".group-search"),function(r,g){const M=$(r.target).attr("data-uid");b.put("/groups/"+g.item.group.slug+"/membership/"+M,void 0).then(()=>{g.item.group.nameEscaped=P.escape(g.item.group.displayName),app.parseAndTranslate("admin/partials/manage_user_groups",{users:[{groups:[g.item.group]}]},function(T){$("[data-uid="+M+"] .group-area").append(T.find(".group-area").html())})}).catch(u.error)})}),n.on("click",".group-area a",function(){n.modal("hide")}),n.on("click",".remove-group-icon",function(){const r=$(this).parents("[data-group-name]"),g=r.attr("data-group-name"),M=$(this).parents("[data-uid]").attr("data-uid");return b.del("/groups/"+I(g)+"/membership/"+M).then(()=>{r.remove()}).catch(u.error),!1})})})}),$(".set-reputation").on("click",function(){const a=s();if(!a.length)return u.error("[[error:no-users-selected]]"),!1;let i="";if(a.length===1){const e=ajaxify.data.users.find(n=>n&&n.uid===parseInt(a[0],10));e&&(i=String(e.reputation))}const m=f.dialog({message:`<input id="new-reputation" type="text" class="form-control" value="${i}">`,title:"[[admin/manage/users:set-reputation]]",onEscape:!0,buttons:{submit:{label:"[[global:save]]",callback:function(){const e=m.find("#new-reputation").val();if(!utils.isNumber(e))return u.error("[[error:invalid-data]]"),!1;socket.emit("admin.user.setReputation",{value:e,uids:a}).then(()=>{a.forEach(n=>{$(`[component="user/reputation"][data-uid="${n}"]`).text(w.formattedNumber(e));const r=ajaxify.data.users.find(g=>g&&g.uid===parseInt(n,10));r&&(r.reputation=e)})}).catch(u.error)}}}});m.on("shown.bs.modal",()=>{m.find("#new-reputation").selectRange(0,m.find("#new-reputation").val().length)})}),$(".ban-user").on("click",function(){const a=s();if(!a.length)return u.error("[[error:no-users-selected]]"),!1;f.confirm(a.length>1?"[[admin/manage/users:alerts.confirm-ban-multi]]":"[[admin/manage/users:alerts.confirm-ban]]",function(i){i&&Promise.all(a.map(function(m){return b.put("/users/"+m+"/ban")})).then(()=>{_("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(u.error)})}),$(".ban-user-temporary").on("click",function(){const a=s();if(!a.length)return u.error("[[error:no-users-selected]]"),!1;k.render("modals/temporary-ban",{}).then(function(i){const m=f.dialog({title:"[[user:ban-account]]",message:i,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[admin/manage/users:alerts.button-ban-x, "+a.length+"]]",callback:function(){const e=m.find("form").serializeArray().reduce(function(r,g){return r[g.name]=g.value,r},{}),n=e.length>0?Date.now()+e.length*1e3*60*60*(parseInt(e.unit,10)?24:1):0;Promise.all(a.map(function(r){return b.put("/users/"+r+"/ban",{until:n,reason:e.reason})})).then(()=>{_("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(u.error)}}}})})}),$(".unban-user").on("click",function(){const a=s();if(!a.length)return u.error("[[error:no-users-selected]]"),!1;k.render("modals/unban",{}).then(function(i){const m=f.dialog({title:"[[user:unban-account]]",message:i,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:unban-account]]",callback:function(){const e=m.find("form").serializeArray().reduce(function(n,r){return n[r.name]=r.value,n},{});Promise.all(a.map(function(n){return b.del("/users/"+n+"/ban",{reason:e.reason||""})})).then(()=>{_("[[admin/manage/users:alerts.unban-success]]",".ban",!1)}).catch(u.error)}}}})})}),$(".reset-lockout").on("click",function(){const a=s();a.length&&socket.emit("admin.user.resetLockouts",a,N("[[admin/manage/users:alerts.lockout-reset-success]]"))}),$(".change-email").on("click",function(){const a=s();if(a.length!==1)return u.error("[[admin/manage/users:alerts.select-a-single-user-to-change-email]]");p.init({uid:a[0],onSuccess:function(i){c(".notvalidated",!1),c(".pending",!1),c(".expired",!1),c(".validated",!1),c(".validated-by-admin",!!i),c(".no-email",!i),$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(".validated-by-admin .email").text(i)}})}),$(".validate-email").on("click",function(){const a=s();a.length&&f.confirm("[[admin/manage/users:alerts.confirm-validate-email]]",function(i){i&&socket.emit("admin.user.validateEmail",a,function(m){if(m)return u.error(m);u.success("[[admin/manage/users:alerts.validate-email-success]]"),c(".notvalidated",!1),c(".pending",!1),c(".expired",!1),c(".validated",!1),c(".validated-by-admin",!0),D()})})}),$(".send-validation-email").on("click",function(){const a=s();a.length&&socket.emit("admin.user.sendValidationEmail",a,function(i){if(i)return u.error(i);u.success("[[notifications:email-confirm-sent]]")})}),$(".change-password").on("click",async function(){const a=s();if(!a.length)return;async function i(e){const n=e.find("#newPassword").val(),r=e.find("#confirmPassword").val();if(n!==r)throw new Error("[[[user:change-password-error-match]]");await Promise.all(a.map(g=>b.put("/users/"+g+"/password",{currentPassword:"",newPassword:n})))}const m=f.dialog({message:`<div class="d-flex flex-column gap-2">
					<label class="form-label">[[user:new-password]]</label>
					<input id="newPassword" class="form-control" type="text">
					<label class="form-label">[[user:confirm-password]]</label>
					<input id="confirmPassword" class="form-control" type="text">
				</div>`,title:"[[admin/manage/users:change-password]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){return i(m).then(()=>{m.modal("hide")}).catch(u.error),!1}}}})}),$(".password-reset-email").on("click",function(){const a=s();a.length&&f.confirm("[[admin/manage/users:alerts.password-reset-confirm]]",function(i){i&&socket.emit("admin.user.sendPasswordResetEmail",a,N("[[admin/manage/users:alerts.password-reset-email-sent]]"))})}),$(".force-password-reset").on("click",function(){const a=s();a.length&&f.confirm("[[admin/manage/users:alerts.confirm-force-password-reset]]",function(i){i&&socket.emit("admin.user.forcePasswordReset",a,N("[[admin/manage/users:alerts.validate-force-password-reset-success]]"))})}),$(".delete-user").on("click",()=>{z("[[admin/manage/users:alerts.confirm-delete]]","/account")}),$(".delete-user-content").on("click",()=>{z("[[admin/manage/users:alerts.confirm-delete-content]]","/content")}),$(".delete-user-and-content").on("click",()=>{z("[[admin/manage/users:alerts.confirm-purge]]","")});const G=document.querySelector(".users-table"),J=document.getElementById("action-dropdown");G.addEventListener("change",a=>{(a.target.closest('[component="user/select/single"]')||a.target.closest('[component="user/select/all"]'))&&(s().length?J.removeAttribute("disabled"):J.setAttribute("disabled","disabled"))});function z(a,i){const m=s();m.length&&f.confirm(a,function(e){e&&Promise.all(m.map(n=>b.del(`/users/${encodeURIComponent(n)}${i}`,{}).then(()=>{i!=="/content"&&R(n)}))).then(()=>{i!=="/content"?u.success("[[admin/manage/users:alerts.delete-success]]"):u.success("[[admin/manage/users:alerts.delete-content-success]]"),D(),$('.users-table [component="user/select/single"]').length||ajaxify.refresh()}).catch(u.error)})}function Y(){$('[data-action="create"]').on("click",function(){return k.render("admin/partials/create_user_modal",{}).then(function(a){const i=f.dialog({message:a,title:"[[admin/manage/users:alerts.create]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},create:{label:"[[admin/manage/users:alerts.button-create]]",className:"btn-primary",callback:function(){return V.call(this),!1}}}});i.on("shown.bs.modal",function(){i.find("#create-user-name").focus()})}),!1})}function V(){const a=this,i=document.getElementById("create-user-name").value,m=document.getElementById("create-user-email").value,e=document.getElementById("create-user-password").value,n=document.getElementById("create-user-password-again").value,r=$("#create-modal-error");if(e!==n)return r.translateHtml("[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]").removeClass("hide");const g={username:i,email:m,password:e};b.post("/users",g).then(()=>{a.modal("hide"),a.on("hidden.bs.modal",function(){ajaxify.refresh()}),u.success("[[admin/manage/users:alerts.create-success]]")}).catch(M=>r.translateHtml("[[admin/manage/users:alerts.error-x, "+M.message+"]]").removeClass("hidden"))}t(),Y(),x(),A(),U.handle()};function t(){function s(){$(".fa-spinner").removeClass("hidden"),l({searchBy:$("#user-search-by").val(),query:$("#user-search").val(),page:1})}$("#user-search").on("keyup",utils.debounce(s,250)),$("#user-search-by").on("change",s)}function l(s){const c=utils.params();c.searchBy=s.searchBy,c.query=s.query,c.page=s.page,c.sortBy=c.sortBy||"lastonline";const D=$.param(c);$.get(config.relative_path+"/api/admin/manage/users?"+D,function(R){o(R);const N=config.relative_path+"/admin/manage/users?"+D;history.pushState&&history.pushState({url:N},null,window.location.protocol+"//"+window.location.host+N)}).fail(function(R){R&&R.responseJSON&&R.responseJSON.error&&u.error(R.responseJSON.error)})}function o(s){k.render("partials/paginator",{pagination:s.pagination}).then(function(c){$(".pagination-container").replaceWith(c)}),app.parseAndTranslate("admin/manage/users","users",s,function(c){if($(".users-table tbody tr").remove(),$(".users-table tbody").append(c),c.find(".timeago").timeago(),$(".fa-spinner").addClass("hidden"),!$("#user-search").val()){$("#user-found-notify").addClass("hidden"),$("#user-notfound-notify").addClass("hidden");return}s&&s.users.length===0?($("#user-notfound-notify").translateHtml("[[admin/manage/users:search.not-found]]").removeClass("hidden"),$("#user-found-notify").addClass("hidden")):($("#user-found-notify").translateHtml(P.compile("admin/manage/users:alerts.x-users-found",s.matchCount,s.timing)).removeClass("hidden"),$("#user-notfound-notify").addClass("hidden"))})}function E(s){return $("#user-search").val()?(s.query=$("#user-search").val(),s.searchBy=$("#user-search-by").val()):(delete s.query,delete s.searchBy),$.param(s)}function x(){$(".users-table thead th").on("click",function(){const c=$(this).attr("data-sort");if(!c)return;const D=utils.params();D.sortBy=c,ajaxify.data.sortBy===c?D.sortDirection=ajaxify.data.reverse?"asc":"desc":D.sortDirection="desc";const R=E(D);ajaxify.go("admin/manage/users?"+R)})}function C(){const s=[];return $("#filter-by").find("[data-filter-by]").each(function(){$(this).find(".fa-check").length&&s.push($(this).attr("data-filter-by"))}),s}function A(){let s=C();$("#filter-by").on("click","li",function(){const c=$(this);return c.find("i").toggleClass("fa-check",!c.find("i").hasClass("fa-check")),!1}),$("#filter-by").on("hidden.bs.dropdown",function(){const c=C();let D=c.length!==s.length;if(c.length===s.length&&c.forEach(function(R,N){R!==s[N]&&(D=!0)}),s=C(),D){const R=utils.params();R.filters=c;const N=E(R);ajaxify.go("admin/manage/users?"+N)}})}return v}.apply(S,h),y!==void 0&&(B.exports=y)}}]);
