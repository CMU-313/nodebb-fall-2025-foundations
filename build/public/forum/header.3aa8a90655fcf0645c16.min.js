"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13201,34271,34590,49897,68326,98813,99127],{11599:(k,v,c)=>{var l,g;l=[c(52473),c(91749),c(49897)],g=function(E,T,w){const f={};f.prepareDOM=function(){const i=$('[component="chat/dropdown"]');i.on("show.bs.dropdown",n=>{d("loadChatsDropdown",$(n.target).parent().find('[component="chat/list"]'))}),i.each((n,r)=>{const t=$(r).parent().find(".dropdown-menu");t.hasClass("show")&&d("loadChatsDropdown",t.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",u),socket.on("event:chats.receive",u),socket.removeListener("event:chats.typing",e),socket.on("event:chats.typing",e),socket.removeListener("event:chats.roomRename",s),socket.on("event:chats.roomRename",s),socket.on("event:unread.updateChatCount",async function(n){if(n){const[o,m]=await app.require(["chat","forum/chats"]);if(o.isFromBlockedUser(n.fromUid)||o.isLookingAtRoom(n.roomId)||app.user.uid===parseInt(n.fromUid,10))return;m.markChatPageElUnread(n),m.updateTeaser(n.roomId,n.teaser)}let{count:r}=await w.get("/chats/unread");const t=E.get("chat/icon");r=Math.max(0,r),t.toggleClass("fa-comment",r>0).toggleClass("fa-comment-o",r<=0);const a=r>99?"99+":r;E.get("chat/icon").toggleClass("unread-count",r>0).attr("data-content",a),E.get("chat/count").toggleClass("hidden",r<=0).text(a),T.fire("action:chat.updateCount",{count:r})})};function u(i){d("onChatMessageReceived",i)}function e(i){d("onUserTyping",i)}function s(i){d("onRoomRename",i)}async function d(i,n){(await app.require("chat"))[i](n)}return f}.apply(v,l),g!==void 0&&(k.exports=g)},19046:(k,v,c)=>{var l,g;l=[c(91749)],g=function(E){const T={},w={ignoring:1,notwatching:2,watching:3};T.initUnreadTopics=function(){const e=app.user.unreadData;function s(n){if(n&&n.posts&&n.posts.length&&e){const r=n.posts[0];if(parseInt(r.uid,10)===parseInt(app.user.uid,10)||!r.topic.isFollowing&&r.categoryWatchState!==w.watching)return;const t=r.topic.tid;(!e[""][t]||!e.new[t]||!e.watched[t]||!e.unreplied[t])&&i(t),e[""][t]||(d(""),e[""][t]=!0),r.isMain&&parseInt(r.uid,10)!==parseInt(app.user.uid,10)&&!e.new[t]&&(d("new"),e.new[t]=!0),parseInt(r.topic.postcount,10)<=1&&!e.unreplied[t]&&(d("unreplied"),e.unreplied[t]=!0),r.topic.isFollowing&&!e.watched[t]&&(d("watched"),e.watched[t]=!0)}}function d(n){const r="/unread"+(n?"?filter="+n:""),t=1+parseInt($('a[href="'+config.relative_path+r+'"].navigation-link i').attr("data-content"),10);u(r,t)}function i(n){$('[data-tid="'+n+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(n){delete e[n][ajaxify.data.tid]})}),socket.removeListener("event:new_post",s),socket.on("event:new_post",s),socket.removeListener("event:unread.updateCount",f),socket.on("event:unread.updateCount",f)};function f(e){u("/unread",e.unreadTopicCount),u("/unread?filter=new",e.unreadNewTopicCount),u("/unread?filter=watched",e.unreadWatchedTopicCount),u("/unread?filter=unreplied",e.unreadUnrepliedTopicCount)}function u(e,s){if(!utils.isNumber(s))return;s=Math.max(0,s);const d=s>99?"99+":s,i=$('a[href="'+config.relative_path+e+'"].navigation-link');i.find("i").toggleClass("unread-count",s>0).attr("data-content",d),i.find('[component="navigation/count"]').toggleClass("hidden",s<=0).text(s),i.length&&($('#mobile-menu [data-unread-url="'+e+'"]').attr("data-content",d),$('[component="unread/count"][data-unread-url="'+e+'"]').toggleClass("hidden",s<=0).text(d)),E.fire("action:unread.updateCount",{url:e,count:s})}return T.updateUnreadTopicCount=u,T}.apply(v,l),g!==void 0&&(k.exports=g)},49897:(k,v,c)=>{c.r(v),c.d(v,{del:()=>r,get:()=>e,head:()=>s,patch:()=>i,post:()=>d,put:()=>n});var l=c(91749),g=c.n(l),E=c(33530),T=c.n(E);const w=config.relative_path+"/api/v3";async function f(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:w+t.url,typeof a=="function"){u(t).then(o=>a(null,o),o=>{let m=o;o instanceof Error||(m=new Error(String(o)));const C=m.message||String(m);if(C&&!C.startsWith("[[error:")&&(C.toLowerCase()==="fetch failed"||C.toLowerCase()==="failed to fetch"||C.toLowerCase().includes("networkerror")||C.toLowerCase().includes("network")&&C.toLowerCase().includes("failed"))){const p=new Error("[[error:no-connection]]");p.originalError=m,m=p}a(m)});return}try{return await u(t)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:m}=await(0,l.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",C=>{C&&ajaxify.go(m)})}throw o}}async function u(t){const{url:a}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,l.fire)("filter:api.options",{options:t}))}catch(h){console.error("[API] Error in filter:api.options hook:",h)}t.data&&(t.body=t.data,delete t.data);let o;try{o=await fetch(a,t)}catch(h){const y=h.message||h.toString()||String(h),A=h.name||"Error";if(A==="TypeError"&&(y.toLowerCase().includes("fetch")||y.toLowerCase().includes("network")||y.toLowerCase().includes("failed to fetch")||y.toLowerCase().includes("load failed"))||y.toLowerCase().includes("cors")||y.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:a,method:t.method||"GET",error:y,name:A});const _=new Error("[[error:no-connection]]");throw _.originalError=h,_}throw console.error("[API] Unexpected fetch error:",{url:a,method:t.method||"GET",error:y,name:A}),h}const{headers:m}=o;if(m.get("x-redirect"))return u({url:m.get("x-redirect"),...t});const C=m.get("content-type"),D=C&&C.startsWith("application/json");let p;if(t.method!=="HEAD")try{D?p=await o.json():p=await o.text()}catch(h){throw console.error("[API] Error parsing response:",{url:a,status:o.status,statusText:o.statusText,contentType:C,error:h.message}),new Error("[[error:invalid-json]]")}if(!o.ok){let h;throw p?D&&p.status&&p.status.message?h=p.status.message:typeof p=="string"?h=p:h=o.statusText||"Request failed":h=o.statusText||"Request failed",new Error(h)}return D&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function e(t,a,o){return f({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},o)}function s(t,a,o){return f({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},o)}function d(t,a,o){return f({url:t,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}function i(t,a,o){return f({url:t,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}function n(t,a,o){return f({url:t,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}function r(t,a,o){return f({url:t,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}},71949:(k,v,c)=>{var l;l=function(){const g={};g.prepareDOM=function(){const w=$('[component="notifications"] [data-bs-toggle="dropdown"]');w.on("show.bs.dropdown",async f=>{const u=await app.require("notifications"),e=$(f.target);u.loadNotifications(e,e.parent().find('[component="notifications/list"]'))}),w.each((f,u)=>{const e=$(u),s=e.parent().find(".dropdown-menu");s.hasClass("show")&&app.require("notifications").then(d=>{d.loadNotifications(e,s.find('[component="notifications/list"]'))})}),socket.removeListener("event:new_notification",E),socket.on("event:new_notification",E),socket.removeListener("event:notifications.updateCount",T),socket.on("event:notifications.updateCount",T)};async function E(w){(await app.require("notifications")).onNewNotification(w)}async function T(w){(await app.require("notifications")).updateNotifCount(w)}return g}.call(v,c,v,k),l!==void 0&&(k.exports=l)},86174:(k,v,c)=>{var l,g;l=[c(19046),c(71949),c(11599),c(29930)],g=function(E,T,w,f){const u={};u.prepareDOM=function(){app.user.uid>0&&E.initUnreadTopics(),T.prepareDOM(),w.prepareDOM(),e(),s(),d()};function e(){$('[component="header/usercontrol"] [data-status]').off("click").on("click",function(i){const n=$(this).attr("data-status");socket.emit("user.setStatus",n,function(r){if(r)return f.error(r);$('[data-uid="'+app.user.uid+'"] [component="user/status"], [component="header/profilelink"] [component="user/status"]').removeClass("away online dnd offline").addClass(n),$('[component="header/usercontrol"] [data-status]').each(function(){$(this).toggleClass("selected",$(this).attr("data-status")===n)}),app.user.status=n}),i.preventDefault()})}function s(){const i=utils.findBootstrapEnvironment();if(i==="xs"||i==="sm"||utils.isTouchDevice())return;const n=$("#header-menu .nav-item[title]");n.tooltip({trigger:"manual",animation:!1,placement:"bottom"}),n.on("mouseenter",function(r){const t=$(r.target);t.hasClass("dropdown-menu")||!!t.parents(".dropdown-menu").length||$(this).tooltip("show")}),n.on("click mouseleave",function(){$(this).tooltip("hide")})}function d(){$("body").on("click",'[component="user/logout"]',function(){return c.e(20739).then(function(){var i=[c(75427)];(function(n){n()}).apply(null,i)}).catch(c.oe),!1})}return u}.apply(v,l),g!==void 0&&(k.exports=g)}}]);
