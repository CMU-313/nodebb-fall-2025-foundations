(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,56974,97082],{18675:()=>{(function(v){var j=v(window),c=function(e,a,t,n){if(arguments.length===3||n){if(t<e)return e;if(t>a)return a}return t},y=function(e){e.clientX=e.originalEvent.touches[0].clientX,e.clientY=e.originalEvent.touches[0].clientY},g=function(e){var a=(e.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(a){var t={width:0,height:0},n=new Image;return n.onload=function(){if(e.css("background-size")=="cover"){var s=e.innerWidth(),i=e.innerHeight(),r=s/i,u=n.width/n.height,o=1;u>=r?o=i/n.height:o=s/n.width,t.width=n.width*o,t.height=n.height*o}else t.width=n.width,t.height=n.height},n.src=a,t}};function x(e,a){this.element=e,this.options=a,this.init()}x.prototype.init=function(){var e=v(this.element),a=(e.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t=this.options;if(a){var n={width:0,height:0};(t.bound||t.units=="percent")&&(n=g(e)),v(window).on("keydown.dbg",s=>{var i=e.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],r=parseInt(i[1])||0,u=parseInt(i[2])||0;t.units=="percent"&&(r=Math.round(r/-200*n.width),u=Math.round(u/-200*n.height));var o=0,d=0;return s.which===37?o=-5:s.which===39?o=5:s.which===38?d=-5:s.which===40&&(d=5),t.units==="percent"?(r=t.axis==="y"?r:c(-n.width/2,0,r+o,t.bound),u=t.axis==="x"?u:c(-n.height/2,0,u+d,t.bound),e.css("background-position",r/n.width*-200+"% "+u/n.height*-200+"%")):(r=t.axis==="y"?r:c(e.innerWidth()-n.width,0,r+o,t.bound),u=t.axis==="x"?u:c(e.innerHeight()-n.height,0,u+d,t.bound)),[37,38,39,40].includes(s.which)?!1:void 0}),e.on("mousedown.dbg touchstart.dbg",function(s){if(s.target===e[0]){if(s.preventDefault(),s.originalEvent.touches)y(s);else if(s.which!==1)return;var i=s.clientX,r=s.clientY,u=e.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],o=parseInt(u[1])||0,d=parseInt(u[2])||0;t.units=="percent"&&(o=Math.round(o/-200*n.width),d=Math.round(d/-200*n.height)),j.on("mousemove.dbg touchmove.dbg",function(C){C.preventDefault(),C.originalEvent.touches&&y(C);var f=C.clientX,b=C.clientY;t.units=="percent"?(o=t.axis==="y"?o:c(-n.width/2,0,o+f-i,t.bound),d=t.axis==="x"?d:c(-n.height/2,0,d+b-r,t.bound),e.css("background-position",o/n.width*-200+"% "+d/n.height*-200+"%")):(o=t.axis==="y"?o:c(e.innerWidth()-n.width,0,o+f-i,t.bound),d=t.axis==="x"?d:c(e.innerHeight()-n.height,0,d+b-r,t.bound),e.css("background-position",o+"px "+d+"px")),i=f,r=b}),j.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){t.done&&t.done(),j.off("mousemove.dbg touchmove.dbg"),j.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},x.prototype.disable=function(){var e=v(this.element);e.off("mousedown.dbg touchstart.dbg"),j.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},v.fn.backgroundDraggable=function(e){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=v(this),n;typeof e>"u"||typeof e=="object"?(e=v.extend({},v.fn.backgroundDraggable.defaults,e),n=new x(this,e),t.data("dbg",n)):typeof e=="string"&&t.data("dbg")&&(n=t.data("dbg"),x.prototype[e].apply(n,a))})},v.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(v,j,c)=>{"use strict";var y,g;y=[c(81335),c(49897),c(33530),c(29930)],g=function(x,e,a,t){const n={};n.banAccount=function(i,r){i=i||ajaxify.data.theirid,s({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(u){const o=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;e.put("/users/"+i+"/ban",{until:o,reason:u.reason||""}).then(()=>{if(typeof r=="function")return r();ajaxify.refresh()}).catch(t.error)}})},n.unbanAccount=function(i){s({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(r){e.del("/users/"+i+"/ban",{reason:r.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})},n.muteAccount=function(i,r){i=i||ajaxify.data.theirid,s({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(u){const o=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;e.put("/users/"+i+"/mute",{until:o,reason:u.reason||""}).then(()=>{if(typeof r=="function")return r();ajaxify.refresh()}).catch(t.error)}})},n.unmuteAccount=function(i){s({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(r){e.del("/users/"+i+"/mute",{reason:r.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})};function s(i){x.render(i.tpl,{}).then(function(r){const u=a.dialog({title:i.title,message:r,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:i.title,callback:function(){const o=u.find("form").serializeArray().reduce(function(d,C){return d[C.name]=C.value,d},{});i.onSubmit(o)}}}})})}return n}.apply(j,y),g!==void 0&&(v.exports=g)},36684:(v,j,c)=>{"use strict";var y,g;y=[c(29930),c(18675)],g=function(x){const e={coverEl:null,saveFn:null};e.init=function(t,n,s,i){e.coverEl=t,e.saveFn=n,t.find(".upload").on("click",s),t.find(".resize").on("click",function(){a(t)}),t.find(".remove").on("click",i),t.on("dragover",e.onDragOver).on("drop",e.onDrop),t.find(".save").on("click",e.save),t.addClass("initialised")},e.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},e.onDrop=function(t){t.stopPropagation(),t.preventDefault();const n=t.originalEvent.dataTransfer.files,s=new FileReader;n.length&&n[0].type.match("image.*")&&(s.onload=function(i){e.coverEl.css("background-image","url("+i.target.result+")"),e.newCover=i.target.result},s.readAsDataURL(n[0]),a(e.coverEl))};function a(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),x.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return e.save=function(){e.coverEl.addClass("saving"),e.saveFn(e.newCover||void 0,e.coverEl.css("background-position"),function(t){t?x.error(t):(e.coverEl.toggleClass("active",0),e.coverEl.backgroundDraggable("disable"),e.coverEl.off("dragover",e.onDragOver),e.coverEl.off("drop",e.onDrop),x.success("[[modules:cover.saved]]")),e.coverEl.removeClass("saving")})},e}.apply(j,y),g!==void 0&&(v.exports=g)},47283:(v,j,c)=>{"use strict";var y,g;y=[c(49897),c(33530),c(29930)],g=function(x,e,a){const t={};t.account=function(s,i){n(s,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",i)},t.content=function(s,i){n(s,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",i)},t.purge=function(s,i){n(s,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",i)};function n(s,i,r,u,o){e.confirm(i,function(d){d&&x.del(`/users/${encodeURIComponent(s)}${r}`,{}).then(()=>{if(a.success(u),typeof o=="function")return o()}).catch(a.error)})}return t}.apply(j,y),g!==void 0&&(v.exports=g)},67910:(v,j,c)=>{"use strict";var y,g;y=[c(36684),c(72254),c(52473),c(17459),c(47283),c(28061),c(7524),c(49897),c(33530),c(29930)],g=function(x,e,a,t,n,s,i,r,u,o){const d={};let C;d.init=function(){C=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,f(),b(),C&&A(),a.get("account/follow").on("click",()=>h("follow")),a.get("account/unfollow").on("click",()=>h("unfollow")),a.get("account/chat").on("click",async function(){const{roomId:l}=await r.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),p=await app.require("chat");l?p.openChat(l):p.newChat(ajaxify.data.uid)}),a.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){a.get("account/chat").parent().removeClass("hidden")})}),a.get("account/ban").on("click",()=>s.banAccount(ajaxify.data.theirid)),a.get("account/mute").on("click",()=>s.muteAccount(ajaxify.data.theirid)),a.get("account/unban").on("click",()=>s.unbanAccount(ajaxify.data.theirid)),a.get("account/unmute").on("click",()=>s.unmuteAccount(ajaxify.data.theirid)),a.get("account/delete-account").on("click",()=>n.account(ajaxify.data.theirid)),a.get("account/delete-content").on("click",()=>n.content(ajaxify.data.theirid)),a.get("account/delete-all").on("click",()=>n.purge(ajaxify.data.theirid)),a.get("account/flag").on("click",k),a.get("account/already-flagged").on("click",w),a.get("account/block").on("click",()=>E("block")),a.get("account/unblock").on("click",()=>E("unblock"))};function f(){$(".account-sub-links li a").removeClass("active").each(function(){const l=$(this).attr("href");if(decodeURIComponent(l)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function b(){$('[component="profile/change/picture"]').on("click",function(){return i.openChangeModal(),!1})}function A(){x.init(a.get("account/cover"),function(l,p,m){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:l,position:p},m)},function(){e.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(l){l=(l.startsWith("http")?"":config.relative_path)+l+"?"+Date.now(),a.get("account/cover").css("background-image","url("+l+")")})},D)}function h(l){const p=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return r[l==="follow"?"put":"del"]("/users/"+p+"/follow",void 0,function(m){if(m)return o.error(m);a.get("account/follow").toggleClass("hide",l==="follow"),a.get("account/unfollow").toggleClass("hide",l==="unfollow"),o.success("[[global:alert."+l+", "+ajaxify.data.username+"]]")}),!1}function k(){c.e(6574).then(function(){var l=[c(6574)];(function(p){p.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,l)}).catch(c.oe)}function w(){const l=$(this).data("flag-id");c.e(6574).then(function(){var p=[c(6574)];(function(m){u.confirm("[[flags:modal-confirm-rescind]]",function(U){U&&m.rescind(l)})}).apply(null,p)}).catch(c.oe)}function E(l){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:l},function(p,m){if(p)return o.error(p);a.get("account/block").toggleClass("hidden",m),a.get("account/unblock").toggleClass("hidden",!m)}),!1}function D(){t.translate("[[user:remove-cover-picture-confirm]]",function(l){u.confirm(l,function(p){p&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(m){m?o.error(m):ajaxify.refresh()})})})}return d}.apply(j,y),g!==void 0&&(v.exports=g)},74902:(v,j,c)=>{"use strict";var y,g;y=[c(67910),c(33530),c(49897),c(29930)],g=function(x,e,a,t){const n={};function s(o){if(!o)return"";const d=o.replace(/<[^>]*>/g,"").trim(),C={of:!0,the:!0};return d.split(/\s+/).map(function(b,A){const h=b.toLowerCase();return A===0?h.charAt(0).toUpperCase()+h.slice(1):C[h]?h:h.charAt(0).toUpperCase()+h.slice(1)}).join(" ")}function i(o,d){if(!o)return"";const f=o.replace(/<[^>]*>/g,"").trim().split(/\s+/).map(function(b){const A=b.toLowerCase();return A.charAt(0).toUpperCase()+A.slice(1)}).join(" ");return d==="state"&&f.replace(/\s+/g,"").length===2?f.replace(/\s+/g,"").toUpperCase():d==="country"&&f.replace(/\s+/g,"").length===3?f.replace(/\s+/g,"").toUpperCase():f}n.init=function(){x.init(),app.enterRoom("user/"+ajaxify.data.theirid),r(),parseInt(ajaxify.data.emailChanged,10)===1&&e.alert({message:"[[user:emailUpdate.change-instructions]]",closeButton:!1}),socket.removeListener("event:user_status_change",u),socket.on("event:user_status_change",u)};function r(){if($('[component="posts"] [component="post/content"] img:not(.not-responsive), [component="aboutme"] img:not(.not-responsive)').addClass("img-fluid"),parseInt(ajaxify.data.uid,10)===parseInt(ajaxify.data.theirid,10)){if(!(ajaxify.data.customUserFields||[]).some(f=>f.key==="university"&&f.value)){const f=$('<div class="card p-2 mb-3" id="add-university-card"><a href="#" id="profile-add-university">Add University</a></div>'),b=$('[component="aboutme"]').first();if(b.length)b.after(f);else{const A=$(".account-stats").first();if(A.length)A.before(f);else{const h=$(".account .container").first();h.length?h.prepend(f):$("body").prepend(f)}}$("#profile-add-university").on("click",function(A){A.preventDefault(),e.dialog({title:"Add University",message:'<p><input class="form-control mb-2" id="boot-university" placeholder="University"></p><p><input class="form-control" id="boot-gradyear" placeholder="Graduation Year" type="number"></p>',buttons:{cancel:{label:"Cancel",className:"btn-light"},submit:{label:"Save",className:"btn-primary",callback:function(){var h=$("#boot-university").val()||"",k=$("#boot-gradyear").val()||"";h=s(h),k=k.toString().replace(/[^0-9]/g,"");var w={uid:ajaxify.data.theirid};if(h&&k){var E=k.slice(-2);w.university=h+" ('"+E+")"}else h&&(w.university=h);if(!w.university)return!1;a.put("/users/"+ajaxify.data.theirid,w).then(function(){t.success("[[user:profile-update-success]]");try{$("#add-university-card").remove();var D="University",l="fa-solid fa-graduation-cap",p=$('<div class="stat"><div class="align-items-center justify-content-center card card-header p-3 border-0 rounded-1 h-100 gap-2"><span class="stat-label text-xs fw-semibold"><span><i class="text-muted '+l+'"></i> '+D+'</span></span><span class="text-center fs-6 ff-secondary"></span></div></div>');p.find(".ff-secondary").text(w.university);var m=$(".account-stats .row").first();if(m.length)m.append(p);else{window.location.reload();return}ajaxify.data.customUserFields=ajaxify.data.customUserFields||[],ajaxify.data.customUserFields.push({key:"university",name:D,value:w.university,icon:l,type:"input-text"}),ajaxify.data.university=w.university}catch{window.location.reload()}}).catch(function(D){t.error(D)})}}}})})}if(!(ajaxify.data.customUserFields||[]).some(f=>f.key==="location"&&f.value)){const f=$('<div class="card p-2 mb-3" id="add-location-card"><a href="#" id="profile-add-location">Add Location</a></div>'),b=$(".account-stats .stat").filter(function(){return $(this).text().trim().includes("University")}).first();if(b.length)b.after(f);else{const A=$('[component="aboutme"]').first();A.length?A.after(f):$(".account-stats").first().length?$(".account-stats").first().before(f):$(".account .container").first().length?$(".account .container").first().prepend(f):$("body").prepend(f)}$("#profile-add-location").on("click",function(A){A.preventDefault(),e.dialog({title:"Add Location",message:'<p><input class="form-control mb-2" id="boot-city" placeholder="City"></p><p><input class="form-control mb-2" id="boot-state" placeholder="State"></p><p><input class="form-control" id="boot-country" placeholder="Country"></p>',buttons:{cancel:{label:"Cancel",className:"btn-light"},submit:{label:"Save",className:"btn-primary",callback:function(){var h=i($("#boot-city").val()||""),k=i($("#boot-state").val()||"","state"),w=i($("#boot-country").val()||"","country"),E=[h,k,w].filter(Boolean).join(", ");if(!E)return!1;var D={uid:ajaxify.data.theirid,location:E};a.put("/users/"+ajaxify.data.theirid,D).then(function(){t.success("[[user:profile-update-success]]");try{$("#add-location-card").remove();var l="Location",p="fa-solid fa-location-dot",m=$('<div class="stat"><div class="align-items-center justify-content-center card card-header p-3 border-0 rounded-1 h-100 gap-2"><span class="stat-label text-xs fw-semibold"><span><i class="text-muted '+p+'"></i> '+l+'</span></span><span class="text-center fs-6 ff-secondary"></span></div></div>');if(m.find(".ff-secondary").text(E),b.length)b.after(m);else{var U=$(".account-stats .row").first();if(U.length)U.append(m);else{window.location.reload();return}}ajaxify.data.customUserFields=ajaxify.data.customUserFields||[],ajaxify.data.customUserFields.push({key:"location",name:l,value:E,icon:p,type:"input-text"}),ajaxify.data.location=E}catch{window.location.reload()}}).catch(function(l){t.error(l)})}}}})})}}}function u(o){parseInt(ajaxify.data.theirid,10)===parseInt(o.uid,10)&&app.updateUserStatus($('.account [data-uid="'+o.uid+'"] [component="user/status"]'),o.status)}return n}.apply(j,y),g!==void 0&&(v.exports=g)}}]);
