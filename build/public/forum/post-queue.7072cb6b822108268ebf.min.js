"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,5719,26477,34271,42289,49897,51831,69185,86198,99127],{28061:(j,k,s)=>{var A,E;A=[s(81335),s(49897),s(33530),s(29930)],E=function(P,x,w,m){const g={};g.banAccount=function(e,a){e=e||ajaxify.data.theirid,t({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(r){const u=r.length>0?Date.now()+r.length*1e3*60*60*(parseInt(r.unit,10)?24:1):0;x.put("/users/"+e+"/ban",{until:u,reason:r.reason||""}).then(()=>{if(typeof a=="function")return a();ajaxify.refresh()}).catch(m.error)}})},g.unbanAccount=function(e){t({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(a){x.del("/users/"+e+"/ban",{reason:a.reason||""}).then(()=>{ajaxify.refresh()}).catch(m.error)}})},g.muteAccount=function(e,a){e=e||ajaxify.data.theirid,t({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(r){const u=r.length>0?Date.now()+r.length*1e3*60*60*(parseInt(r.unit,10)?24:1):0;x.put("/users/"+e+"/mute",{until:u,reason:r.reason||""}).then(()=>{if(typeof a=="function")return a();ajaxify.refresh()}).catch(m.error)}})},g.unmuteAccount=function(e){t({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(a){x.del("/users/"+e+"/mute",{reason:a.reason||""}).then(()=>{ajaxify.refresh()}).catch(m.error)}})};function t(e){P.render(e.tpl,{}).then(function(a){const r=w.dialog({title:e.title,message:a,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:e.title,callback:function(){const u=r.find("form").serializeArray().reduce(function(h,n){return h[n.name]=n.value,h},{});e.onSubmit(u)}}}})})}return g}.apply(k,A),E!==void 0&&(j.exports=E)},39259:(j,k,s)=>{var A,E;A=[s(96349),s(49897),s(91749)],E=function(P,x,w){const m={};m.init=function(t,e){if(!t||!t.length)return;e=e||{},e.states=e.states||["watching","tracking","notwatching","ignoring"],e.template=e.template||"partials/category/filter-dropdown-left",w.fire("action:category.filter.options",{el:t,options:e}),P.init(t,e);let a=[],r=[];Array.isArray(e.selectedCids)?a=e.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(a=ajaxify.data.selectedCids.map(String)),r=a.slice(),t.on("hidden.bs.dropdown",function(){let u=r.length!==a.length;if(r.forEach(function(h,n){h!==a[n]&&(u=!0)}),r=a.slice(),u&&(e.updateButton?e.updateButton({el:t,changed:u,selectedCids:a.slice()}):e.updateButton!==!1&&g(t,a)),e.onHidden){e.onHidden({changed:u,selectedCids:a.slice()});return}if(u){let h=window.location.pathname;const n=utils.params();a.length?n.cid=a:delete n.cid,delete n.page,Object.keys(n).length&&(h+="?"+$.param(n)),ajaxify.go(h)}}),t.on("click",'[component="category/list"] [data-cid]',function(u){const h=t.find('[component="category/list"]'),n=$(this),i=n.find("a").attr("href");if(i&&i!=="#"&&i.length){u.stopPropagation();return}const o=n.attr("data-cid"),p=n.find('[component="category/select/icon"]');return o!=="all"?(a.includes(o)?a.splice(a.indexOf(o),1):a.push(o),a.sort(function(C,l){return C-l}),p.toggleClass("invisible"),h.find('[data-cid="all"] i').toggleClass("invisible",!!a.length)):(t.find('[component="category/select/icon"]').addClass("invisible"),h.find('[data-cid="all"] i').removeClass("invisible"),a=[]),e.selectedCids=a,e.onSelect&&e.onSelect({cid:o,selectedCids:a.slice()}),!1})};function g(t,e){e.length>1?a({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):e.length===1?x.get(`/categories/${e[0]}`,{}).then(a):a();function a(r){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:r},function(u){t.find("button").replaceWith($("<div/>").html(u).find("button"))})}}return m}.apply(k,A),E!==void 0&&(j.exports=E)},47283:(j,k,s)=>{var A,E;A=[s(49897),s(33530),s(29930)],E=function(P,x,w){const m={};m.account=function(t,e){g(t,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",e)},m.content=function(t,e){g(t,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",e)},m.purge=function(t,e){g(t,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",e)};function g(t,e,a,r,u){x.confirm(e,function(h){h&&P.del(`/users/${encodeURIComponent(t)}${a}`,{}).then(()=>{if(w.success(r),typeof u=="function")return u()}).catch(w.error)})}return m}.apply(k,A),E!==void 0&&(j.exports=E)},49897:(j,k,s)=>{s.r(k),s.d(k,{del:()=>h,get:()=>t,head:()=>e,patch:()=>r,post:()=>a,put:()=>u});var A=s(91749),E=s.n(A),P=s(33530),x=s.n(P);const w=config.relative_path+"/api/v3";async function m(n,i){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:w+n.url,typeof i=="function"){g(n).then(o=>i(null,o),o=>{let p=o;o instanceof Error||(p=new Error(String(o)));const C=p.message||String(p);if(C&&!C.startsWith("[[error:")&&(C.toLowerCase()==="fetch failed"||C.toLowerCase()==="failed to fetch"||C.toLowerCase().includes("networkerror")||C.toLowerCase().includes("network")&&C.toLowerCase().includes("failed"))){const c=new Error("[[error:no-connection]]");c.originalError=p,p=c}i(p)});return}try{return await g(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:p}=await(0,A.fire)("filter:admin.reauth",{url:"login"});return(0,P.confirm)("[[error:api.reauth-required]]",C=>{C&&ajaxify.go(p)})}throw o}}async function g(n){const{url:i}=n;delete n.url,n.headers||(n.headers={}),n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8");try{({options:n}=await(0,A.fire)("filter:api.options",{options:n}))}catch(d){console.error("[API] Error in filter:api.options hook:",d)}n.data&&(n.body=n.data,delete n.data);let o;try{o=await fetch(i,n)}catch(d){const y=d.message||d.toString()||String(d),f=d.name||"Error";if(f==="TypeError"&&(y.toLowerCase().includes("fetch")||y.toLowerCase().includes("network")||y.toLowerCase().includes("failed to fetch")||y.toLowerCase().includes("load failed"))||y.toLowerCase().includes("cors")||y.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:i,method:n.method||"GET",error:y,name:f});const v=new Error("[[error:no-connection]]");throw v.originalError=d,v}throw console.error("[API] Unexpected fetch error:",{url:i,method:n.method||"GET",error:y,name:f}),d}const{headers:p}=o;if(p.get("x-redirect"))return g({url:p.get("x-redirect"),...n});const C=p.get("content-type"),l=C&&C.startsWith("application/json");let c;if(n.method!=="HEAD")try{l?c=await o.json():c=await o.text()}catch(d){throw console.error("[API] Error parsing response:",{url:i,status:o.status,statusText:o.statusText,contentType:C,error:d.message}),new Error("[[error:invalid-json]]")}if(!o.ok){let d;throw c?l&&c.status&&c.status.message?d=c.status.message:typeof c=="string"?d=c:d=o.statusText||"Request failed":d=o.statusText||"Request failed",new Error(d)}return l&&c&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c}function t(n,i,o){return m({url:n+(i&&Object.keys(i).length?"?"+$.param(i):"")},o)}function e(n,i,o){return m({url:n+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},o)}function a(n,i,o){return m({url:n,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function r(n,i,o){return m({url:n,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function u(n,i,o){return m({url:n,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function h(n,i,o){return m({url:n,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}},65348:(j,k,s)=>{var A,E;A=[s(96349),s(33530),s(91749),s(17459)],E=function(P,x,w,m){const g={};return g.init=function(t,e){if(!t||!t.length)return;e=e||{};const a=e.onSelect||function(){};e.states=e.states||["watching","tracking","notwatching","ignoring"],e.template=e.template||"partials/category/selector-dropdown-left",w.fire("action:category.selector.options",{el:t,options:e}),P.init(t,e);const r={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const h=$(this);return h.hasClass("disabled")?!1:(r.selectCategory(h.attr("data-cid")),a(r.selectedCategory))});let u=r.el.find('[component="category-selector-selected"]').html();return m.translate(u,h=>{u=h}),r.selectCategory=function(h){const n=r.el.find('[data-cid="'+h+'"]');r.selectedCategory={cid:h,name:n.attr("data-name")},n.length?r.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(u)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},e.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(e.template,{selectedCategory:e.selectedCategory},function(h){r.el.find('[component="category-selector-selected"]').html(h.find('[component="category-selector-selected"]').html())}),r},g.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(e){const a=x.dialog({title:t.title||"[[modules:composer.select-category]]",message:e,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),r=g.init(a.find('[component="category-selector"]'),t);function u(h){return h.preventDefault(),r.selectedCategory&&(t.onSubmit(r.selectedCategory),a.modal("hide")),!1}t.openOnLoad&&a.on("shown.bs.modal",function(){a.find(".dropdown-toggle").dropdown("toggle")}),a.find("form").on("submit",u)})},g}.apply(k,A),E!==void 0&&(j.exports=E)},67855:(j,k,s)=>{var A,E;A=[s(39259),s(65348),s(49897),s(29930),s(33530),s(28061),s(47283)],E=function(P,x,w,m,g,t,e){const a={};a.init=function(){$('[data-bs-toggle="tooltip"]').tooltip(),P.init($('[component="category/dropdown"]'),{privilege:"moderate"}),i(),C(),h('[data-action="editContent"]',".post-content-editable","textarea",".post-content"),h('[data-action="editTitle"]',".topic-title-editable","input",".topic-title"),$(".posts-list").on("click",".topic-category[data-editable]",function(l){n(this),l.stopPropagation(),l.preventDefault()}),$('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),r()};function r(){$(".posts-list [data-id]").each((l,c)=>{const d=$(c),y=d.find('[component="post-queue/link-container"]'),f=y.find('[component="post-queue/link-container/list"]'),b=d.find(".post-content a");b.each((v,D)=>{const S=$(D).attr("href");f.append(`<li><a href="${S}">${S}</a></li>`)}),y.toggleClass("hidden",!b.length)})}function u(l){return new Promise(c=>{g.confirm(l,c)})}function h(l,c,d,y){$(".posts-list").on("click",l,function(){const f=$(this),b=f.parents("[data-id]").find(c),v=f.parents("[data-id]").find(y);b.length&&(v.addClass("hidden"),b.removeClass("hidden").find(d).focus())}),$(".posts-list").on("blur",c+" "+d,function(){const f=$(this),b=f.parent().parent().find(y),v=f.parents("[data-id]").attr("data-id"),D=l==='[data-action="editTitle"]';w.put(`/posts/queue/${v}`,{title:D?f.val():void 0,content:D?void 0:f.val()}).then(S=>{D?b.find(".title-text").text(S.postData.title):b.html(S.postData.content),f.parent().addClass("hidden"),b.removeClass("hidden")}).catch(m.error)})}function n(l){const c=$(l),d=c.parents("[data-id]").attr("data-id");return x.modal({onSubmit:function(y){Promise.all([w.get(`/categories/${y.cid}`,{}),w.put(`/posts/queue/${d}`,{cid:y.cid})]).then(function(f){const b=f[0];app.parseAndTranslate("post-queue","posts",{posts:[{category:b}]},function(v){c.find(".category-text").length?c.find(".category-text").text(v.find(".topic-category .category-text").text()):c.replaceWith(v.find(".topic-category"))})}).catch(m.error)}}),!1}function i(){const l=document.querySelector(".posts-list");l&&l.addEventListener("click",c=>{const d=c.target.closest("[data-action]");if(d){const y=d.getAttribute("data-action"),f=d.closest("[data-uid]").getAttribute("data-uid");switch(y){case"editCategory":{const b=c.target.closest("[data-id]").querySelector(".topic-category");n(b);break}case"ban":t.banAccount(f,ajaxify.refresh);break;case"unban":t.unbanAccount(f);break;case"mute":t.muteAccount(f,ajaxify.refresh);break;case"unmute":t.unmuteAccount(f);break;case"delete-account":e.account(f,ajaxify.go.bind(null,"post-queue"));break;case"delete-content":e.content(f,ajaxify.go.bind(null,"post-queue"));break;case"delete-all":e.purge(f,ajaxify.go.bind(null,"post-queue"));break;default:o.call(c.target);break}}})}async function o(){const l=$(this).parents("[data-id]"),c=$(this).attr("data-action"),d=l.attr("data-id"),y=l.get(0).parentNode;if(!(!["accept","reject","notify"].includes(c)||c==="reject"&&!await u(ajaxify.data.canAccept?"[[post-queue:confirm-reject]]":"[[post-queue:confirm-remove]]")))return p(c,d).then(function(){(c==="accept"||c==="reject")&&l.remove(),y.childElementCount===0&&(ajaxify.data.singlePost?ajaxify.go("/post-queue"+window.location.search):ajaxify.refresh())}).catch(m.error),!1}async function p(l,c){function d(){return new Promise(f=>{const b=g.dialog({title:"[[post-queue:notify-user]]",message:'<textarea class="form-control"></textarea>',buttons:{OK:{label:"[[modules:bootbox.send]]",callback:function(){const v=b.find("textarea").val();v&&f(v)}}}})})}const y={accept:()=>w.post(`/posts/queue/${c}`,{}),reject:()=>w.del(`/posts/queue/${c}`,{}),notify:async()=>w.post(`/posts/queue/${c}/notify`,{message:await d()})};if(y[l]){const f=y[l]();return f instanceof Promise?f:Promise.resolve(f)}throw new Error(`Unknown action: ${l}`)}function C(){$('[component="post-queue/bulk-actions"]').on("click","[data-action]",async function(){const l=$(this).attr("data-action");let c=$(".posts-list [data-id]");(l==="accept-selected"||l==="reject-selected")&&(c=c.filter((D,S)=>$(S).find('input[type="checkbox"]').is(":checked")));const d=c.map((D,S)=>$(S).attr("data-id")).get(),y=l==="reject-all"||l==="reject-selected",f=ajaxify.data.canAccept?`${l}-confirm`:`${l.replace(/^reject/,"remove")}-confirm`;if(!d.length||y&&!await u(`[[post-queue:${f}, ${d.length}]]`))return;const b=l.split("-")[0],v=d.map(D=>p(b,D));Promise.allSettled(v).then(function(D){const S=D.filter(L=>L.status==="fulfilled").length,T=D.filter(L=>L.status==="rejected");S&&(m.success(`[[post-queue:bulk-${b}-success, ${S}]]`),ajaxify.refresh()),T.forEach(L=>m.error(L.reason))})})}return a}.apply(k,A),E!==void 0&&(j.exports=E)},96349:(j,k,s)=>{var A,E;A=[s(29930),s(89336),s(49897)],E=function(P,x,w){const m={};return m.init=function(g,t){let e=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let a=[];Array.isArray(t.localCategories)&&(a=t.localCategories.map(i=>({...i})),e&&(e=[...a,...e])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const r=g.find('[component="category-selector-search"]');if(!r.length)return;const u=r.parents('[component="category/dropdown"]').length>0||r.parents('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){u&&r.removeClass("hidden");function i(){const o=r.find("input").val();o.length>1||!o&&!e?h(o,function(p){e=t.cacheList&&(e||p),n(p)}):!o&&e&&n(e)}r.on("click",function(o){o.preventDefault(),o.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(i,300)),i()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||r.find("input").focus()}),g.on("hide.bs.dropdown",function(){u&&r.addClass("hidden"),r.off("click"),r.find("input").off("keyup")});function h(i,o){w.get("/search/categories",{search:i,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(p,{categories:C}){if(p)return P.error(p);o(a.concat(C))})}function n(i){const o=t.selectedCids.map(String);i.forEach(function(p){p.selected=o.includes(String(p.cid))}),app.parseAndTranslate(t.template,{categoryItems:i.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(p){g.find('[component="category/list"]').html(p.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!i.length);const C=x.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));C&&C.update()})}},m}.apply(k,A),E!==void 0&&(j.exports=E)}}]);
