"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,99127],{49897:(x,w,i)=>{i.r(w),i.d(w,{del:()=>L,get:()=>k,head:()=>y,patch:()=>C,post:()=>P,put:()=>T});var f=i(91749),O=i.n(f),E=i(33530),A=i.n(E);const m=config.relative_path+"/api/v3";async function l(r,t){if(r.url=r.url.startsWith("/api")?config.relative_path+r.url:m+r.url,typeof t=="function"){d(r).then(e=>t(null,e),e=>{let a=e;e instanceof Error||(a=new Error(String(e)));const n=a.message||String(a);if(n&&!n.startsWith("[[error:")&&(n.toLowerCase()==="fetch failed"||n.toLowerCase()==="failed to fetch"||n.toLowerCase().includes("networkerror")||n.toLowerCase().includes("network")&&n.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=a,a=o}t(a)});return}try{return await d(r)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:a}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",n=>{n&&ajaxify.go(a)})}throw e}}async function d(r){const{url:t}=r;delete r.url,r.headers||(r.headers={}),r.data&&!(r.data instanceof FormData)&&(r.data=JSON.stringify(r.data||{}),r.headers["content-type"]="application/json; charset=utf-8");try{({options:r}=await(0,f.fire)("filter:api.options",{options:r}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}r.data&&(r.body=r.data,delete r.data);let e;try{e=await fetch(t,r)}catch(s){const c=s.message||s.toString()||String(s),h=s.name||"Error";if(h==="TypeError"&&(c.toLowerCase().includes("fetch")||c.toLowerCase().includes("network")||c.toLowerCase().includes("failed to fetch")||c.toLowerCase().includes("load failed"))||c.toLowerCase().includes("cors")||c.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:r.method||"GET",error:c,name:h});const g=new Error("[[error:no-connection]]");throw g.originalError=s,g}throw console.error("[API] Unexpected fetch error:",{url:t,method:r.method||"GET",error:c,name:h}),s}const{headers:a}=e;if(a.get("x-redirect"))return d({url:a.get("x-redirect"),...r});const n=a.get("content-type"),u=n&&n.startsWith("application/json");let o;if(r.method!=="HEAD")try{u?o=await e.json():o=await e.text()}catch(s){throw console.error("[API] Error parsing response:",{url:t,status:e.status,statusText:e.statusText,contentType:n,error:s.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let s;throw o?u&&o.status&&o.status.message?s=o.status.message:typeof o=="string"?s=o:s=e.statusText||"Request failed":s=e.statusText||"Request failed",new Error(s)}return u&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function k(r,t,e){return l({url:r+(t&&Object.keys(t).length?"?"+$.param(t):"")},e)}function y(r,t,e){return l({url:r+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},e)}function P(r,t,e){return l({url:r,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function C(r,t,e){return l({url:r,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function T(r,t,e){return l({url:r,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function L(r,t,e){return l({url:r,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
