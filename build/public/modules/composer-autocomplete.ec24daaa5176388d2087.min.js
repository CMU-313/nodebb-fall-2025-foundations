(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,6232,13417,34271,34405,49897,73848,99127],{34405:(y,x,u)=>{"use strict";var E,v;E=[u(49897),u(29930),u(36e3),u(9787),u(35786)],v=function(_,h,{Textcomplete:s},{TextareaEditor:i},{ContenteditableEditor:c}){const a={},p={delay:200,appendTo:null};a.init=d=>{const o={...p,...d},{input:l,onSelect:e}=o;app.loadJQueryUI(function(){l.autocomplete({...o,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(t,r){T(l,e,t,r)}})})},a.user=function(d,o,l){typeof o=="function"&&(l=o,o={}),o=o||{},a.init({input:d,onSelect:l,source:(e,t)=>{o.query=e.term,_.get("/api/users",o,function(r,n){if(r)return h.error(r);if(n&&n.users){const f=n.users.map(function(m){const g=$("<div></div>").html(m.username).text();return m&&{label:g,value:g,user:{uid:m.uid,name:m.username,slug:m.userslug,username:m.username,userslug:m.userslug,displayname:m.displayname,picture:m.picture,banned:m.banned,"icon:text":m["icon:text"],"icon:bgColor":m["icon:bgColor"]}}});t(f)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.group=function(d,o){a.init({input:d,onSelect:o,source:(l,e)=>{socket.emit("groups.search",{query:l.term},function(t,r){if(t)return h.error(t);if(r&&r.length){const n=r.map(function(f){return f&&{label:f.name,value:f.name,group:f}});e(n)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.tag=function(d,o){a.init({input:d,onSelect:o,delay:100,source:(l,e)=>{socket.emit("topics.autocompleteTags",{query:l.term,cid:ajaxify.data.cid||0},function(t,r){if(t)return h.error(t);r&&e(r),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function T(d,o,l,e){o=o||function(){};const t=jQuery.Event("keypress");t.which=13,t.keyCode=13,setTimeout(function(){d.trigger(t)},100),o(l,e)}return a.setup=function({element:d,strategies:o,options:l}){const e=d.get(0);if(e){var t;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?t=new i(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(t=new c(e)),!t)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var r=new s(t,o,{dropdown:l});return r.on("rendered",function(){r.dropdown.items.length&&r.dropdown.items[0].activate()}),r}},a}.apply(x,E),v!==void 0&&(y.exports=v)},49897:(y,x,u)=>{"use strict";u.r(x),u.d(x,{del:()=>l,get:()=>a,head:()=>p,patch:()=>d,post:()=>T,put:()=>o});var E=u(91749),v=u.n(E),_=u(33530),h=u.n(_);const s=config.relative_path+"/api/v3";async function i(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:s+e.url,typeof t=="function"){c(e).then(r=>t(null,r),r=>{let n=r;r instanceof Error||(n=new Error(String(r)));const f=n.message||String(n);if(f&&!f.startsWith("[[error:")&&(f.toLowerCase()==="fetch failed"||f.toLowerCase()==="failed to fetch"||f.toLowerCase().includes("networkerror")||f.toLowerCase().includes("network")&&f.toLowerCase().includes("failed"))){const g=new Error("[[error:no-connection]]");g.originalError=n,n=g}t(n)});return}try{return await c(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:n}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,_.confirm)("[[error:api.reauth-required]]",f=>{f&&ajaxify.go(n)})}throw r}}async function c(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(w){console.error("[API] Error in filter:api.options hook:",w)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(w){const A=w.message||w.toString()||String(w),L=w.name||"Error";if(L==="TypeError"&&(A.toLowerCase().includes("fetch")||A.toLowerCase().includes("network")||A.toLowerCase().includes("failed to fetch")||A.toLowerCase().includes("load failed"))||A.toLowerCase().includes("cors")||A.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:A,name:L});const P=new Error("[[error:no-connection]]");throw P.originalError=w,P}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:A,name:L}),w}const{headers:n}=r;if(n.get("x-redirect"))return c({url:n.get("x-redirect"),...e});const f=n.get("content-type"),m=f&&f.startsWith("application/json");let g;if(e.method!=="HEAD")try{m?g=await r.json():g=await r.text()}catch(w){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:f,error:w.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let w;throw g?m&&g.status&&g.status.message?w=g.status.message:typeof g=="string"?w=g:w=r.statusText||"Request failed":w=r.statusText||"Request failed",new Error(w)}return m&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function a(e,t,r){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function p(e,t,r){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function T(e,t,r){return i({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function d(e,t,r){return i({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function o(e,t,r){return i({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function l(e,t,r){return i({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}},54516:(y,x,u)=>{"use strict";var E,v;E=[u(89596),u(34405)],v=function(_,h){var s={_active:{}};return $(window).on("action:composer.discard",function(i,c){s._active.hasOwnProperty(c.post_uuid)&&(s._active[c.post_uuid].destroy(),delete s._active[c.post_uuid])}),s.init=function(i,c){var a=i.find(".write"),p="composer-autocomplete-dropdown-"+c,T;if(a.length){var d={element:a,strategies:[],options:{style:{"z-index":2e4},className:p+" dropdown-menu textcomplete-dropdown"}};a.on("keyup",function(){clearTimeout(T),T=setTimeout(function(){var o=document.querySelector("."+p);if(o){var l=o.getBoundingClientRect(),e=parseFloat(o.style.marginTop,10)||0,t=window.innerHeight+e-10-l.bottom;o.style.marginTop=Math.min(t,0)+"px"}},0)}),$(window).trigger("composer:autocomplete:init",d),s._active[c]=h.setup(d),d.element.on("textComplete:select",function(){_.render(i)})}},s}.apply(x,E),v!==void 0&&(y.exports=v)},62590:(y,x,u)=>{"use strict";var E,v;E=[u(91749)],v=function(_){var h={};return h.render=function(s,i){if(i=i||function(){},!s.find(".preview-container").is(":visible"))return i();var c=s.find("textarea");socket.emit("plugins.composer.renderPreview",c.val(),function(a,p){a||(p=$("<div>"+p+"</div>"),p.find("img:not(.not-responsive)").addClass("img-fluid"),s.find(".preview").html(p),_.fire("action:composer.preview",{postContainer:s,preview:p}),i())})},h.matchScroll=function(s){if(s.find(".preview-container").is(":visible")){var i=s.find("textarea"),c=s.find(".preview");if(i.length&&c.length){var a=i[0].scrollHeight-i.height();if(a===0)return;var p=i.scrollTop()/a;c.scrollTop(Math.max(c[0].scrollHeight-c.height(),0)*p)}}},h.handleToggler=function(s){const i=s.get(0);h.env=utils.findBootstrapEnvironment();const c=["xs","sm"].includes(h.env),a=i.querySelector('.formatting-bar [data-action="preview"]'),p=a.querySelector(".show-text"),T=a.querySelector(".hide-text"),d=localStorage.getItem("composer:previewToggled"),o=config["composer-default"]&&config["composer-default"].hidePreviewOnOpen==="on";let l=!c&&(d===null&&!o||d==="true");const e=i.querySelector(".preview-container"),t=i.querySelector(".write-container");if(!a)return;function r(n){c?(e.classList.toggle("hide",!1),t.classList.toggle("maximized",!1),e.classList.toggle("d-none",!n),e.classList.toggle("d-flex",n),e.classList.toggle("w-100",n),t.classList.toggle("d-flex",!n),t.classList.toggle("d-none",n),t.classList.toggle("w-100",!n)):(e.classList.toggle("hide",!n),t.classList.toggle("w-50",n),t.classList.toggle("w-100",!n),localStorage.setItem("composer:previewToggled",n)),p.classList.toggle("hide",n),T.classList.toggle("hide",!n),n&&h.render(s),h.matchScroll(s)}h.toggle=r,a.addEventListener("click",n=>{n.button===0&&(l=!l,r(l))}),r(l)},h}.apply(x,E),v!==void 0&&(y.exports=v)},88518:(y,x,u)=>{y.exports=u(54516)},89596:(y,x,u)=>{y.exports=u(62590)}}]);
