"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[98088],{57642:(P,j,i)=>{var S,u;S=[i(8454),i(60984),i(47536),i(2269),i(52473),i(17459),i(91749),i(30076)],u=function(g,c,m,k,d,a,x,A){const f={},C={"event:user_status_change":b,"event:voted":I,"event:bookmarked":B,"event:topic_deleted":c.setDeleteState,"event:topic_restored":c.setDeleteState,"event:topic_purged":R,"event:topic_locked":c.setLockedState,"event:topic_unlocked":c.setLockedState,"event:topic_pinned":c.setPinnedState,"event:topic_unpinned":c.setPinnedState,"event:topic_moved":O,"event:post_edited":w,"event:post_pinned":U,"event:post_unpinned":D,"event:post_purged":L,"event:post_deleted":y,"event:post_restored":y,"posts.bookmark":E,"posts.unbookmark":E,"posts.upvote":v,"posts.downvote":v,"posts.unvote":v,"event:new_notification":N,"event:new_post":m.onNewPost};f.init=function(){f.removeListeners();for(const[t,n]of Object.entries(C))socket.on(t,n)},f.removeListeners=function(){for(const[t,n]of Object.entries(C))socket.removeListener(t,n)};function b(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function I(t){const n=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(p,o){return $(o).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}),e=$('.reputation[data-uid="'+t.post.uid+'"]');n.html(t.post.votes).attr("data-votes",t.post.votes),e.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function B(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(n,e){return $(e).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function R(t){ajaxify.data.category&&ajaxify.data.category.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function O(t){t&&t.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("topic/"+t.slug,null,!0)}function w(t){if(!t||!t.post||String(t.post.tid)!==String(ajaxify.data.tid))return;const n=d.get("post/content",t.post.pid).filter(function(s,r){return String($(r).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),e=$(`[data-pid="${t.post.pid}"]`),p=e.find('[component="post/editor"]').filter(function(s,r){return String($(r).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),o=d.get("topic/title"),l=d.get("navbar/title").find("span"),h=d.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(o.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const s="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:s},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+s),o.fadeOut(250,function(){o.html(t.topic.title).fadeIn(250)}),h.fadeOut(250,function(){h.html(t.topic.title).fadeIn(250)}),l.fadeOut(250,function(){l.html(t.topic.title).fadeIn(250)})}if(t.post.changed){n.fadeOut(250,function(){if(n.html(a.unescape(t.post.content)),n.find("img:not(.not-responsive)").addClass("img-fluid"),k.wrapImagesInLinks(n.parent()),m.addBlockquoteEllipses(n.parent()),n.fadeIn(250),t.post.edited){const r={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",r,function(M){p.replaceWith(M),e.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${A.isoTimeToLocaleString(r.editedISO,config.userLang)}]]`),e.find('[component="post/editor"] .timeago').timeago(),x.fire("action:posts.edited",t)})}});const s=$(`[component="post/parent"][data-parent-pid="${t.post.pid}"]`);s.length&&(s.find('[component="post/parent/content"]').html(a.unescape(t.post.content)),s.find("img:not(.not-responsive)").addClass("img-fluid"),s.find('[component="post/parent/content]" img:not(.emoji)').each(function(){k.wrapImageInLink($(this))}))}else x.fire("action:posts.edited",t);t.topic.tags&&t.topic.tagsupdated&&Promise.all([i.e(20056),i.e(63)]).then(function(){var s=[i(63)];(function(r){r.updateTopicTags([t.topic])}).apply(null,s)}).catch(i.oe),g.removeMenu(d.get("post","pid",t.post.pid))}function L(t){!t||String(t.tid)!==String(ajaxify.data.tid)||(d.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),m.showBottomPostBar()}),ajaxify.data.postcount-=1,g.updatePostCount(ajaxify.data.postcount),i.e(18631).then(function(){var n=[i(18631)];(function(e){e.onPostPurged(t)}).apply(null,n)}).catch(i.oe),$(`[component="post/parent"][data-parent-pid="${t.pid}"]`).remove())}function y(t){const n=d.get("post","pid",t.pid),{isAdminOrMod:e}=ajaxify.data.privileges,p=String(t.uid)===String(app.user.uid),o=!!t.deleted;n.length&&(n.toggleClass("deleted"),g.toggle(t.pid,o),!e&&!p&&(n.find('[component="post/tools"]').toggleClass("hidden",o),o?n.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):n.find('[component="post/content"]').html(a.unescape(t.content))));const l=$(`[component="post/parent"][data-parent-pid="${t.pid}"]`);l.length&&l.each((h,s)=>{const r=$(s);o?r.find('[component="post/parent/content"]').translateHtml("[[topic:post-is-deleted]]"):r.find('[component="post/parent/content"]').html(a.unescape(t.content))})}function U(t){if(!t||String(t.tid)!==String(ajaxify.data.tid))return;const n=d.get("post","pid",t.pid);if(n.length){if(n.addClass("pinned-post"),n.find('[component="post/pin"]').toggleClass("hidden",!0).parent().attr("hidden",""),n.find('[component="post/unpin"]').toggleClass("hidden",!1).parent().attr("hidden",null),n.find('[component="post/pinned-indicator"]').length)n.find('[component="post/pinned-indicator"]').removeClass("hidden");else{const e=n.find('[component="post/edit-indicator"]');e.length?e.after('<i component="post/pinned-indicator" class="fa fa-thumb-tack text-muted pinned-icon ms-1" aria-hidden="true"></i>'):n.find('[component="post/header"]').append('<i component="post/pinned-indicator" class="fa fa-thumb-tack text-muted pinned-icon ms-1" aria-hidden="true"></i>'),a.translate("[[topic:pinned]]",function(p){n.find('[component="post/pinned-indicator"]').attr("title",p)})}try{const e=d.get("topic"),p=e.find('[component="post"][data-index="0"]');let o=e.find('[component="post"].pinned-post').not(n).last();o.length||(o=p.length?p:null),o?(n.data("pin-previous-next",n.next()),o[0]!==n[0]&&n.insertAfter(o)):e.append(n)}catch(e){console.warn("Unable to move pinned post in DOM",e)}}}function D(t){if(!t||String(t.tid)!==String(ajaxify.data.tid))return;const n=d.get("post","pid",t.pid);if(n.length){n.removeClass("pinned-post"),n.find('[component="post/pin"]').toggleClass("hidden",!1).parent().attr("hidden",null),n.find('[component="post/unpin"]').toggleClass("hidden",!0).parent().attr("hidden",""),n.find('[component="post/pinned"]').remove(),n.find('[component="post/pinned-indicator"]').remove();try{const e=n.data("pin-previous-next");e&&e.length?n.insertBefore(e):d.get("topic").append(n),n.removeData("pin-previous-next")}catch(e){console.warn("Unable to restore unpinned post position",e)}}}function E(t){const n=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(e,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)});n.length&&(n.attr("data-bookmarked",t.isBookmarked),n.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),n.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function v(t){const n=$('[data-pid="'+t.post.pid+'"]');n.find('[component="post/upvote"]').filter(function(e,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("upvoted",t.upvote),n.find('[component="post/downvote"]').filter(function(e,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("downvoted",t.downvote)}function N(t){const n=ajaxify.data.tid;t&&t.tid&&String(t.tid)===String(n)&&socket.emit("topics.markTopicNotificationsRead",[n])}return f}.apply(j,S),u!==void 0&&(P.exports=u)}}]);
