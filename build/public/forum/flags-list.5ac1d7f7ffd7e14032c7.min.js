"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,26174,26874,34271,34405,37019,49897,51831,69185,99127],{13230:(L,D,d)=>{var h,y,v;(function(_){y=[d(53050)],h=_,v=typeof h=="function"?h.apply(D,y):h,v!==void 0&&(L.exports=v)})(function(_){const k=_("[^\\p{L}\\s\\d\\-_@.]","g"),E=/[^\w\s\d\-_@.]/g,C=/^\s+|\s+$/g,r=/\s+/g,i=/-+/g,l=/-$/g,c=/^-/g,o=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(C,""),o.test(e)?e=e.replace(E,"-"):e=_.replace(e,k,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(r,"-"),e=e.replace(i,"-"),e=e.replace(l,""),e=e.replace(c,""),e):""}})},33491:(L,D,d)=>{d.r(D),d.d(D,{enableCheckboxes:()=>n,enableFilterForm:()=>e,getSelected:()=>u,handleBulkActions:()=>f,handleGraphs:()=>g,init:()=>m});var h=d(70106),y=d(39259),v=d.n(y),_=d(64308),k=d.n(_),E=d(34405),C=d.n(E),r=d(49897),i=d(29930),l=d(52473),c=d.n(l);h.t1.register(h.ZT,h.PP,h.kc,h.No,h.FN,h.m_,h.dN);const o=new Map([["cids",[]],["assignee",[]],["targetUid",[]],["reporterId",[]]]);function m(){e(),n(),f(),ajaxify.data.filters.hasOwnProperty("cid")&&o.set("cids",Array.isArray(ajaxify.data.filters.cid)?ajaxify.data.filters.cid:[ajaxify.data.filters.cid]),y.init($('[component="category/dropdown"]'),{privilege:"moderate",selectedCids:o.get("cids"),updateButton:function({selectedCids:a}){o.set("cids",a),t()}}),["assignee","targetUid","reporterId"].forEach(a=>{ajaxify.data.filters.hasOwnProperty("filter")&&o.set(a,ajaxify.data.selected[a]);const s=$(`[component="flags/filter/${a}"]`);_.init(s,{selectedUsers:o.get(a),template:"partials/flags/filters",selectedBlock:`selected.${a}`,onSelect:function(p){o.set(a,p)},onHidden:function(){t()}})}),l.get("flags/list").on("click","[data-flag-id]",function(a){if(["BUTTON","A"].includes(a.target.nodeName))return;const s=this.getAttribute("data-flag-id");ajaxify.go("flags/"+s)}),$("#flags-daily-wrapper").one("shown.bs.collapse",function(){g()}),E.user($("#filter-assignee, #filter-targetUid, #filter-reporterId"),(a,s)=>{setTimeout(()=>{a.target.value=s.item.user.uid})})}function e(){const a=l.get("flags/filters");if(a&&a.get(0).nodeName!=="FORM"){const s=a.get(0),p=s.querySelector("form");s.addEventListener("click",w=>{const A=w.target.closest("[data-value]");if(!A)return;const P=A.getAttribute("data-name"),b=A.getAttribute("data-value");p[P].value=b,t()})}else{for(const[s,p]of Object.entries(ajaxify.data.filters))a.find('[name="'+s+'"]').val(p);a.find('[name="sort"]').val(ajaxify.data.sort),document.getElementById("apply-filters").addEventListener("click",function(){t()}),a.find('button[data-target="#more-filters"]').click(s=>{const p=s.target.getAttribute("data-text-variant");p&&(s.target.setAttribute("data-text-variant",s.target.textContent),s.target.firstChild.textContent=p)})}}function t(){let a=l.get("flags/filters").get(0);if(!a)return;a.nodeName!=="FORM"&&(a=a.querySelector("form"));const s=new FormData(a);o.get("cids").forEach(function(A){s.append("cid",A)}),["assignee","targetUid","reporterId"].forEach(A=>{o.get(A).forEach(({uid:P})=>{s.append(A,P)})});const p=Array.from(s.values()).filter(Boolean),w=new URLSearchParams(s).toString();ajaxify.go("flags?"+(p?w:"reset=1"))}function n(){const a=document.querySelector('[component="flags/list"]'),s=a.querySelectorAll('[data-flag-id] input[type="checkbox"]'),p=document.querySelector('[component="flags/bulk-actions"] button');let w;document.querySelector('[data-action="toggle-all"]').addEventListener("click",function(){const A=this.checked;s.forEach(function(P){P.checked=A}),p.disabled=!A}),a.addEventListener("click",function(A){const P=A.target.closest('input[type="checkbox"]');if(P){if(A.stopImmediatePropagation(),w&&A.shiftKey&&w!==P){const b=P.checked;let x=!1;s.forEach(function(O){[P,w].some(function(T){return T===O})&&(x=!x),x&&(O.checked=b)})}p.disabled=!Array.prototype.some.call(s,function(b){return b.checked}),w=P}A.target.querySelector('input[type="checkbox"]')&&A.stopImmediatePropagation()})}function f(){document.querySelector('[component="flags/bulk-actions"]').addEventListener("click",function(a){const s=a.target.closest("[data-action]");if(s){const p=s.getAttribute("data-action");let w;p==="bulk-purge"&&(w=new Promise((b,x)=>{bootbox.confirm("[[flags:confirm-purge]]",O=>{O?b():x(new Error("[[flags:purge-cancelled]]"))})}));const P=u().map(async b=>{const x={};switch(p){case"bulk-assign":{x.assignee=app.user.uid;break}case"bulk-mark-resolved":{x.state="resolved";break}case"bulk-purge":return await w,r.del(`/flags/${b}`)}return r.put(`/flags/${b}`,x)});Promise.allSettled(P).then(function(b){const x=b.filter(function(T){return T.status==="fulfilled"}).length,O=b.filter(function(T){return T.status==="rejected"});x&&(i.success("[[flags:bulk-success, "+x+"]]"),ajaxify.refresh()),O.forEach(function(T){i.error(T.reason)})})}})}function u(){const a=document.querySelectorAll('[component="flags/list"] [data-flag-id] input[type="checkbox"]'),s=[];return a.forEach(function(p){p.checked&&s.push(p.closest("[data-flag-id]").getAttribute("data-flag-id"))}),s}function g(){const a=document.getElementById("flags:daily"),s=utils.getDaysArray().map(function(w,A){return A%3?"":w});utils.isMobile()&&(h.t1.defaults.plugins.tooltip.enabled=!1);const p={"flags:daily":{labels:s,datasets:[{label:"",backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:ajaxify.data.analytics}]}};a.width=$(a).parent().width(),new h.t1(a.getContext("2d"),{type:"line",data:p["flags:daily"],options:{responsive:!0,animation:!1,scales:{y:{beginAtZero:!0}}}})}},34405:(L,D,d)=>{var h,y;h=[d(49897),d(29930),d(36e3),d(9787),d(35786)],y=function(v,_,{Textcomplete:k},{TextareaEditor:E},{ContenteditableEditor:C}){const r={},i={delay:200,appendTo:null};r.init=c=>{const o={...i,...c},{input:m,onSelect:e}=o;app.loadJQueryUI(function(){m.autocomplete({...o,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(t,n){l(m,e,t,n)}})})},r.user=function(c,o,m){typeof o=="function"&&(m=o,o={}),o=o||{},r.init({input:c,onSelect:m,source:(e,t)=>{o.query=e.term,v.get("/api/users",o,function(n,f){if(n)return _.error(n);if(f&&f.users){const u=f.users.map(function(g){const a=$("<div></div>").html(g.username).text();return g&&{label:a,value:a,user:{uid:g.uid,name:g.username,slug:g.userslug,username:g.username,userslug:g.userslug,displayname:g.displayname,picture:g.picture,banned:g.banned,"icon:text":g["icon:text"],"icon:bgColor":g["icon:bgColor"]}}});t(u)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.group=function(c,o){r.init({input:c,onSelect:o,source:(m,e)=>{socket.emit("groups.search",{query:m.term},function(t,n){if(t)return _.error(t);if(n&&n.length){const f=n.map(function(u){return u&&{label:u.name,value:u.name,group:u}});e(f)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.tag=function(c,o){r.init({input:c,onSelect:o,delay:100,source:(m,e)=>{socket.emit("topics.autocompleteTags",{query:m.term,cid:ajaxify.data.cid||0},function(t,n){if(t)return _.error(t);n&&e(n),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function l(c,o,m,e){o=o||function(){};const t=jQuery.Event("keypress");t.which=13,t.keyCode=13,setTimeout(function(){c.trigger(t)},100),o(m,e)}return r.setup=function({element:c,strategies:o,options:m}){const e=c.get(0);if(e){var t;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?t=new E(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(t=new C(e)),!t)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new k(t,o,{dropdown:m});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},r}.apply(D,h),y!==void 0&&(L.exports=y)},39259:(L,D,d)=>{var h,y;h=[d(96349),d(49897),d(91749)],y=function(v,_,k){const E={};E.init=function(r,i){if(!r||!r.length)return;i=i||{},i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/filter-dropdown-left",k.fire("action:category.filter.options",{el:r,options:i}),v.init(r,i);let l=[],c=[];Array.isArray(i.selectedCids)?l=i.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(l=ajaxify.data.selectedCids.map(String)),c=l.slice(),r.on("hidden.bs.dropdown",function(){let o=c.length!==l.length;if(c.forEach(function(m,e){m!==l[e]&&(o=!0)}),c=l.slice(),o&&(i.updateButton?i.updateButton({el:r,changed:o,selectedCids:l.slice()}):i.updateButton!==!1&&C(r,l)),i.onHidden){i.onHidden({changed:o,selectedCids:l.slice()});return}if(o){let m=window.location.pathname;const e=utils.params();l.length?e.cid=l:delete e.cid,delete e.page,Object.keys(e).length&&(m+="?"+$.param(e)),ajaxify.go(m)}}),r.on("click",'[component="category/list"] [data-cid]',function(o){const m=r.find('[component="category/list"]'),e=$(this),t=e.find("a").attr("href");if(t&&t!=="#"&&t.length){o.stopPropagation();return}const n=e.attr("data-cid"),f=e.find('[component="category/select/icon"]');return n!=="all"?(l.includes(n)?l.splice(l.indexOf(n),1):l.push(n),l.sort(function(u,g){return u-g}),f.toggleClass("invisible"),m.find('[data-cid="all"] i').toggleClass("invisible",!!l.length)):(r.find('[component="category/select/icon"]').addClass("invisible"),m.find('[data-cid="all"] i').removeClass("invisible"),l=[]),i.selectedCids=l,i.onSelect&&i.onSelect({cid:n,selectedCids:l.slice()}),!1})};function C(r,i){i.length>1?l({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):i.length===1?_.get(`/categories/${i[0]}`,{}).then(l):l();function l(c){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:c},function(o){r.find("button").replaceWith($("<div/>").html(o).find("button"))})}}return E}.apply(D,h),y!==void 0&&(L.exports=y)},49897:(L,D,d)=>{d.r(D),d.d(D,{del:()=>m,get:()=>r,head:()=>i,patch:()=>c,post:()=>l,put:()=>o});var h=d(91749),y=d.n(h),v=d(33530),_=d.n(v);const k=config.relative_path+"/api/v3";async function E(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:k+e.url,typeof t=="function"){C(e).then(n=>t(null,n),n=>{let f=n;n instanceof Error||(f=new Error(String(n)));const u=f.message||String(f);if(u&&!u.startsWith("[[error:")&&(u.toLowerCase()==="fetch failed"||u.toLowerCase()==="failed to fetch"||u.toLowerCase().includes("networkerror")||u.toLowerCase().includes("network")&&u.toLowerCase().includes("failed"))){const a=new Error("[[error:no-connection]]");a.originalError=f,f=a}t(f)});return}try{return await C(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:f}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go(f)})}throw n}}async function C(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,h.fire)("filter:api.options",{options:e}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}e.data&&(e.body=e.data,delete e.data);let n;try{n=await fetch(t,e)}catch(s){const p=s.message||s.toString()||String(s),w=s.name||"Error";if(w==="TypeError"&&(p.toLowerCase().includes("fetch")||p.toLowerCase().includes("network")||p.toLowerCase().includes("failed to fetch")||p.toLowerCase().includes("load failed"))||p.toLowerCase().includes("cors")||p.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:p,name:w});const P=new Error("[[error:no-connection]]");throw P.originalError=s,P}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:p,name:w}),s}const{headers:f}=n;if(f.get("x-redirect"))return C({url:f.get("x-redirect"),...e});const u=f.get("content-type"),g=u&&u.startsWith("application/json");let a;if(e.method!=="HEAD")try{g?a=await n.json():a=await n.text()}catch(s){throw console.error("[API] Error parsing response:",{url:t,status:n.status,statusText:n.statusText,contentType:u,error:s.message}),new Error("[[error:invalid-json]]")}if(!n.ok){let s;throw a?g&&a.status&&a.status.message?s=a.status.message:typeof a=="string"?s=a:s=n.statusText||"Request failed":s=n.statusText||"Request failed",new Error(s)}return g&&a&&a.hasOwnProperty("status")&&a.hasOwnProperty("response")?a.response:a}function r(e,t,n){return E({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n)}function i(e,t,n){return E({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},n)}function l(e,t,n){return E({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function c(e,t,n){return E({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function o(e,t,n){return E({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function m(e,t,n){return E({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}},64308:(L,D,d)=>{var h,y;h=[d(49897),d(91749),d(13230),d(81335)],y=function(v,_,k,E){const C={};return C.init=function(r,i){if(!r||!r.length)return;i=i||{};let l,c=[];i.selectedUsers&&(c=i.selectedUsers.map(t=>({...t}))),_.fire("action:user.filter.options",{el:r,options:i});async function o(){const t=i.selectedBlock||"userFilterSelected",n={};if(t.indexOf(".")!==-1){const u=t.split(".");n[u[0]]={},n[u[0]][u[1]]=c}else n[t]=c;const f=await app.parseAndTranslate(i.template,t,n);r.find('[component="user/filter/selected"]').html(f)}async function m(){await o(),i.onSelect&&i.onSelect(c)}async function e(){let t={users:[]};const n=r.find('[component="user/filter/search"]').val();if(n&&n.length>1)if(app.user.privileges["search:users"])t=await v.get("/api/users",{query:n});else try{const g=await v.get(`/api/user/${k(n)}`);t.users.push(g)}catch(g){console.error(g)}if(!t.users.length){r.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}t.users=t.users.slice(0,20);const f={};t.users.forEach(g=>{f[g.uid]=g});const u=await app.parseAndTranslate(i.template,"userFilterResults",{userFilterResults:t.users});r.find('[component="user/filter/results"]').html(u),r.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const g=parseInt($(this).attr("data-uid"),10);c.find(a=>a.uid===g)||(c.push(f[g]),await m())})}r.find('[component="user/filter/search"]').on("keyup",()=>{r.find('[component="user/filter/results"]').html(l)}),r.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),r.on("click",'[component="user/filter/delete"]',async function(){const t=$(this).attr("data-uid");c=c.filter(n=>parseInt(n.uid,10)!==parseInt(t,10)),await m()}),r.find('[component="user/filter/search"]').on("keyup",t=>{t.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),r.on("shown.bs.dropdown",function(){r.find('[component="user/filter/search"]').trigger("focus")}),r.on("hidden.bs.dropdown",function(){i.onHidden&&i.onHidden(c)}),E.render(i.placeholderTemplate||"partials/userFilter-placeholders").then(t=>{l=t})},C}.apply(D,h),y!==void 0&&(L.exports=y)},96349:(L,D,d)=>{var h,y;h=[d(29930),d(89336),d(49897)],y=function(v,_,k){const E={};return E.init=function(C,r){let i=r.defaultCategories||null;r=r||{},r.privilege=r.privilege||"topics:read",r.states=r.states||["watching","tracking","notwatching","ignoring"],r.cacheList=r.hasOwnProperty("cacheList")?r.cacheList:!0;let l=[];Array.isArray(r.localCategories)&&(l=r.localCategories.map(t=>({...t})),i&&(i=[...l,...i])),r.selectedCids=r.selectedCids||ajaxify.data.selectedCids||[];const c=C.find('[component="category-selector-search"]');if(!c.length)return;const o=c.parents('[component="category/dropdown"]').length>0||c.parents('[component="category-selector"]').length>0;C.on("show.bs.dropdown",function(){o&&c.removeClass("hidden");function t(){const n=c.find("input").val();n.length>1||!n&&!i?m(n,function(f){i=r.cacheList&&(i||f),e(f)}):!n&&i&&e(i)}c.on("click",function(n){n.preventDefault(),n.stopPropagation()}),c.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),C.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||c.find("input").focus()}),C.on("hide.bs.dropdown",function(){o&&c.addClass("hidden"),c.off("click"),c.find("input").off("keyup")});function m(t,n){k.get("/search/categories",{search:t,query:utils.params(),parentCid:r.parentCid||0,selectedCids:r.selectedCids,privilege:r.privilege,states:r.states,showLinks:r.showLinks},function(f,{categories:u}){if(f)return v.error(f);n(l.concat(u))})}function e(t){const n=r.selectedCids.map(String);t.forEach(function(f){f.selected=n.includes(String(f.cid))}),app.parseAndTranslate(r.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(f){C.find('[component="category/list"]').html(f.find('[component="category/list"]').html()),C.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const u=_.Dropdown.getInstance(C.find(".dropdown-toggle").get(0));u&&u.update()})}},E}.apply(D,h),y!==void 0&&(L.exports=y)}}]);
