"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,2403,18593,34271,49897,69749,87212,92717,99127],{2403:(_,O,p)=>{var x,m;x=[p(69749),p(29930),p(49897)],m=function(y,w,c){const d={};let a,g,C={};d.init=function(t){t=t||function(){},!a&&app.parseAndTranslate("modals/merge-topic",{},function(r){a=r,$("body").append(a),g=a.find("#merge_topics_confirm"),a.find("#merge_topics_cancel").on("click",e),$("#content").on("click",'[component="topic/select"]',T),f(),g.on("click",function(){n(g)}),y.enableQuickSearch({searchElements:{inputEl:a.find(".topic-search-input"),resultEl:a.find(".quick-search-container")},searchOptions:{in:"titles"},dropdown:{maxWidth:"400px",maxHeight:"350px"}}),a.on("click","[data-tid]",function(){const i=$(this).attr("data-tid");return i&&d.addTopic(i),!1}),a.on("click","[data-remove-tid]",function(){const i=$(this).attr("data-remove-tid");return i&&d.removeTopic(i),!1}),t()})},d.addTopic=function(t,r){r=r||function(){},c.get(`/topics/${t}`,{}).then(function(i){const o=i?i.title:"No title";C[t]=o,s(),f(),r()}).catch(w.error)},d.removeTopic=function(t){C[t]&&delete C[t],s(),f()};function T(t){if(!a)return;const r=$(this).parents('[component="category/topic"]'),i=r.hasClass("selected"),o=r.attr("data-tid");return i?d.addTopic(o):d.removeTopic(o),t.preventDefault(),t.stopPropagation(),!1}function n(t){t.attr("disabled",!0);const r=Object.keys(C),i={};a.find(".merge-main-topic-radio").is(":checked")?i.mainTid=a.find(".merge-main-topic-select").val():a.find(".merge-new-title-radio").is(":checked")&&(i.newTopicTitle=a.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:r,options:i},function(o,v){if(t.removeAttr("disabled"),o)return w.error(o);ajaxify.go("/topic/"+v),e()})}function f(){if(!a)return;const t=Object.keys(C);t.sort(function(i,o){return i-o});const r=t.map(function(i){return{tid:i,title:C[i]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:r},function(i){a.find(".topics-section").html(i.find(".topics-section").html()),a.find(".merge-main-topic-select").html(i.find(".merge-main-topic-select").html())}):(a.find(".topics-section").translateHtml("[[error:no-topics-selected]]"),a.find(".merge-main-topic-select").html(""))}function s(){Object.keys(C).length?g.removeAttr("disabled"):g.attr("disabled",!0)}function e(){a&&(a.remove(),a=null),C={},$("#content").off("click",'[component="topic/select"]',T)}return d}.apply(O,x),m!==void 0&&(_.exports=m)},49897:(_,O,p)=>{p.r(O),p.d(O,{del:()=>s,get:()=>g,head:()=>C,patch:()=>n,post:()=>T,put:()=>f});var x=p(91749),m=p.n(x),y=p(33530),w=p.n(y);const c=config.relative_path+"/api/v3";async function d(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:c+e.url,typeof t=="function"){a(e).then(r=>t(null,r),r=>{let i=r;r instanceof Error||(i=new Error(String(r)));const o=i.message||String(i);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const u=new Error("[[error:no-connection]]");u.originalError=i,i=u}t(i)});return}try{return await a(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,x.fire)("filter:admin.reauth",{url:"login"});return(0,y.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(i)})}throw r}}async function a(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,x.fire)("filter:api.options",{options:e}))}catch(l){console.error("[API] Error in filter:api.options hook:",l)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(l){const k=l.message||l.toString()||String(l),h=l.name||"Error";if(h==="TypeError"&&(k.toLowerCase().includes("fetch")||k.toLowerCase().includes("network")||k.toLowerCase().includes("failed to fetch")||k.toLowerCase().includes("load failed"))||k.toLowerCase().includes("cors")||k.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:k,name:h});const S=new Error("[[error:no-connection]]");throw S.originalError=l,S}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:k,name:h}),l}const{headers:i}=r;if(i.get("x-redirect"))return a({url:i.get("x-redirect"),...e});const o=i.get("content-type"),v=o&&o.startsWith("application/json");let u;if(e.method!=="HEAD")try{v?u=await r.json():u=await r.text()}catch(l){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:o,error:l.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let l;throw u?v&&u.status&&u.status.message?l=u.status.message:typeof u=="string"?l=u:l=r.statusText||"Request failed":l=r.statusText||"Request failed",new Error(l)}return v&&u&&u.hasOwnProperty("status")&&u.hasOwnProperty("response")?u.response:u}function g(e,t,r){return d({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function C(e,t,r){return d({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function T(e,t,r){return d({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function n(e,t,r){return d({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function f(e,t,r){return d({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function s(e,t,r){return d({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}},68636:(_,O,p)=>{var x;x=function(){function m(){this._store={},this._keys=[]}m.prototype.isMock=!0,m.prototype.setItem=function(c,d){c=String(c),this._keys.indexOf(c)===-1&&this._keys.push(c),this._store[c]=d},m.prototype.getItem=function(c){return c=String(c),this._keys.indexOf(c)===-1?null:this._store[c]},m.prototype.removeItem=function(c){c=String(c),this._keys=this._keys.filter(function(d){return d!==c}),this._store[c]=null},m.prototype.clear=function(){this._keys=[],this._store={}},m.prototype.key=function(c){return c=parseInt(c,10)||0,this._keys[c]},Object.defineProperty&&Object.defineProperty(m.prototype,"length",{get:function(){return this._keys.length}});let y;const w=Date.now().toString();try{if(y=window.localStorage,y.setItem(w,w),y.getItem(w)!==w)throw Error("localStorage behaved unexpectedly");return y.removeItem(w),y}catch(c){console.warn(c),console.warn("localStorage failed, falling back on sessionStorage");try{if(y=window.sessionStorage,y.setItem(w,w),y.getItem(w)!==w)throw Error("sessionStorage behaved unexpectedly");return y.removeItem(w),y}catch(d){return console.warn(d),console.warn("sessionStorage failed, falling back on memory storage"),new m}}}.call(O,p,O,_),x!==void 0&&(_.exports=x)},69749:(_,O,p)=>{var x,m;x=[p(17459),p(68636),p(91749),p(29930),p(89336)],m=function(y,w,c,d,a){const g={current:{}};g.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((s,e)=>{C($(e),n)})};function C(n,f){const s=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),r=e.find("#quick-search-container"),i=e.hasClass("hidden"),o=/^(@|acct:)?[\w-]+@.+$/;i&&e.off("focusout").on("focusout",function(){setTimeout(function(){e.find(":focus").length||(e.addClass("hidden"),s.removeClass("hidden"))},200)}),t.off("focus");const v={inputEl:t,resultEl:r};g.enableQuickSearch({searchOptions:f,searchElements:v}),s.off("click").on("click",function(u){return!config.loggedIn&&!app.user.privileges["search:content"]?(d.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(u.stopPropagation(),g.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const u=$(this).find('input[name="query"]'),l=g.getSearchPreferences();return l.term=u.val(),l.in=f.in,o.test(l.term)&&(l.in="users"),c.fire("action:search.submit",{searchOptions:l,searchElements:v}),g.query(l,function(){u.val(""),t.trigger("blur")}),!1})}g.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const f=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),s=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const r=s.find(".filter-category");function i(){ajaxify.data.template.category&&ajaxify.data.cid&&y.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(h){const E=$("<div></div>").html(h).text();r.find(".name").text(E)}),r.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function o(){n.searchOptions=Object.assign({},f),n.searchOptions.term=e.val(),i(),ajaxify.data.template.category&&ajaxify.data.cid&&r.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(s.removeClass("hidden").find(".quick-search-results-container").html(""),s.find(".loading-indicator").removeClass("hidden")),c.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,g.api(n.searchOptions,function(h){if(s.find(".loading-indicator").addClass("hidden"),n.searchOptions.in==="categories"){if(!h.categories||n.hideOnNoMatches&&!h.categories.length)return s.addClass("hidden").find(".quick-search-results-container").html("");h.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-category-search-results",h,E=>{E.length&&E.find(".timeago").timeago(),s.toggleClass("hidden",!E.length||!e.is(":focus")).find(".quick-search-results-container").html(E.length?E:""),c.fire("action:search.quick.complete",{data:h,options:n})})}else{if(!h.posts||n.hideOnNoMatches&&!h.posts.length)return s.addClass("hidden").find(".quick-search-results-container").html("");h.posts.forEach(function(E){const S=$("<div>"+E.content+"</div>").text(),P=e.val().toLowerCase().replace(/^in:topic-\d+/,""),A=Math.max(0,S.toLowerCase().indexOf(P)-40);E.snippet=utils.escapeHTML((A>0?"...":"")+S.slice(A,A+80)+(S.length-A>80?"...":""))}),h.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-search-results",h,function(E){E.length&&E.find(".timeago").timeago(),s.toggleClass("hidden",!E.length||!e.is(":focus")).find(".quick-search-results-container").html(E.length?E:"");const S=s.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");g.highlightMatches(n.searchOptions.term,S),c.fire("action:search.quick.complete",{data:h,options:n})})}})}s.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),o()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){s.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return s.addClass("hidden");o()}},500)),s.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){s.addClass("hidden")})});const v=e.parent(),u=s.parent();v.on("focusout",l),u.on("focusout",l);function l(){setTimeout(function(){!v.find(":focus").length&&!u.find(":focus").length&&!s.hasClass("hidden")&&s.addClass("hidden")},200)}let k=!1;c.on("action:ajaxify.end",function(){ajaxify.isCold()||(k=!0),s.addClass("hidden")}),e.on("focus",function(){const h=e.val();t=h,h&&s.find("#quick-search-results").children().length&&(i(),k?(o(),k=!1):s.removeClass("hidden"),e[0].setSelectionRange(h.startsWith("in:topic")?h.indexOf(" ")+1:0,h.length))}),e.off("refresh").on("refresh",function(){o()})},g.showAndFocusInput=function(n){const f=n.parents(".dropdown-menu");if(f.length){const s=f.siblings("[data-bs-toggle]"),e=a.Dropdown.getOrCreateInstance(s[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},g.query=function(n,f){f=f||function(){},ajaxify.go("search?"+T(n),f)},g.api=function(n,f){const s=config.relative_path+"/api/search?"+T(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+T(n);$.get(s,function(t){t.url=e,f(t)})};function T(n){const f=n.in||"titles",s=n.term.replace(/^[ ?#]*/,""),e={...n,term:s,in:f};return c.fire("action:search.createQueryString",{query:e,data:n}),$.param(e)}return g.getSearchPreferences=function(){try{return JSON.parse(w.getItem("search-preferences")||"{}")}catch(n){return console.error(n),{}}},g.highlightMatches=function(n,f){if(!n||!f.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const s=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+s+")","gi");f.each(function(){const t=$(this),r=[];t.find("*").each(function(){$(this).after("<!-- "+r.length+" -->"),r.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(i,o){return'<strong class="search-match fw-bold text-decoration-underline">'+o+"</strong>"})),r.forEach(function(i,o){t.html(t.html().replace("<!-- "+o+" -->",function(){return i.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},g}.apply(O,x),m!==void 0&&(_.exports=m)}}]);
