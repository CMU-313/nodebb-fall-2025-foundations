"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,34271,34405,37759,49897,69185,86198,99127],{3665:(b,v,l)=>{var E,y;E=[l(34405),l(49897),l(33530),l(29930),l(65348)],y=function(w,C,A,f,m){const n={};return n.init=function(){w.user($("#admin-search"),function(o,s){socket.emit("admin.user.makeAdmins",[s.item.user.uid],function(r){if(r)return f.error(r);$("#admin-search").val(""),!$('.administrator-area [data-uid="'+s.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","admins.members",{admins:{members:[s.item.user]}},function(i){$(".administrator-area").prepend(i)})})}),$(".administrator-area").on("click",".remove-user-icon",function(){const o=$(this).parents("[data-uid]"),s=o.attr("data-uid");if(parseInt(s,10)===parseInt(app.user.uid,10))return f.error("[[admin/manage/users:alerts.no-remove-yourself-admin]]");A.confirm("[[admin/manage/users:alerts.confirm-remove-admin]]",function(r){r&&socket.emit("admin.user.removeAdmins",[s],function(i){if(i)return f.error(i.message);o.remove()})})}),w.user($("#global-mod-search"),function(o,s){C.put("/groups/global-moderators/membership/"+s.item.user.uid).then(()=>{$("#global-mod-search").val(""),!$('.global-moderator-area [data-uid="'+s.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[s.item.user]}},function(r){$(".global-moderator-area").prepend(r),$("#no-global-mods-warning").addClass("hidden")})}).catch(f.error)}),$(".global-moderator-area").on("click",".remove-user-icon",function(){const o=$(this).parents("[data-uid]"),s=o.attr("data-uid");A.confirm("[[admin/manage/users:alerts.confirm-remove-global-mod]]",function(r){r&&C.del("/groups/global-moderators/membership/"+s).then(()=>{o.remove(),$(".global-moderator-area").children().length||$("#no-global-mods-warning").removeClass("hidden")}).catch(f.error)})}),m.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(o){ajaxify.go("admin/manage/admins-mods"+(o.cid?"?cid="+o.cid:""))},localCategories:[]}),w.user($(".moderator-search"),function(o,s){const r=$(o.target),i=$(o.target).attr("data-cid");C.put(`/categories/${i}/moderator/${s.item.user.uid}`,{},function(c){if(c)return f.error(c);r.val(""),!$('.moderator-area[data-cid="'+i+'"] [data-uid="'+s.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[s.item.user]}},function(e){$('.moderator-area[data-cid="'+i+'"]').prepend(e),$('.no-moderator-warning[data-cid="'+i+'"]').addClass("hidden")})})}),$(".moderator-area").on("click",".remove-user-icon",function(){const o=$(this).parents("[data-cid]"),s=o.attr("data-cid"),r=$(this).parents("[data-uid]"),i=r.attr("data-uid");A.confirm("[[admin/manage/users:alerts.confirm-remove-moderator]]",function(c){c&&C.del(`/categories/${s}/moderator/${i}`,{},function(e){if(e)return f.error(e);r.remove(),o.children().length||$('.no-moderator-warning[data-cid="'+s+'"]').removeClass("hidden")})})})},n}.apply(v,E),y!==void 0&&(b.exports=y)},34405:(b,v,l)=>{var E,y;E=[l(49897),l(29930),l(36e3),l(9787),l(35786)],y=function(w,C,{Textcomplete:A},{TextareaEditor:f},{ContenteditableEditor:m}){const n={},o={delay:200,appendTo:null};n.init=r=>{const i={...o,...r},{input:c,onSelect:e}=i;app.loadJQueryUI(function(){c.autocomplete({...i,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(a,t){s(c,e,a,t)}})})},n.user=function(r,i,c){typeof i=="function"&&(c=i,i={}),i=i||{},n.init({input:r,onSelect:c,source:(e,a)=>{i.query=e.term,w.get("/api/users",i,function(t,d){if(t)return C.error(t);if(d&&d.users){const u=d.users.map(function(h){const g=$("<div></div>").html(h.username).text();return h&&{label:g,value:g,user:{uid:h.uid,name:h.username,slug:h.userslug,username:h.username,userslug:h.userslug,displayname:h.displayname,picture:h.picture,banned:h.banned,"icon:text":h["icon:text"],"icon:bgColor":h["icon:bgColor"]}}});a(u)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},n.group=function(r,i){n.init({input:r,onSelect:i,source:(c,e)=>{socket.emit("groups.search",{query:c.term},function(a,t){if(a)return C.error(a);if(t&&t.length){const d=t.map(function(u){return u&&{label:u.name,value:u.name,group:u}});e(d)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},n.tag=function(r,i){n.init({input:r,onSelect:i,delay:100,source:(c,e)=>{socket.emit("topics.autocompleteTags",{query:c.term,cid:ajaxify.data.cid||0},function(a,t){if(a)return C.error(a);t&&e(t),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function s(r,i,c,e){i=i||function(){};const a=jQuery.Event("keypress");a.which=13,a.keyCode=13,setTimeout(function(){r.trigger(a)},100),i(c,e)}return n.setup=function({element:r,strategies:i,options:c}){const e=r.get(0);if(e){var a;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?a=new f(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(a=new m(e)),!a)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var t=new A(a,i,{dropdown:c});return t.on("rendered",function(){t.dropdown.items.length&&t.dropdown.items[0].activate()}),t}},n}.apply(v,E),y!==void 0&&(b.exports=y)},49897:(b,v,l)=>{l.r(v),l.d(v,{del:()=>c,get:()=>n,head:()=>o,patch:()=>r,post:()=>s,put:()=>i});var E=l(91749),y=l.n(E),w=l(33530),C=l.n(w);const A=config.relative_path+"/api/v3";async function f(e,a){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:A+e.url,typeof a=="function"){m(e).then(t=>a(null,t),t=>{let d=t;t instanceof Error||(d=new Error(String(t)));const u=d.message||String(d);if(u&&!u.startsWith("[[error:")&&(u.toLowerCase()==="fetch failed"||u.toLowerCase()==="failed to fetch"||u.toLowerCase().includes("networkerror")||u.toLowerCase().includes("network")&&u.toLowerCase().includes("failed"))){const g=new Error("[[error:no-connection]]");g.originalError=d,d=g}a(d)});return}try{return await m(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:d}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,w.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go(d)})}throw t}}async function m(e){const{url:a}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(p){console.error("[API] Error in filter:api.options hook:",p)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(a,e)}catch(p){const T=p.message||p.toString()||String(p),x=p.name||"Error";if(x==="TypeError"&&(T.toLowerCase().includes("fetch")||T.toLowerCase().includes("network")||T.toLowerCase().includes("failed to fetch")||T.toLowerCase().includes("load failed"))||T.toLowerCase().includes("cors")||T.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:a,method:e.method||"GET",error:T,name:x});const D=new Error("[[error:no-connection]]");throw D.originalError=p,D}throw console.error("[API] Unexpected fetch error:",{url:a,method:e.method||"GET",error:T,name:x}),p}const{headers:d}=t;if(d.get("x-redirect"))return m({url:d.get("x-redirect"),...e});const u=d.get("content-type"),h=u&&u.startsWith("application/json");let g;if(e.method!=="HEAD")try{h?g=await t.json():g=await t.text()}catch(p){throw console.error("[API] Error parsing response:",{url:a,status:t.status,statusText:t.statusText,contentType:u,error:p.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let p;throw g?h&&g.status&&g.status.message?p=g.status.message:typeof g=="string"?p=g:p=t.statusText||"Request failed":p=t.statusText||"Request failed",new Error(p)}return h&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function n(e,a,t){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):"")},t)}function o(e,a,t){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},t)}function s(e,a,t){return f({url:e,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}function r(e,a,t){return f({url:e,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}function i(e,a,t){return f({url:e,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}function c(e,a,t){return f({url:e,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}},65348:(b,v,l)=>{var E,y;E=[l(96349),l(33530),l(91749),l(17459)],y=function(w,C,A,f){const m={};return m.init=function(n,o){if(!n||!n.length)return;o=o||{};const s=o.onSelect||function(){};o.states=o.states||["watching","tracking","notwatching","ignoring"],o.template=o.template||"partials/category/selector-dropdown-left",A.fire("action:category.selector.options",{el:n,options:o}),w.init(n,o);const r={el:n,selectedCategory:null};n.on("click","[data-cid]",function(){const c=$(this);return c.hasClass("disabled")?!1:(r.selectCategory(c.attr("data-cid")),s(r.selectedCategory))});let i=r.el.find('[component="category-selector-selected"]').html();return f.translate(i,c=>{i=c}),r.selectCategory=function(c){const e=r.el.find('[data-cid="'+c+'"]');r.selectedCategory={cid:c,name:e.attr("data-name")},e.length?r.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(i)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},o.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(o.template,{selectedCategory:o.selectedCategory},function(c){r.el.find('[component="category-selector-selected"]').html(c.find('[component="category-selector-selected"]').html())}),r},m.modal=function(n){n=n||{},n.onSelect=n.onSelect||function(){},n.onSubmit=n.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:n.message},function(o){const s=C.dialog({title:n.title||"[[modules:composer.select-category]]",message:o,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:i}}}),r=m.init(s.find('[component="category-selector"]'),n);function i(c){return c.preventDefault(),r.selectedCategory&&(n.onSubmit(r.selectedCategory),s.modal("hide")),!1}n.openOnLoad&&s.on("shown.bs.modal",function(){s.find(".dropdown-toggle").dropdown("toggle")}),s.find("form").on("submit",i)})},m}.apply(v,E),y!==void 0&&(b.exports=y)},96349:(b,v,l)=>{var E,y;E=[l(29930),l(89336),l(49897)],y=function(w,C,A){const f={};return f.init=function(m,n){let o=n.defaultCategories||null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","tracking","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let s=[];Array.isArray(n.localCategories)&&(s=n.localCategories.map(a=>({...a})),o&&(o=[...s,...o])),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const r=m.find('[component="category-selector-search"]');if(!r.length)return;const i=r.parents('[component="category/dropdown"]').length>0||r.parents('[component="category-selector"]').length>0;m.on("show.bs.dropdown",function(){i&&r.removeClass("hidden");function a(){const t=r.find("input").val();t.length>1||!t&&!o?c(t,function(d){o=n.cacheList&&(o||d),e(d)}):!t&&o&&e(o)}r.on("click",function(t){t.preventDefault(),t.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),m.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||r.find("input").focus()}),m.on("hide.bs.dropdown",function(){i&&r.addClass("hidden"),r.off("click"),r.find("input").off("keyup")});function c(a,t){A.get("/search/categories",{search:a,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(d,{categories:u}){if(d)return w.error(d);t(s.concat(u))})}function e(a){const t=n.selectedCids.map(String);a.forEach(function(d){d.selected=t.includes(String(d.cid))}),app.parseAndTranslate(n.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(d){m.find('[component="category/list"]').html(d.find('[component="category/list"]').html()),m.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const u=C.Dropdown.getInstance(m.find(".dropdown-toggle").get(0));u&&u.update()})}},f}.apply(v,E),y!==void 0&&(b.exports=y)}}]);
