"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,86198,90479,99127],{29195:(k,I,u)=>{var E,w;E=[u(17459),u(81335),u(65348),u(49897),u(10246),u(33530),u(29930)],w=function(v,P,A,p,h,r,s){h=h.default;const f={};let i=-1,C;(function(){const t='[data-action="purge"][data-cid]';$(document).off("click.adminPurge",t).on("click.adminPurge",t,function(a){a.preventDefault();const g=$(this),o=g.closest("li[data-cid]"),l=g.attr("data-cid")||o.length&&o.attr("data-cid"),d=o.length&&o.find(".title").text().trim()||"";if(!l){console.error("admin/manage/categories: purge clicked but no cid",this);return}p.get(`/categories/${encodeURIComponent(l)}/count`).then(function(m){const x=m&&m.count?m.count:0;P.render("admin/partials/categories/purge",{name:d,topic_count:x}).then(function(b){const S=r.dialog({title:"[[admin/manage/categories:purge]]",message:b,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){S.find(".modal-footer button").prop("disabled",!0);const D=setInterval(async function(){try{const{count:L}=await p.get(`/categories/${encodeURIComponent(l)}/count`);let T=0;x>0&&(T=Math.max(0,1-L/x)*100),S.find(".progress-bar").css({width:T+"%"})}catch(L){clearInterval(D),s.error(L)}},1e3);return p.del("/categories/"+l).then(function(){D&&clearInterval(D),S.modal("hide"),s.success("[[admin/manage/categories:alert.purge-success]]"),o&&o.length&&o.remove()}).catch(function(L){clearInterval(D),s.error(L)}),!1}}}})})}).catch(s.error)})})(),f.init=function(){A.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(t){ajaxify.go("/admin/manage/categories"+(t.cid?"?cid="+t.cid:""))},cacheList:!1,localCategories:[],template:"admin/partials/category/selector-dropdown-right"}),f.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",f.throwCreateModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const t=$(this),a=t.attr("data-disable-cid"),g=t.parents('li[data-cid="'+a+'"]'),o=g.hasClass("disabled"),d=g.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();f.toggle([a].concat(d),!o)}),$(".categories").on("click",".toggle",function(){const t=$(this);t.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),t.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden");const a=t.closest("[data-cid]").find("> ul.has-more-categories");parseInt(a.attr("data-hasmore"),10)===1&&a.toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const t=$(this).attr("data-cid"),a=$(this).attr("data-order"),g=r.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+a+' /><p class="form-text">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const o=g.find("input").val();if(o&&t){const l={};l[t]={order:Math.max(1,parseInt(o,10))},p.put("/categories/"+t,l[t]).then(function(){ajaxify.refresh()}).catch(s.error)}else return!1}}}})}),$("#toggle-collapse-all").on("click",function(){const t=$(this),a=parseInt(t.attr("data-collapsed"),10)===1;e(a),t.attr("data-collapsed",a?0:1).translateText(a?"[[admin/manage/categories:collapse-all]]":"[[admin/manage/categories:expand-all]]")});function e(t){const a=$(".categories .toggle");a.find("i").toggleClass("fa-chevron-down",t).toggleClass("fa-chevron-right",!t),a.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!t)}},f.throwCreateModal=function(){P.render("admin/partials/categories/create",{}).then(function(e){const t=r.dialog({title:"[[admin/manage/categories:alert.create]]",message:e,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:l}}}),a={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}],template:"admin/partials/category/selector-dropdown-left"},g=A.init(t.find('#parentCidGroup [component="category-selector"]'),a),o=A.init(t.find('#cloneFromCidGroup [component="category-selector"]'),a);function l(){const d=t.find("form").serializeObject();return d.description="",d.icon="fa-comments",d.uid=app.user.uid,d.parentCid=g.getSelectedCid(),d.cloneFromCid=o.getSelectedCid(),f.create(d),t.modal("hide"),!1}$("#cloneChildren").on("change",function(){const d=$(this),m=t.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');d.prop("checked")?(m.attr("disabled","disabled"),g.selectCategory(0)):m.removeAttr("disabled")}),t.find("form").on("submit",l)})},f.create=function(e){p.post("/categories",e,function(t,a){if(t)return s.error(t);s.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+a.cid)})},f.render=function(e){const t=$(".categories");!e||!e.length?v.translate("[[admin/manage/categories:alert.none-active]]",function(a){$("<div></div>").addClass("alert alert-info text-center").text(a).appendTo(t)}):(C={},c(e,t,{cid:0}))},f.toggle=function(e,t){const a=document.querySelector('.categories [data-cid="0"]');Promise.all(e.map(g=>p.put("/categories/"+g,{disabled:t?1:0}).then(()=>{const o=a.querySelector(`li[data-cid="${g}"]`);o.classList[t?"add":"remove"]("disabled"),$(o).find('li a[data-action="toggle"]').first().translateText(t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(s.error)))};function y(e){i=e.to.dataset.cid}function n(e){const t=parseInt(i,10)!==-1;if(e.newIndex!=null&&parseInt(e.oldIndex,10)!==parseInt(e.newIndex,10)||t){const a=e.item.dataset.cid,g={},o=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(g[a]={order:o+e.newIndex+1},t){g[a].parentCid=i;const l=parseInt(e.from.getAttribute("data-cid"),10),d=parseInt(e.to.getAttribute("data-cid"),10);if(l!==d){const m=document.querySelector(`.categories li[data-cid="${d}"] .toggle`);if(m&&m.classList.toggle("invisible",!1),!document.querySelectorAll(`.categories li[data-cid="${l}"] ul[data-cid] li[data-cid]`).length){const b=document.querySelector(`.categories li[data-cid="${l}"] .toggle`);b&&b.classList.toggle("invisible",!0)}e.item.dataset.parentCid=d}}i=-1,p.put("/categories/"+a,g[a]).catch(s.error)}}function c(e,t,a){let g=0;const o=a.cid;e.forEach(function(d,m,x){v.translate(d.name,function(b){d.name!==b&&(d.name=b),g+=1,g===x.length&&l()})}),e.length||l();function l(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:a.cid,categories:e,parentCategory:a},function(d){t.find(".category-row").length?t.find(".category-row").after(d):t.append(d),e.length||t.get(0).querySelector(".toggle").classList.toggle("invisible",!0);for(let m=0,x=e.length;m<x;m+=1)c(e[m].children,$('li[data-cid="'+e[m].cid+'"]'),e[m]);C[o]=h.create($('ul[data-cid="'+o+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:y,onEnd:n})})}}return f}.apply(I,E),w!==void 0&&(k.exports=w)},49897:(k,I,u)=>{u.r(I),u.d(I,{del:()=>y,get:()=>r,head:()=>s,patch:()=>i,post:()=>f,put:()=>C});var E=u(91749),w=u.n(E),v=u(33530),P=u.n(v);const A=config.relative_path+"/api/v3";async function p(n,c){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:A+n.url,typeof c=="function"){h(n).then(e=>c(null,e),e=>{let t=e;e instanceof Error||(t=new Error(String(e)));const a=t.message||String(t);if(a&&!a.startsWith("[[error:")&&(a.toLowerCase()==="fetch failed"||a.toLowerCase()==="failed to fetch"||a.toLowerCase().includes("networkerror")||a.toLowerCase().includes("network")&&a.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=t,t=o}c(t)});return}try{return await h(n)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:t}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",a=>{a&&ajaxify.go(t)})}throw e}}async function h(n){const{url:c}=n;delete n.url,n.headers||(n.headers={}),n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8");try{({options:n}=await(0,E.fire)("filter:api.options",{options:n}))}catch(l){console.error("[API] Error in filter:api.options hook:",l)}n.data&&(n.body=n.data,delete n.data);let e;try{e=await fetch(c,n)}catch(l){const d=l.message||l.toString()||String(l),m=l.name||"Error";if(m==="TypeError"&&(d.toLowerCase().includes("fetch")||d.toLowerCase().includes("network")||d.toLowerCase().includes("failed to fetch")||d.toLowerCase().includes("load failed"))||d.toLowerCase().includes("cors")||d.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:c,method:n.method||"GET",error:d,name:m});const b=new Error("[[error:no-connection]]");throw b.originalError=l,b}throw console.error("[API] Unexpected fetch error:",{url:c,method:n.method||"GET",error:d,name:m}),l}const{headers:t}=e;if(t.get("x-redirect"))return h({url:t.get("x-redirect"),...n});const a=t.get("content-type"),g=a&&a.startsWith("application/json");let o;if(n.method!=="HEAD")try{g?o=await e.json():o=await e.text()}catch(l){throw console.error("[API] Error parsing response:",{url:c,status:e.status,statusText:e.statusText,contentType:a,error:l.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let l;throw o?g&&o.status&&o.status.message?l=o.status.message:typeof o=="string"?l=o:l=e.statusText||"Request failed":l=e.statusText||"Request failed",new Error(l)}return g&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function r(n,c,e){return p({url:n+(c&&Object.keys(c).length?"?"+$.param(c):"")},e)}function s(n,c,e){return p({url:n+(c&&Object.keys(c).length?"?"+$.param(c):""),method:"HEAD"},e)}function f(n,c,e){return p({url:n,method:"POST",data:c,headers:{"x-csrf-token":config.csrf_token}},e)}function i(n,c,e){return p({url:n,method:"PATCH",data:c,headers:{"x-csrf-token":config.csrf_token}},e)}function C(n,c,e){return p({url:n,method:"PUT",data:c,headers:{"x-csrf-token":config.csrf_token}},e)}function y(n,c,e){return p({url:n,method:"DELETE",data:c,headers:{"x-csrf-token":config.csrf_token}},e)}},65348:(k,I,u)=>{var E,w;E=[u(96349),u(33530),u(91749),u(17459)],w=function(v,P,A,p){const h={};return h.init=function(r,s){if(!r||!r.length)return;s=s||{};const f=s.onSelect||function(){};s.states=s.states||["watching","tracking","notwatching","ignoring"],s.template=s.template||"partials/category/selector-dropdown-left",A.fire("action:category.selector.options",{el:r,options:s}),v.init(r,s);const i={el:r,selectedCategory:null};r.on("click","[data-cid]",function(){const y=$(this);return y.hasClass("disabled")?!1:(i.selectCategory(y.attr("data-cid")),f(i.selectedCategory))});let C=i.el.find('[component="category-selector-selected"]').html();return p.translate(C,y=>{C=y}),i.selectCategory=function(y){const n=i.el.find('[data-cid="'+y+'"]');i.selectedCategory={cid:y,name:n.attr("data-name")},n.length?i.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(C)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},s.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(s.template,{selectedCategory:s.selectedCategory},function(y){i.el.find('[component="category-selector-selected"]').html(y.find('[component="category-selector-selected"]').html())}),i},h.modal=function(r){r=r||{},r.onSelect=r.onSelect||function(){},r.onSubmit=r.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:r.message},function(s){const f=P.dialog({title:r.title||"[[modules:composer.select-category]]",message:s,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:C}}}),i=h.init(f.find('[component="category-selector"]'),r);function C(y){return y.preventDefault(),i.selectedCategory&&(r.onSubmit(i.selectedCategory),f.modal("hide")),!1}r.openOnLoad&&f.on("shown.bs.modal",function(){f.find(".dropdown-toggle").dropdown("toggle")}),f.find("form").on("submit",C)})},h}.apply(I,E),w!==void 0&&(k.exports=w)},96349:(k,I,u)=>{var E,w;E=[u(29930),u(89336),u(49897)],w=function(v,P,A){const p={};return p.init=function(h,r){let s=r.defaultCategories||null;r=r||{},r.privilege=r.privilege||"topics:read",r.states=r.states||["watching","tracking","notwatching","ignoring"],r.cacheList=r.hasOwnProperty("cacheList")?r.cacheList:!0;let f=[];Array.isArray(r.localCategories)&&(f=r.localCategories.map(c=>({...c})),s&&(s=[...f,...s])),r.selectedCids=r.selectedCids||ajaxify.data.selectedCids||[];const i=h.find('[component="category-selector-search"]');if(!i.length)return;const C=i.parents('[component="category/dropdown"]').length>0||i.parents('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){C&&i.removeClass("hidden");function c(){const e=i.find("input").val();e.length>1||!e&&!s?y(e,function(t){s=r.cacheList&&(s||t),n(t)}):!e&&s&&n(s)}i.on("click",function(e){e.preventDefault(),e.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(c,300)),c()}),h.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),h.on("hide.bs.dropdown",function(){C&&i.addClass("hidden"),i.off("click"),i.find("input").off("keyup")});function y(c,e){A.get("/search/categories",{search:c,query:utils.params(),parentCid:r.parentCid||0,selectedCids:r.selectedCids,privilege:r.privilege,states:r.states,showLinks:r.showLinks},function(t,{categories:a}){if(t)return v.error(t);e(f.concat(a))})}function n(c){const e=r.selectedCids.map(String);c.forEach(function(t){t.selected=e.includes(String(t.cid))}),app.parseAndTranslate(r.template,{categoryItems:c.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){h.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!c.length);const a=P.Dropdown.getInstance(h.find(".dropdown-toggle").get(0));a&&a.update()})}},p}.apply(I,E),w!==void 0&&(k.exports=w)}}]);
