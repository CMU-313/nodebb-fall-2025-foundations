"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,99127],{49897:(A,E,d)=>{d.r(E),d.d(E,{del:()=>L,get:()=>n,head:()=>f,patch:()=>c,post:()=>w,put:()=>C});var g=d(91749),m=d.n(g),y=d(33530),x=d.n(y);const k=config.relative_path+"/api/v3";async function u(r,t){if(r.url=r.url.startsWith("/api")?config.relative_path+r.url:k+r.url,typeof t=="function"){l(r).then(e=>t(null,e),e=>{let a=e;e instanceof Error||(a=new Error(String(e)));const s=a.message||String(a);if(s&&!s.startsWith("[[error:")&&(s.toLowerCase()==="fetch failed"||s.toLowerCase()==="failed to fetch"||s.toLowerCase().includes("networkerror")||s.toLowerCase().includes("network")&&s.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=a,a=o}t(a)});return}try{return await l(r)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:a}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,y.confirm)("[[error:api.reauth-required]]",s=>{s&&ajaxify.go(a)})}throw e}}async function l(r){const{url:t}=r;delete r.url,r.headers||(r.headers={}),r.data&&!(r.data instanceof FormData)&&(r.data=JSON.stringify(r.data||{}),r.headers["content-type"]="application/json; charset=utf-8");try{({options:r}=await(0,g.fire)("filter:api.options",{options:r}))}catch(i){console.error("[API] Error in filter:api.options hook:",i)}r.data&&(r.body=r.data,delete r.data);let e;try{e=await fetch(t,r)}catch(i){const h=i.message||i.toString()||String(i),P=i.name||"Error";if(P==="TypeError"&&(h.toLowerCase().includes("fetch")||h.toLowerCase().includes("network")||h.toLowerCase().includes("failed to fetch")||h.toLowerCase().includes("load failed"))||h.toLowerCase().includes("cors")||h.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:r.method||"GET",error:h,name:P});const T=new Error("[[error:no-connection]]");throw T.originalError=i,T}throw console.error("[API] Unexpected fetch error:",{url:t,method:r.method||"GET",error:h,name:P}),i}const{headers:a}=e;if(a.get("x-redirect"))return l({url:a.get("x-redirect"),...r});const s=a.get("content-type"),p=s&&s.startsWith("application/json");let o;if(r.method!=="HEAD")try{p?o=await e.json():o=await e.text()}catch(i){throw console.error("[API] Error parsing response:",{url:t,status:e.status,statusText:e.statusText,contentType:s,error:i.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let i;throw o?p&&o.status&&o.status.message?i=o.status.message:typeof o=="string"?i=o:i=e.statusText||"Request failed":i=e.statusText||"Request failed",new Error(i)}return p&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function n(r,t,e){return u({url:r+(t&&Object.keys(t).length?"?"+$.param(t):"")},e)}function f(r,t,e){return u({url:r+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},e)}function w(r,t,e){return u({url:r,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function c(r,t,e){return u({url:r,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function C(r,t,e){return u({url:r,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function L(r,t,e){return u({url:r,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}},96349:(A,E,d)=>{var g,m;g=[d(29930),d(89336),d(49897)],m=function(y,x,k){const u={};return u.init=function(l,n){let f=n.defaultCategories||null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","tracking","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let w=[];Array.isArray(n.localCategories)&&(w=n.localCategories.map(t=>({...t})),f&&(f=[...w,...f])),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const c=l.find('[component="category-selector-search"]');if(!c.length)return;const C=c.parents('[component="category/dropdown"]').length>0||c.parents('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){C&&c.removeClass("hidden");function t(){const e=c.find("input").val();e.length>1||!e&&!f?L(e,function(a){f=n.cacheList&&(f||a),r(a)}):!e&&f&&r(f)}c.on("click",function(e){e.preventDefault(),e.stopPropagation()}),c.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||c.find("input").focus()}),l.on("hide.bs.dropdown",function(){C&&c.addClass("hidden"),c.off("click"),c.find("input").off("keyup")});function L(t,e){k.get("/search/categories",{search:t,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(a,{categories:s}){if(a)return y.error(a);e(w.concat(s))})}function r(t){const e=n.selectedCids.map(String);t.forEach(function(a){a.selected=e.includes(String(a.cid))}),app.parseAndTranslate(n.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(a){l.find('[component="category/list"]').html(a.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const s=x.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));s&&s.update()})}},u}.apply(E,g),m!==void 0&&(A.exports=m)}}]);
