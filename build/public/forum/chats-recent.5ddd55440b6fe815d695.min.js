"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,26832,34271,49897,56418,61462,99127],{26832:(T,m,o)=>{var g,w;g=[o(29930),o(49897),o(92619)],w=function(p,x,y){const f={};f.init=function(){Promise.all([o.e(20056),o.e(6411),o.e(60419),o.e(38636)]).then(function(){var c=[o(38636)];(function(u){$('[component="chat/nav-wrapper"]').on("click",'[component="chat/recent/room"], [component="chat/public/room"]',function(n){n.stopPropagation(),n.preventDefault();const h=this.getAttribute("data-roomid");u.switchChat(h)}).on("click",".mark-read",function(n){n.stopPropagation();const h=this.closest("[data-roomid]");y.toggleReadState(h)}),$('[component="chat/recent"]').on("scroll",utils.debounce(function(){const n=$(this),h=(n[0].scrollHeight-n.height())*.9;n.scrollTop()>h&&E()},100))}).apply(null,c)}).catch(o.oe)};async function E(){const c=$('[component="chat/recent"]');c.attr("loading")||(c.attr("loading",1),x.get("/chats",{uid:ajaxify.data.uid,start:c.attr("data-nextstart")}).then(({rooms:u,nextStart:n})=>{u.length?C({rooms:u,nextStart:n},function(){c.removeAttr("loading"),c.attr("data-nextstart",n)}):c.removeAttr("loading")}).catch(p.error))}function C(c,u){if(!c.rooms.length)return u();c.loadingMore=!0,app.parseAndTranslate("chats","rooms",c,function(n){$('[component="chat/recent"]').append(n),n.find(".timeago").timeago(),u()})}return f}.apply(m,g),w!==void 0&&(T.exports=w)},49897:(T,m,o)=>{o.r(m),o.d(m,{del:()=>L,get:()=>C,head:()=>c,patch:()=>n,post:()=>u,put:()=>h});var g=o(91749),w=o.n(g),p=o(33530),x=o.n(p);const y=config.relative_path+"/api/v3";async function f(t,r){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:y+t.url,typeof r=="function"){E(t).then(e=>r(null,e),e=>{let l=e;e instanceof Error||(l=new Error(String(e)));const i=l.message||String(l);if(i&&!i.startsWith("[[error:")&&(i.toLowerCase()==="fetch failed"||i.toLowerCase()==="failed to fetch"||i.toLowerCase().includes("networkerror")||i.toLowerCase().includes("network")&&i.toLowerCase().includes("failed"))){const a=new Error("[[error:no-connection]]");a.originalError=l,l=a}r(l)});return}try{return await E(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:l}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",i=>{i&&ajaxify.go(l)})}throw e}}async function E(t){const{url:r}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,g.fire)("filter:api.options",{options:t}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}t.data&&(t.body=t.data,delete t.data);let e;try{e=await fetch(r,t)}catch(s){const d=s.message||s.toString()||String(s),P=s.name||"Error";if(P==="TypeError"&&(d.toLowerCase().includes("fetch")||d.toLowerCase().includes("network")||d.toLowerCase().includes("failed to fetch")||d.toLowerCase().includes("load failed"))||d.toLowerCase().includes("cors")||d.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:t.method||"GET",error:d,name:P});const D=new Error("[[error:no-connection]]");throw D.originalError=s,D}throw console.error("[API] Unexpected fetch error:",{url:r,method:t.method||"GET",error:d,name:P}),s}const{headers:l}=e;if(l.get("x-redirect"))return E({url:l.get("x-redirect"),...t});const i=l.get("content-type"),A=i&&i.startsWith("application/json");let a;if(t.method!=="HEAD")try{A?a=await e.json():a=await e.text()}catch(s){throw console.error("[API] Error parsing response:",{url:r,status:e.status,statusText:e.statusText,contentType:i,error:s.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let s;throw a?A&&a.status&&a.status.message?s=a.status.message:typeof a=="string"?s=a:s=e.statusText||"Request failed":s=e.statusText||"Request failed",new Error(s)}return A&&a&&a.hasOwnProperty("status")&&a.hasOwnProperty("response")?a.response:a}function C(t,r,e){return f({url:t+(r&&Object.keys(r).length?"?"+$.param(r):"")},e)}function c(t,r,e){return f({url:t+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},e)}function u(t,r,e){return f({url:t,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function n(t,r,e){return f({url:t,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function h(t,r,e){return f({url:t,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function L(t,r,e){return f({url:t,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
