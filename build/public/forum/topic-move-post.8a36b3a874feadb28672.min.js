"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,38395,49897,90677,94747,99127],{16227:(C,v,p)=>{var E,y;E=[p(52473)],y=function(k){const i={};let P;i.pids=[];let l=!1;i.init=function(f,c){i.pids.length=0,P=f,c=c||{},l=c.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',w),s()};function w(f){f.stopPropagation();const c=$(this).attr("data-pid"),m=$('[component="topic"] [data-pid="'+c+'"]');!l&&parseInt($(this).attr("data-index"),10)===0||i.togglePostSelection(m,c)}i.disable=function(){i.pids.forEach(function(f){k.get("post","pid",f).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',w),h()},i.togglePostSelection=function(f,c){if(c){const m=i.pids.indexOf(c);m===-1?(i.pids.push(c),f.toggleClass("selected",!0)):(i.pids.splice(m,1),f.toggleClass("selected",!1)),i.pids.length&&i.pids.sort(function(t,n){return t-n}),typeof P=="function"&&P()}};function x(){return!1}function s(){$("#content").on("click",'[component="post"] button, [component="post"] a',x)}function h(){$("#content").off("click",'[component="post"] button, [component="post"] a',x)}return i}.apply(v,E),y!==void 0&&(C.exports=y)},49897:(C,v,p)=>{p.r(v),p.d(v,{del:()=>m,get:()=>x,head:()=>s,patch:()=>f,post:()=>h,put:()=>c});var E=p(91749),y=p.n(E),k=p(33530),i=p.n(k);const P=config.relative_path+"/api/v3";async function l(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:P+t.url,typeof n=="function"){w(t).then(e=>n(null,e),e=>{let u=e;e instanceof Error||(u=new Error(String(e)));const d=u.message||String(u);if(d&&!d.startsWith("[[error:")&&(d.toLowerCase()==="fetch failed"||d.toLowerCase()==="failed to fetch"||d.toLowerCase().includes("networkerror")||d.toLowerCase().includes("network")&&d.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=u,u=o}n(u)});return}try{return await w(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:u}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,k.confirm)("[[error:api.reauth-required]]",d=>{d&&ajaxify.go(u)})}throw e}}async function w(t){const{url:n}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,E.fire)("filter:api.options",{options:t}))}catch(a){console.error("[API] Error in filter:api.options hook:",a)}t.data&&(t.body=t.data,delete t.data);let e;try{e=await fetch(n,t)}catch(a){const g=a.message||a.toString()||String(a),T=a.name||"Error";if(T==="TypeError"&&(g.toLowerCase().includes("fetch")||g.toLowerCase().includes("network")||g.toLowerCase().includes("failed to fetch")||g.toLowerCase().includes("load failed"))||g.toLowerCase().includes("cors")||g.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:n,method:t.method||"GET",error:g,name:T});const _=new Error("[[error:no-connection]]");throw _.originalError=a,_}throw console.error("[API] Unexpected fetch error:",{url:n,method:t.method||"GET",error:g,name:T}),a}const{headers:u}=e;if(u.get("x-redirect"))return w({url:u.get("x-redirect"),...t});const d=u.get("content-type"),r=d&&d.startsWith("application/json");let o;if(t.method!=="HEAD")try{r?o=await e.json():o=await e.text()}catch(a){throw console.error("[API] Error parsing response:",{url:n,status:e.status,statusText:e.statusText,contentType:d,error:a.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let a;throw o?r&&o.status&&o.status.message?a=o.status.message:typeof o=="string"?a=o:a=e.statusText||"Request failed":a=e.statusText||"Request failed",new Error(a)}return r&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function x(t,n,e){return l({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function s(t,n,e){return l({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function h(t,n,e){return l({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function f(t,n,e){return l({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function c(t,n,e){return l({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function m(t,n,e){return l({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},90677:(C,v,p)=>{var E,y;E=[p(52473),p(16227),p(17459),p(29930),p(49897)],y=function(k,i,P,l,w){const x={};let s,h,f;x.init=function(r){s||(f=ajaxify.data.tid,app.parseAndTranslate("modals/move-post",{},function(o){s=o,h=s.find("#move_posts_confirm"),$("body").append(s),s.find("#move_posts_cancel").on("click",d),s.find("#topicId").on("keyup",utils.debounce(n,200)),i.init(e),t(),r&&i.togglePostSelection(r,r.attr("data-pid")),$(window).off("action:ajaxify.end",c).on("action:ajaxify.end",c),h.on("click",function(){const a=m();if(!a)return;h.attr("disabled",!0);const g={pids:i.pids.slice(),tid:a};if(config.undoTimeout>0)return l.alert({alert_id:"pids_move_"+i.pids.join("-"),title:"[[topic:thread-tools.move-posts]]",message:"[[topic:topic-move-posts-success]]",type:"success",timeout:config.undoTimeout,timeoutfn:function(){u(g)},clickfn:function(T,A){delete A.timeoutfn,l.success("[[topic:topic-move-posts-undone]]"),h.removeAttr("disabled")}});u(g)})}))};function c(){if(!s)return;const r=s.find("#topicId");let o=null;ajaxify.data.template.topic&&ajaxify.data.tid&&String(ajaxify.data.tid)!==String(f)&&(o=ajaxify.data.tid),o&&r.val(o),n()}function m(){const r=s.find("#topicId");return r.length&&r.val()?r.val():ajaxify.data.template.topic&&ajaxify.data.tid}function t(){if(!s)return;const r=m();i.pids.length?r&&String(r)!==String(f)?w.get(`/topics/${r}`,{}).then(function(o){if(!o||!o.tid)return l.error("[[error:no-topic]]");if(o.scheduled)return l.error("[[error:cant-move-posts-to-scheduled]]");const a=P.compile("topic:x-posts-will-be-moved-to-y",i.pids.length,o.title);s.find("#pids").translateHtml(a)}):s.find("#pids").translateHtml("[[topic:x-posts-selected, "+i.pids.length+"]]"):s.find("#pids").translateHtml("[[topic:no-posts-selected]]")}function n(){if(!s)return;const r=m();i.pids.length&&r&&String(r)!==String(f)?h.removeAttr("disabled"):h.attr("disabled",!0),t()}function e(){n()}function u(r){r.tid&&Promise.all(r.pids.map(o=>w.put(`/posts/${encodeURIComponent(o)}/move`,{tid:r.tid}))).then(()=>{r.pids.forEach(function(o){k.get("post","pid",o).fadeOut(500,function(){$(this).remove()})}),r.pids.length&&ajaxify.data.template.topic&&String(r.tid)===String(ajaxify.data.tid)&&ajaxify.go(`/post/${r.pids[0]}`),d()}).catch(l.error)}function d(){s&&(s.remove(),s=null,i.disable(),$(window).off("action:ajaxify.end",c))}return x}.apply(v,E),y!==void 0&&(C.exports=y)}}]);
