"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[25285,27810,33085,34405,98088],{22148:(B,F,a)=>{var I,A;I=[a(22410),a(60984),a(8454),a(57642),a(47536),a(96352),a(43349),a(95692),a(52473),a(68636),a(91749),a(49897),a(29930),a(33530),a(57576)],A=function(b,x,f,h,p,e,u,E,c,r,l,m,v,C,R){const k={};let g="0",T="";$(window).on("action:ajaxify.start",function(n,s){h.removeListeners(),String(s.url).startsWith("topic/")||(e.disable(),c.get("navbar/title").find("span").text("").hide(),v.remove("bookmark"))}),k.init=async function(){const n=g==="0"||String(g)!==String(ajaxify.data.tid);g=String(ajaxify.data.tid),T=ajaxify.currentPage,l.fire("action:topic.loading"),app.enterRoom("topic_"+g),n&&(p.signaturesShown={}),await p.onTopicPageLoad(c.get("post")),e.init('[component="topic"]>[component="post"]',ajaxify.data.postcount,k.toTop,k.toBottom,k.navigatorCallback),f.init(g),x.init(g,$(".topic")),h.init(),u.handleSort("topicPostSort","topic/"+ajaxify.data.slug),config.usePagination||b.init($('[component="topic"]'),p.loadMorePosts),V(),t(),o(),y(),D(),O(),P(),M(g),Y(),$(window).on("scroll",utils.debounce(W,250)),K(),l.fire("action:topic.loaded",ajaxify.data)};function O(){$(".topic").on("click",".view-translated-btn",function(){$(this).closest(".sensitive-content-message").next(".translated-content").toggle();var n=$(this).closest(".sensitive-content-message").next(".translated-content").is(":visible");n?$(this).text("Hide the translated message."):$(this).text("Click here to view the translated message.")})}function K(){Promise.resolve().then(function(){var n=[a(6411)];(s=>{config.topicSearchEnabled&&a.e(69749).then(function(){var i=[a(69749)];(function(d){s.bind(["command+f","ctrl+f"],function(S){S.preventDefault();let w=$('[component="navbar"] [component="search/form"]');w.length||(w=$('[component="sidebar/right"] [component="search/form"]')),w.find('[component="search/fields"] input[name="query"]').val("in:topic-"+ajaxify.data.tid+" "),d.showAndFocusInput(w)}),l.onPage("action:ajaxify.cleanup",()=>{s.unbind(["command+f","ctrl+f"])})}).apply(null,i)}).catch(a.oe),s.bind("j",i=>{if(i.target.classList.contains("mousetrap"))return;const d=e.getIndex(),S=e.getCount();d!==S&&e.scrollToIndex(d,!0,0)}),s.bind("k",i=>{if(i.target.classList.contains("mousetrap"))return;const d=e.getIndex();d!==1&&e.scrollToIndex(d-2,!0,0)})}).apply(null,n)}).catch(a.oe)}k.toTop=function(){e.scrollTop(0)},k.toBottom=function(){socket.emit("topics.postcount",ajaxify.data.tid,function(n,s){if(n)return v.error(n);e.scrollBottom(s-1)})};function M(n){if(window.location.hash){const d=$(utils.escapeHTML(window.location.hash));if(d.length){const S=d.parents("[data-pid]");return e.scrollToElement(S,!0,0)}}const s=ajaxify.data.bookmark||r.getItem("topic:"+n+":bookmark"),i=ajaxify.data.postIndex;if(H(i),e.shouldScrollToPost(i))return e.scrollToPostIndex(i-1,!0,0);s&&(!config.usePagination||config.usePagination&&ajaxify.data.pagination.currentPage===1)&&ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&v.alert({alert_id:"bookmark",message:"[[topic:bookmark-instructions]]",timeout:15e3,type:"info",clickfn:function(){e.scrollToIndex(Math.max(0,parseInt(s,10)-1),!0)},closefn:function(){r.removeItem("topic:"+n+":bookmark")}})}function Y(){const n=document.querySelector('[component="topic/thumb/list"]');n&&n.addEventListener("click",async s=>{const i=s.target.closest("a");if(i){const d=Array.from(i.parentNode.children).indexOf(i);s.stopPropagation(),s.preventDefault();const S=ajaxify.data.thumbs.map(j=>({...j}));S.forEach((j,U)=>{j.selected=U===d});const w=await app.parseAndTranslate("modals/topic-thumbs-view",{src:i.href,thumbs:S});C.dialog({size:"lg",onEscape:!0,backdrop:!0,message:w}).on("click",'[component="topic/thumb/select"]',function(){$('[component="topic/thumb/select"]').removeClass("border-primary"),$(this).addClass("border-primary"),$('[component="topic/thumb/current"]').attr("src",$(this).attr("src"))})}})}function V(){c.get("topic").on("click","blockquote .toggle",function(){const n=$(this).parent("blockquote"),s=$(this);n.toggleClass("uncollapsed");const i=!n.hasClass("uncollapsed");s.toggleClass("fa-angle-down",i).toggleClass("fa-angle-up",!i)})}function t(){new R('[component="copy/code/btn"]',{text:function(s){const i=$(s);i.find("i").removeClass("fa-copy").addClass("fa-check"),setTimeout(()=>i.find("i").removeClass("fa-check").addClass("fa-copy"),2e3);const d=i.parent().find("code");return d.attr("data-lines")&&d.find(".hljs-ln-code[data-line-number]").length?d.find(".hljs-ln-code[data-line-number]").map((S,w)=>w.textContent).get().join(`
`):d.text()}});function n(){function s(j){return j.scrollHeight>j.clientHeight}function i(j){if(j.length){if(!j[0].scrollHeight)return setTimeout(i,100,j);s(j.get(0))&&j.parent().parent().find('[component="copy/code/btn"]').css({margin:"0.5rem 1.5rem 0 0"})}}let d=$('[component="topic"] [component="post/content"] code:not([data-button-added])');d=d.filter((j,U)=>$(U).text().includes(`
`));const S=$('<div class="hover-parent position-relative"></div>'),w=$('<button component="copy/code/btn" class="hover-visible position-absolute top-0 btn btn-sm btn-outline-secondary" style="right: 0px; margin: 0.5rem 0.5rem 0 0;"><i class="fa fa-fw fa-copy"></i></button>'),N=d.parent();N.wrap(S).parent().append(w),N.parent().find('[component="copy/code/btn"]').translateAttr("title","[[topic:copy-code]]"),N.each((j,U)=>{i($(U).find("code"))}),d.attr("data-button-added",1)}l.registerPage("action:posts.loaded",n),l.registerPage("action:topic.loaded",n),l.registerPage("action:posts.edited",n)}function o(){function n(s,i){const d=$('[component="topic"]>[component="post"][data-pid="'+i+'"]');if(d.length)return s.preventDefault(),e.scrollToIndex(d.attr("data-index"),!0),!1}c.get("topic").on("click",'[component="post/parent"]',function(s){const i=$(this),d=i.find('[component="post/parent/content"]');if(d.length){const S=i.attr("data-collapsed")==="true";if(i.attr("data-collapsed",S?"false":"true"),d.toggleClass("line-clamp-1"),i.find(".timeago").toggleClass("hidden"),i.toggleClass("flex-column").toggleClass("flex-row"),S)return!1}else return n(s,i.attr("data-topid"))}),c.get("topic").on("click",'[component="post/parent"] .timeago',function(s){return n(s,$(this).parents("[data-parent-pid]").attr("data-parent-pid"))})}function y(){$('[component="topic"]').on("click",'[component="post/reply-count"]',function(){const n=$(this);a.e(18631).then(function(){var s=[a(18631)];(function(i){i.init(n)}).apply(null,s)}).catch(a.oe)})}function D(){if(!ajaxify.data.showPostPreviewsOnHover||utils.isMobile())return;let n=0,s=!1,i=null;const d={};function S(){clearTimeout(n),n=0,$("#post-tooltip").remove(),s=!0}function w(N){$(N.target).closest("#post-tooltip").length||S()}$(window).one("action:ajaxify.start",S),$('[component="topic"]').on("mouseenter",'a[component="post/parent"], [component="post/parent/content"] a,[component="post/content"] a, [component="topic/event"] a',async function(){i=$(this),i.removeAttr("over-tooltip"),i.one("mouseleave",function(){clearTimeout(n),n=0,setTimeout(()=>{!i.attr("over-tooltip")&&!n&&S()},100)}),clearTimeout(n),s=!1,n=setTimeout(async()=>{async function N(L){const z=d[L]||await m.get(`/posts/${encodeURIComponent(L)}/summary`);if($("#post-tooltip").remove(),z&&ajaxify.data.template.topic){d[L]=z;const Q=await app.parseAndTranslate("partials/topic/post-preview",{post:z});if(s)return;Q.hide().find(".timeago").timeago(),Q.appendTo($("body")).fadeIn(300);const q=i.parents('[component="topic"]').find('[component="post/content"]').first(),tt=q.offset(),et=q.width(),_=i.offset(),{top:nt}=i.get(0).getBoundingClientRect(),ot=nt>window.innerHeight/2;Q.on("mouseenter",function(){i.attr("over-tooltip",1)}),Q.one("mouseleave",S),$(window).off("click",w).one("click",w),Q.css({top:ot?_.top-Q.outerHeight():_.top+30,left:tt.left,width:et})}}const j=i.attr("href"),U=utils.urlToLocation(j),J=U.pathname,X=j&&j!=="#"&&window.location.hostname===U.hostname;$("#post-tooltip").remove();const G=X&&J&&J.match(/\/post\/([\d]+|(?:[\w_.~!$&'()*+,;=:@-]|%[\dA-F]{2})+)/),Z=X&&J&&J.match(/\/topic\/([\da-z-]+)/);if(G){const L=G[1];if(encodeURIComponent(i.parents('[component="post"]').attr("data-pid"))===encodeURIComponent(L))return;N(L)}else if(Z){const L=Z[1],z=await m.get("/topics/"+L,{});N(z.mainPid)}},300)})}function P(){(config.enableQuickReply||config.theme&&config.theme.enableQuickReply)&&E.init()}function W(){const n=c.get("navbar/title").find("span");$(window).scrollTop()>50&&n.hasClass("hidden")?n.html(ajaxify.data.title).removeClass("hidden"):$(window).scrollTop()<=50&&!n.hasClass("hidden")&&n.html("").addClass("hidden"),$(window).scrollTop()>300&&v.remove("bookmark")}k.navigatorCallback=function(n,s){if(!ajaxify.data.template.topic||e.scrollActive)return;const i="topic/"+ajaxify.data.slug+(n>1?"/"+n:"");if(i!==T&&(T=i,n>=s&&app.user.uid&&m.put(`/topics/${ajaxify.data.tid}/read`),H(n),ajaxify.data.updateUrlWithPostIndex&&history.replaceState)){let d=window.location.search||"";config.usePagination||(d=d&&!/^\?page=\d+$/.test(d)?d:""),history.replaceState({url:i+d},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+i+d)}};function H(n){const s="topic:"+ajaxify.data.tid+":bookmark",i=ajaxify.data.bookmark||r.getItem(s);config.topicPostSort==="newest_to_oldest"&&(n=Math.max(1,ajaxify.data.postcount-n+2)),ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&(!i||parseInt(n,10)>parseInt(i,10)||ajaxify.data.postcount<parseInt(i,10))&&(app.user.uid?(ajaxify.data.bookmark=Math.min(n,ajaxify.data.postcount),socket.emit("topics.bookmark",{tid:ajaxify.data.tid,index:ajaxify.data.bookmark},function(d){if(d)return ajaxify.data.bookmark=i,v.error(d)})):r.setItem(s,n)),(!i||parseInt(n,10)>=parseInt(i,10))&&v.remove("bookmark")}return k}.apply(F,I),A!==void 0&&(B.exports=A)},34405:(B,F,a)=>{var I,A;I=[a(49897),a(29930),a(36e3),a(9787),a(35786)],A=function(b,x,{Textcomplete:f},{TextareaEditor:h},{ContenteditableEditor:p}){const e={},u={delay:200,appendTo:null};e.init=c=>{const r={...u,...c},{input:l,onSelect:m}=r;app.loadJQueryUI(function(){l.autocomplete({...r,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(v,C){E(l,m,v,C)}})})},e.user=function(c,r,l){typeof r=="function"&&(l=r,r={}),r=r||{},e.init({input:c,onSelect:l,source:(m,v)=>{r.query=m.term,b.get("/api/users",r,function(C,R){if(C)return x.error(C);if(R&&R.users){const k=R.users.map(function(g){const T=$("<div></div>").html(g.username).text();return g&&{label:T,value:T,user:{uid:g.uid,name:g.username,slug:g.userslug,username:g.username,userslug:g.userslug,displayname:g.displayname,picture:g.picture,banned:g.banned,"icon:text":g["icon:text"],"icon:bgColor":g["icon:bgColor"]}}});v(k)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},e.group=function(c,r){e.init({input:c,onSelect:r,source:(l,m)=>{socket.emit("groups.search",{query:l.term},function(v,C){if(v)return x.error(v);if(C&&C.length){const R=C.map(function(k){return k&&{label:k.name,value:k.name,group:k}});m(R)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},e.tag=function(c,r){e.init({input:c,onSelect:r,delay:100,source:(l,m)=>{socket.emit("topics.autocompleteTags",{query:l.term,cid:ajaxify.data.cid||0},function(v,C){if(v)return x.error(v);C&&m(C),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function E(c,r,l,m){r=r||function(){};const v=jQuery.Event("keypress");v.which=13,v.keyCode=13,setTimeout(function(){c.trigger(v)},100),r(l,m)}return e.setup=function({element:c,strategies:r,options:l}){const m=c.get(0);if(m){var v;if(m.nodeName==="TEXTAREA"||m.nodeName==="INPUT"?v=new h(m):m.nodeName==="DIV"&&m.getAttribute("contenteditable")==="true"&&(v=new p(m)),!v)throw new Error("unknown target element type");m.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var C=new f(v,r,{dropdown:l});return C.on("rendered",function(){C.dropdown.items.length&&C.dropdown.items[0].activate()}),C}},e}.apply(F,I),A!==void 0&&(B.exports=A)},43103:(B,F,a)=>{var I,A;I=[a(29930)],A=function(b){const x={};return x.init=function(f){const h=f.uploadFormEl;if(h.length&&(h.attr("action",config.relative_path+f.route),f.dragDropAreaEl&&x.handleDragDrop({container:f.dragDropAreaEl,callback:function(p){x.ajaxSubmit({uploadForm:h,upload:p,callback:f.callback})}}),f.pasteEl&&x.handlePaste({container:f.pasteEl,callback:function(p){x.ajaxSubmit({uploadForm:h,upload:p,callback:f.callback})}}),f.uploadBtnEl)){const p=h.find('input[name="files[]"]');f.uploadBtnEl.on("click",function(){return p.trigger("click"),!1}),p.on("change",function(e){const u=(e.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);u&&x.ajaxSubmit({uploadForm:h,upload:{files:u,fileNames:Array.from(u).map(E=>E.name)},callback:f.callback})})}},x.handleDragDrop=function(f){let h=!1;const p=f.container,e=f.container.find(".imagedrop");p.on("dragenter",function(){h||(e.css("top","0px"),e.css("height",p.height()+"px"),e.css("line-height",p.height()+"px"),e.show(),e.on("dragleave",function(){e.hide(),e.off("dragleave")}))}),e.on("drop",function(c){c.preventDefault();const r=c.originalEvent.dataTransfer.files;if(r.length){let m;if(window.FormData){m=new FormData;for(var l=0;l<r.length;++l)m.append("files[]",r[l],r[l].name)}f.callback({files:r,formData:m})}return e.hide(),!1});function u(E){return E.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){h=!0}).off("dragend").on("dragend, mouseup",function(){h=!1}),e.on("dragover",u),e.on("dragenter",u)},x.handlePaste=function(f){f.container.on("paste",function(p){const e=(p.clipboardData||p.originalEvent.clipboardData||{}).items,u=[],E=[];let c=null;window.FormData&&(c=new FormData),[].forEach.call(e,function(r){const l=r.getAsFile();if(l){const m=utils.generateUUID()+"-"+l.name;c&&c.append("files[]",l,m),u.push(l),E.push(m)}}),u.length&&f.callback({files:u,fileNames:E,formData:c})})},x.ajaxSubmit=function(f){const h=[...f.upload.files];for(let e=0;e<h.length;++e){const u=h[e].type.match(/image./);if(u&&!app.user.privileges["upload:post:image"]||!u&&!app.user.privileges["upload:post:file"])return b.error("[[error:no-privileges]]");if(!app.user.isAdmin&&h[e].size>parseInt(config.maximumFileSize,10)*1024)return f.uploadForm[0].reset(),b.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const p=Date.now();f.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:f.upload.formData,error:function(e){let u=e.responseJSON&&(e.responseJSON.error||e.responseJSON.status&&e.responseJSON.status.message)||"[[error:parse-error]]";e&&e.status===413&&(u=e.statusText||"Request Entity Too Large"),b.error(u),b.remove(p)},uploadProgress:function(e,u,E,c){b.alert({alert_id:p,message:"[[modules:composer.uploading, "+c+"%]]"})},success:function(e){const u=e.response.images;if(u&&u.length)for(var E=0;E<u.length;++E)u[E].filename=h[E].name,u[E].isImage=/image./.test(h[E].type);f.callback(u)},complete:function(){f.uploadForm[0].reset(),setTimeout(b.remove,100,p)}}),!1}),f.uploadForm.submit()},x}.apply(F,I),A!==void 0&&(B.exports=A)},43349:(B,F,a)=>{var I,A;I=[a(52473)],A=function(b){const x={};return x.handleSort=function(f,h){const p=b.get("thread/sort");p.find("i").removeClass("fa-check");const e=utils.params().sort||config[f];p.find('a[data-sort="'+e+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a[data-sort]').on("click",'[component="thread/sort"] a[data-sort]',function(){const E=$(this).attr("data-sort"),c=utils.params();c.sort=E;const r=$.param(c);ajaxify.go(h+(r?"?"+r:""))})},x}.apply(F,I),A!==void 0&&(B.exports=A)},57642:(B,F,a)=>{var I,A;I=[a(8454),a(60984),a(47536),a(2269),a(52473),a(17459),a(91749),a(30076)],A=function(b,x,f,h,p,e,u,E){const c={},r={"event:user_status_change":l,"event:voted":m,"event:bookmarked":v,"event:topic_deleted":x.setDeleteState,"event:topic_restored":x.setDeleteState,"event:topic_purged":C,"event:topic_locked":x.setLockedState,"event:topic_unlocked":x.setLockedState,"event:topic_pinned":x.setPinnedState,"event:topic_unpinned":x.setPinnedState,"event:topic_moved":R,"event:post_edited":k,"event:post_pinned":O,"event:post_unpinned":K,"event:post_purged":g,"event:post_deleted":T,"event:post_restored":T,"posts.bookmark":M,"posts.unbookmark":M,"posts.upvote":Y,"posts.downvote":Y,"posts.unvote":Y,"event:new_notification":V,"event:new_post":f.onNewPost};c.init=function(){c.removeListeners();for(const[t,o]of Object.entries(r))socket.on(t,o)},c.removeListeners=function(){for(const[t,o]of Object.entries(r))socket.removeListener(t,o)};function l(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function m(t){const o=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(D,P){return $(P).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}),y=$('.reputation[data-uid="'+t.post.uid+'"]');o.html(t.post.votes).attr("data-votes",t.post.votes),y.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function v(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(o,y){return $(y).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function C(t){ajaxify.data.category&&ajaxify.data.category.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function R(t){t&&t.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("topic/"+t.slug,null,!0)}function k(t){if(!t||!t.post||String(t.post.tid)!==String(ajaxify.data.tid))return;const o=p.get("post/content",t.post.pid).filter(function(n,s){return String($(s).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),y=$(`[data-pid="${t.post.pid}"]`),D=y.find('[component="post/editor"]').filter(function(n,s){return String($(s).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),P=p.get("topic/title"),W=p.get("navbar/title").find("span"),H=p.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(P.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const n="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:n},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+n),P.fadeOut(250,function(){P.html(t.topic.title).fadeIn(250)}),H.fadeOut(250,function(){H.html(t.topic.title).fadeIn(250)}),W.fadeOut(250,function(){W.html(t.topic.title).fadeIn(250)})}if(t.post.changed){o.fadeOut(250,function(){if(o.html(e.unescape(t.post.content)),o.find("img:not(.not-responsive)").addClass("img-fluid"),h.wrapImagesInLinks(o.parent()),f.addBlockquoteEllipses(o.parent()),o.fadeIn(250),t.post.edited){const s={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",s,function(i){D.replaceWith(i),y.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${E.isoTimeToLocaleString(s.editedISO,config.userLang)}]]`),y.find('[component="post/editor"] .timeago').timeago(),u.fire("action:posts.edited",t)})}});const n=$(`[component="post/parent"][data-parent-pid="${t.post.pid}"]`);n.length&&(n.find('[component="post/parent/content"]').html(e.unescape(t.post.content)),n.find("img:not(.not-responsive)").addClass("img-fluid"),n.find('[component="post/parent/content]" img:not(.emoji)').each(function(){h.wrapImageInLink($(this))}))}else u.fire("action:posts.edited",t);t.topic.tags&&t.topic.tagsupdated&&Promise.all([a.e(20056),a.e(63)]).then(function(){var n=[a(63)];(function(s){s.updateTopicTags([t.topic])}).apply(null,n)}).catch(a.oe),b.removeMenu(p.get("post","pid",t.post.pid))}function g(t){!t||String(t.tid)!==String(ajaxify.data.tid)||(p.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),f.showBottomPostBar()}),ajaxify.data.postcount-=1,b.updatePostCount(ajaxify.data.postcount),a.e(18631).then(function(){var o=[a(18631)];(function(y){y.onPostPurged(t)}).apply(null,o)}).catch(a.oe),$(`[component="post/parent"][data-parent-pid="${t.pid}"]`).remove())}function T(t){const o=p.get("post","pid",t.pid),{isAdminOrMod:y}=ajaxify.data.privileges,D=String(t.uid)===String(app.user.uid),P=!!t.deleted;o.length&&(o.toggleClass("deleted"),b.toggle(t.pid,P),!y&&!D&&(o.find('[component="post/tools"]').toggleClass("hidden",P),P?o.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):o.find('[component="post/content"]').html(e.unescape(t.content))));const W=$(`[component="post/parent"][data-parent-pid="${t.pid}"]`);W.length&&W.each((H,n)=>{const s=$(n);P?s.find('[component="post/parent/content"]').translateHtml("[[topic:post-is-deleted]]"):s.find('[component="post/parent/content"]').html(e.unescape(t.content))})}function O(t){if(!t||String(t.tid)!==String(ajaxify.data.tid))return;const o=p.get("post","pid",t.pid);if(o.length){if(o.addClass("pinned-post"),o.find('[component="post/pin"]').toggleClass("hidden",!0).parent().attr("hidden",""),o.find('[component="post/unpin"]').toggleClass("hidden",!1).parent().attr("hidden",null),o.find('[component="post/pinned-indicator"]').length)o.find('[component="post/pinned-indicator"]').removeClass("hidden");else{const y=o.find('[component="post/edit-indicator"]');y.length?y.after('<i component="post/pinned-indicator" class="fa fa-thumb-tack text-muted pinned-icon ms-1" aria-hidden="true"></i>'):o.find('[component="post/header"]').append('<i component="post/pinned-indicator" class="fa fa-thumb-tack text-muted pinned-icon ms-1" aria-hidden="true"></i>'),e.translate("[[topic:pinned]]",function(D){o.find('[component="post/pinned-indicator"]').attr("title",D)})}try{const y=p.get("topic"),D=y.find('[component="post"][data-index="0"]');let P=y.find('[component="post"].pinned-post').not(o).last();P.length||(P=D.length?D:null),P?(o.data("pin-previous-next",o.next()),P[0]!==o[0]&&o.insertAfter(P)):y.append(o)}catch(y){console.warn("Unable to move pinned post in DOM",y)}}}function K(t){if(!t||String(t.tid)!==String(ajaxify.data.tid))return;const o=p.get("post","pid",t.pid);if(o.length){o.removeClass("pinned-post"),o.find('[component="post/pin"]').toggleClass("hidden",!1).parent().attr("hidden",null),o.find('[component="post/unpin"]').toggleClass("hidden",!0).parent().attr("hidden",""),o.find('[component="post/pinned"]').remove(),o.find('[component="post/pinned-indicator"]').remove();try{const y=o.data("pin-previous-next");y&&y.length?o.insertBefore(y):p.get("topic").append(o),o.removeData("pin-previous-next")}catch(y){console.warn("Unable to restore unpinned post position",y)}}}function M(t){const o=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(y,D){return $(D).closest("[data-pid]").attr("data-pid")===String(t.post.pid)});o.length&&(o.attr("data-bookmarked",t.isBookmarked),o.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),o.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function Y(t){const o=$('[data-pid="'+t.post.pid+'"]');o.find('[component="post/upvote"]').filter(function(y,D){return $(D).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("upvoted",t.upvote),o.find('[component="post/downvote"]').filter(function(y,D){return $(D).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("downvoted",t.downvote)}function V(t){const o=ajaxify.data.tid;t&&t.tid&&String(t.tid)===String(o)&&socket.emit("topics.markTopicNotificationsRead",[o])}return c}.apply(F,I),A!==void 0&&(B.exports=A)},95692:(B,F,a)=>{var I,A;I=[a(52473),a(34405),a(49897),a(29930),a(43103),a(6411),a(68636),a(91749)],A=function(b,x,f,h,p,e,u,E){const c={_autocomplete:null};c.init=function(){const l=b.get("topic/quickreply/text"),m=`qr:draft:tid:${ajaxify.data.tid}`,v={element:l,strategies:[],options:{style:{"z-index":100}}};r(),$(window).one("action:ajaxify.start",()=>{r()}),$(window).trigger("composer:autocomplete:init",v),c._autocomplete=x.setup(v),e.bind("ctrl+return",k=>{k.target===l.get(0)&&b.get("topic/quickreply/button").get(0).click()}),p.init({uploadBtnEl:$('[component="topic/quickreply/upload/button"]'),dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:l,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:l,route:"/api/post/upload",callback:function(k){let g=l.val();k.forEach(T=>{g=g+(g?`
`:"")+(T.isImage?"!":"")+`[${T.filename}](${T.url})`}),l.val(g)}});let C=!0;b.get("topic/quickreply/button").on("click",function(k){if(k.preventDefault(),!C)return;const g=b.get("topic/quickreply/text").val(),T={tid:ajaxify.data.tid,handle:void 0,content:g},O=g.length;if(O<parseInt(config.minimumPostLength,10))return h.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(O>parseInt(config.maximumPostLength,10))return h.error("[[error:content-too-long, "+config.maximumPostLength+"]]");C=!1,f.post(`/topics/${ajaxify.data.tid}`,T,function(K,M){if(C=!0,K)return h.error(K);M&&M.queued&&h.alert({type:"success",title:"[[global:alert.success]]",message:M.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${M.id}`)}}),b.get("topic/quickreply/text").val(""),u.removeItem(m),c._autocomplete.hide(),E.fire("action:quickreply.success",{data:M})})});const R=u.getItem(m);R&&l.val(R),l.on("keyup",utils.debounce(function(){const k=l.val();k?u.setItem(m,k):u.removeItem(m)},1e3)),b.get("topic/quickreply/expand").on("click",k=>{k.preventDefault(),u.removeItem(m);const g=b.get("topic/quickreply/text");E.fire("action:composer.post.new",{tid:ajaxify.data.tid,title:ajaxify.data.titleRaw,body:g.val()}),g.val("")})};function r(){c._autocomplete&&(c._autocomplete.destroy(),c._autocomplete=null)}return c}.apply(F,I),A!==void 0&&(B.exports=A)}}]);
