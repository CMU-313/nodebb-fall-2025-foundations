"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,34271,34405,49897,58087,99127],{29821:(x,p,f)=>{var h,E;h=[f(34405)],E=function(A){const w={};return w.init=function(){const T=$('[data-field="welcomeUid"]');A.user(T,function(m,y){setTimeout(function(){T.val(y.item.user.uid)})})},w}.apply(p,h),E!==void 0&&(x.exports=E)},34405:(x,p,f)=>{var h,E;h=[f(49897),f(29930),f(36e3),f(9787),f(35786)],E=function(A,w,{Textcomplete:T},{TextareaEditor:m},{ContenteditableEditor:y}){const d={},C={delay:200,appendTo:null};d.init=l=>{const n={...C,...l},{input:u,onSelect:e}=n;app.loadJQueryUI(function(){u.autocomplete({...n,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(r,t){P(u,e,r,t)}})})},d.user=function(l,n,u){typeof n=="function"&&(u=n,n={}),n=n||{},d.init({input:l,onSelect:u,source:(e,r)=>{n.query=e.term,A.get("/api/users",n,function(t,i){if(t)return w.error(t);if(i&&i.users){const o=i.users.map(function(s){const a=$("<div></div>").html(s.username).text();return s&&{label:a,value:a,user:{uid:s.uid,name:s.username,slug:s.userslug,username:s.username,userslug:s.userslug,displayname:s.displayname,picture:s.picture,banned:s.banned,"icon:text":s["icon:text"],"icon:bgColor":s["icon:bgColor"]}}});r(o)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},d.group=function(l,n){d.init({input:l,onSelect:n,source:(u,e)=>{socket.emit("groups.search",{query:u.term},function(r,t){if(r)return w.error(r);if(t&&t.length){const i=t.map(function(o){return o&&{label:o.name,value:o.name,group:o}});e(i)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},d.tag=function(l,n){d.init({input:l,onSelect:n,delay:100,source:(u,e)=>{socket.emit("topics.autocompleteTags",{query:u.term,cid:ajaxify.data.cid||0},function(r,t){if(r)return w.error(r);t&&e(t),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function P(l,n,u,e){n=n||function(){};const r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){l.trigger(r)},100),n(u,e)}return d.setup=function({element:l,strategies:n,options:u}){const e=l.get(0);if(e){var r;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?r=new m(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(r=new y(e)),!r)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var t=new T(r,n,{dropdown:u});return t.on("rendered",function(){t.dropdown.items.length&&t.dropdown.items[0].activate()}),t}},d}.apply(p,h),E!==void 0&&(x.exports=E)},49897:(x,p,f)=>{f.r(p),f.d(p,{del:()=>u,get:()=>d,head:()=>C,patch:()=>l,post:()=>P,put:()=>n});var h=f(91749),E=f.n(h),A=f(33530),w=f.n(A);const T=config.relative_path+"/api/v3";async function m(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:T+e.url,typeof r=="function"){y(e).then(t=>r(null,t),t=>{let i=t;t instanceof Error||(i=new Error(String(t)));const o=i.message||String(i);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const a=new Error("[[error:no-connection]]");a.originalError=i,i=a}r(i)});return}try{return await y(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,A.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(i)})}throw t}}async function y(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,h.fire)("filter:api.options",{options:e}))}catch(c){console.error("[API] Error in filter:api.options hook:",c)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(c){const g=c.message||c.toString()||String(c),k=c.name||"Error";if(k==="TypeError"&&(g.toLowerCase().includes("fetch")||g.toLowerCase().includes("network")||g.toLowerCase().includes("failed to fetch")||g.toLowerCase().includes("load failed"))||g.toLowerCase().includes("cors")||g.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:g,name:k});const v=new Error("[[error:no-connection]]");throw v.originalError=c,v}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:g,name:k}),c}const{headers:i}=t;if(i.get("x-redirect"))return y({url:i.get("x-redirect"),...e});const o=i.get("content-type"),s=o&&o.startsWith("application/json");let a;if(e.method!=="HEAD")try{s?a=await t.json():a=await t.text()}catch(c){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:o,error:c.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let c;throw a?s&&a.status&&a.status.message?c=a.status.message:typeof a=="string"?c=a:c=t.statusText||"Request failed":c=t.statusText||"Request failed",new Error(c)}return s&&a&&a.hasOwnProperty("status")&&a.hasOwnProperty("response")?a.response:a}function d(e,r,t){return m({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function C(e,r,t){return m({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function P(e,r,t){return m({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function l(e,r,t){return m({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function n(e,r,t){return m({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function u(e,r,t){return m({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
