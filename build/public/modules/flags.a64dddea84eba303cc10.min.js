"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,6574,34271,47282,49897,99127],{6574:(P,y,f)=>{var E,v;E=[f(91749),f(52473),f(49897),f(29930)],v=function(u,T,w,i){const d={};let c,h,g;d.showFlagModal=function(o){o.remote=URL.canParse(o.id)?new URL(o.id).hostname:!1,app.parseAndTranslate("modals/flag",o,function(e){c=e,c.on("hidden.bs.modal",function(){c.remove()}),h=c.find("#flag-post-commit"),g=c.find("#flag-reason-custom"),c.on("click",'input[name="flag-reason"]',function(){$(this).attr("id")==="flag-reason-other"?(g.removeAttr("disabled"),g.val().length||h.attr("disabled",!0)):(g.attr("disabled",!0),h.removeAttr("disabled"))}),h.on("click",function(){const t=$('input[name="flag-reason"]:checked');let r=t.val();t.attr("id")==="flag-reason-other"&&(r=g.val());const s=$('input[name="flag-notify-remote"]').is(":checked");C(o.type,o.id,r,s)}),c.on("click","#flag-reason-other",function(){g.focus()}),c.modal("show"),u.fire("action:flag.showModal",{modalEl:c,type:o.type,id:o.id,remote:o.remote}),c.find("#flag-reason-custom").on("keyup blur change",k)})},d.resolve=function(o){w.put(`/flags/${o}`,{state:"resolved"}).then(()=>{i.success("[[flags:resolved]]"),u.fire("action:flag.resolved",{flagId:o})}).catch(i.error)},d.rescind=function(o){w.del(`/flags/${o}/report`).then(()=>{i.success("[[flags:report-rescinded]]"),u.fire("action:flag.rescinded",{flagId:o})}).catch(i.error)},d.purge=function(o){w.del(`/flags/${o}`).then(()=>{i.success("[[flags:purged]]"),u.fire("action:flag.purged",{flagId:o})}).catch(i.error)};function C(o,e,t,r=!1){if(!o||!e||!t)return;const s={type:o,id:e,reason:t,notifyRemote:r};w.post("/flags",s,function(a,p){if(a)return i.error(a);if(c.modal("hide"),i.success("[[flags:modal-submit-success]]"),o==="post"){const n=T.get("post","pid",e);n.find('[component="post/flag"]').addClass("hidden").parent().attr("hidden",""),n.find('[component="post/already-flagged"]').removeClass("hidden").parent().attr("hidden",null)}u.fire("action:flag.create",{flagId:p,data:s})})}function k(){c.find("#flag-reason-custom").val()?h.removeAttr("disabled"):h.attr("disabled",!0)}return d}.apply(y,E),v!==void 0&&(P.exports=v)},49897:(P,y,f)=>{f.r(y),f.d(y,{del:()=>o,get:()=>c,head:()=>h,patch:()=>C,post:()=>g,put:()=>k});var E=f(91749),v=f.n(E),u=f(33530),T=f.n(u);const w=config.relative_path+"/api/v3";async function i(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:w+e.url,typeof t=="function"){d(e).then(r=>t(null,r),r=>{let s=r;r instanceof Error||(s=new Error(String(r)));const a=s.message||String(s);if(a&&!a.startsWith("[[error:")&&(a.toLowerCase()==="fetch failed"||a.toLowerCase()==="failed to fetch"||a.toLowerCase().includes("networkerror")||a.toLowerCase().includes("network")&&a.toLowerCase().includes("failed"))){const n=new Error("[[error:no-connection]]");n.originalError=s,s=n}t(s)});return}try{return await d(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,u.confirm)("[[error:api.reauth-required]]",a=>{a&&ajaxify.go(s)})}throw r}}async function d(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(l){console.error("[API] Error in filter:api.options hook:",l)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(l){const m=l.message||l.toString()||String(l),A=l.name||"Error";if(A==="TypeError"&&(m.toLowerCase().includes("fetch")||m.toLowerCase().includes("network")||m.toLowerCase().includes("failed to fetch")||m.toLowerCase().includes("load failed"))||m.toLowerCase().includes("cors")||m.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:m,name:A});const L=new Error("[[error:no-connection]]");throw L.originalError=l,L}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:m,name:A}),l}const{headers:s}=r;if(s.get("x-redirect"))return d({url:s.get("x-redirect"),...e});const a=s.get("content-type"),p=a&&a.startsWith("application/json");let n;if(e.method!=="HEAD")try{p?n=await r.json():n=await r.text()}catch(l){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:a,error:l.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let l;throw n?p&&n.status&&n.status.message?l=n.status.message:typeof n=="string"?l=n:l=r.statusText||"Request failed":l=r.statusText||"Request failed",new Error(l)}return p&&n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n}function c(e,t,r){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function h(e,t,r){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function g(e,t,r){return i({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function C(e,t,r){return i({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function k(e,t,r){return i({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function o(e,t,r){return i({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}}}]);
