"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,5719,34271,36228,42289,49897,99127],{10281:(C,b,a)=>{var y,E;y=[a(52473),a(17459),a(81335),a(28061),a(47283),a(49897),a(33530),a(29930)],E=function(A,p,j,l,d,i,n,o){const s={};s.init=function(){$("#state").val(ajaxify.data.state).removeAttr("disabled"),$("#assignee").val(ajaxify.data.assignee).removeAttr("disabled"),$("#content > div").on("click","[data-action]",function(){const g=this.getAttribute("data-action"),e=$(this).parents("[data-uid]").attr("data-uid"),r=document.getElementById("note");switch(g){case"assign":$("#assignee").val(app.user.uid);case"update":{const t=$("#attributes").serializeArray().reduce((c,u)=>(c[u.name]=u.value,c),{});i.put(`/flags/${ajaxify.data.flagId}`,t).then(({history:c})=>{o.success("[[flags:updated]]"),s.reloadHistory(c)}).catch(o.error);break}case"addEditNote":{const t=this.closest('[component="flag/note"]');let c,u;if(t){c=t.getAttribute("data-datetime");const x=t.getAttribute("data-index");u=ajaxify.data.notes[x].content}n.prompt({title:`[[flags:${c?"edit":"add"}-note]]`,inputType:"textarea",rows:3,value:u,callback:x=>{x&&i.post(`/flags/${ajaxify.data.flagId}/notes`,{note:x,datetime:c}).then(f=>{o.success("[[flags:note-added]]"),s.reloadNotes(f.notes),s.reloadHistory(f.history)}).catch(o.error)}});break}case"appendNote":i.post(`/flags/${ajaxify.data.flagId}/notes`,{note:r.value,datetime:parseInt(r.getAttribute("data-datetime"),10)}).then(t=>{o.success("[[flags:note-added]]"),s.reloadNotes(t.notes),s.reloadHistory(t.history),r.removeAttribute("data-datetime")}).catch(o.error);break;case"delete-note":{const t=parseInt(this.closest("[data-datetime]").getAttribute("data-datetime"),10);n.confirm("[[flags:delete-note-confirm]]",function(c){c&&i.del(`/flags/${ajaxify.data.flagId}/notes/${t}`,{}).then(u=>{o.success("[[flags:note-deleted]]"),s.reloadNotes(u.notes),s.reloadHistory(u.history)}).catch(o.error)});break}case"chat":a.e(92619).then(function(){var t=[a(92619)];(function(c){c.newChat(e)}).apply(null,t)}).catch(a.oe);break;case"ban":l.banAccount(e,ajaxify.refresh);break;case"unban":l.unbanAccount(e);break;case"mute":l.muteAccount(e,ajaxify.refresh);break;case"unmute":l.unmuteAccount(e);break;case"delete-account":d.account(e,ajaxify.refresh);break;case"delete-content":d.content(e,ajaxify.refresh);break;case"delete-all":d.purge(e,ajaxify.refresh);break;case"delete-post":m("delete",i.del,`/posts/${ajaxify.data.target.pid}/state`);break;case"purge-post":m("purge",i.del,`/posts/${ajaxify.data.target.pid}`);break;case"restore-post":m("restore",i.put,`/posts/${ajaxify.data.target.pid}/state`);break;case"delete-flag":{n.confirm("[[flags:delete-flag-confirm]]",function(t){t&&i.del(`/flags/${ajaxify.data.flagId}`,{}).then(()=>{o.success("[[flags:flag-deleted]]"),ajaxify.go("flags")}).catch(o.error)});break}}})};function m(g,e,r){p.translate("[[topic:post-"+g+"-confirm]]",function(t){n.confirm(t,function(c){c&&e(r).then(ajaxify.refresh).catch(o.error)})})}return s.reloadNotes=function(g){ajaxify.data.notes=g,j.render("flags/detail",{notes:g},"notes").then(function(e){const r=A.get("flag/notes");r.empty(),r.html(e),r.find("span.timeago").timeago()})},s.reloadHistory=function(g){app.parseAndTranslate("flags/detail","history",{history:g},function(e){const r=A.get("flag/history");r.empty(),r.html(e),r.find("span.timeago").timeago()})},s}.apply(b,y),E!==void 0&&(C.exports=E)},28061:(C,b,a)=>{var y,E;y=[a(81335),a(49897),a(33530),a(29930)],E=function(A,p,j,l){const d={};d.banAccount=function(n,o){n=n||ajaxify.data.theirid,i({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(s){const m=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;p.put("/users/"+n+"/ban",{until:m,reason:s.reason||""}).then(()=>{if(typeof o=="function")return o();ajaxify.refresh()}).catch(l.error)}})},d.unbanAccount=function(n){i({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(o){p.del("/users/"+n+"/ban",{reason:o.reason||""}).then(()=>{ajaxify.refresh()}).catch(l.error)}})},d.muteAccount=function(n,o){n=n||ajaxify.data.theirid,i({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(s){const m=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;p.put("/users/"+n+"/mute",{until:m,reason:s.reason||""}).then(()=>{if(typeof o=="function")return o();ajaxify.refresh()}).catch(l.error)}})},d.unmuteAccount=function(n){i({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(o){p.del("/users/"+n+"/mute",{reason:o.reason||""}).then(()=>{ajaxify.refresh()}).catch(l.error)}})};function i(n){A.render(n.tpl,{}).then(function(o){const s=j.dialog({title:n.title,message:o,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:n.title,callback:function(){const m=s.find("form").serializeArray().reduce(function(g,e){return g[e.name]=e.value,g},{});n.onSubmit(m)}}}})})}return d}.apply(b,y),E!==void 0&&(C.exports=E)},47283:(C,b,a)=>{var y,E;y=[a(49897),a(33530),a(29930)],E=function(A,p,j){const l={};l.account=function(i,n){d(i,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",n)},l.content=function(i,n){d(i,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",n)},l.purge=function(i,n){d(i,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",n)};function d(i,n,o,s,m){p.confirm(n,function(g){g&&A.del(`/users/${encodeURIComponent(i)}${o}`,{}).then(()=>{if(j.success(s),typeof m=="function")return m()}).catch(j.error)})}return l}.apply(b,y),E!==void 0&&(C.exports=E)},49897:(C,b,a)=>{a.r(b),a.d(b,{del:()=>g,get:()=>i,head:()=>n,patch:()=>s,post:()=>o,put:()=>m});var y=a(91749),E=a.n(y),A=a(33530),p=a.n(A);const j=config.relative_path+"/api/v3";async function l(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:j+e.url,typeof r=="function"){d(e).then(t=>r(null,t),t=>{let c=t;t instanceof Error||(c=new Error(String(t)));const u=c.message||String(c);if(u&&!u.startsWith("[[error:")&&(u.toLowerCase()==="fetch failed"||u.toLowerCase()==="failed to fetch"||u.toLowerCase().includes("networkerror")||u.toLowerCase().includes("network")&&u.toLowerCase().includes("failed"))){const f=new Error("[[error:no-connection]]");f.originalError=c,c=f}r(c)});return}try{return await d(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:c}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,A.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go(c)})}throw t}}async function d(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,y.fire)("filter:api.options",{options:e}))}catch(h){console.error("[API] Error in filter:api.options hook:",h)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(h){const w=h.message||h.toString()||String(h),k=h.name||"Error";if(k==="TypeError"&&(w.toLowerCase().includes("fetch")||w.toLowerCase().includes("network")||w.toLowerCase().includes("failed to fetch")||w.toLowerCase().includes("load failed"))||w.toLowerCase().includes("cors")||w.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:w,name:k});const I=new Error("[[error:no-connection]]");throw I.originalError=h,I}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:w,name:k}),h}const{headers:c}=t;if(c.get("x-redirect"))return d({url:c.get("x-redirect"),...e});const u=c.get("content-type"),x=u&&u.startsWith("application/json");let f;if(e.method!=="HEAD")try{x?f=await t.json():f=await t.text()}catch(h){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:u,error:h.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let h;throw f?x&&f.status&&f.status.message?h=f.status.message:typeof f=="string"?h=f:h=t.statusText||"Request failed":h=t.statusText||"Request failed",new Error(h)}return x&&f&&f.hasOwnProperty("status")&&f.hasOwnProperty("response")?f.response:f}function i(e,r,t){return l({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function n(e,r,t){return l({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function o(e,r,t){return l({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function s(e,r,t){return l({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function m(e,r,t){return l({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function g(e,r,t){return l({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
