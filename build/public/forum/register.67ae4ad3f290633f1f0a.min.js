"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,19992,26174,34271,49897,89034,99127],{10034:(D,k,l)=>{var m,w;m=[l(17459),l(13230),l(49897),l(33530),l(97014),l(7065),l(64061)],w=function(g,E,u,c,d,v){const h={};let y=!1;const C="";h.init=function(){const t=$("#username"),a=$("#password"),r=$("#password-confirm"),o=$("#register");p(),$("#content #noscript").val("false");const i=utils.params();i.token&&$("#token").val(i.token),t.on("keyup",function(){$("#yourUsername").text(this.value.length>0?E(this.value):"username")}),t.on("blur",function(){t.val().length&&f(t.val())}),a.on("blur",function(){a.val().length&&x(a.val(),r.val())}),r.on("blur",function(){r.val().length&&e(a.val(),r.val())});function _(S){y=!1,$('[aria-invalid="true"]').removeAttr("aria-invalid"),x(a.val(),r.val()),e(a.val(),r.val()),f(t.val(),S)}d.capsLockCheck(document.querySelector("#password"),document.querySelector("#caps-lock-warning")),o.on("click",function(S){const A=$(this),P=$("#register-error-notify");P.addClass("hidden"),S.preventDefault(),_(function(){y||(A.addClass("disabled"),A.parents("form").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},success:function(L){if(A.removeClass("disabled"),!!L)if(L.next){const T=utils.urlToLocation(L.next).pathname,I=utils.params({url:L.next});I.registered=!0;const b=$.param(I);window.location.href=T+"?"+b}else L.message&&g.translate(L.message,function(T){c.alert(T),ajaxify.go("/")})},error:function(L){g.translate(L.responseText,config.defaultLang,function(T){L.status===403&&L.responseText==="Forbidden"?window.location.href=config.relative_path+"/register?error=csrf-invalid":(P.find("p").text(T),P.removeClass("hidden"),A.removeClass("disabled"))})}}))})}),$("#username").trigger("focus")};function f(t,a){a=a||function(){};const r=$("#username-notify");r.text("");const o=$("#username"),i=E(t);t.length<ajaxify.data.minimumUsernameLength||i.length<ajaxify.data.minimumUsernameLength?n(o,r,"[[error:username-too-short]]"):t.length>ajaxify.data.maximumUsernameLength?n(o,r,"[[error:username-too-long]]"):!utils.isUserNameValid(t)||!i?n(o,r,"[[error:invalid-username]]"):Promise.allSettled([u.head(`/users/bySlug/${i}`,{}),u.head(`/groups/${t}`,{})]).then(_=>{_.every(S=>S.status==="rejected")?s(o,r,C):n(o,r,"[[error:username-taken]]"),a()})}function x(t,a){const r=$("#password"),o=$("#password-notify"),i=$("#password-confirm-notify");o.text(""),i.text("");try{if(utils.assertPasswordValidity(t,v),t===$("#username").val())throw new Error("[[user:password-same-as-username]]");s(r,o,C)}catch(_){n(r,o,_.message)}t!==a&&a!==""&&n(r,i,"[[user:change-password-error-match]]")}function e(t,a){const r=$("#password-confirm"),o=$("#password-notify"),i=$("#password-confirm-notify");i.text(""),!(!t||o.hasClass("alert-error"))&&(t!==a?n(r,i,"[[user:change-password-error-match]]"):s(r,i,C))}function n(t,a,r){g.translate(r,function(o){t.attr("aria-invalid","true"),a.html(o),a.parent().removeClass("register-success").addClass("register-danger"),a.show()}),y=!0}function s(t,a,r){g.translate(r,function(o){t.removeAttr("aria-invalid"),a.html(o),a.parent().removeClass("register-danger").addClass("register-success"),a.show()})}function p(){if(!app.user.uid&&config.defaultLang!==config.userLang){const t=$('[component="register/local"]'),a=$('<input type="hidden" name="userLang" value="'+config.userLang+'" />');t.append(a)}}return h}.apply(k,m),w!==void 0&&(D.exports=w)},13230:(D,k,l)=>{var m,w,g;(function(E){w=[l(53050)],m=E,g=typeof m=="function"?m.apply(k,w):m,g!==void 0&&(D.exports=g)})(function(E){const u=E("[^\\p{L}\\s\\d\\-_@.]","g"),c=/[^\w\s\d\-_@.]/g,d=/^\s+|\s+$/g,v=/\s+/g,h=/-+/g,y=/-$/g,C=/^-/g,f=/^[\w\d\s.,\-@]+$/;return function(e,n){return e?(e=String(e).replace(d,""),f.test(e)?e=e.replace(c,"-"):e=E.replace(e,u,"-"),e=n?e:e.toLocaleLowerCase(),e=e.replace(v,"-"),e=e.replace(h,"-"),e=e.replace(y,""),e=e.replace(C,""),e):""}})},49897:(D,k,l)=>{l.r(k),l.d(k,{del:()=>x,get:()=>v,head:()=>h,patch:()=>C,post:()=>y,put:()=>f});var m=l(91749),w=l.n(m),g=l(33530),E=l.n(g);const u=config.relative_path+"/api/v3";async function c(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:u+e.url,typeof n=="function"){d(e).then(s=>n(null,s),s=>{let p=s;s instanceof Error||(p=new Error(String(s)));const t=p.message||String(p);if(t&&!t.startsWith("[[error:")&&(t.toLowerCase()==="fetch failed"||t.toLowerCase()==="failed to fetch"||t.toLowerCase().includes("networkerror")||t.toLowerCase().includes("network")&&t.toLowerCase().includes("failed"))){const r=new Error("[[error:no-connection]]");r.originalError=p,p=r}n(p)});return}try{return await d(e)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again."){const{url:p}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,g.confirm)("[[error:api.reauth-required]]",t=>{t&&ajaxify.go(p)})}throw s}}async function d(e){const{url:n}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,m.fire)("filter:api.options",{options:e}))}catch(o){console.error("[API] Error in filter:api.options hook:",o)}e.data&&(e.body=e.data,delete e.data);let s;try{s=await fetch(n,e)}catch(o){const i=o.message||o.toString()||String(o),_=o.name||"Error";if(_==="TypeError"&&(i.toLowerCase().includes("fetch")||i.toLowerCase().includes("network")||i.toLowerCase().includes("failed to fetch")||i.toLowerCase().includes("load failed"))||i.toLowerCase().includes("cors")||i.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:n,method:e.method||"GET",error:i,name:_});const A=new Error("[[error:no-connection]]");throw A.originalError=o,A}throw console.error("[API] Unexpected fetch error:",{url:n,method:e.method||"GET",error:i,name:_}),o}const{headers:p}=s;if(p.get("x-redirect"))return d({url:p.get("x-redirect"),...e});const t=p.get("content-type"),a=t&&t.startsWith("application/json");let r;if(e.method!=="HEAD")try{a?r=await s.json():r=await s.text()}catch(o){throw console.error("[API] Error parsing response:",{url:n,status:s.status,statusText:s.statusText,contentType:t,error:o.message}),new Error("[[error:invalid-json]]")}if(!s.ok){let o;throw r?a&&r.status&&r.status.message?o=r.status.message:typeof r=="string"?o=r:o=s.statusText||"Request failed":o=s.statusText||"Request failed",new Error(o)}return a&&r&&r.hasOwnProperty("status")&&r.hasOwnProperty("response")?r.response:r}function v(e,n,s){return c({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},s)}function h(e,n,s){return c({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},s)}function y(e,n,s){return c({url:e,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}function C(e,n,s){return c({url:e,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}function f(e,n,s){return c({url:e,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}function x(e,n,s){return c({url:e,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}},97014:(D,k,l)=>{var m,w;m=[l(91749),l(17459),l(64061)],w=function(g,E){const u={_capsState:!1};return u.init=function(){const c=$("#login-error-notify"),d=$("#login"),v=$("#login-form");d.on("click",async function(h){h.preventDefault();const y=$("#username").val(),C=$("#password").val();if(c.addClass("hidden").find("p").text(""),!y||!C){c.find("p").translateText("[[error:invalid-username-or-password]]"),c.removeClass("hidden");return}if(!d.hasClass("disabled")){d.addClass("disabled");try{if((await g.fire("filter:app.login",{username:y,password:C,cancel:!1})).cancel){d.removeClass("disabled");return}}catch(f){c.find("p").translateText(f.message),c.removeClass("hidden"),d.removeClass("disabled");return}g.fire("action:app.login"),v.ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},beforeSend:function(){app.flags._login=!0},success:function(f){g.fire("action:app.loggedIn",f);const x=utils.urlToLocation(f.next).pathname,e=utils.params({url:f.next});e.loggedin=!0,delete e.register;const n=$.param(e);window.location.href=x+"?"+n},error:function(f){let x=f.responseText;const e=f.responseJSON;f.status===403&&f.responseText==="Forbidden"?window.location.href=config.relative_path+"/login?error=csrf-invalid":e&&e.hasOwnProperty("banned_until")&&(x=e.banned_until?E.compile("error:user-banned-reason-until",new Date(e.banned_until).toLocaleString(),e.reason):"[[error:user-banned-reason, "+e.reason+"]]"),c.find("p").translateText(x),c.removeClass("hidden"),d.removeClass("disabled"),$("#password:focus").length&&$("#password").select()}})}}),u.capsLockCheck(document.querySelector("#password"),document.querySelector("#caps-lock-warning")),$("#content #username").val()?$("#content #password").val("").focus():$("#content #username").focus(),$("#content #noscript").val("false")},u.capsLockCheck=(c,d)=>{const v=h=>{d.classList[h?"remove":"add"]("hidden"),d.parentNode.classList[h?"add":"remove"]("has-warning")};c&&(c.addEventListener("keyup",function(h){if(u._capsState&&h.key==="CapsLock"){v(!1),u._capsState=!u._capsState;return}u._capsState=h.getModifierState&&h.getModifierState("CapsLock"),v(u._capsState)}),u._capsState&&v(!0))},u}.apply(k,m),w!==void 0&&(D.exports=w)}}]);
