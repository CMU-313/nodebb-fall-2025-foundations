"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,36159,49897,62441,88189,98463,99127],{24187:(S,w,a)=>{var E,A;E=[a(64061)],A=function(){const h={};h.show=function(t,s){const n=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:n,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(r){r.modal("show"),r.on("hidden.bs.modal",function(){r.remove()});const l=r.find("#uploadForm");l.attr("action",t.route),l.find("#params").val(JSON.stringify(t.params)),r.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),l.submit()}),l.submit(function(){return C(r,n,s),!1})})},h.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function C(t,s,n){p(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const r=t.find("#fileInput");if(!r.val())return p(t,"error","[[uploads:select-file-to-upload]]");if(!P(r[0],s))return p(t,"error","[[error:file-too-big, "+s+"]]");h.ajaxSubmit(t,n)}function p(t,s,n){h.hideAlerts(t),s==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),n=n.replace(/&amp;#44/g,"&#44"),t.find("#alert-"+s).translateText(n).removeClass("hide")}h.ajaxSubmit=function(t,s){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(r){r=g(r),p(t,"error",r.responseJSON?.status?.message||r.responseJSON?.error||`[[error:upload-error-fallback, ${r.status} ${r.statusText}]]`)},uploadProgress:function(r,l,f,e){t.find("#upload-progress-bar").css("width",e+"%")},success:function(r){let l=g(r);r.hasOwnProperty("response")&&r.hasOwnProperty("status")&&r.status.code==="ok"&&(l=r.response.images),s(l[0].url),p(t,"success","[[uploads:upload-success]]"),setTimeout(function(){h.hideAlerts(t),t.modal("hide")},750)}})};function g(t){if(typeof t=="string")try{return JSON.parse(t)}catch(s){return console.error(s),{error:"[[error:parse-error]]"}}return t}function P(t,s){return window.FileReader&&s?t.files[0].size<=s*1e3:!0}return h}.apply(w,E),A!==void 0&&(S.exports=A)},36159:(S,w,a)=>{var E,A;E=[a(49897),a(33530),a(29930),a(24187),a(81335),a(17459),a(65285)],A=function(h,C,p,g,P,t){const s={};return s.get=n=>h.get(`/topics/${n}/thumbs`,{thumbsOnly:1}),s.getByPid=n=>h.get(`/posts/${encodeURIComponent(n)}`,{}).then(r=>s.get(r.tid)),s.delete=(n,r)=>h.del(`/topics/${n}/thumbs`,{path:r}),s.deleteAll=n=>{s.get(n).then(r=>{Promise.all(r.map(l=>s.delete(n,l.url)))})},s.upload=n=>new Promise(r=>{g.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${n}/thumbs`},function(l){r(l)})}),s.modal={},s.modal.open=function(n){const{id:r,pid:l}=n;let{modal:f}=n,e;return new Promise(i=>{Promise.all([s.get(r),l?s.getByPid(l):[]]).then(o=>new Promise(c=>{const u=o.reduce((y,d)=>y.concat(d));e=u.length,c(u)})).then(o=>P.render("modals/topic-thumbs",{thumbs:o})).then(o=>{f?t.translate(o,function(c){f.find(".bootbox-body").html(c),s.modal.handleSort({modal:f,numThumbs:e})}):(f=C.dialog({title:"[[modules:thumbs.modal.title]]",message:o,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(s.upload(r).then(()=>{s.modal.open({...n,modal:f}),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var c=[a(71431)];(u=>{u.updateThumbCount(r,$(`[component="composer"][data-uuid="${r}"]`)),i()}).apply(null,c)}).catch(a.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),s.modal.handleDelete({...n,modal:f}),s.modal.handleSort({modal:f,numThumbs:e}))})})},s.modal.handleDelete=n=>{const r=n.modal.get(0),{id:l}=n;r.addEventListener("click",f=>{f.target.closest('button[data-action="remove"]')&&C.confirm("[[modules:thumbs.modal.confirm-remove]]",e=>{if(!e)return;const i=f.target.closest("[data-id]").getAttribute("data-id"),o=f.target.closest("[data-path]").getAttribute("data-path");h.del(`/topics/${i}/thumbs`,{path:o}).then(()=>{s.modal.open(n),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var c=[a(71431)];(u=>{u.updateThumbCount(l,$(`[component="composer"][data-uuid="${l}"]`))}).apply(null,c)}).catch(a.oe)}).catch(p.error)})})},s.modal.handleSort=({modal:n,numThumbs:r})=>{if(r>1){const l=n.find(".topic-thumbs-modal");l.sortable({items:"[data-id]"}),l.on("sortupdate",s.modal.handleSortChange)}},s.modal.handleSortChange=(n,r)=>{const l=r.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(l).forEach((f,e)=>{const i=f.getAttribute("data-id");let o=f.getAttribute("data-path");o=o.replace(new RegExp(`^${config.upload_url}`),""),h.put(`/topics/${i}/thumbs/order`,{path:o,order:e}).catch(p.error)})},s}.apply(w,E),A!==void 0&&(S.exports=A)},49897:(S,w,a)=>{a.r(w),a.d(w,{del:()=>f,get:()=>t,head:()=>s,patch:()=>r,post:()=>n,put:()=>l});var E=a(91749),A=a.n(E),h=a(33530),C=a.n(h);const p=config.relative_path+"/api/v3";async function g(e,i){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:p+e.url,typeof i=="function"){P(e).then(o=>i(null,o),o=>{let c=o;o instanceof Error||(c=new Error(String(o)));const u=c.message||String(c);if(u&&!u.startsWith("[[error:")&&(u.toLowerCase()==="fetch failed"||u.toLowerCase()==="failed to fetch"||u.toLowerCase().includes("networkerror")||u.toLowerCase().includes("network")&&u.toLowerCase().includes("failed"))){const d=new Error("[[error:no-connection]]");d.originalError=c,c=d}i(c)});return}try{return await P(e)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:c}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,h.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go(c)})}throw o}}async function P(e){const{url:i}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(m){console.error("[API] Error in filter:api.options hook:",m)}e.data&&(e.body=e.data,delete e.data);let o;try{o=await fetch(i,e)}catch(m){const b=m.message||m.toString()||String(m),T=m.name||"Error";if(T==="TypeError"&&(b.toLowerCase().includes("fetch")||b.toLowerCase().includes("network")||b.toLowerCase().includes("failed to fetch")||b.toLowerCase().includes("load failed"))||b.toLowerCase().includes("cors")||b.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:i,method:e.method||"GET",error:b,name:T});const v=new Error("[[error:no-connection]]");throw v.originalError=m,v}throw console.error("[API] Unexpected fetch error:",{url:i,method:e.method||"GET",error:b,name:T}),m}const{headers:c}=o;if(c.get("x-redirect"))return P({url:c.get("x-redirect"),...e});const u=c.get("content-type"),y=u&&u.startsWith("application/json");let d;if(e.method!=="HEAD")try{y?d=await o.json():d=await o.text()}catch(m){throw console.error("[API] Error parsing response:",{url:i,status:o.status,statusText:o.statusText,contentType:u,error:m.message}),new Error("[[error:invalid-json]]")}if(!o.ok){let m;throw d?y&&d.status&&d.status.message?m=d.status.message:typeof d=="string"?m=d:m=o.statusText||"Request failed":m=o.statusText||"Request failed",new Error(m)}return y&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function t(e,i,o){return g({url:e+(i&&Object.keys(i).length?"?"+$.param(i):"")},o)}function s(e,i,o){return g({url:e+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},o)}function n(e,i,o){return g({url:e,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function r(e,i,o){return g({url:e,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function l(e,i,o){return g({url:e,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function f(e,i,o){return g({url:e,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}}}]);
