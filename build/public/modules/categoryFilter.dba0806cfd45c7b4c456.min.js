"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,51831,69185,99127],{39259:(L,w,f)=>{var m,E;m=[f(96349),f(49897),f(91749)],E=function(p,P,k){const h={};h.init=function(n,a){if(!n||!n.length)return;a=a||{},a.states=a.states||["watching","tracking","notwatching","ignoring"],a.template=a.template||"partials/category/filter-dropdown-left",k.fire("action:category.filter.options",{el:n,options:a}),p.init(n,a);let i=[],o=[];Array.isArray(a.selectedCids)?i=a.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(i=ajaxify.data.selectedCids.map(String)),o=i.slice(),n.on("hidden.bs.dropdown",function(){let u=o.length!==i.length;if(o.forEach(function(y,e){y!==i[e]&&(u=!0)}),o=i.slice(),u&&(a.updateButton?a.updateButton({el:n,changed:u,selectedCids:i.slice()}):a.updateButton!==!1&&g(n,i)),a.onHidden){a.onHidden({changed:u,selectedCids:i.slice()});return}if(u){let y=window.location.pathname;const e=utils.params();i.length?e.cid=i:delete e.cid,delete e.page,Object.keys(e).length&&(y+="?"+$.param(e)),ajaxify.go(y)}}),n.on("click",'[component="category/list"] [data-cid]',function(u){const y=n.find('[component="category/list"]'),e=$(this),r=e.find("a").attr("href");if(r&&r!=="#"&&r.length){u.stopPropagation();return}const t=e.attr("data-cid"),s=e.find('[component="category/select/icon"]');return t!=="all"?(i.includes(t)?i.splice(i.indexOf(t),1):i.push(t),i.sort(function(c,A){return c-A}),s.toggleClass("invisible"),y.find('[data-cid="all"] i').toggleClass("invisible",!!i.length)):(n.find('[component="category/select/icon"]').addClass("invisible"),y.find('[data-cid="all"] i').removeClass("invisible"),i=[]),a.selectedCids=i,a.onSelect&&a.onSelect({cid:t,selectedCids:i.slice()}),!1})};function g(n,a){a.length>1?i({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):a.length===1?P.get(`/categories/${a[0]}`,{}).then(i):i();function i(o){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:o},function(u){n.find("button").replaceWith($("<div/>").html(u).find("button"))})}}return h}.apply(w,m),E!==void 0&&(L.exports=E)},49897:(L,w,f)=>{f.r(w),f.d(w,{del:()=>y,get:()=>n,head:()=>a,patch:()=>o,post:()=>i,put:()=>u});var m=f(91749),E=f.n(m),p=f(33530),P=f.n(p);const k=config.relative_path+"/api/v3";async function h(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:k+e.url,typeof r=="function"){g(e).then(t=>r(null,t),t=>{let s=t;t instanceof Error||(s=new Error(String(t)));const c=s.message||String(s);if(c&&!c.startsWith("[[error:")&&(c.toLowerCase()==="fetch failed"||c.toLowerCase()==="failed to fetch"||c.toLowerCase().includes("networkerror")||c.toLowerCase().includes("network")&&c.toLowerCase().includes("failed"))){const l=new Error("[[error:no-connection]]");l.originalError=s,s=l}r(s)});return}try{return await g(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(s)})}throw t}}async function g(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,m.fire)("filter:api.options",{options:e}))}catch(d){console.error("[API] Error in filter:api.options hook:",d)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(d){const C=d.message||d.toString()||String(d),v=d.name||"Error";if(v==="TypeError"&&(C.toLowerCase().includes("fetch")||C.toLowerCase().includes("network")||C.toLowerCase().includes("failed to fetch")||C.toLowerCase().includes("load failed"))||C.toLowerCase().includes("cors")||C.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:C,name:v});const x=new Error("[[error:no-connection]]");throw x.originalError=d,x}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:C,name:v}),d}const{headers:s}=t;if(s.get("x-redirect"))return g({url:s.get("x-redirect"),...e});const c=s.get("content-type"),A=c&&c.startsWith("application/json");let l;if(e.method!=="HEAD")try{A?l=await t.json():l=await t.text()}catch(d){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:c,error:d.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let d;throw l?A&&l.status&&l.status.message?d=l.status.message:typeof l=="string"?d=l:d=t.statusText||"Request failed":d=t.statusText||"Request failed",new Error(d)}return A&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function n(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function a(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function i(e,r,t){return h({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function o(e,r,t){return h({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function u(e,r,t){return h({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function y(e,r,t){return h({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}},96349:(L,w,f)=>{var m,E;m=[f(29930),f(89336),f(49897)],E=function(p,P,k){const h={};return h.init=function(g,n){let a=n.defaultCategories||null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","tracking","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let i=[];Array.isArray(n.localCategories)&&(i=n.localCategories.map(r=>({...r})),a&&(a=[...i,...a])),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const o=g.find('[component="category-selector-search"]');if(!o.length)return;const u=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){u&&o.removeClass("hidden");function r(){const t=o.find("input").val();t.length>1||!t&&!a?y(t,function(s){a=n.cacheList&&(a||s),e(s)}):!t&&a&&e(a)}o.on("click",function(t){t.preventDefault(),t.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),g.on("hide.bs.dropdown",function(){u&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function y(r,t){k.get("/search/categories",{search:r,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(s,{categories:c}){if(s)return p.error(s);t(i.concat(c))})}function e(r){const t=n.selectedCids.map(String);r.forEach(function(s){s.selected=t.includes(String(s.cid))}),app.parseAndTranslate(n.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){g.find('[component="category/list"]').html(s.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const c=P.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));c&&c.update()})}},h}.apply(w,m),E!==void 0&&(L.exports=E)}}]);
