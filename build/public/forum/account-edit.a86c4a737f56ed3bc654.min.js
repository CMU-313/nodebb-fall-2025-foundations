"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[98391],{63387:(v,x,c)=>{var d,l;d=[c(67910),c(7524),c(17459),c(49897),c(91749),c(33530),c(29930),c(86296)],l=function(b,j,m,f,p,g,r,w){const E={};function L(e){if(!e)return"";const a=e.replace(/<[^>]*>/g,"").trim(),t={of:!0,the:!0};return a.split(/\s+/).map(function(s,i){const o=s.toLowerCase();return i===0?o.charAt(0).toUpperCase()+o.slice(1):t[o]?o:o.charAt(0).toUpperCase()+o.slice(1)}).join(" ")}function u(e,a){if(!e)return"";const n=e.replace(/<[^>]*>/g,"").trim().split(/\s+/).map(function(s){const i=s.toLowerCase();return i.charAt(0).toUpperCase()+i.slice(1)}).join(" ");return a==="state"&&n.replace(/\s+/g,"").length===2?n.replace(/\s+/g,"").toUpperCase():a==="country"&&n.replace(/\s+/g,"").length===3?n.replace(/\s+/g,"").toUpperCase():n}E.init=function(){b.init();try{const e=$("#university").length?$("#university").val()||"":ajaxify.data.university||"";e&&e.toString().trim()&&($("#university-placeholder").hide(),$("#university-fields").show())}catch{}try{const e=$("input#university");e.length>1&&e.slice(1).each((i,o)=>{$(o).closest(".mb-3").remove()});const a=$("input#graduationYear");a.length>1&&a.slice(1).each((i,o)=>{$(o).closest(".mb-3").remove()});const t=$("input#location_city");t.length>1&&t.slice(1).each((i,o)=>{$(o).closest(".mb-3").remove()});const n=$("input#location_state");n.length>1&&n.slice(1).each((i,o)=>{$(o).closest(".mb-3").remove()});const s=$("input#location_country");s.length>1&&s.slice(1).each((i,o)=>{$(o).closest(".mb-3").remove()})}catch{}$("#addUniversityBtn").on("click",function(e){e.preventDefault(),$("#university-placeholder").hide(),$("#university-fields").show()}),$("#addLocationBtn").on("click",function(e){e.preventDefault(),$("#location-placeholder").hide(),$("#location-fields").show()}),$("#submitBtn").on("click",k);try{const e=$("#location_city").length&&$("#location_city").val()||""||ajaxify.data.location||"";if(e&&e.toString().trim()&&($("#location-placeholder").hide(),$("#location-fields").show(),ajaxify.data.location&&!$("#location_city").val())){const a=ajaxify.data.location.split(",").map(t=>t.trim());$("#location_city").val(a[0]?u(a[0]):""),$("#location_state").val(a[1]?u(a[1],"state"):""),$("#location_country").val(a[2]?u(a[2],"country"):"")}}catch{}ajaxify.data.groupTitleArray.length===1&&ajaxify.data.groupTitleArray[0]===""&&$('#groupTitle option[value=""]').attr("selected",!0),F(),S(),B(),D(),M(),!ajaxify.data.isSelf&&ajaxify.data.canEdit&&$(`a[href="${config.relative_path}/user/${ajaxify.data.userslug}/edit/email"]`).on("click",()=>(w.init({uid:ajaxify.data.uid,email:ajaxify.data.email,onSuccess:function(){r.success("[[user:email-updated]]")}}),!1))};function k(){function e(){return $('[component="group/badge/list"] [component="group/badge/item"][data-selected="true"]').map((s,i)=>$(i).attr("data-value")).get()}const a=$('form[component="profile/edit/form"]'),t=a.serializeObject();if(a.find("select[multiple]").each((n,s)=>{const i=$(s).attr("name");t[i]&&!Array.isArray(t[i])&&(t[i]=[t[i]]),t[i]=JSON.stringify(t[i]||[])}),t.university&&(t.university=L(t.university)),t.graduationYear&&(t.graduationYear=t.graduationYear.toString().replace(/[^0-9]/g,"")),t.university&&t.graduationYear){const n=t.graduationYear.toString().slice(-2);t.university=t.university+" ('"+n+")"}if(t.location_city&&(t.location_city=u(t.location_city)),t.location_state&&(t.location_state=u(t.location_state,"state")),t.location_country&&(t.location_country=u(t.location_country,"country")),t.location_city||t.location_state||t.location_country){const n=[t.location_city,t.location_state,t.location_country].filter(Boolean);n.length&&(t.location=n.join(", "))}else t.location="";return t.uid=ajaxify.data.uid,t.groupTitle=t.groupTitle||"",t.groupTitle=JSON.stringify(e()),p.fire("action:profile.update",t),f.put("/users/"+t.uid,t).then(n=>{if(r.success("[[user:profile-update-success]]"),ajaxify.data.university=t.university||ajaxify.data.university,ajaxify.data.location=t.location!==void 0?t.location:ajaxify.data.location,t.location===""&&($(".account-stats .stat").filter(function(){return $(this).text().trim().includes("Location")}).remove(),ajaxify.data.customUserFields&&(ajaxify.data.customUserFields=ajaxify.data.customUserFields.filter(T=>T.key!=="location"))),t.location&&t.location!==""){var s=$(".account-stats .stat").filter(function(){return $(this).text().trim().includes("Location")}).first();if(s.length)s.find(".ff-secondary").text(t.location);else{var i="Location",o="fa-solid fa-location-dot",C=$('<div class="stat"><div class="align-items-center justify-content-center card card-header p-3 border-0 rounded-1 h-100 gap-2"><span class="stat-label text-xs fw-semibold"><span><i class="text-muted '+o+'"></i> '+i+'</span></span><span class="text-center fs-6 ff-secondary"></span></div></div>');C.find(".ff-secondary").text(t.location);var A=$(".account-stats .stat").filter(function(){return $(this).text().trim().includes("University")}).first();A.length?A.after(C):$(".account-stats .row").first().append(C)}ajaxify.data.customUserFields=ajaxify.data.customUserFields||[];for(var U=!1,y=0;y<ajaxify.data.customUserFields.length;y++)if(ajaxify.data.customUserFields[y].key==="location"){ajaxify.data.customUserFields[y].value=t.location,U=!0;break}U||ajaxify.data.customUserFields.push({key:"location",name:"Location",value:t.location,icon:"fa-solid fa-location-dot",type:"input-text"})}n.picture&&$("#user-current-picture").attr("src",n.picture),j.updateHeader(n.picture)}).catch(r.error),!1}function F(){$("#deleteAccountBtn").on("click",function(){return m.translate("[[user:delete-account-confirm]]",function(e){const a=g.confirm(e+'<p><input type="password" class="form-control" id="confirm-password" /></p>',function(t){if(!t)return;const n=a.find(".btn-primary");return n.html('<i class="fa fa-spinner fa-spin"></i>'),n.prop("disabled",!0),f.del(`/users/${ajaxify.data.uid}/account`,{password:$("#confirm-password").val()},function(s){function i(){m.translate("[[modules:bootbox.confirm]]",function(o){n.text(o),n.prop("disabled",!1)})}if(s)return i(),r.error(s);n.html('<i class="fa fa-check"></i>'),window.location.href=`${config.relative_path}/`}),!1});a.on("shown.bs.modal",function(){a.find("input").focus()})}),!1})}function S(){$("#confirm-email").on("click",function(){const e=$(this).attr("disabled",!0);socket.emit("user.emailConfirm",{},function(a){if(e.removeAttr("disabled"),a)return r.error(a);r.success("[[notifications:email-confirm-sent]]")})})}function h(e,a){return e.length?"("+e.val().length+"/"+a+")":""}function B(){const e=$("#signature");$("#signatureCharCountLeft").html(h(e,ajaxify.data.maximumSignatureLength)),e.on("keyup change",function(){$("#signatureCharCountLeft").html(h(e,ajaxify.data.maximumSignatureLength))})}function D(){const e=$("#aboutme");$("#aboutMeCharCountLeft").html(h(e,ajaxify.data.maximumAboutMeLength)),e.on("keyup change",function(){$("#aboutMeCharCountLeft").html(h(e,ajaxify.data.maximumAboutMeLength))})}function M(){const{allowMultipleBadges:e}=ajaxify.data;$('[component="group/toggle/hide"]').on("click",function(){const a=$(this).parents('[component="group/badge/item"]');a.attr("data-selected","false"),$(this).addClass("hidden"),a.find('[component="group/toggle/show"]').removeClass("hidden")}),$('[component="group/toggle/show"]').on("click",function(){e||($('[component="group/badge/list"] [component="group/toggle/show"]').removeClass("hidden"),$('[component="group/badge/list"] [component="group/toggle/hide"]').addClass("hidden"),$('[component="group/badge/list"] [component="group/badge/item"]').attr("data-selected","false"));const a=$(this).parents('[component="group/badge/item"]');a.attr("data-selected","true"),$(this).addClass("hidden"),a.find('[component="group/toggle/hide"]').removeClass("hidden")}),$('[component="group/order/up"]').on("click",function(){const a=$(this).parents('[component="group/badge/item"]');a.insertBefore(a.prev())}),$('[component="group/order/down"]').on("click",function(){const a=$(this).parents('[component="group/badge/item"]');a.insertAfter(a.next())})}return E}.apply(x,d),l!==void 0&&(v.exports=l)},86296:(v,x,c)=>{var d,l;d=[c(49897),c(33530),c(29930)],l=function(b,j,m){const f={};return f.init=function(p){const g=j.dialog({message:`
				<label class="form-label">[[admin/manage/users:new-email]]</label>
				<input id="newEmail" class="form-control" type="text" value="${utils.escapeHTML(p.email||"")}">
			`,title:"[[admin/manage/users:change-email]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){const r=g.find("#newEmail").val();return b.post("/users/"+p.uid+"/emails",{skipConfirmation:!0,email:r}).then(()=>{g.modal("hide"),p.onSuccess(r)}).catch(m.error),!1}}}})},f}.apply(x,d),l!==void 0&&(v.exports=l)}}]);
