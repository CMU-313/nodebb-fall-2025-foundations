(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,97082,98391],{18675:()=>{(function(v){var A=v(window),o=function(e,c,n,a){if(arguments.length===3||a){if(n<e)return e;if(n>c)return c}return n},b=function(e){e.clientX=e.originalEvent.touches[0].clientX,e.clientY=e.originalEvent.touches[0].clientY},p=function(e){var c=(e.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(c){var n={width:0,height:0},a=new Image;return a.onload=function(){if(e.css("background-size")=="cover"){var r=e.innerWidth(),i=e.innerHeight(),f=r/i,g=a.width/a.height,d=1;g>=f?d=i/a.height:d=r/a.width,n.width=a.width*d,n.height=a.height*d}else n.width=a.width,n.height=a.height},a.src=c,n}};function E(e,c){this.element=e,this.options=c,this.init()}E.prototype.init=function(){var e=v(this.element),c=(e.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],n=this.options;if(c){var a={width:0,height:0};(n.bound||n.units=="percent")&&(a=p(e)),v(window).on("keydown.dbg",r=>{var i=e.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],f=parseInt(i[1])||0,g=parseInt(i[2])||0;n.units=="percent"&&(f=Math.round(f/-200*a.width),g=Math.round(g/-200*a.height));var d=0,h=0;return r.which===37?d=-5:r.which===39?d=5:r.which===38?h=-5:r.which===40&&(h=5),n.units==="percent"?(f=n.axis==="y"?f:o(-a.width/2,0,f+d,n.bound),g=n.axis==="x"?g:o(-a.height/2,0,g+h,n.bound),e.css("background-position",f/a.width*-200+"% "+g/a.height*-200+"%")):(f=n.axis==="y"?f:o(e.innerWidth()-a.width,0,f+d,n.bound),g=n.axis==="x"?g:o(e.innerHeight()-a.height,0,g+h,n.bound)),[37,38,39,40].includes(r.which)?!1:void 0}),e.on("mousedown.dbg touchstart.dbg",function(r){if(r.target===e[0]){if(r.preventDefault(),r.originalEvent.touches)b(r);else if(r.which!==1)return;var i=r.clientX,f=r.clientY,g=e.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],d=parseInt(g[1])||0,h=parseInt(g[2])||0;n.units=="percent"&&(d=Math.round(d/-200*a.width),h=Math.round(h/-200*a.height)),A.on("mousemove.dbg touchmove.dbg",function(C){C.preventDefault(),C.originalEvent.touches&&b(C);var j=C.clientX,w=C.clientY;n.units=="percent"?(d=n.axis==="y"?d:o(-a.width/2,0,d+j-i,n.bound),h=n.axis==="x"?h:o(-a.height/2,0,h+w-f,n.bound),e.css("background-position",d/a.width*-200+"% "+h/a.height*-200+"%")):(d=n.axis==="y"?d:o(e.innerWidth()-a.width,0,d+j-i,n.bound),h=n.axis==="x"?h:o(e.innerHeight()-a.height,0,h+w-f,n.bound),e.css("background-position",d+"px "+h+"px")),i=j,f=w}),A.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){n.done&&n.done(),A.off("mousemove.dbg touchmove.dbg"),A.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},E.prototype.disable=function(){var e=v(this.element);e.off("mousedown.dbg touchstart.dbg"),A.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},v.fn.backgroundDraggable=function(e){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=v(this),a;typeof e>"u"||typeof e=="object"?(e=v.extend({},v.fn.backgroundDraggable.defaults,e),a=new E(this,e),n.data("dbg",a)):typeof e=="string"&&n.data("dbg")&&(a=n.data("dbg"),E.prototype[e].apply(a,c))})},v.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(v,A,o)=>{"use strict";var b,p;b=[o(81335),o(49897),o(33530),o(29930)],p=function(E,e,c,n){const a={};a.banAccount=function(i,f){i=i||ajaxify.data.theirid,r({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(g){const d=g.length>0?Date.now()+g.length*1e3*60*60*(parseInt(g.unit,10)?24:1):0;e.put("/users/"+i+"/ban",{until:d,reason:g.reason||""}).then(()=>{if(typeof f=="function")return f();ajaxify.refresh()}).catch(n.error)}})},a.unbanAccount=function(i){r({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(f){e.del("/users/"+i+"/ban",{reason:f.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})},a.muteAccount=function(i,f){i=i||ajaxify.data.theirid,r({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(g){const d=g.length>0?Date.now()+g.length*1e3*60*60*(parseInt(g.unit,10)?24:1):0;e.put("/users/"+i+"/mute",{until:d,reason:g.reason||""}).then(()=>{if(typeof f=="function")return f();ajaxify.refresh()}).catch(n.error)}})},a.unmuteAccount=function(i){r({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(f){e.del("/users/"+i+"/mute",{reason:f.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})};function r(i){E.render(i.tpl,{}).then(function(f){const g=c.dialog({title:i.title,message:f,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:i.title,callback:function(){const d=g.find("form").serializeArray().reduce(function(h,C){return h[C.name]=C.value,h},{});i.onSubmit(d)}}}})})}return a}.apply(A,b),p!==void 0&&(v.exports=p)},36684:(v,A,o)=>{"use strict";var b,p;b=[o(29930),o(18675)],p=function(E){const e={coverEl:null,saveFn:null};e.init=function(n,a,r,i){e.coverEl=n,e.saveFn=a,n.find(".upload").on("click",r),n.find(".resize").on("click",function(){c(n)}),n.find(".remove").on("click",i),n.on("dragover",e.onDragOver).on("drop",e.onDrop),n.find(".save").on("click",e.save),n.addClass("initialised")},e.onDragOver=function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"},e.onDrop=function(n){n.stopPropagation(),n.preventDefault();const a=n.originalEvent.dataTransfer.files,r=new FileReader;a.length&&a[0].type.match("image.*")&&(r.onload=function(i){e.coverEl.css("background-image","url("+i.target.result+")"),e.newCover=i.target.result},r.readAsDataURL(a[0]),c(e.coverEl))};function c(n){n.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),E.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return e.save=function(){e.coverEl.addClass("saving"),e.saveFn(e.newCover||void 0,e.coverEl.css("background-position"),function(n){n?E.error(n):(e.coverEl.toggleClass("active",0),e.coverEl.backgroundDraggable("disable"),e.coverEl.off("dragover",e.onDragOver),e.coverEl.off("drop",e.onDrop),E.success("[[modules:cover.saved]]")),e.coverEl.removeClass("saving")})},e}.apply(A,b),p!==void 0&&(v.exports=p)},47283:(v,A,o)=>{"use strict";var b,p;b=[o(49897),o(33530),o(29930)],p=function(E,e,c){const n={};n.account=function(r,i){a(r,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",i)},n.content=function(r,i){a(r,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",i)},n.purge=function(r,i){a(r,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",i)};function a(r,i,f,g,d){e.confirm(i,function(h){h&&E.del(`/users/${encodeURIComponent(r)}${f}`,{}).then(()=>{if(c.success(g),typeof d=="function")return d()}).catch(c.error)})}return n}.apply(A,b),p!==void 0&&(v.exports=p)},63387:(v,A,o)=>{"use strict";var b,p;b=[o(67910),o(7524),o(17459),o(49897),o(91749),o(33530),o(29930),o(86296)],p=function(E,e,c,n,a,r,i,f){const g={};function d(s){if(!s)return"";const l=s.replace(/<[^>]*>/g,"").trim(),t={of:!0,the:!0};return l.split(/\s+/).map(function(m,y){const x=m.toLowerCase();return y===0?x.charAt(0).toUpperCase()+x.slice(1):t[x]?x:x.charAt(0).toUpperCase()+x.slice(1)}).join(" ")}function h(s,l){if(!s)return"";const u=s.replace(/<[^>]*>/g,"").trim().split(/\s+/).map(function(m){const y=m.toLowerCase();return y.charAt(0).toUpperCase()+y.slice(1)}).join(" ");return l==="state"&&u.replace(/\s+/g,"").length===2?u.replace(/\s+/g,"").toUpperCase():l==="country"&&u.replace(/\s+/g,"").length===3?u.replace(/\s+/g,"").toUpperCase():u}g.init=function(){E.init();try{const s=$("#university").length?$("#university").val()||"":ajaxify.data.university||"";s&&s.toString().trim()&&($("#university-placeholder").hide(),$("#university-fields").show())}catch{}try{const s=$("input#university");s.length>1&&s.slice(1).each((y,x)=>{$(x).closest(".mb-3").remove()});const l=$("input#graduationYear");l.length>1&&l.slice(1).each((y,x)=>{$(x).closest(".mb-3").remove()});const t=$("input#location_city");t.length>1&&t.slice(1).each((y,x)=>{$(x).closest(".mb-3").remove()});const u=$("input#location_state");u.length>1&&u.slice(1).each((y,x)=>{$(x).closest(".mb-3").remove()});const m=$("input#location_country");m.length>1&&m.slice(1).each((y,x)=>{$(x).closest(".mb-3").remove()})}catch{}$("#addUniversityBtn").on("click",function(s){s.preventDefault(),$("#university-placeholder").hide(),$("#university-fields").show()}),$("#addLocationBtn").on("click",function(s){s.preventDefault(),$("#location-placeholder").hide(),$("#location-fields").show()}),$("#submitBtn").on("click",C);try{const s=$("#location_city").length&&$("#location_city").val()||""||ajaxify.data.location||"";if(s&&s.toString().trim()&&($("#location-placeholder").hide(),$("#location-fields").show(),ajaxify.data.location&&!$("#location_city").val())){const l=ajaxify.data.location.split(",").map(t=>t.trim());$("#location_city").val(l[0]?h(l[0]):""),$("#location_state").val(l[1]?h(l[1],"state"):""),$("#location_country").val(l[2]?h(l[2],"country"):"")}}catch{}ajaxify.data.groupTitleArray.length===1&&ajaxify.data.groupTitleArray[0]===""&&$('#groupTitle option[value=""]').attr("selected",!0),j(),w(),D(),F(),I(),!ajaxify.data.isSelf&&ajaxify.data.canEdit&&$(`a[href="${config.relative_path}/user/${ajaxify.data.userslug}/edit/email"]`).on("click",()=>(f.init({uid:ajaxify.data.uid,email:ajaxify.data.email,onSuccess:function(){i.success("[[user:email-updated]]")}}),!1))};function C(){function s(){return $('[component="group/badge/list"] [component="group/badge/item"][data-selected="true"]').map((m,y)=>$(y).attr("data-value")).get()}const l=$('form[component="profile/edit/form"]'),t=l.serializeObject();if(l.find("select[multiple]").each((u,m)=>{const y=$(m).attr("name");t[y]&&!Array.isArray(t[y])&&(t[y]=[t[y]]),t[y]=JSON.stringify(t[y]||[])}),t.university&&(t.university=d(t.university)),t.graduationYear&&(t.graduationYear=t.graduationYear.toString().replace(/[^0-9]/g,"")),t.university&&t.graduationYear){const u=t.graduationYear.toString().slice(-2);t.university=t.university+" ('"+u+")"}if(t.location_city&&(t.location_city=h(t.location_city)),t.location_state&&(t.location_state=h(t.location_state,"state")),t.location_country&&(t.location_country=h(t.location_country,"country")),t.location_city||t.location_state||t.location_country){const u=[t.location_city,t.location_state,t.location_country].filter(Boolean);u.length&&(t.location=u.join(", "))}else t.location="";return t.uid=ajaxify.data.uid,t.groupTitle=t.groupTitle||"",t.groupTitle=JSON.stringify(s()),a.fire("action:profile.update",t),n.put("/users/"+t.uid,t).then(u=>{if(i.success("[[user:profile-update-success]]"),ajaxify.data.university=t.university||ajaxify.data.university,ajaxify.data.location=t.location!==void 0?t.location:ajaxify.data.location,t.location===""&&($(".account-stats .stat").filter(function(){return $(this).text().trim().includes("Location")}).remove(),ajaxify.data.customUserFields&&(ajaxify.data.customUserFields=ajaxify.data.customUserFields.filter(P=>P.key!=="location"))),t.location&&t.location!==""){var m=$(".account-stats .stat").filter(function(){return $(this).text().trim().includes("Location")}).first();if(m.length)m.find(".ff-secondary").text(t.location);else{var y="Location",x="fa-solid fa-location-dot",U=$('<div class="stat"><div class="align-items-center justify-content-center card card-header p-3 border-0 rounded-1 h-100 gap-2"><span class="stat-label text-xs fw-semibold"><span><i class="text-muted '+x+'"></i> '+y+'</span></span><span class="text-center fs-6 ff-secondary"></span></div></div>');U.find(".ff-secondary").text(t.location);var M=$(".account-stats .stat").filter(function(){return $(this).text().trim().includes("University")}).first();M.length?M.after(U):$(".account-stats .row").first().append(U)}ajaxify.data.customUserFields=ajaxify.data.customUserFields||[];for(var B=!1,R=0;R<ajaxify.data.customUserFields.length;R++)if(ajaxify.data.customUserFields[R].key==="location"){ajaxify.data.customUserFields[R].value=t.location,B=!0;break}B||ajaxify.data.customUserFields.push({key:"location",name:"Location",value:t.location,icon:"fa-solid fa-location-dot",type:"input-text"})}u.picture&&$("#user-current-picture").attr("src",u.picture),e.updateHeader(u.picture)}).catch(i.error),!1}function j(){$("#deleteAccountBtn").on("click",function(){return c.translate("[[user:delete-account-confirm]]",function(s){const l=r.confirm(s+'<p><input type="password" class="form-control" id="confirm-password" /></p>',function(t){if(!t)return;const u=l.find(".btn-primary");return u.html('<i class="fa fa-spinner fa-spin"></i>'),u.prop("disabled",!0),n.del(`/users/${ajaxify.data.uid}/account`,{password:$("#confirm-password").val()},function(m){function y(){c.translate("[[modules:bootbox.confirm]]",function(x){u.text(x),u.prop("disabled",!1)})}if(m)return y(),i.error(m);u.html('<i class="fa fa-check"></i>'),window.location.href=`${config.relative_path}/`}),!1});l.on("shown.bs.modal",function(){l.find("input").focus()})}),!1})}function w(){$("#confirm-email").on("click",function(){const s=$(this).attr("disabled",!0);socket.emit("user.emailConfirm",{},function(l){if(s.removeAttr("disabled"),l)return i.error(l);i.success("[[notifications:email-confirm-sent]]")})})}function k(s,l){return s.length?"("+s.val().length+"/"+l+")":""}function D(){const s=$("#signature");$("#signatureCharCountLeft").html(k(s,ajaxify.data.maximumSignatureLength)),s.on("keyup change",function(){$("#signatureCharCountLeft").html(k(s,ajaxify.data.maximumSignatureLength))})}function F(){const s=$("#aboutme");$("#aboutMeCharCountLeft").html(k(s,ajaxify.data.maximumAboutMeLength)),s.on("keyup change",function(){$("#aboutMeCharCountLeft").html(k(s,ajaxify.data.maximumAboutMeLength))})}function I(){const{allowMultipleBadges:s}=ajaxify.data;$('[component="group/toggle/hide"]').on("click",function(){const l=$(this).parents('[component="group/badge/item"]');l.attr("data-selected","false"),$(this).addClass("hidden"),l.find('[component="group/toggle/show"]').removeClass("hidden")}),$('[component="group/toggle/show"]').on("click",function(){s||($('[component="group/badge/list"] [component="group/toggle/show"]').removeClass("hidden"),$('[component="group/badge/list"] [component="group/toggle/hide"]').addClass("hidden"),$('[component="group/badge/list"] [component="group/badge/item"]').attr("data-selected","false"));const l=$(this).parents('[component="group/badge/item"]');l.attr("data-selected","true"),$(this).addClass("hidden"),l.find('[component="group/toggle/hide"]').removeClass("hidden")}),$('[component="group/order/up"]').on("click",function(){const l=$(this).parents('[component="group/badge/item"]');l.insertBefore(l.prev())}),$('[component="group/order/down"]').on("click",function(){const l=$(this).parents('[component="group/badge/item"]');l.insertAfter(l.next())})}return g}.apply(A,b),p!==void 0&&(v.exports=p)},67910:(v,A,o)=>{"use strict";var b,p;b=[o(36684),o(72254),o(52473),o(17459),o(47283),o(28061),o(7524),o(49897),o(33530),o(29930)],p=function(E,e,c,n,a,r,i,f,g,d){const h={};let C;h.init=function(){C=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,j(),w(),C&&k(),c.get("account/follow").on("click",()=>D("follow")),c.get("account/unfollow").on("click",()=>D("unfollow")),c.get("account/chat").on("click",async function(){const{roomId:t}=await f.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),u=await app.require("chat");t?u.openChat(t):u.newChat(ajaxify.data.uid)}),c.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){c.get("account/chat").parent().removeClass("hidden")})}),c.get("account/ban").on("click",()=>r.banAccount(ajaxify.data.theirid)),c.get("account/mute").on("click",()=>r.muteAccount(ajaxify.data.theirid)),c.get("account/unban").on("click",()=>r.unbanAccount(ajaxify.data.theirid)),c.get("account/unmute").on("click",()=>r.unmuteAccount(ajaxify.data.theirid)),c.get("account/delete-account").on("click",()=>a.account(ajaxify.data.theirid)),c.get("account/delete-content").on("click",()=>a.content(ajaxify.data.theirid)),c.get("account/delete-all").on("click",()=>a.purge(ajaxify.data.theirid)),c.get("account/flag").on("click",F),c.get("account/already-flagged").on("click",I),c.get("account/block").on("click",()=>s("block")),c.get("account/unblock").on("click",()=>s("unblock"))};function j(){$(".account-sub-links li a").removeClass("active").each(function(){const t=$(this).attr("href");if(decodeURIComponent(t)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function w(){$('[component="profile/change/picture"]').on("click",function(){return i.openChangeModal(),!1})}function k(){E.init(c.get("account/cover"),function(t,u,m){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:t,position:u},m)},function(){e.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(t){t=(t.startsWith("http")?"":config.relative_path)+t+"?"+Date.now(),c.get("account/cover").css("background-image","url("+t+")")})},l)}function D(t){const u=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return f[t==="follow"?"put":"del"]("/users/"+u+"/follow",void 0,function(m){if(m)return d.error(m);c.get("account/follow").toggleClass("hide",t==="follow"),c.get("account/unfollow").toggleClass("hide",t==="unfollow"),d.success("[[global:alert."+t+", "+ajaxify.data.username+"]]")}),!1}function F(){o.e(6574).then(function(){var t=[o(6574)];(function(u){u.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,t)}).catch(o.oe)}function I(){const t=$(this).data("flag-id");o.e(6574).then(function(){var u=[o(6574)];(function(m){g.confirm("[[flags:modal-confirm-rescind]]",function(y){y&&m.rescind(t)})}).apply(null,u)}).catch(o.oe)}function s(t){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:t},function(u,m){if(u)return d.error(u);c.get("account/block").toggleClass("hidden",m),c.get("account/unblock").toggleClass("hidden",!m)}),!1}function l(){n.translate("[[user:remove-cover-picture-confirm]]",function(t){g.confirm(t,function(u){u&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(m){m?d.error(m):ajaxify.refresh()})})})}return h}.apply(A,b),p!==void 0&&(v.exports=p)},86296:(v,A,o)=>{"use strict";var b,p;b=[o(49897),o(33530),o(29930)],p=function(E,e,c){const n={};return n.init=function(a){const r=e.dialog({message:`
				<label class="form-label">[[admin/manage/users:new-email]]</label>
				<input id="newEmail" class="form-control" type="text" value="${utils.escapeHTML(a.email||"")}">
			`,title:"[[admin/manage/users:change-email]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){const i=r.find("#newEmail").val();return E.post("/users/"+a.uid+"/emails",{skipConfirmation:!0,email:i}).then(()=>{r.modal("hide"),a.onSuccess(i)}).catch(c.error),!1}}}})},n}.apply(A,b),p!==void 0&&(v.exports=p)}}]);
