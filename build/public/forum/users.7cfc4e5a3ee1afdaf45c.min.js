"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,66131,95737,99127],{30637:(P,w,i)=>{var f,m;f=[i(49897),i(81335),i(33530),i(29930)],m=function(v,k,C,c){const u={};function d(){return ajaxify.data.template.name.startsWith("admin/")}return u.handle=function(){$('[component="user/invite"]').on("click",function(y){y.preventDefault(),v.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(p=>{k.parse("modals/invite",{groups:p},function(h){C.dialog({message:h,title:`[[${d()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${d()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${d()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:u.send}}})})}).catch(c.error)})},u.send=function(){const y=$("#invite-modal-emails"),p=$("#invite-modal-groups"),h={emails:y.val().split(",").map(g=>g.trim()).filter(Boolean).filter((g,A,r)=>A===r.indexOf(g)).join(","),groupsToJoin:p.val()};h.emails&&v.post(`/users/${app.user.uid}/invites`,h).then(()=>{c.success(`[[${d()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${h.emails.replace(/,/g,"&#44; ")}]]`)}).catch(c.error)},u}.apply(w,f),m!==void 0&&(P.exports=m)},34567:(P,w,i)=>{var f,m;f=[i(49897),i(29930),i(30637)],m=function(v,k,C){const c={};let u=0;c.init=function(){app.enterRoom("user_list");const t=utils.param("section")?"?section="+utils.param("section"):"",e=$('[component="user/list/menu"]');e.find("a").removeClass("active"),e.find('a[href="'+window.location.pathname+t+'"]').addClass("active"),c.handleSearch(),C.handle(),socket.removeListener("event:user_status_change",g),socket.on("event:user_status_change",g)},c.handleSearch=function(t){u=t&&t.resultCount,$("#search-user").on("keyup",utils.debounce(d,250)),$('.search select, .search input[type="checkbox"]').on("change",d);const e=document.getElementById("search-user");if(e){const s=new URLSearchParams(document.location.search).get("query");s&&(e.value=s),utils.isMobile()||e.focus()}};function d(){if(!ajaxify.data.template.users)return;$('[component="user/search/icon"]').removeClass("fa-search").addClass("fa-spinner fa-spin");const t=r(),e={section:t||"users",page:1},n=$("#search-user").val();if(n)e.query=n;else return p(e);const s=y();s&&(e.sortBy=s);const l=[];($(".search .online-only").is(":checked")||t==="online")&&l.push("online"),t==="banned"&&l.push("banned"),t==="flagged"&&l.push("flagged"),l.length&&(e.filters=l),p(e)}function y(){let t;const e=r();return e==="sort-posts"?t="postcount":e==="sort-reputation"?t="reputation":e==="users"&&(t="joindate"),t}function p(t){v.get("/api/users",t).then(h).catch(k.error);const e=new URLSearchParams(t);ajaxify.updateHistory(`users?${e.toString()}`,!0)}function h(t){app.parseAndTranslate("partials/paginator",{pagination:t.pagination}).then(function(e){$(".pagination-container").replaceWith(e)}),u&&(t.users=t.users.slice(0,u)),t.isAdminOrGlobalMod=app.user.isAdmin||app.user.isGlobalMod,app.parseAndTranslate("users","users",t,function(e){$("#users-container").html(e),e.find(".timeago").timeago(),$('[component="user/search/icon"]').addClass("fa-search").removeClass("fa-spinner fa-spin")})}function g(t){const e=r();(e.startsWith("online")||e.startsWith("users"))&&A(t)}function A(t){app.updateUserStatus($('#users-container [data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function r(){return utils.param("section")||""}return c}.apply(w,f),m!==void 0&&(P.exports=m)},49897:(P,w,i)=>{i.r(w),i.d(w,{del:()=>A,get:()=>d,head:()=>y,patch:()=>h,post:()=>p,put:()=>g});var f=i(91749),m=i.n(f),v=i(33530),k=i.n(v);const C=config.relative_path+"/api/v3";async function c(r,t){if(r.url=r.url.startsWith("/api")?config.relative_path+r.url:C+r.url,typeof t=="function"){u(r).then(e=>t(null,e),e=>{let n=e;e instanceof Error||(n=new Error(String(e)));const s=n.message||String(n);if(s&&!s.startsWith("[[error:")&&(s.toLowerCase()==="fetch failed"||s.toLowerCase()==="failed to fetch"||s.toLowerCase().includes("networkerror")||s.toLowerCase().includes("network")&&s.toLowerCase().includes("failed"))){const a=new Error("[[error:no-connection]]");a.originalError=n,n=a}t(n)});return}try{return await u(r)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:n}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",s=>{s&&ajaxify.go(n)})}throw e}}async function u(r){const{url:t}=r;delete r.url,r.headers||(r.headers={}),r.data&&!(r.data instanceof FormData)&&(r.data=JSON.stringify(r.data||{}),r.headers["content-type"]="application/json; charset=utf-8");try{({options:r}=await(0,f.fire)("filter:api.options",{options:r}))}catch(o){console.error("[API] Error in filter:api.options hook:",o)}r.data&&(r.body=r.data,delete r.data);let e;try{e=await fetch(t,r)}catch(o){const E=o.message||o.toString()||String(o),x=o.name||"Error";if(x==="TypeError"&&(E.toLowerCase().includes("fetch")||E.toLowerCase().includes("network")||E.toLowerCase().includes("failed to fetch")||E.toLowerCase().includes("load failed"))||E.toLowerCase().includes("cors")||E.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:r.method||"GET",error:E,name:x});const T=new Error("[[error:no-connection]]");throw T.originalError=o,T}throw console.error("[API] Unexpected fetch error:",{url:t,method:r.method||"GET",error:E,name:x}),o}const{headers:n}=e;if(n.get("x-redirect"))return u({url:n.get("x-redirect"),...r});const s=n.get("content-type"),l=s&&s.startsWith("application/json");let a;if(r.method!=="HEAD")try{l?a=await e.json():a=await e.text()}catch(o){throw console.error("[API] Error parsing response:",{url:t,status:e.status,statusText:e.statusText,contentType:s,error:o.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let o;throw a?l&&a.status&&a.status.message?o=a.status.message:typeof a=="string"?o=a:o=e.statusText||"Request failed":o=e.statusText||"Request failed",new Error(o)}return l&&a&&a.hasOwnProperty("status")&&a.hasOwnProperty("response")?a.response:a}function d(r,t,e){return c({url:r+(t&&Object.keys(t).length?"?"+$.param(t):"")},e)}function y(r,t,e){return c({url:r+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},e)}function p(r,t,e){return c({url:r,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function h(r,t,e){return c({url:r,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function g(r,t,e){return c({url:r,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function A(r,t,e){return c({url:r,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
