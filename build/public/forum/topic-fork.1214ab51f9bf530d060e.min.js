"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,38395,49771,49897,69185,86198,95431,99127],{16227:(A,w,d)=>{var E,m;E=[d(52473)],m=function(k){const c={};let C;c.pids=[];let p=!1;c.init=function(n,i){c.pids.length=0,C=n,i=i||{},p=i.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',f),a()};function f(n){n.stopPropagation();const i=$(this).attr("data-pid"),u=$('[component="topic"] [data-pid="'+i+'"]');!p&&parseInt($(this).attr("data-index"),10)===0||c.togglePostSelection(u,i)}c.disable=function(){c.pids.forEach(function(n){k.get("post","pid",n).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',f),h()},c.togglePostSelection=function(n,i){if(i){const u=c.pids.indexOf(i);u===-1?(c.pids.push(i),n.toggleClass("selected",!0)):(c.pids.splice(u,1),n.toggleClass("selected",!1)),c.pids.length&&c.pids.sort(function(t,o){return t-o}),typeof C=="function"&&C()}};function e(){return!1}function a(){$("#content").on("click",'[component="post"] button, [component="post"] a',e)}function h(){$("#content").off("click",'[component="post"] button, [component="post"] a',e)}return c}.apply(w,E),m!==void 0&&(A.exports=m)},49771:(A,w,d)=>{var E,m;E=[d(52473),d(16227),d(29930),d(65348)],m=function(k,c,C,p){const f={};let e,a,h,n;f.init=function(){h=ajaxify.data.tid,n=ajaxify.data.category,$(window).off("action:ajaxify.end",i).on("action:ajaxify.end",i),!e&&app.parseAndTranslate("modals/fork-topic",{selectedCategory:n},function(s){e=s,a=e.find("#fork_thread_commit"),$("body").append(e);const l=e.find('[component="category-selector"]');l.addClass("dropup"),p.init(l,{onSelect:function(P){n=P},privilege:"moderate"}),e.find("#fork_thread_cancel").on("click",r),e.find("#fork-title").on("keyup",o),c.init(function(){o(),t()}),t(),a.on("click",u)})};function i(){(ajaxify.data.template.name!=="topic"||ajaxify.data.tid!==h)&&(r(),$(window).off("action:ajaxify.end",i))}function u(){n&&(a.attr("disabled",!0),socket.emit("topics.createTopicFromPosts",{title:e.find("#fork-title").val(),pids:c.pids,fromTid:h,cid:n.cid},function(s,l){function P(g){k.get("post","pid",g).fadeOut(500,function(){$(this).remove()})}if(a.removeAttr("disabled"),s)return C.error(s.message);C.alert({timeout:5e3,title:"[[global:alert.success]]",message:"[[topic:fork-success]]",type:"success",clickfn:function(){ajaxify.go("topic/"+l.slug)}}),c.pids.forEach(function(g){P(g)}),r()}))}function t(){c.pids.length?e.find("#fork-pids").translateHtml("[[topic:fork-pid-count, "+c.pids.length+"]]"):e.find("#fork-pids").translateHtml("[[topic:fork-no-pids]]")}function o(){e.find("#fork-title").val().length&&c.pids.length?a.removeAttr("disabled"):a.attr("disabled",!0)}function r(){e&&(e.remove(),e=null,c.disable())}return f}.apply(w,E),m!==void 0&&(A.exports=m)},49897:(A,w,d)=>{d.r(w),d.d(w,{del:()=>u,get:()=>e,head:()=>a,patch:()=>n,post:()=>h,put:()=>i});var E=d(91749),m=d.n(E),k=d(33530),c=d.n(k);const C=config.relative_path+"/api/v3";async function p(t,o){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:C+t.url,typeof o=="function"){f(t).then(r=>o(null,r),r=>{let s=r;r instanceof Error||(s=new Error(String(r)));const l=s.message||String(s);if(l&&!l.startsWith("[[error:")&&(l.toLowerCase()==="fetch failed"||l.toLowerCase()==="failed to fetch"||l.toLowerCase().includes("networkerror")||l.toLowerCase().includes("network")&&l.toLowerCase().includes("failed"))){const g=new Error("[[error:no-connection]]");g.originalError=s,s=g}o(s)});return}try{return await f(t)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,k.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(s)})}throw r}}async function f(t){const{url:o}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,E.fire)("filter:api.options",{options:t}))}catch(y){console.error("[API] Error in filter:api.options hook:",y)}t.data&&(t.body=t.data,delete t.data);let r;try{r=await fetch(o,t)}catch(y){const x=y.message||y.toString()||String(y),v=y.name||"Error";if(v==="TypeError"&&(x.toLowerCase().includes("fetch")||x.toLowerCase().includes("network")||x.toLowerCase().includes("failed to fetch")||x.toLowerCase().includes("load failed"))||x.toLowerCase().includes("cors")||x.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:o,method:t.method||"GET",error:x,name:v});const D=new Error("[[error:no-connection]]");throw D.originalError=y,D}throw console.error("[API] Unexpected fetch error:",{url:o,method:t.method||"GET",error:x,name:v}),y}const{headers:s}=r;if(s.get("x-redirect"))return f({url:s.get("x-redirect"),...t});const l=s.get("content-type"),P=l&&l.startsWith("application/json");let g;if(t.method!=="HEAD")try{P?g=await r.json():g=await r.text()}catch(y){throw console.error("[API] Error parsing response:",{url:o,status:r.status,statusText:r.statusText,contentType:l,error:y.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let y;throw g?P&&g.status&&g.status.message?y=g.status.message:typeof g=="string"?y=g:y=r.statusText||"Request failed":y=r.statusText||"Request failed",new Error(y)}return P&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function e(t,o,r){return p({url:t+(o&&Object.keys(o).length?"?"+$.param(o):"")},r)}function a(t,o,r){return p({url:t+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"HEAD"},r)}function h(t,o,r){return p({url:t,method:"POST",data:o,headers:{"x-csrf-token":config.csrf_token}},r)}function n(t,o,r){return p({url:t,method:"PATCH",data:o,headers:{"x-csrf-token":config.csrf_token}},r)}function i(t,o,r){return p({url:t,method:"PUT",data:o,headers:{"x-csrf-token":config.csrf_token}},r)}function u(t,o,r){return p({url:t,method:"DELETE",data:o,headers:{"x-csrf-token":config.csrf_token}},r)}},65348:(A,w,d)=>{var E,m;E=[d(96349),d(33530),d(91749),d(17459)],m=function(k,c,C,p){const f={};return f.init=function(e,a){if(!e||!e.length)return;a=a||{};const h=a.onSelect||function(){};a.states=a.states||["watching","tracking","notwatching","ignoring"],a.template=a.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:e,options:a}),k.init(e,a);const n={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const u=$(this);return u.hasClass("disabled")?!1:(n.selectCategory(u.attr("data-cid")),h(n.selectedCategory))});let i=n.el.find('[component="category-selector-selected"]').html();return p.translate(i,u=>{i=u}),n.selectCategory=function(u){const t=n.el.find('[data-cid="'+u+'"]');n.selectedCategory={cid:u,name:t.attr("data-name")},t.length?n.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(i)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},a.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(a.template,{selectedCategory:a.selectedCategory},function(u){n.el.find('[component="category-selector-selected"]').html(u.find('[component="category-selector-selected"]').html())}),n},f.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(a){const h=c.dialog({title:e.title||"[[modules:composer.select-category]]",message:a,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:i}}}),n=f.init(h.find('[component="category-selector"]'),e);function i(u){return u.preventDefault(),n.selectedCategory&&(e.onSubmit(n.selectedCategory),h.modal("hide")),!1}e.openOnLoad&&h.on("shown.bs.modal",function(){h.find(".dropdown-toggle").dropdown("toggle")}),h.find("form").on("submit",i)})},f}.apply(w,E),m!==void 0&&(A.exports=m)},96349:(A,w,d)=>{var E,m;E=[d(29930),d(89336),d(49897)],m=function(k,c,C){const p={};return p.init=function(f,e){let a=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let h=[];Array.isArray(e.localCategories)&&(h=e.localCategories.map(o=>({...o})),a&&(a=[...h,...a])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const n=f.find('[component="category-selector-search"]');if(!n.length)return;const i=n.parents('[component="category/dropdown"]').length>0||n.parents('[component="category-selector"]').length>0;f.on("show.bs.dropdown",function(){i&&n.removeClass("hidden");function o(){const r=n.find("input").val();r.length>1||!r&&!a?u(r,function(s){a=e.cacheList&&(a||s),t(s)}):!r&&a&&t(a)}n.on("click",function(r){r.preventDefault(),r.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(o,300)),o()}),f.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),f.on("hide.bs.dropdown",function(){i&&n.addClass("hidden"),n.off("click"),n.find("input").off("keyup")});function u(o,r){C.get("/search/categories",{search:o,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(s,{categories:l}){if(s)return k.error(s);r(h.concat(l))})}function t(o){const r=e.selectedCids.map(String);o.forEach(function(s){s.selected=r.includes(String(s.cid))}),app.parseAndTranslate(e.template,{categoryItems:o.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){f.find('[component="category/list"]').html(s.find('[component="category/list"]').html()),f.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!o.length);const l=c.Dropdown.getInstance(f.find(".dropdown-toggle").get(0));l&&l.update()})}},p}.apply(w,E),m!==void 0&&(A.exports=m)}}]);
