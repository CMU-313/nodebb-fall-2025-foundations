"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,26174,26874,34271,49897,99127],{13230:(D,y,u)=>{var d,m,p;(function(w){m=[u(53050)],d=w,p=typeof d=="function"?d.apply(y,m):d,p!==void 0&&(D.exports=p)})(function(w){const A=w("[^\\p{L}\\s\\d\\-_@.]","g"),h=/[^\w\s\d\-_@.]/g,g=/^\s+|\s+$/g,n=/\s+/g,a=/-+/g,_=/-$/g,f=/^-/g,k=/^[\w\d\s.,\-@]+$/;return function(e,r){return e?(e=String(e).replace(g,""),k.test(e)?e=e.replace(h,"-"):e=w.replace(e,A,"-"),e=r?e:e.toLocaleLowerCase(),e=e.replace(n,"-"),e=e.replace(a,"-"),e=e.replace(_,""),e=e.replace(f,""),e):""}})},49897:(D,y,u)=>{u.r(y),u.d(y,{del:()=>C,get:()=>n,head:()=>a,patch:()=>f,post:()=>_,put:()=>k});var d=u(91749),m=u.n(d),p=u(33530),w=u.n(p);const A=config.relative_path+"/api/v3";async function h(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:A+e.url,typeof r=="function"){g(e).then(t=>r(null,t),t=>{let i=t;t instanceof Error||(i=new Error(String(t)));const s=i.message||String(i);if(s&&!s.startsWith("[[error:")&&(s.toLowerCase()==="fetch failed"||s.toLowerCase()==="failed to fetch"||s.toLowerCase().includes("networkerror")||s.toLowerCase().includes("network")&&s.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=i,i=o}r(i)});return}try{return await g(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,d.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",s=>{s&&ajaxify.go(i)})}throw t}}async function g(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,d.fire)("filter:api.options",{options:e}))}catch(c){console.error("[API] Error in filter:api.options hook:",c)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(c){const E=c.message||c.toString()||String(c),T=c.name||"Error";if(T==="TypeError"&&(E.toLowerCase().includes("fetch")||E.toLowerCase().includes("network")||E.toLowerCase().includes("failed to fetch")||E.toLowerCase().includes("load failed"))||E.toLowerCase().includes("cors")||E.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:E,name:T});const L=new Error("[[error:no-connection]]");throw L.originalError=c,L}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:E,name:T}),c}const{headers:i}=t;if(i.get("x-redirect"))return g({url:i.get("x-redirect"),...e});const s=i.get("content-type"),l=s&&s.startsWith("application/json");let o;if(e.method!=="HEAD")try{l?o=await t.json():o=await t.text()}catch(c){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:s,error:c.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let c;throw o?l&&o.status&&o.status.message?c=o.status.message:typeof o=="string"?c=o:c=t.statusText||"Request failed":c=t.statusText||"Request failed",new Error(c)}return l&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function n(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function a(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function _(e,r,t){return h({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function f(e,r,t){return h({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function k(e,r,t){return h({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function C(e,r,t){return h({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}},64308:(D,y,u)=>{var d,m;d=[u(49897),u(91749),u(13230),u(81335)],m=function(p,w,A,h){const g={};return g.init=function(n,a){if(!n||!n.length)return;a=a||{};let _,f=[];a.selectedUsers&&(f=a.selectedUsers.map(r=>({...r}))),w.fire("action:user.filter.options",{el:n,options:a});async function k(){const r=a.selectedBlock||"userFilterSelected",t={};if(r.indexOf(".")!==-1){const s=r.split(".");t[s[0]]={},t[s[0]][s[1]]=f}else t[r]=f;const i=await app.parseAndTranslate(a.template,r,t);n.find('[component="user/filter/selected"]').html(i)}async function C(){await k(),a.onSelect&&a.onSelect(f)}async function e(){let r={users:[]};const t=n.find('[component="user/filter/search"]').val();if(t&&t.length>1)if(app.user.privileges["search:users"])r=await p.get("/api/users",{query:t});else try{const l=await p.get(`/api/user/${A(t)}`);r.users.push(l)}catch(l){console.error(l)}if(!r.users.length){n.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}r.users=r.users.slice(0,20);const i={};r.users.forEach(l=>{i[l.uid]=l});const s=await app.parseAndTranslate(a.template,"userFilterResults",{userFilterResults:r.users});n.find('[component="user/filter/results"]').html(s),n.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const l=parseInt($(this).attr("data-uid"),10);f.find(o=>o.uid===l)||(f.push(i[l]),await C())})}n.find('[component="user/filter/search"]').on("keyup",()=>{n.find('[component="user/filter/results"]').html(_)}),n.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),n.on("click",'[component="user/filter/delete"]',async function(){const r=$(this).attr("data-uid");f=f.filter(t=>parseInt(t.uid,10)!==parseInt(r,10)),await C()}),n.find('[component="user/filter/search"]').on("keyup",r=>{r.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),n.on("shown.bs.dropdown",function(){n.find('[component="user/filter/search"]').trigger("focus")}),n.on("hidden.bs.dropdown",function(){a.onHidden&&a.onHidden(f)}),h.render(a.placeholderTemplate||"partials/userFilter-placeholders").then(r=>{_=r})},g}.apply(y,d),m!==void 0&&(D.exports=m)}}]);
