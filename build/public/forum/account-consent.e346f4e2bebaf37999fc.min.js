(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,15587,97082],{18675:()=>{(function(g){var v=g(window),c=function(t,o,n,e){if(arguments.length===3||e){if(n<t)return t;if(n>o)return o}return n},h=function(t){t.clientX=t.originalEvent.touches[0].clientX,t.clientY=t.originalEvent.touches[0].clientY},f=function(t){var o=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(o){var n={width:0,height:0},e=new Image;return e.onload=function(){if(t.css("background-size")=="cover"){var i=t.innerWidth(),a=t.innerHeight(),u=i/a,s=e.width/e.height,r=1;s>=u?r=a/e.height:r=i/e.width,n.width=e.width*r,n.height=e.height*r}else n.width=e.width,n.height=e.height},e.src=o,n}};function p(t,o){this.element=t,this.options=o,this.init()}p.prototype.init=function(){var t=g(this.element),o=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],n=this.options;if(o){var e={width:0,height:0};(n.bound||n.units=="percent")&&(e=f(t)),g(window).on("keydown.dbg",i=>{var a=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],u=parseInt(a[1])||0,s=parseInt(a[2])||0;n.units=="percent"&&(u=Math.round(u/-200*e.width),s=Math.round(s/-200*e.height));var r=0,l=0;return i.which===37?r=-5:i.which===39?r=5:i.which===38?l=-5:i.which===40&&(l=5),n.units==="percent"?(u=n.axis==="y"?u:c(-e.width/2,0,u+r,n.bound),s=n.axis==="x"?s:c(-e.height/2,0,s+l,n.bound),t.css("background-position",u/e.width*-200+"% "+s/e.height*-200+"%")):(u=n.axis==="y"?u:c(t.innerWidth()-e.width,0,u+r,n.bound),s=n.axis==="x"?s:c(t.innerHeight()-e.height,0,s+l,n.bound)),[37,38,39,40].includes(i.which)?!1:void 0}),t.on("mousedown.dbg touchstart.dbg",function(i){if(i.target===t[0]){if(i.preventDefault(),i.originalEvent.touches)h(i);else if(i.which!==1)return;var a=i.clientX,u=i.clientY,s=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],r=parseInt(s[1])||0,l=parseInt(s[2])||0;n.units=="percent"&&(r=Math.round(r/-200*e.width),l=Math.round(l/-200*e.height)),v.on("mousemove.dbg touchmove.dbg",function(y){y.preventDefault(),y.originalEvent.touches&&h(y);var x=y.clientX,E=y.clientY;n.units=="percent"?(r=n.axis==="y"?r:c(-e.width/2,0,r+x-a,n.bound),l=n.axis==="x"?l:c(-e.height/2,0,l+E-u,n.bound),t.css("background-position",r/e.width*-200+"% "+l/e.height*-200+"%")):(r=n.axis==="y"?r:c(t.innerWidth()-e.width,0,r+x-a,n.bound),l=n.axis==="x"?l:c(t.innerHeight()-e.height,0,l+E-u,n.bound),t.css("background-position",r+"px "+l+"px")),a=x,u=E}),v.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){n.done&&n.done(),v.off("mousemove.dbg touchmove.dbg"),v.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},p.prototype.disable=function(){var t=g(this.element);t.off("mousedown.dbg touchstart.dbg"),v.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},g.fn.backgroundDraggable=function(t){var o=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=g(this),e;typeof t>"u"||typeof t=="object"?(t=g.extend({},g.fn.backgroundDraggable.defaults,t),e=new p(this,t),n.data("dbg",e)):typeof t=="string"&&n.data("dbg")&&(e=n.data("dbg"),p.prototype[t].apply(e,o))})},g.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(g,v,c)=>{"use strict";var h,f;h=[c(81335),c(49897),c(33530),c(29930)],f=function(p,t,o,n){const e={};e.banAccount=function(a,u){a=a||ajaxify.data.theirid,i({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(s){const r=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;t.put("/users/"+a+"/ban",{until:r,reason:s.reason||""}).then(()=>{if(typeof u=="function")return u();ajaxify.refresh()}).catch(n.error)}})},e.unbanAccount=function(a){i({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(u){t.del("/users/"+a+"/ban",{reason:u.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})},e.muteAccount=function(a,u){a=a||ajaxify.data.theirid,i({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(s){const r=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;t.put("/users/"+a+"/mute",{until:r,reason:s.reason||""}).then(()=>{if(typeof u=="function")return u();ajaxify.refresh()}).catch(n.error)}})},e.unmuteAccount=function(a){i({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(u){t.del("/users/"+a+"/mute",{reason:u.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})};function i(a){p.render(a.tpl,{}).then(function(u){const s=o.dialog({title:a.title,message:u,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:a.title,callback:function(){const r=s.find("form").serializeArray().reduce(function(l,y){return l[y.name]=y.value,l},{});a.onSubmit(r)}}}})})}return e}.apply(v,h),f!==void 0&&(g.exports=f)},36684:(g,v,c)=>{"use strict";var h,f;h=[c(29930),c(18675)],f=function(p){const t={coverEl:null,saveFn:null};t.init=function(n,e,i,a){t.coverEl=n,t.saveFn=e,n.find(".upload").on("click",i),n.find(".resize").on("click",function(){o(n)}),n.find(".remove").on("click",a),n.on("dragover",t.onDragOver).on("drop",t.onDrop),n.find(".save").on("click",t.save),n.addClass("initialised")},t.onDragOver=function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"},t.onDrop=function(n){n.stopPropagation(),n.preventDefault();const e=n.originalEvent.dataTransfer.files,i=new FileReader;e.length&&e[0].type.match("image.*")&&(i.onload=function(a){t.coverEl.css("background-image","url("+a.target.result+")"),t.newCover=a.target.result},i.readAsDataURL(e[0]),o(t.coverEl))};function o(n){n.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),p.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return t.save=function(){t.coverEl.addClass("saving"),t.saveFn(t.newCover||void 0,t.coverEl.css("background-position"),function(n){n?p.error(n):(t.coverEl.toggleClass("active",0),t.coverEl.backgroundDraggable("disable"),t.coverEl.off("dragover",t.onDragOver),t.coverEl.off("drop",t.onDrop),p.success("[[modules:cover.saved]]")),t.coverEl.removeClass("saving")})},t}.apply(v,h),f!==void 0&&(g.exports=f)},47283:(g,v,c)=>{"use strict";var h,f;h=[c(49897),c(33530),c(29930)],f=function(p,t,o){const n={};n.account=function(i,a){e(i,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",a)},n.content=function(i,a){e(i,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",a)},n.purge=function(i,a){e(i,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",a)};function e(i,a,u,s,r){t.confirm(a,function(l){l&&p.del(`/users/${encodeURIComponent(i)}${u}`,{}).then(()=>{if(o.success(s),typeof r=="function")return r()}).catch(o.error)})}return n}.apply(v,h),f!==void 0&&(g.exports=f)},67910:(g,v,c)=>{"use strict";var h,f;h=[c(36684),c(72254),c(52473),c(17459),c(47283),c(28061),c(7524),c(49897),c(33530),c(29930)],f=function(p,t,o,n,e,i,a,u,s,r){const l={};let y;l.init=function(){y=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,x(),E(),y&&w(),o.get("account/follow").on("click",()=>A("follow")),o.get("account/unfollow").on("click",()=>A("unfollow")),o.get("account/chat").on("click",async function(){const{roomId:d}=await u.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),m=await app.require("chat");d?m.openChat(d):m.newChat(ajaxify.data.uid)}),o.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){o.get("account/chat").parent().removeClass("hidden")})}),o.get("account/ban").on("click",()=>i.banAccount(ajaxify.data.theirid)),o.get("account/mute").on("click",()=>i.muteAccount(ajaxify.data.theirid)),o.get("account/unban").on("click",()=>i.unbanAccount(ajaxify.data.theirid)),o.get("account/unmute").on("click",()=>i.unmuteAccount(ajaxify.data.theirid)),o.get("account/delete-account").on("click",()=>e.account(ajaxify.data.theirid)),o.get("account/delete-content").on("click",()=>e.content(ajaxify.data.theirid)),o.get("account/delete-all").on("click",()=>e.purge(ajaxify.data.theirid)),o.get("account/flag").on("click",D),o.get("account/already-flagged").on("click",k),o.get("account/block").on("click",()=>C("block")),o.get("account/unblock").on("click",()=>C("unblock"))};function x(){$(".account-sub-links li a").removeClass("active").each(function(){const d=$(this).attr("href");if(decodeURIComponent(d)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function E(){$('[component="profile/change/picture"]').on("click",function(){return a.openChangeModal(),!1})}function w(){p.init(o.get("account/cover"),function(d,m,b){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:d,position:m},b)},function(){t.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(d){d=(d.startsWith("http")?"":config.relative_path)+d+"?"+Date.now(),o.get("account/cover").css("background-image","url("+d+")")})},j)}function A(d){const m=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return u[d==="follow"?"put":"del"]("/users/"+m+"/follow",void 0,function(b){if(b)return r.error(b);o.get("account/follow").toggleClass("hide",d==="follow"),o.get("account/unfollow").toggleClass("hide",d==="unfollow"),r.success("[[global:alert."+d+", "+ajaxify.data.username+"]]")}),!1}function D(){c.e(6574).then(function(){var d=[c(6574)];(function(m){m.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,d)}).catch(c.oe)}function k(){const d=$(this).data("flag-id");c.e(6574).then(function(){var m=[c(6574)];(function(b){s.confirm("[[flags:modal-confirm-rescind]]",function(R){R&&b.rescind(d)})}).apply(null,m)}).catch(c.oe)}function C(d){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:d},function(m,b){if(m)return r.error(m);o.get("account/block").toggleClass("hidden",b),o.get("account/unblock").toggleClass("hidden",!b)}),!1}function j(){n.translate("[[user:remove-cover-picture-confirm]]",function(d){s.confirm(d,function(m){m&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(b){b?r.error(b):ajaxify.refresh()})})})}return l}.apply(v,h),f!==void 0&&(g.exports=f)},84485:(g,v,c)=>{"use strict";var h,f;h=[c(67910),c(29930),c(49897)],f=function(p,t,o){const n={};return n.init=function(){p.init(),$('[data-action="consent"]').on("click",function(){socket.emit("user.gdpr.consent",{},function(i){if(i)return t.error(i);ajaxify.refresh()})}),e($('[data-action="export-profile"]'),"profile","[[user:consent.export-profile-success]]"),e($('[data-action="export-posts"]'),"posts","[[user:consent.export-posts-success]]"),e($('[data-action="export-uploads"]'),"uploads","[[user:consent.export-uploads-success]]");function e(i,a,u){i.on("click",function(){o.post(`/users/${ajaxify.data.uid}/exports/${a}`).then(()=>{t.success(u)}).catch(t.error)})}},n}.apply(v,h),f!==void 0&&(g.exports=f)}}]);
