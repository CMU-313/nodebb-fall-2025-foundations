(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,6232,25764,33069,33085,34271,49897,50350,69185,86198,99127],{13342:(C,A,g)=>{C.exports=g(41644)},14063:(C,A,g)=>{"use strict";C=g.nmd(C);var E,y;E=[g(17459),g(91749)],y=function(w,v){const r={};let s=!1;r.init=function(){if(r.taskbar=$('[component="taskbar"]'),r.tasklist=r.taskbar.find("ul"),!r.taskbar.length||!r.tasklist.length){s=!0;return}r.taskbar.on("click","li",async function(){const e=$(this),a=e.attr("data-module"),i=e.attr("data-uuid"),t=await app.require(a);return e.hasClass("active")?t.minimize(i):(n(),t.load(i),r.toggleNew(i,!1),r.tasklist.removeClass("active"),e.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){r.closeAll()})},r.close=async function(e,a){if(s)return;if(r.tasklist.find('[data-module="'+C+'"][data-uuid="'+a+'"]').length){const t=await app.require(e);t&&typeof t.close=="function"&&t.close(a)}},r.closeAll=function(e){if(s)return;let a="[data-uuid]";e&&(a='[data-module="'+e+'"]'+a),r.tasklist.find(a).each(function(i,t){r.close(e||t.getAttribute("data-module"),t.getAttribute("data-uuid"))})},r.discard=function(e,a){if(s)return;r.tasklist.find('[data-module="'+e+'"][data-uuid="'+a+'"]').remove(),c()},r.push=function(e,a,i,t){if(t=t||function(){},s)return t();const l=r.tasklist.find('li[data-uuid="'+a+'"]'),d={module:e,uuid:a,options:i,element:l};v.fire("filter:taskbar.push",d),!l.length&&d.module?o(d,t):t(l)},r.get=function(e){return s?[]:$('[data-module="'+e+'"]').map(function(i,t){return $(t).data()})},r.minimize=function(e,a){if(s)return;r.tasklist.find('[data-module="'+e+'"][data-uuid="'+a+'"]').toggleClass("active",!1)},r.toggleNew=function(e,a,i){if(s)return;r.tasklist.find('[data-uuid="'+e+'"]').toggleClass("new",a),i||v.fire("action:taskbar.toggleNew",e)},r.updateActive=function(e){if(s)return;const a=r.tasklist.find("li");a.removeClass("active"),a.filter('[data-uuid="'+e+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+e+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},r.isActive=function(e){return s?!1:r.tasklist.find('li[data-uuid="'+e+'"]').hasClass("active")};function c(){if(s)return;r.tasklist.find("li").length>0?r.taskbar.attr("data-active","1"):r.taskbar.removeAttr("data-active")}function n(){s||r.tasklist.find(".active").removeClass("active")}function o(e,a){if(s)return a();w.translate(e.options.title,function(i){const t=$("<div></div>").text(i||"NodeBB Task").html(),l=$("<li></li>").addClass(e.options.className).html('<a href="#"'+(e.options.image?` style="background-image: url('`+e.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(e.options.icon?'<i class="fa '+e.options.icon+'"></i> ':"")+'<span aria-label="'+t+'" component="taskbar/title">'+t+"</span></a>").attr({title:t,"data-module":e.module,"data-uuid":e.uuid}).addClass(e.options.state!==void 0?e.options.state:"active");(!e.options.state||e.options.state==="active")&&n(),r.tasklist.append(l),c(),e.element=l,l.data(e),v.fire("action:taskbar.pushed",e),a(l)})}const h=function(e,a,i){switch(a){case"title":e.find('[component="taskbar/title"]').text(i);break;case"icon":e.find("i").attr("class","fa fa-"+i);break;case"image":e.find("a").css("background-image",i?'url("'+i.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":e.find("a").css("background-color",i);break;case"color":e.find("a").css("color",i);break}};return r.update=function(e,a,i){if(s)return;const t=r.tasklist.find('[data-module="'+e+'"][data-uuid="'+a+'"]');if(!t.length)return;const l=t.data();Object.keys(i).forEach(function(d){l[d]=i[d],h(t,d,i[d])}),t.data(l)},r}.apply(A,E),y!==void 0&&(C.exports=y)},31494:(C,A,g)=>{C.exports=g(36244)},36244:(C,A,g)=>{"use strict";var E,y;E=[g(89596),g(13342),g(17459),g(29930),g(43103),g(64061)],y=function(w,v,r,s,c){var n={inProgress:{}},o="";n.initialize=function(p){i(p),t(p),h(p),e(p),r.translate("[[modules:composer.uploading, 0%]]",function(u){o=u})};function h(p){var u=$('.composer[data-uuid="'+p+'"]');u.find("#files").on("change",function(f){var k=(f.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);k&&m({files:k,post_uuid:p,route:"/api/post/upload"})})}function e(p){var u=$('.composer[data-uuid="'+p+'"]');u.on("click",".topic-thumb-clear-btn",function(f){u.find("input#topic-thumb-url").val("").trigger("change"),a(u.find("input#topic-thumb-file")),$(this).addClass("hide"),f.preventDefault()}),u.on("paste change keypress","input#topic-thumb-url",function(){var f=$(this);setTimeout(function(){var k=f.val();k?u.find(".topic-thumb-clear-btn").removeClass("hide"):(a(u.find("input#topic-thumb-file")),u.find(".topic-thumb-clear-btn").addClass("hide")),u.find("img.topic-thumb-preview").attr("src",k)},100)})}function a(p){p.wrap("<form />").closest("form").get(0).reset(),p.unwrap()}function i(p){var u=$('.composer[data-uuid="'+p+'"]');c.handleDragDrop({container:u,callback:function(f){m({files:f.files,post_uuid:p,route:"/api/post/upload",formData:f.formData})}})}function t(p){var u=$('.composer[data-uuid="'+p+'"]');c.handlePaste({container:u,callback:function(f){m({files:f.files,fileNames:f.fileNames,post_uuid:p,route:"/api/post/upload",formData:f.formData})}})}function l(p){return p.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function d(p,u,f){return p.slice(0,u)+f+p.slice(u)}function m(p){var u=[...p.files],f=p.post_uuid,k=$('.composer[data-uuid="'+f+'"]'),T=k.find("textarea"),N=T.val(),L=k.find("#fileForm"),B=!1;L.attr("action",config.relative_path+p.route);var O=v.getSelectedCid();!O&&ajaxify.data.cid&&(O=ajaxify.data.cid);var x=0,F=!1;for(x=0;x<u.length;++x)if(F=u[x].type.match(/image./),F&&!app.user.privileges["upload:post:image"]||!F&&!app.user.privileges["upload:post:file"])return s.error("[[error:no-privileges]]");var _=[];let U="";for(x=0;x<u.length;++x){if(_.push(x+"_"+Date.now()+"_"+(p.fileNames?p.fileNames[x]:u[x].name)),F=u[x].type.match(/image./),!app.user.isAdmin&&u[x].size>parseInt(config.maximumFileSize,10)*1024)return L[0].reset(),s.error("[[error:file-too-big, "+config.maximumFileSize+"]]");U+=(F?"!":"")+"["+_[x]+"]("+o+") "}const W=T.getCursorPosition(),K=N.length;N=d(N,W,U),L.length&&k.find('[data-action="post"]').prop("disabled",!0),T.val(N),$(window).trigger("action:composer.uploadStart",{post_uuid:f,files:_.map(function(I,P){return{filename:I.replace(/^\d+_\d{13}_/,""),isImage:/image./.test(u[P].type)}}),text:o}),L.off("submit").submit(function(){function I(P,S,D){var M;D&&(M=P.replace(/^\d+_\d{13}_/,""));var j=T.val(),R=new RegExp(l(P)+"]\\([^)]+\\)","g");T.val(j.replace(R,(M||P)+"]("+S+")")),$(window).trigger("action:composer.uploadUpdate",{post_uuid:f,filename:P,text:S})}return n.inProgress[f]=n.inProgress[f]||[],n.inProgress[f].push(1),p.formData&&p.formData.append("cid",O),$(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:p.formData,data:{cid:O},error:function(P){B=!0,k.find('[data-action="post"]').prop("disabled",!1);const S=b(P,f);for(var D=0;D<u.length;++D)I(_[D],S,!0);w.render(k)},uploadProgress:function(P,S,D,M){r.translate("[[modules:composer.uploading, "+M+"%]]",function(j){if(!B)for(var R=0;R<u.length;++R)I(_[R],j)})},success:function(P){const S=P.response.images;if(B=!0,S&&S.length)for(var D=0;D<S.length;++D)S[D].filename=_[D].replace(/^\d+_\d{13}_/,""),S[D].isImage=/image./.test(u[D].type),I(_[D],S[D].url,!0);w.render(k),T.prop("selectionEnd",W+T.val().length-K),T.focus(),k.find('[data-action="post"]').prop("disabled",!1),$(window).trigger("action:composer.upload",{post_uuid:f,files:S})},complete:function(){L[0].reset(),n.inProgress[f].pop()}}),!1}),L.submit()}function b(p,u){var f=p.responseJSON&&(p.responseJSON.error||p.responseJSON.status&&p.responseJSON.status.message)||"[[error:parse-error]]";return p&&p.status===413&&(f=p.statusText||"Request Entity Too Large"),s.error(f),$(window).trigger("action:composer.uploadError",{post_uuid:u,message:f}),f}return n}.apply(A,E),y!==void 0&&(C.exports=y)},41644:(C,A,g)=>{"use strict";var E,y;E=[g(65348),g(14063),g(49897)],y=function(w,v,r){var s={},c;s.init=function(e,a){var i=e.find(".category-list-container");i.length&&(e.on("action:composer.resize",function(){n(e)}),s.updateTaskbar(e,a),c=w.init(i.find('[component="category-selector"]'),{privilege:"topics:create",states:["watching","tracking","notwatching","ignoring"],onSelect:function(t){a.hasOwnProperty("cid")&&h(e,a,t)}}),c&&(a.cid&&a.category?c.selectedCategory={cid:a.cid,name:a.category.name}:ajaxify.data.template.compose&&ajaxify.data.selectedCategory&&(c.selectedCategory={cid:ajaxify.data.cid,name:ajaxify.data.selectedCategory}),e.find(".category-name").translateHtml(c.selectedCategory?c.selectedCategory.name:"[[modules:composer.select-category]]").on("click",function(){w.modal({privilege:"topics:create",states:["watching","tracking","notwatching","ignoring"],openOnLoad:!0,showLinks:!1,onSubmit:function(t){e.find(".category-name").text(t.name),c.selectCategory(t.cid),a.hasOwnProperty("cid")&&h(e,a,t)}})}),n(e)))};function n(e){e.find('.category-list-container [component="category-selector"]').toggleClass("dropup",e.outerHeight()<$(window).height()/2)}s.getSelectedCid=function(){var e;return c&&(e=c.getSelectedCategory()),e?e.cid:0},s.updateTaskbar=function(e,a){parseInt(a.cid,10)&&r.get(`/categories/${a.cid}`,{}).then(function(i){o(e,i)})};function o(e,a){if(a){var i=e.attr("data-uuid");v.update("composer",i,{image:a.backgroundImage,color:a.color,"background-color":a.bgColor,icon:a.icon&&a.icon.slice(3)})}}async function h(e,a,i){a.cid=i.cid;const t=await window.fetch(`${config.relative_path}/api/category/${encodeURIComponent(i.cid)}`).then(l=>l.json());a.category=t,o(e,t),g.e(56382).then(function(){var l=[g(72573),g(52543),g(92762)];(function(d,m,b){d.onChangeCategory(t),m.onChangeCategory(e,a,i.cid,t),b.onChangeCategory(e,a),$(window).trigger("action:composer.changeCategory",{postContainer:e,postData:a,selectedCategory:i,categoryData:t})}).apply(null,l)}).catch(g.oe)}return s}.apply(A,E),y!==void 0&&(C.exports=y)},43103:(C,A,g)=>{"use strict";var E,y;E=[g(29930)],y=function(w){const v={};return v.init=function(r){const s=r.uploadFormEl;if(s.length&&(s.attr("action",config.relative_path+r.route),r.dragDropAreaEl&&v.handleDragDrop({container:r.dragDropAreaEl,callback:function(c){v.ajaxSubmit({uploadForm:s,upload:c,callback:r.callback})}}),r.pasteEl&&v.handlePaste({container:r.pasteEl,callback:function(c){v.ajaxSubmit({uploadForm:s,upload:c,callback:r.callback})}}),r.uploadBtnEl)){const c=s.find('input[name="files[]"]');r.uploadBtnEl.on("click",function(){return c.trigger("click"),!1}),c.on("change",function(n){const o=(n.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);o&&v.ajaxSubmit({uploadForm:s,upload:{files:o,fileNames:Array.from(o).map(h=>h.name)},callback:r.callback})})}},v.handleDragDrop=function(r){let s=!1;const c=r.container,n=r.container.find(".imagedrop");c.on("dragenter",function(){s||(n.css("top","0px"),n.css("height",c.height()+"px"),n.css("line-height",c.height()+"px"),n.show(),n.on("dragleave",function(){n.hide(),n.off("dragleave")}))}),n.on("drop",function(e){e.preventDefault();const a=e.originalEvent.dataTransfer.files;if(a.length){let t;if(window.FormData){t=new FormData;for(var i=0;i<a.length;++i)t.append("files[]",a[i],a[i].name)}r.callback({files:a,formData:t})}return n.hide(),!1});function o(h){return h.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){s=!0}).off("dragend").on("dragend, mouseup",function(){s=!1}),n.on("dragover",o),n.on("dragenter",o)},v.handlePaste=function(r){r.container.on("paste",function(c){const n=(c.clipboardData||c.originalEvent.clipboardData||{}).items,o=[],h=[];let e=null;window.FormData&&(e=new FormData),[].forEach.call(n,function(a){const i=a.getAsFile();if(i){const t=utils.generateUUID()+"-"+i.name;e&&e.append("files[]",i,t),o.push(i),h.push(t)}}),o.length&&r.callback({files:o,fileNames:h,formData:e})})},v.ajaxSubmit=function(r){const s=[...r.upload.files];for(let n=0;n<s.length;++n){const o=s[n].type.match(/image./);if(o&&!app.user.privileges["upload:post:image"]||!o&&!app.user.privileges["upload:post:file"])return w.error("[[error:no-privileges]]");if(!app.user.isAdmin&&s[n].size>parseInt(config.maximumFileSize,10)*1024)return r.uploadForm[0].reset(),w.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const c=Date.now();r.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:r.upload.formData,error:function(n){let o=n.responseJSON&&(n.responseJSON.error||n.responseJSON.status&&n.responseJSON.status.message)||"[[error:parse-error]]";n&&n.status===413&&(o=n.statusText||"Request Entity Too Large"),w.error(o),w.remove(c)},uploadProgress:function(n,o,h,e){w.alert({alert_id:c,message:"[[modules:composer.uploading, "+e+"%]]"})},success:function(n){const o=n.response.images;if(o&&o.length)for(var h=0;h<o.length;++h)o[h].filename=s[h].name,o[h].isImage=/image./.test(s[h].type);r.callback(o)},complete:function(){r.uploadForm[0].reset(),setTimeout(w.remove,100,c)}}),!1}),r.uploadForm.submit()},v}.apply(A,E),y!==void 0&&(C.exports=y)},49897:(C,A,g)=>{"use strict";g.r(A),g.d(A,{del:()=>i,get:()=>n,head:()=>o,patch:()=>e,post:()=>h,put:()=>a});var E=g(91749),y=g.n(E),w=g(33530),v=g.n(w);const r=config.relative_path+"/api/v3";async function s(t,l){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:r+t.url,typeof l=="function"){c(t).then(d=>l(null,d),d=>{let m=d;d instanceof Error||(m=new Error(String(d)));const b=m.message||String(m);if(b&&!b.startsWith("[[error:")&&(b.toLowerCase()==="fetch failed"||b.toLowerCase()==="failed to fetch"||b.toLowerCase().includes("networkerror")||b.toLowerCase().includes("network")&&b.toLowerCase().includes("failed"))){const u=new Error("[[error:no-connection]]");u.originalError=m,m=u}l(m)});return}try{return await c(t)}catch(d){if(d.message==="A valid login session was not found. Please log in and try again."){const{url:m}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,w.confirm)("[[error:api.reauth-required]]",b=>{b&&ajaxify.go(m)})}throw d}}async function c(t){const{url:l}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,E.fire)("filter:api.options",{options:t}))}catch(f){console.error("[API] Error in filter:api.options hook:",f)}t.data&&(t.body=t.data,delete t.data);let d;try{d=await fetch(l,t)}catch(f){const k=f.message||f.toString()||String(f),T=f.name||"Error";if(T==="TypeError"&&(k.toLowerCase().includes("fetch")||k.toLowerCase().includes("network")||k.toLowerCase().includes("failed to fetch")||k.toLowerCase().includes("load failed"))||k.toLowerCase().includes("cors")||k.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:l,method:t.method||"GET",error:k,name:T});const L=new Error("[[error:no-connection]]");throw L.originalError=f,L}throw console.error("[API] Unexpected fetch error:",{url:l,method:t.method||"GET",error:k,name:T}),f}const{headers:m}=d;if(m.get("x-redirect"))return c({url:m.get("x-redirect"),...t});const b=m.get("content-type"),p=b&&b.startsWith("application/json");let u;if(t.method!=="HEAD")try{p?u=await d.json():u=await d.text()}catch(f){throw console.error("[API] Error parsing response:",{url:l,status:d.status,statusText:d.statusText,contentType:b,error:f.message}),new Error("[[error:invalid-json]]")}if(!d.ok){let f;throw u?p&&u.status&&u.status.message?f=u.status.message:typeof u=="string"?f=u:f=d.statusText||"Request failed":f=d.statusText||"Request failed",new Error(f)}return p&&u&&u.hasOwnProperty("status")&&u.hasOwnProperty("response")?u.response:u}function n(t,l,d){return s({url:t+(l&&Object.keys(l).length?"?"+$.param(l):"")},d)}function o(t,l,d){return s({url:t+(l&&Object.keys(l).length?"?"+$.param(l):""),method:"HEAD"},d)}function h(t,l,d){return s({url:t,method:"POST",data:l,headers:{"x-csrf-token":config.csrf_token}},d)}function e(t,l,d){return s({url:t,method:"PATCH",data:l,headers:{"x-csrf-token":config.csrf_token}},d)}function a(t,l,d){return s({url:t,method:"PUT",data:l,headers:{"x-csrf-token":config.csrf_token}},d)}function i(t,l,d){return s({url:t,method:"DELETE",data:l,headers:{"x-csrf-token":config.csrf_token}},d)}},62590:(C,A,g)=>{"use strict";var E,y;E=[g(91749)],y=function(w){var v={};return v.render=function(r,s){if(s=s||function(){},!r.find(".preview-container").is(":visible"))return s();var c=r.find("textarea");socket.emit("plugins.composer.renderPreview",c.val(),function(n,o){n||(o=$("<div>"+o+"</div>"),o.find("img:not(.not-responsive)").addClass("img-fluid"),r.find(".preview").html(o),w.fire("action:composer.preview",{postContainer:r,preview:o}),s())})},v.matchScroll=function(r){if(r.find(".preview-container").is(":visible")){var s=r.find("textarea"),c=r.find(".preview");if(s.length&&c.length){var n=s[0].scrollHeight-s.height();if(n===0)return;var o=s.scrollTop()/n;c.scrollTop(Math.max(c[0].scrollHeight-c.height(),0)*o)}}},v.handleToggler=function(r){const s=r.get(0);v.env=utils.findBootstrapEnvironment();const c=["xs","sm"].includes(v.env),n=s.querySelector('.formatting-bar [data-action="preview"]'),o=n.querySelector(".show-text"),h=n.querySelector(".hide-text"),e=localStorage.getItem("composer:previewToggled"),a=config["composer-default"]&&config["composer-default"].hidePreviewOnOpen==="on";let i=!c&&(e===null&&!a||e==="true");const t=s.querySelector(".preview-container"),l=s.querySelector(".write-container");if(!n)return;function d(m){c?(t.classList.toggle("hide",!1),l.classList.toggle("maximized",!1),t.classList.toggle("d-none",!m),t.classList.toggle("d-flex",m),t.classList.toggle("w-100",m),l.classList.toggle("d-flex",!m),l.classList.toggle("d-none",m),l.classList.toggle("w-100",!m)):(t.classList.toggle("hide",!m),l.classList.toggle("w-50",m),l.classList.toggle("w-100",!m),localStorage.setItem("composer:previewToggled",m)),o.classList.toggle("hide",m),h.classList.toggle("hide",!m),m&&v.render(r),v.matchScroll(r)}v.toggle=d,n.addEventListener("click",m=>{m.button===0&&(i=!i,d(i))}),d(i)},v}.apply(A,E),y!==void 0&&(C.exports=y)},65348:(C,A,g)=>{"use strict";var E,y;E=[g(96349),g(33530),g(91749),g(17459)],y=function(w,v,r,s){const c={};return c.init=function(n,o){if(!n||!n.length)return;o=o||{};const h=o.onSelect||function(){};o.states=o.states||["watching","tracking","notwatching","ignoring"],o.template=o.template||"partials/category/selector-dropdown-left",r.fire("action:category.selector.options",{el:n,options:o}),w.init(n,o);const e={el:n,selectedCategory:null};n.on("click","[data-cid]",function(){const i=$(this);return i.hasClass("disabled")?!1:(e.selectCategory(i.attr("data-cid")),h(e.selectedCategory))});let a=e.el.find('[component="category-selector-selected"]').html();return s.translate(a,i=>{a=i}),e.selectCategory=function(i){const t=e.el.find('[data-cid="'+i+'"]');e.selectedCategory={cid:i,name:t.attr("data-name")},t.length?e.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):e.el.find('[component="category-selector-selected"]').html(a)},e.getSelectedCategory=function(){return e.selectedCategory},e.getSelectedCid=function(){return e.selectedCategory?e.selectedCategory.cid:0},o.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(o.template,{selectedCategory:o.selectedCategory},function(i){e.el.find('[component="category-selector-selected"]').html(i.find('[component="category-selector-selected"]').html())}),e},c.modal=function(n){n=n||{},n.onSelect=n.onSelect||function(){},n.onSubmit=n.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:n.message},function(o){const h=v.dialog({title:n.title||"[[modules:composer.select-category]]",message:o,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:a}}}),e=c.init(h.find('[component="category-selector"]'),n);function a(i){return i.preventDefault(),e.selectedCategory&&(n.onSubmit(e.selectedCategory),h.modal("hide")),!1}n.openOnLoad&&h.on("shown.bs.modal",function(){h.find(".dropdown-toggle").dropdown("toggle")}),h.find("form").on("submit",a)})},c}.apply(A,E),y!==void 0&&(C.exports=y)},89596:(C,A,g)=>{C.exports=g(62590)},96349:(C,A,g)=>{"use strict";var E,y;E=[g(29930),g(89336),g(49897)],y=function(w,v,r){const s={};return s.init=function(c,n){let o=n.defaultCategories||null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","tracking","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let h=[];Array.isArray(n.localCategories)&&(h=n.localCategories.map(l=>({...l})),o&&(o=[...h,...o])),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const e=c.find('[component="category-selector-search"]');if(!e.length)return;const a=e.parents('[component="category/dropdown"]').length>0||e.parents('[component="category-selector"]').length>0;c.on("show.bs.dropdown",function(){a&&e.removeClass("hidden");function l(){const d=e.find("input").val();d.length>1||!d&&!o?i(d,function(m){o=n.cacheList&&(o||m),t(m)}):!d&&o&&t(o)}e.on("click",function(d){d.preventDefault(),d.stopPropagation()}),e.find("input").val("").on("keyup",utils.debounce(l,300)),l()}),c.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||e.find("input").focus()}),c.on("hide.bs.dropdown",function(){a&&e.addClass("hidden"),e.off("click"),e.find("input").off("keyup")});function i(l,d){r.get("/search/categories",{search:l,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(m,{categories:b}){if(m)return w.error(m);d(h.concat(b))})}function t(l){const d=n.selectedCids.map(String);l.forEach(function(m){m.selected=d.includes(String(m.cid))}),app.parseAndTranslate(n.template,{categoryItems:l.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(m){c.find('[component="category/list"]').html(m.find('[component="category/list"]').html()),c.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!l.length);const b=v.Dropdown.getInstance(c.find(".dropdown-toggle").get(0));b&&b.update()})}},s}.apply(A,E),y!==void 0&&(C.exports=y)}}]);
