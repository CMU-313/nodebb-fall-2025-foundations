"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,24459,34271,34405,49897,91579,99127],{24459:(x,A,l)=>{var h,g;h=[l(34405),l(29930)],g=function(T,k){const v={};let a;v.init=async function(y){if(a)return;const E=y.attr("data-pid");let o=await socket.emit("posts.getEditors",{pid:E});app.parseAndTranslate("modals/manage-editors",{editors:o},function(n){a=n;const u=a.find("#manage_editors_commit");$("body").append(a),a.find("#manage_editors_cancel").on("click",m),u.on("click",function(){w(E)}),T.user(a.find("#username"),{filters:["notbanned"]},function(e,r){o.find(i=>String(i.uid)===String(r.item.user.uid))||(o.push(r.item.user),app.parseAndTranslate("modals/manage-editors","editors",{editors:o},function(i){a.find('[component="topic/editors"]').html(i),a.find("#username").val("")}))}),a.on("click","button.remove-user-icon",function(){const e=$(this).parents("[data-uid]"),r=e.attr("data-uid");o=o.filter(t=>String(t.uid)!==String(r)),e.remove()})})};function w(y){const E=a.find('[component="topic/editors"]>[data-uid]').map((o,n)=>$(n).attr("data-uid")).get();socket.emit("posts.saveEditors",{pid:y,uids:E},function(o){if(o)return k.error(o);m()})}function m(){a&&(a.remove(),a=null)}return v}.apply(A,h),g!==void 0&&(x.exports=g)},34405:(x,A,l)=>{var h,g;h=[l(49897),l(29930),l(36e3),l(9787),l(35786)],g=function(T,k,{Textcomplete:v},{TextareaEditor:a},{ContenteditableEditor:w}){const m={},y={delay:200,appendTo:null};m.init=o=>{const n={...y,...o},{input:u,onSelect:e}=n;app.loadJQueryUI(function(){u.autocomplete({...n,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(r,t){E(u,e,r,t)}})})},m.user=function(o,n,u){typeof n=="function"&&(u=n,n={}),n=n||{},m.init({input:o,onSelect:u,source:(e,r)=>{n.query=e.term,T.get("/api/users",n,function(t,i){if(t)return k.error(t);if(i&&i.users){const s=i.users.map(function(d){const c=$("<div></div>").html(d.username).text();return d&&{label:c,value:c,user:{uid:d.uid,name:d.username,slug:d.userslug,username:d.username,userslug:d.userslug,displayname:d.displayname,picture:d.picture,banned:d.banned,"icon:text":d["icon:text"],"icon:bgColor":d["icon:bgColor"]}}});r(s)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},m.group=function(o,n){m.init({input:o,onSelect:n,source:(u,e)=>{socket.emit("groups.search",{query:u.term},function(r,t){if(r)return k.error(r);if(t&&t.length){const i=t.map(function(s){return s&&{label:s.name,value:s.name,group:s}});e(i)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},m.tag=function(o,n){m.init({input:o,onSelect:n,delay:100,source:(u,e)=>{socket.emit("topics.autocompleteTags",{query:u.term,cid:ajaxify.data.cid||0},function(r,t){if(r)return k.error(r);t&&e(t),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function E(o,n,u,e){n=n||function(){};const r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){o.trigger(r)},100),n(u,e)}return m.setup=function({element:o,strategies:n,options:u}){const e=o.get(0);if(e){var r;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?r=new a(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(r=new w(e)),!r)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var t=new v(r,n,{dropdown:u});return t.on("rendered",function(){t.dropdown.items.length&&t.dropdown.items[0].activate()}),t}},m}.apply(A,h),g!==void 0&&(x.exports=g)},49897:(x,A,l)=>{l.r(A),l.d(A,{del:()=>u,get:()=>m,head:()=>y,patch:()=>o,post:()=>E,put:()=>n});var h=l(91749),g=l.n(h),T=l(33530),k=l.n(T);const v=config.relative_path+"/api/v3";async function a(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:v+e.url,typeof r=="function"){w(e).then(t=>r(null,t),t=>{let i=t;t instanceof Error||(i=new Error(String(t)));const s=i.message||String(i);if(s&&!s.startsWith("[[error:")&&(s.toLowerCase()==="fetch failed"||s.toLowerCase()==="failed to fetch"||s.toLowerCase().includes("networkerror")||s.toLowerCase().includes("network")&&s.toLowerCase().includes("failed"))){const c=new Error("[[error:no-connection]]");c.originalError=i,i=c}r(i)});return}try{return await w(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,T.confirm)("[[error:api.reauth-required]]",s=>{s&&ajaxify.go(i)})}throw t}}async function w(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,h.fire)("filter:api.options",{options:e}))}catch(f){console.error("[API] Error in filter:api.options hook:",f)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(f){const p=f.message||f.toString()||String(f),C=f.name||"Error";if(C==="TypeError"&&(p.toLowerCase().includes("fetch")||p.toLowerCase().includes("network")||p.toLowerCase().includes("failed to fetch")||p.toLowerCase().includes("load failed"))||p.toLowerCase().includes("cors")||p.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:p,name:C});const P=new Error("[[error:no-connection]]");throw P.originalError=f,P}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:p,name:C}),f}const{headers:i}=t;if(i.get("x-redirect"))return w({url:i.get("x-redirect"),...e});const s=i.get("content-type"),d=s&&s.startsWith("application/json");let c;if(e.method!=="HEAD")try{d?c=await t.json():c=await t.text()}catch(f){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:s,error:f.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let f;throw c?d&&c.status&&c.status.message?f=c.status.message:typeof c=="string"?f=c:f=t.statusText||"Request failed":f=t.statusText||"Request failed",new Error(f)}return d&&c&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c}function m(e,r,t){return a({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function y(e,r,t){return a({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function E(e,r,t){return a({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function o(e,r,t){return a({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function n(e,r,t){return a({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function u(e,r,t){return a({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
