(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,80896,99127],{46243:(l,f,c)=>{l.exports=c(20460)},49897:(l,f,c)=>{"use strict";c.r(f),c.d(f,{del:()=>_,get:()=>y,head:()=>x,patch:()=>C,post:()=>P,put:()=>T});var h=c(91749),p=c.n(h),g=c(33530),L=c.n(g);const k=config.relative_path+"/api/v3";async function u(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:k+e.url,typeof t=="function"){w(e).then(r=>t(null,r),r=>{let a=r;r instanceof Error||(a=new Error(String(r)));const n=a.message||String(a);if(n&&!n.startsWith("[[error:")&&(n.toLowerCase()==="fetch failed"||n.toLowerCase()==="failed to fetch"||n.toLowerCase().includes("networkerror")||n.toLowerCase().includes("network")&&n.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=a,a=o}t(a)});return}try{return await w(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:a}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,g.confirm)("[[error:api.reauth-required]]",n=>{n&&ajaxify.go(a)})}throw r}}async function w(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,h.fire)("filter:api.options",{options:e}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(s){const i=s.message||s.toString()||String(s),E=s.name||"Error";if(E==="TypeError"&&(i.toLowerCase().includes("fetch")||i.toLowerCase().includes("network")||i.toLowerCase().includes("failed to fetch")||i.toLowerCase().includes("load failed"))||i.toLowerCase().includes("cors")||i.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:i,name:E});const m=new Error("[[error:no-connection]]");throw m.originalError=s,m}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:i,name:E}),s}const{headers:a}=r;if(a.get("x-redirect"))return w({url:a.get("x-redirect"),...e});const n=a.get("content-type"),d=n&&n.startsWith("application/json");let o;if(e.method!=="HEAD")try{d?o=await r.json():o=await r.text()}catch(s){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:n,error:s.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let s;throw o?d&&o.status&&o.status.message?s=o.status.message:typeof o=="string"?s=o:s=r.statusText||"Request failed":s=r.statusText||"Request failed",new Error(s)}return d&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function y(e,t,r){return u({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function x(e,t,r){return u({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function P(e,t,r){return u({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function C(e,t,r){return u({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function T(e,t,r){return u({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function _(e,t,r){return u({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}},86246:(l,f,c)=>{l.exports=c(13402)}}]);
