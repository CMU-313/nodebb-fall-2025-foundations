"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,34271,34405,49897,91977,99127],{34405:(C,w,l)=>{var g,E;g=[l(49897),l(29930),l(36e3),l(9787),l(35786)],E=function(v,y,{Textcomplete:A},{TextareaEditor:h},{ContenteditableEditor:c}){const s={},x={delay:200,appendTo:null};s.init=m=>{const n={...x,...m},{input:d,onSelect:e}=n;app.loadJQueryUI(function(){d.autocomplete({...n,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(r,t){k(d,e,r,t)}})})},s.user=function(m,n,d){typeof n=="function"&&(d=n,n={}),n=n||{},s.init({input:m,onSelect:d,source:(e,r)=>{n.query=e.term,v.get("/api/users",n,function(t,i){if(t)return y.error(t);if(i&&i.users){const o=i.users.map(function(u){const a=$("<div></div>").html(u.username).text();return u&&{label:a,value:a,user:{uid:u.uid,name:u.username,slug:u.userslug,username:u.username,userslug:u.userslug,displayname:u.displayname,picture:u.picture,banned:u.banned,"icon:text":u["icon:text"],"icon:bgColor":u["icon:bgColor"]}}});r(o)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},s.group=function(m,n){s.init({input:m,onSelect:n,source:(d,e)=>{socket.emit("groups.search",{query:d.term},function(r,t){if(r)return y.error(r);if(t&&t.length){const i=t.map(function(o){return o&&{label:o.name,value:o.name,group:o}});e(i)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},s.tag=function(m,n){s.init({input:m,onSelect:n,delay:100,source:(d,e)=>{socket.emit("topics.autocompleteTags",{query:d.term,cid:ajaxify.data.cid||0},function(r,t){if(r)return y.error(r);t&&e(t),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function k(m,n,d,e){n=n||function(){};const r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){m.trigger(r)},100),n(d,e)}return s.setup=function({element:m,strategies:n,options:d}){const e=m.get(0);if(e){var r;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?r=new h(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(r=new c(e)),!r)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var t=new A(r,n,{dropdown:d});return t.on("rendered",function(){t.dropdown.items.length&&t.dropdown.items[0].activate()}),t}},s}.apply(w,g),E!==void 0&&(C.exports=E)},49897:(C,w,l)=>{l.r(w),l.d(w,{del:()=>d,get:()=>s,head:()=>x,patch:()=>m,post:()=>k,put:()=>n});var g=l(91749),E=l.n(g),v=l(33530),y=l.n(v);const A=config.relative_path+"/api/v3";async function h(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:A+e.url,typeof r=="function"){c(e).then(t=>r(null,t),t=>{let i=t;t instanceof Error||(i=new Error(String(t)));const o=i.message||String(i);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const a=new Error("[[error:no-connection]]");a.originalError=i,i=a}r(i)});return}try{return await c(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(i)})}throw t}}async function c(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,g.fire)("filter:api.options",{options:e}))}catch(f){console.error("[API] Error in filter:api.options hook:",f)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(f){const p=f.message||f.toString()||String(f),T=f.name||"Error";if(T==="TypeError"&&(p.toLowerCase().includes("fetch")||p.toLowerCase().includes("network")||p.toLowerCase().includes("failed to fetch")||p.toLowerCase().includes("load failed"))||p.toLowerCase().includes("cors")||p.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:p,name:T});const P=new Error("[[error:no-connection]]");throw P.originalError=f,P}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:p,name:T}),f}const{headers:i}=t;if(i.get("x-redirect"))return c({url:i.get("x-redirect"),...e});const o=i.get("content-type"),u=o&&o.startsWith("application/json");let a;if(e.method!=="HEAD")try{u?a=await t.json():a=await t.text()}catch(f){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:o,error:f.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let f;throw a?u&&a.status&&a.status.message?f=a.status.message:typeof a=="string"?f=a:f=t.statusText||"Request failed":f=t.statusText||"Request failed",new Error(f)}return u&&a&&a.hasOwnProperty("status")&&a.hasOwnProperty("response")?a.response:a}function s(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function x(e,r,t){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function k(e,r,t){return h({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function m(e,r,t){return h({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function n(e,r,t){return h({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function d(e,r,t){return h({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}},67341:(C,w,l)=>{var g,E;g=[l(33530),l(29930),l(34405)],E=function(v,y,A){const h={};return h.init=function(){$('[data-action="clear"]').on("click",function(){return v.confirm("[[admin/advanced/events:confirm-delete-all-events]]",c=>{c&&socket.emit("admin.deleteAllEvents",function(s){if(s)return y.error(s);$(".events-list").empty()})}),!1}),$(".delete-event").on("click",function(){const c=$(this).parents("[data-eid]"),s=c.attr("data-eid");socket.emit("admin.deleteEvents",[s],function(x){if(x)return y.error(x);c.remove()})}),$("#user-group-select").on("change",function(){const c=$(this).val();$("#username").toggleClass("hidden",c!=="username"),c!=="username"&&$("#username").val(""),$("#group").toggleClass("hidden",c!=="group"),c!=="group"&&$("#group").val("")}),A.user($("#username")),A.group($("#group")),$("#apply").on("click",h.refresh)},h.refresh=function(c){c.preventDefault();const s=$("#filters");ajaxify.go("admin/advanced/events?"+s.serialize())},h}.apply(w,g),E!==void 0&&(C.exports=E)}}]);
