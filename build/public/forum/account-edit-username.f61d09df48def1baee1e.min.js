(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,26174,95512,97082],{13230:(p,v,o)=>{"use strict";var h,f,m;(function(n){f=[o(53050)],h=n,m=typeof h=="function"?h.apply(v,f):h,m!==void 0&&(p.exports=m)})(function(n){const a=n("[^\\p{L}\\s\\d\\-_@.]","g"),t=/[^\w\s\d\-_@.]/g,e=/^\s+|\s+$/g,c=/\s+/g,i=/-+/g,s=/-$/g,r=/^-/g,u=/^[\w\d\s.,\-@]+$/;return function(d,x){return d?(d=String(d).replace(e,""),u.test(d)?d=d.replace(t,"-"):d=n.replace(d,a,"-"),d=x?d:d.toLocaleLowerCase(),d=d.replace(c,"-"),d=d.replace(i,"-"),d=d.replace(s,""),d=d.replace(r,""),d):""}})},18675:()=>{(function(p){var v=p(window),o=function(n,a,t,e){if(arguments.length===3||e){if(t<n)return n;if(t>a)return a}return t},h=function(n){n.clientX=n.originalEvent.touches[0].clientX,n.clientY=n.originalEvent.touches[0].clientY},f=function(n){var a=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(a){var t={width:0,height:0},e=new Image;return e.onload=function(){if(n.css("background-size")=="cover"){var c=n.innerWidth(),i=n.innerHeight(),s=c/i,r=e.width/e.height,u=1;r>=s?u=i/e.height:u=c/e.width,t.width=e.width*u,t.height=e.height*u}else t.width=e.width,t.height=e.height},e.src=a,t}};function m(n,a){this.element=n,this.options=a,this.init()}m.prototype.init=function(){var n=p(this.element),a=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t=this.options;if(a){var e={width:0,height:0};(t.bound||t.units=="percent")&&(e=f(n)),p(window).on("keydown.dbg",c=>{var i=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],s=parseInt(i[1])||0,r=parseInt(i[2])||0;t.units=="percent"&&(s=Math.round(s/-200*e.width),r=Math.round(r/-200*e.height));var u=0,g=0;return c.which===37?u=-5:c.which===39?u=5:c.which===38?g=-5:c.which===40&&(g=5),t.units==="percent"?(s=t.axis==="y"?s:o(-e.width/2,0,s+u,t.bound),r=t.axis==="x"?r:o(-e.height/2,0,r+g,t.bound),n.css("background-position",s/e.width*-200+"% "+r/e.height*-200+"%")):(s=t.axis==="y"?s:o(n.innerWidth()-e.width,0,s+u,t.bound),r=t.axis==="x"?r:o(n.innerHeight()-e.height,0,r+g,t.bound)),[37,38,39,40].includes(c.which)?!1:void 0}),n.on("mousedown.dbg touchstart.dbg",function(c){if(c.target===n[0]){if(c.preventDefault(),c.originalEvent.touches)h(c);else if(c.which!==1)return;var i=c.clientX,s=c.clientY,r=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],u=parseInt(r[1])||0,g=parseInt(r[2])||0;t.units=="percent"&&(u=Math.round(u/-200*e.width),g=Math.round(g/-200*e.height)),v.on("mousemove.dbg touchmove.dbg",function(d){d.preventDefault(),d.originalEvent.touches&&h(d);var x=d.clientX,E=d.clientY;t.units=="percent"?(u=t.axis==="y"?u:o(-e.width/2,0,u+x-i,t.bound),g=t.axis==="x"?g:o(-e.height/2,0,g+E-s,t.bound),n.css("background-position",u/e.width*-200+"% "+g/e.height*-200+"%")):(u=t.axis==="y"?u:o(n.innerWidth()-e.width,0,u+x-i,t.bound),g=t.axis==="x"?g:o(n.innerHeight()-e.height,0,g+E-s,t.bound),n.css("background-position",u+"px "+g+"px")),i=x,s=E}),v.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){t.done&&t.done(),v.off("mousemove.dbg touchmove.dbg"),v.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},m.prototype.disable=function(){var n=p(this.element);n.off("mousedown.dbg touchstart.dbg"),v.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},p.fn.backgroundDraggable=function(n){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=p(this),e;typeof n>"u"||typeof n=="object"?(n=p.extend({},p.fn.backgroundDraggable.defaults,n),e=new m(this,n),t.data("dbg",e)):typeof n=="string"&&t.data("dbg")&&(e=t.data("dbg"),m.prototype[n].apply(e,a))})},p.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},20182:(p,v,o)=>{"use strict";var h,f;h=[o(67910),o(49897),o(13230),o(29930)],f=function(m,n,a,t){const e={};return e.init=function(){m.init(),$("#submitBtn").on("click",function(){const i={uid:$("#inputUID").val(),username:$("#inputNewUsername").val(),password:$("#inputCurrentPassword").val()};if(!i.username)return;if(i.username===i.password)return t.error("[[user:username-same-as-password]]");const s=$(this);return s.addClass("disabled").find("i").removeClass("hide"),n.put("/users/"+i.uid,i).then(r=>{const u=a(i.username);i.username&&u&&parseInt(i.uid,10)===parseInt(app.user.uid,10)&&($('[component="header/profilelink"]').attr("href",config.relative_path+"/user/"+u),$('[component="header/profilelink/edit"]').attr("href",config.relative_path+"/user/"+u+"/edit"),$('[component="header/profilelink/settings"]').attr("href",config.relative_path+"/user/"+u+"/settings"),$('[component="header/username"]').text(i.username),$('[component="header/usericon"]').css("background-color",r["icon:bgColor"]).text(r["icon:text"]),$('[component="avatar/icon"]').css("background-color",r["icon:bgColor"]).text(r["icon:text"])),ajaxify.go("user/"+u+"/edit")}).catch(t.error).finally(()=>{s.removeClass("disabled").find("i").addClass("hide")}),!1})},e}.apply(v,h),f!==void 0&&(p.exports=f)},28061:(p,v,o)=>{"use strict";var h,f;h=[o(81335),o(49897),o(33530),o(29930)],f=function(m,n,a,t){const e={};e.banAccount=function(i,s){i=i||ajaxify.data.theirid,c({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(r){const u=r.length>0?Date.now()+r.length*1e3*60*60*(parseInt(r.unit,10)?24:1):0;n.put("/users/"+i+"/ban",{until:u,reason:r.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(t.error)}})},e.unbanAccount=function(i){c({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(s){n.del("/users/"+i+"/ban",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})},e.muteAccount=function(i,s){i=i||ajaxify.data.theirid,c({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(r){const u=r.length>0?Date.now()+r.length*1e3*60*60*(parseInt(r.unit,10)?24:1):0;n.put("/users/"+i+"/mute",{until:u,reason:r.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(t.error)}})},e.unmuteAccount=function(i){c({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(s){n.del("/users/"+i+"/mute",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})};function c(i){m.render(i.tpl,{}).then(function(s){const r=a.dialog({title:i.title,message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:i.title,callback:function(){const u=r.find("form").serializeArray().reduce(function(g,d){return g[d.name]=d.value,g},{});i.onSubmit(u)}}}})})}return e}.apply(v,h),f!==void 0&&(p.exports=f)},36684:(p,v,o)=>{"use strict";var h,f;h=[o(29930),o(18675)],f=function(m){const n={coverEl:null,saveFn:null};n.init=function(t,e,c,i){n.coverEl=t,n.saveFn=e,t.find(".upload").on("click",c),t.find(".resize").on("click",function(){a(t)}),t.find(".remove").on("click",i),t.on("dragover",n.onDragOver).on("drop",n.onDrop),t.find(".save").on("click",n.save),t.addClass("initialised")},n.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},n.onDrop=function(t){t.stopPropagation(),t.preventDefault();const e=t.originalEvent.dataTransfer.files,c=new FileReader;e.length&&e[0].type.match("image.*")&&(c.onload=function(i){n.coverEl.css("background-image","url("+i.target.result+")"),n.newCover=i.target.result},c.readAsDataURL(e[0]),a(n.coverEl))};function a(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),m.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return n.save=function(){n.coverEl.addClass("saving"),n.saveFn(n.newCover||void 0,n.coverEl.css("background-position"),function(t){t?m.error(t):(n.coverEl.toggleClass("active",0),n.coverEl.backgroundDraggable("disable"),n.coverEl.off("dragover",n.onDragOver),n.coverEl.off("drop",n.onDrop),m.success("[[modules:cover.saved]]")),n.coverEl.removeClass("saving")})},n}.apply(v,h),f!==void 0&&(p.exports=f)},47283:(p,v,o)=>{"use strict";var h,f;h=[o(49897),o(33530),o(29930)],f=function(m,n,a){const t={};t.account=function(c,i){e(c,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",i)},t.content=function(c,i){e(c,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",i)},t.purge=function(c,i){e(c,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",i)};function e(c,i,s,r,u){n.confirm(i,function(g){g&&m.del(`/users/${encodeURIComponent(c)}${s}`,{}).then(()=>{if(a.success(r),typeof u=="function")return u()}).catch(a.error)})}return t}.apply(v,h),f!==void 0&&(p.exports=f)},67910:(p,v,o)=>{"use strict";var h,f;h=[o(36684),o(72254),o(52473),o(17459),o(47283),o(28061),o(7524),o(49897),o(33530),o(29930)],f=function(m,n,a,t,e,c,i,s,r,u){const g={};let d;g.init=function(){d=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,x(),E(),d&&D(),a.get("account/follow").on("click",()=>A("follow")),a.get("account/unfollow").on("click",()=>A("unfollow")),a.get("account/chat").on("click",async function(){const{roomId:l}=await s.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),b=await app.require("chat");l?b.openChat(l):b.newChat(ajaxify.data.uid)}),a.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){a.get("account/chat").parent().removeClass("hidden")})}),a.get("account/ban").on("click",()=>c.banAccount(ajaxify.data.theirid)),a.get("account/mute").on("click",()=>c.muteAccount(ajaxify.data.theirid)),a.get("account/unban").on("click",()=>c.unbanAccount(ajaxify.data.theirid)),a.get("account/unmute").on("click",()=>c.unmuteAccount(ajaxify.data.theirid)),a.get("account/delete-account").on("click",()=>e.account(ajaxify.data.theirid)),a.get("account/delete-content").on("click",()=>e.content(ajaxify.data.theirid)),a.get("account/delete-all").on("click",()=>e.purge(ajaxify.data.theirid)),a.get("account/flag").on("click",w),a.get("account/already-flagged").on("click",k),a.get("account/block").on("click",()=>C("block")),a.get("account/unblock").on("click",()=>C("unblock"))};function x(){$(".account-sub-links li a").removeClass("active").each(function(){const l=$(this).attr("href");if(decodeURIComponent(l)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function E(){$('[component="profile/change/picture"]').on("click",function(){return i.openChangeModal(),!1})}function D(){m.init(a.get("account/cover"),function(l,b,y){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:l,position:b},y)},function(){n.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(l){l=(l.startsWith("http")?"":config.relative_path)+l+"?"+Date.now(),a.get("account/cover").css("background-image","url("+l+")")})},I)}function A(l){const b=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return s[l==="follow"?"put":"del"]("/users/"+b+"/follow",void 0,function(y){if(y)return u.error(y);a.get("account/follow").toggleClass("hide",l==="follow"),a.get("account/unfollow").toggleClass("hide",l==="unfollow"),u.success("[[global:alert."+l+", "+ajaxify.data.username+"]]")}),!1}function w(){o.e(6574).then(function(){var l=[o(6574)];(function(b){b.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,l)}).catch(o.oe)}function k(){const l=$(this).data("flag-id");o.e(6574).then(function(){var b=[o(6574)];(function(y){r.confirm("[[flags:modal-confirm-rescind]]",function(R){R&&y.rescind(l)})}).apply(null,b)}).catch(o.oe)}function C(l){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:l},function(b,y){if(b)return u.error(b);a.get("account/block").toggleClass("hidden",y),a.get("account/unblock").toggleClass("hidden",!y)}),!1}function I(){t.translate("[[user:remove-cover-picture-confirm]]",function(l){r.confirm(l,function(b){b&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(y){y?u.error(y):ajaxify.refresh()})})})}return g}.apply(v,h),f!==void 0&&(p.exports=f)}}]);
