"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[63,1091,13417,27509,34271,34405,49897,99127],{63:(v,x,f)=>{var p,E;p=[f(29930),f(34405),f(49897),f(81335)],E=function(w,C,k,m){const h={};let s,P,y,l;h.init=function(r,e,n){s||(y=r,l=e||[],app.parseAndTranslate("modals/tag-topic",{topics:y,tagWhitelist:l},function(o){s=o,P=s.find("#tag-topic-commit"),$("body").append(s),s.find("#tag-topic-cancel").on("click",t),P.on("click",async()=>{await d(),n&&n()}),s.find(".tags").each((a,c)=>{const u=$(c),g=u.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),T=g[0].$input;y[a].tags.forEach(A=>u.tagsinput("add",A.value)),u.on("itemAdded",function(A){l.length&&!l.includes(A.item)&&(u.tagsinput("remove",A.item),w.error("[[error:tag-not-allowed]]")),T.length&&T.autocomplete("close")}),i({input:T,container:g[0].$container})})}))};function i(r){C.init({input:r.input,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:r.container,source:async(e,n)=>{socket.emit("topics.autocompleteTags",{query:e.term},function(o,a){if(o)return w.error(o);a&&n(a)})}})}async function d(){await Promise.all(s.find(".tags").map(async(r,e)=>{const n=y[r],o=$(e);n.tags=await k.put(`/topics/${n.tid}/tags`,{tags:o.tagsinput("items")}),h.updateTopicTags([n])})),t()}h.updateTopicTags=function(r){r.forEach(e=>{const n=ajaxify.data.template.topic?"partials/topic/tags":"partials/category/tags";m.render(n,{tags:e.tags}).then(function(o){const a=$(`[data-tid="${e.tid}"][component="topic/tags"]`);a.fadeOut(250,function(){a.toggleClass("hidden",e.tags.length===0),a.html(o).fadeIn(250)})})})};function t(){s&&(s.remove(),s=null)}return h}.apply(x,p),E!==void 0&&(v.exports=E)},34405:(v,x,f)=>{var p,E;p=[f(49897),f(29930),f(36e3),f(9787),f(35786)],E=function(w,C,{Textcomplete:k},{TextareaEditor:m},{ContenteditableEditor:h}){const s={},P={delay:200,appendTo:null};s.init=l=>{const i={...P,...l},{input:d,onSelect:t}=i;app.loadJQueryUI(function(){d.autocomplete({...i,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(r,e){y(d,t,r,e)}})})},s.user=function(l,i,d){typeof i=="function"&&(d=i,i={}),i=i||{},s.init({input:l,onSelect:d,source:(t,r)=>{i.query=t.term,w.get("/api/users",i,function(e,n){if(e)return C.error(e);if(n&&n.users){const o=n.users.map(function(a){const c=$("<div></div>").html(a.username).text();return a&&{label:c,value:c,user:{uid:a.uid,name:a.username,slug:a.userslug,username:a.username,userslug:a.userslug,displayname:a.displayname,picture:a.picture,banned:a.banned,"icon:text":a["icon:text"],"icon:bgColor":a["icon:bgColor"]}}});r(o)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},s.group=function(l,i){s.init({input:l,onSelect:i,source:(d,t)=>{socket.emit("groups.search",{query:d.term},function(r,e){if(r)return C.error(r);if(e&&e.length){const n=e.map(function(o){return o&&{label:o.name,value:o.name,group:o}});t(n)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},s.tag=function(l,i){s.init({input:l,onSelect:i,delay:100,source:(d,t)=>{socket.emit("topics.autocompleteTags",{query:d.term,cid:ajaxify.data.cid||0},function(r,e){if(r)return C.error(r);e&&t(e),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function y(l,i,d,t){i=i||function(){};const r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){l.trigger(r)},100),i(d,t)}return s.setup=function({element:l,strategies:i,options:d}){const t=l.get(0);if(t){var r;if(t.nodeName==="TEXTAREA"||t.nodeName==="INPUT"?r=new m(t):t.nodeName==="DIV"&&t.getAttribute("contenteditable")==="true"&&(r=new h(t)),!r)throw new Error("unknown target element type");t.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var e=new k(r,i,{dropdown:d});return e.on("rendered",function(){e.dropdown.items.length&&e.dropdown.items[0].activate()}),e}},s}.apply(x,p),E!==void 0&&(v.exports=E)},49897:(v,x,f)=>{f.r(x),f.d(x,{del:()=>d,get:()=>s,head:()=>P,patch:()=>l,post:()=>y,put:()=>i});var p=f(91749),E=f.n(p),w=f(33530),C=f.n(w);const k=config.relative_path+"/api/v3";async function m(t,r){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:k+t.url,typeof r=="function"){h(t).then(e=>r(null,e),e=>{let n=e;e instanceof Error||(n=new Error(String(e)));const o=n.message||String(n);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const c=new Error("[[error:no-connection]]");c.originalError=n,n=c}r(n)});return}try{return await h(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:n}=await(0,p.fire)("filter:admin.reauth",{url:"login"});return(0,w.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(n)})}throw e}}async function h(t){const{url:r}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,p.fire)("filter:api.options",{options:t}))}catch(u){console.error("[API] Error in filter:api.options hook:",u)}t.data&&(t.body=t.data,delete t.data);let e;try{e=await fetch(r,t)}catch(u){const g=u.message||u.toString()||String(u),T=u.name||"Error";if(T==="TypeError"&&(g.toLowerCase().includes("fetch")||g.toLowerCase().includes("network")||g.toLowerCase().includes("failed to fetch")||g.toLowerCase().includes("load failed"))||g.toLowerCase().includes("cors")||g.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:t.method||"GET",error:g,name:T});const A=new Error("[[error:no-connection]]");throw A.originalError=u,A}throw console.error("[API] Unexpected fetch error:",{url:r,method:t.method||"GET",error:g,name:T}),u}const{headers:n}=e;if(n.get("x-redirect"))return h({url:n.get("x-redirect"),...t});const o=n.get("content-type"),a=o&&o.startsWith("application/json");let c;if(t.method!=="HEAD")try{a?c=await e.json():c=await e.text()}catch(u){throw console.error("[API] Error parsing response:",{url:r,status:e.status,statusText:e.statusText,contentType:o,error:u.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let u;throw c?a&&c.status&&c.status.message?u=c.status.message:typeof c=="string"?u=c:u=e.statusText||"Request failed":u=e.statusText||"Request failed",new Error(u)}return a&&c&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c}function s(t,r,e){return m({url:t+(r&&Object.keys(r).length?"?"+$.param(r):"")},e)}function P(t,r,e){return m({url:t+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},e)}function y(t,r,e){return m({url:t,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function l(t,r,e){return m({url:t,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function i(t,r,e){return m({url:t,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function d(t,r,e){return m({url:t,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
