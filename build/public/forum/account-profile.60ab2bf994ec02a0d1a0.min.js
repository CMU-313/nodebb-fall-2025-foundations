"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[56974],{74902:(A,w,p)=>{var x,v;x=[p(67910),p(33530),p(49897),p(29930)],v=function(k,m,j,y){const U={};function F(n){if(!n)return"";const u=n.replace(/<[^>]*>/g,"").trim(),b={of:!0,the:!0};return u.split(/\s+/).map(function(s,a){const e=s.toLowerCase();return a===0?e.charAt(0).toUpperCase()+e.slice(1):b[e]?e:e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")}function h(n,u){if(!n)return"";const t=n.replace(/<[^>]*>/g,"").trim().split(/\s+/).map(function(s){const a=s.toLowerCase();return a.charAt(0).toUpperCase()+a.slice(1)}).join(" ");return u==="state"&&t.replace(/\s+/g,"").length===2?t.replace(/\s+/g,"").toUpperCase():u==="country"&&t.replace(/\s+/g,"").length===3?t.replace(/\s+/g,"").toUpperCase():t}U.init=function(){k.init(),app.enterRoom("user/"+ajaxify.data.theirid),S(),parseInt(ajaxify.data.emailChanged,10)===1&&m.alert({message:"[[user:emailUpdate.change-instructions]]",closeButton:!1}),socket.removeListener("event:user_status_change",C),socket.on("event:user_status_change",C)};function S(){if($('[component="posts"] [component="post/content"] img:not(.not-responsive), [component="aboutme"] img:not(.not-responsive)').addClass("img-fluid"),parseInt(ajaxify.data.uid,10)===parseInt(ajaxify.data.theirid,10)){if(!(ajaxify.data.customUserFields||[]).some(t=>t.key==="university"&&t.value)){const t=$('<div class="card p-2 mb-3" id="add-university-card"><a href="#" id="profile-add-university">Add University</a></div>'),s=$('[component="aboutme"]').first();if(s.length)s.after(t);else{const a=$(".account-stats").first();if(a.length)a.before(t);else{const e=$(".account .container").first();e.length?e.prepend(t):$("body").prepend(t)}}$("#profile-add-university").on("click",function(a){a.preventDefault(),m.dialog({title:"Add University",message:'<p><input class="form-control mb-2" id="boot-university" placeholder="University"></p><p><input class="form-control" id="boot-gradyear" placeholder="Graduation Year" type="number"></p>',buttons:{cancel:{label:"Cancel",className:"btn-light"},submit:{label:"Save",className:"btn-primary",callback:function(){var e=$("#boot-university").val()||"",c=$("#boot-gradyear").val()||"";e=F(e),c=c.toString().replace(/[^0-9]/g,"");var i={uid:ajaxify.data.theirid};if(e&&c){var r=c.slice(-2);i.university=e+" ('"+r+")"}else e&&(i.university=e);if(!i.university)return!1;j.put("/users/"+ajaxify.data.theirid,i).then(function(){y.success("[[user:profile-update-success]]");try{$("#add-university-card").remove();var l="University",o="fa-solid fa-graduation-cap",f=$('<div class="stat"><div class="align-items-center justify-content-center card card-header p-3 border-0 rounded-1 h-100 gap-2"><span class="stat-label text-xs fw-semibold"><span><i class="text-muted '+o+'"></i> '+l+'</span></span><span class="text-center fs-6 ff-secondary"></span></div></div>');f.find(".ff-secondary").text(i.university);var d=$(".account-stats .row").first();if(d.length)d.append(f);else{window.location.reload();return}ajaxify.data.customUserFields=ajaxify.data.customUserFields||[],ajaxify.data.customUserFields.push({key:"university",name:l,value:i.university,icon:o,type:"input-text"}),ajaxify.data.university=i.university}catch{window.location.reload()}}).catch(function(l){y.error(l)})}}}})})}if(!(ajaxify.data.customUserFields||[]).some(t=>t.key==="location"&&t.value)){const t=$('<div class="card p-2 mb-3" id="add-location-card"><a href="#" id="profile-add-location">Add Location</a></div>'),s=$(".account-stats .stat").filter(function(){return $(this).text().trim().includes("University")}).first();if(s.length)s.after(t);else{const a=$('[component="aboutme"]').first();a.length?a.after(t):$(".account-stats").first().length?$(".account-stats").first().before(t):$(".account .container").first().length?$(".account .container").first().prepend(t):$("body").prepend(t)}$("#profile-add-location").on("click",function(a){a.preventDefault(),m.dialog({title:"Add Location",message:'<p><input class="form-control mb-2" id="boot-city" placeholder="City"></p><p><input class="form-control mb-2" id="boot-state" placeholder="State"></p><p><input class="form-control" id="boot-country" placeholder="Country"></p>',buttons:{cancel:{label:"Cancel",className:"btn-light"},submit:{label:"Save",className:"btn-primary",callback:function(){var e=h($("#boot-city").val()||""),c=h($("#boot-state").val()||"","state"),i=h($("#boot-country").val()||"","country"),r=[e,c,i].filter(Boolean).join(", ");if(!r)return!1;var l={uid:ajaxify.data.theirid,location:r};j.put("/users/"+ajaxify.data.theirid,l).then(function(){y.success("[[user:profile-update-success]]");try{$("#add-location-card").remove();var o="Location",f="fa-solid fa-location-dot",d=$('<div class="stat"><div class="align-items-center justify-content-center card card-header p-3 border-0 rounded-1 h-100 gap-2"><span class="stat-label text-xs fw-semibold"><span><i class="text-muted '+f+'"></i> '+o+'</span></span><span class="text-center fs-6 ff-secondary"></span></div></div>');if(d.find(".ff-secondary").text(r),s.length)s.after(d);else{var g=$(".account-stats .row").first();if(g.length)g.append(d);else{window.location.reload();return}}ajaxify.data.customUserFields=ajaxify.data.customUserFields||[],ajaxify.data.customUserFields.push({key:"location",name:o,value:r,icon:f,type:"input-text"}),ajaxify.data.location=r}catch{window.location.reload()}}).catch(function(o){y.error(o)})}}}})})}}}function C(n){parseInt(ajaxify.data.theirid,10)===parseInt(n.uid,10)&&app.updateUserStatus($('.account [data-uid="'+n.uid+'"] [component="user/status"]'),n.status)}return U}.apply(w,x),v!==void 0&&(A.exports=v)}}]);
