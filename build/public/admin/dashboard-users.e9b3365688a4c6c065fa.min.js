"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,25762,34271,49897,57843,99127],{22884:(v,g,s)=>{var c,E;c=[s(98569),s(91749)],E=((D,w)=>{const m={};return m.init=()=>{D.init({set:"registrations",dataset:ajaxify.data.dataset}).then(()=>{w.onPage("action:admin.dashboard.updateGraph",m.updateTable)})},m.updateTable=()=>{window.fetch&&fetch(`${config.relative_path}/api${ajaxify.data.url}${window.location.search}`,{credentials:"include"}).then(h=>{h.ok&&h.json().then(function(P){app.parseAndTranslate(ajaxify.data.template.name,"users",P,function(_){const y=document.querySelector(".users-list tbody");y.innerHTML="",y.append(..._.map((x,f)=>f)),_.find(".timeago").timeago()})})})},m}).apply(g,c),E!==void 0&&(v.exports=E)},49897:(v,g,s)=>{s.r(g),s.d(g,{del:()=>A,get:()=>_,head:()=>y,patch:()=>f,post:()=>x,put:()=>C});var c=s(91749),E=s.n(c),D=s(33530),w=s.n(D);const m=config.relative_path+"/api/v3";async function h(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:m+t.url,typeof n=="function"){P(t).then(e=>n(null,e),e=>{let r=e;e instanceof Error||(r=new Error(String(e)));const o=r.message||String(r);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const i=new Error("[[error:no-connection]]");i.originalError=r,r=i}n(r)});return}try{return await P(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:r}=await(0,c.fire)("filter:admin.reauth",{url:"login"});return(0,D.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(r)})}throw e}}async function P(t){const{url:n}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,c.fire)("filter:api.options",{options:t}))}catch(a){console.error("[API] Error in filter:api.options hook:",a)}t.data&&(t.body=t.data,delete t.data);let e;try{e=await fetch(n,t)}catch(a){const d=a.message||a.toString()||String(a),l=a.name||"Error";if(l==="TypeError"&&(d.toLowerCase().includes("fetch")||d.toLowerCase().includes("network")||d.toLowerCase().includes("failed to fetch")||d.toLowerCase().includes("load failed"))||d.toLowerCase().includes("cors")||d.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:n,method:t.method||"GET",error:d,name:l});const R=new Error("[[error:no-connection]]");throw R.originalError=a,R}throw console.error("[API] Unexpected fetch error:",{url:n,method:t.method||"GET",error:d,name:l}),a}const{headers:r}=e;if(r.get("x-redirect"))return P({url:r.get("x-redirect"),...t});const o=r.get("content-type"),u=o&&o.startsWith("application/json");let i;if(t.method!=="HEAD")try{u?i=await e.json():i=await e.text()}catch(a){throw console.error("[API] Error parsing response:",{url:n,status:e.status,statusText:e.statusText,contentType:o,error:a.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let a;throw i?u&&i.status&&i.status.message?a=i.status.message:typeof i=="string"?a=i:a=e.statusText||"Request failed":a=e.statusText||"Request failed",new Error(a)}return u&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function _(t,n,e){return h({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function y(t,n,e){return h({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function x(t,n,e){return h({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function f(t,n,e){return h({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function C(t,n,e){return h({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function A(t,n,e){return h({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},98569:(v,g,s)=>{s.r(g),s.d(g,{init:()=>A});var c=s(70106),E=s(81335),D=s.n(E),w=s(33530),m=s.n(w),h=s(17459),P=s.n(h),_=s(49897),y=s(91749),x=s.n(y);c.t1.register(c.ZT,c.PP,c.kc,c.No,c.FN,c.m_,c.dN);let f=null,C=!1;function A({set:e,dataset:r}){const o=document.getElementById("analytics-traffic"),u=o.getContext("2d"),i=utils.getHoursArray();C=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),C&&(c.t1.defaults.plugins.tooltip.enabled=!1),t({set:e});const a=h.Translator.create();return new Promise(d=>{a.translateKey(`admin/menu:${ajaxify.data.template.name.replace("admin/","")}`,[]).then(l=>{const p={labels:i,datasets:[{label:l,fill:!0,tension:.25,backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"rgba(151,187,205,1)",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:r||[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]};o.width=$(o).parent().width(),p.datasets[0].yAxisID="left-y-axis",f=new c.t1(u,{type:"line",data:p,options:{responsive:!0,scales:{"left-y-axis":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:l}}},interaction:{intersect:!1,mode:"index"}}}),r?d(f):n(e).then(d)})})}function t({set:e}){$('[data-action="updateGraph"]:not([data-units="custom"])').on("click",function(){let r=new Date;const o=$(this).attr("data-amount");$(this).attr("data-units")==="days"&&r.setHours(0,0,0,0),r=r.getTime(),n(e,$(this).attr("data-units"),r,o),Promise.resolve().then(function(){var u=[s(17459)];(function(i){i.translate("[[admin/dashboard:page-views-custom]]",function(a){$('[data-action="updateGraph"][data-units="custom"]').text(a)})}).apply(null,u)}).catch(s.oe)}),$('[data-action="updateGraph"][data-units="custom"]').on("click",function(){const r=$(this);E.render("admin/partials/pageviews-range-select",{}).then(function(o){const u=w.dialog({title:"[[admin/dashboard:page-views-custom]]",message:o,buttons:{submit:{label:"[[global:search]]",className:"btn-primary",callback:i}}}).on("shown.bs.modal",function(){const a=new Date,d=a.toISOString().slice(0,10);a.setDate(a.getDate()-1);const l=a.toISOString().slice(0,10);u.find("#startRange").val(r.attr("data-startRange")||l),u.find("#endRange").val(r.attr("data-endRange")||d)});function i(){const a=u.find("form").serializeObject(),d=/\d{4}-\d{2}-\d{2}/;if(!a.startRange&&!a.endRange){n(e,"days");return}else if(!d.test(a.startRange)||!d.test(a.endRange))return u.find(".alert-danger").removeClass("hidden"),!1;let l=new Date(a.endRange);l.setDate(l.getDate()+1),l=l.getTime();const p=(l-new Date(a.startRange).getTime())/(1e3*60*60*24);n(e,"days",l,p),r.attr("data-startRange",a.startRange),r.attr("data-endRange",a.endRange),r.html(a.startRange+" &ndash; "+a.endRange)}})})}function n(e,r=ajaxify.data.query.units||"hours",o=ajaxify.data.query.until,u=ajaxify.data.query.count){return f?new Promise(i=>{_.get(`/admin/analytics/${e}`,{units:r,until:o,amount:u}).then(a=>{r==="days"?f.data.xLabels=utils.getDaysArray(o,u):f.data.xLabels=utils.getHoursArray(),f.data.datasets[0].data=a,f.data.labels=f.data.xLabels,f.update();const d=$("#view-as-json"),l=$.param({units:r||"hours",until:o,count:u});d.attr("href",`${config.relative_path}/api/v3/admin/analytics/${ajaxify.data.set}?${l}`);const p=ajaxify.removeRelativePath(ajaxify.data.url.slice(1));ajaxify.updateHistory(`${p}?${l}`,!0),y.fire("action:admin.dashboard.updateGraph",{graph:f}),i(f)})}):Promise.reject(new Error("[[error:invalid-data]]"))}}}]);
