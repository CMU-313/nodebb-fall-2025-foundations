"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,36422,38395,44864,49897,99127],{16227:(C,_,f)=>{var g,w;g=[f(52473)],w=function(h){const s={};let k;s.pids=[];let u=!1;s.init=function(d,c){s.pids.length=0,k=d,c=c||{},u=c.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',n),E()};function n(d){d.stopPropagation();const c=$(this).attr("data-pid"),m=$('[component="topic"] [data-pid="'+c+'"]');!u&&parseInt($(this).attr("data-index"),10)===0||s.togglePostSelection(m,c)}s.disable=function(){s.pids.forEach(function(d){h.get("post","pid",d).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',n),y()},s.togglePostSelection=function(d,c){if(c){const m=s.pids.indexOf(c);m===-1?(s.pids.push(c),d.toggleClass("selected",!0)):(s.pids.splice(m,1),d.toggleClass("selected",!1)),s.pids.length&&s.pids.sort(function(e,r){return e-r}),typeof k=="function"&&k()}};function p(){return!1}function E(){$("#content").on("click",'[component="post"] button, [component="post"] a',p)}function y(){$("#content").off("click",'[component="post"] button, [component="post"] a',p)}return s}.apply(_,g),w!==void 0&&(C.exports=w)},36422:(C,_,f)=>{var g,w;g=[f(16227),f(29930),f(49897)],w=function(h,s,k){const u={};let n,p,E,y;u.init=function(){y=ajaxify.data.tid,$(window).off("action:ajaxify.end",d).on("action:ajaxify.end",d),!n&&app.parseAndTranslate("modals/delete-posts",{},function(t){n=t,$("body").append(n),p=n.find("#delete_posts_confirm"),E=n.find("#purge_posts_confirm"),n.find("#delete_posts_cancel").on("click",r),h.init(function(){e(),m()},{allowMainPostSelect:!0}),m(),p.on("click",function(){c(p,o=>`/posts/${encodeURIComponent(o)}/state`)}),E.on("click",function(){c(E,o=>`/posts/${encodeURIComponent(o)}`)})})};function d(){(ajaxify.data.template.name!=="topic"||ajaxify.data.tid!==y)&&(r(),$(window).off("action:ajaxify.end",d))}function c(t,o){t.attr("disabled",!0),Promise.all(h.pids.map(l=>k.del(o(l),{}))).then(r).catch(s.error).finally(()=>{t.removeAttr("disabled")})}function m(){h.pids.length?n.find("#pids").translateHtml("[[topic:fork-pid-count, "+h.pids.length+"]]"):n.find("#pids").translateHtml("[[topic:fork-no-pids]]")}function e(){h.pids.length?(p.removeAttr("disabled"),E.removeAttr("disabled")):(p.attr("disabled",!0),E.attr("disabled",!0))}function r(){n&&(n.remove(),n=null,h.disable())}return u}.apply(_,g),w!==void 0&&(C.exports=w)},49897:(C,_,f)=>{f.r(_),f.d(_,{del:()=>m,get:()=>p,head:()=>E,patch:()=>d,post:()=>y,put:()=>c});var g=f(91749),w=f.n(g),h=f(33530),s=f.n(h);const k=config.relative_path+"/api/v3";async function u(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:k+e.url,typeof r=="function"){n(e).then(t=>r(null,t),t=>{let o=t;t instanceof Error||(o=new Error(String(t)));const l=o.message||String(o);if(l&&!l.startsWith("[[error:")&&(l.toLowerCase()==="fetch failed"||l.toLowerCase()==="failed to fetch"||l.toLowerCase().includes("networkerror")||l.toLowerCase().includes("network")&&l.toLowerCase().includes("failed"))){const a=new Error("[[error:no-connection]]");a.originalError=o,o=a}r(o)});return}try{return await n(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:o}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,h.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(o)})}throw t}}async function n(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,g.fire)("filter:api.options",{options:e}))}catch(i){console.error("[API] Error in filter:api.options hook:",i)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(i){const P=i.message||i.toString()||String(i),x=i.name||"Error";if(x==="TypeError"&&(P.toLowerCase().includes("fetch")||P.toLowerCase().includes("network")||P.toLowerCase().includes("failed to fetch")||P.toLowerCase().includes("load failed"))||P.toLowerCase().includes("cors")||P.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:P,name:x});const D=new Error("[[error:no-connection]]");throw D.originalError=i,D}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:P,name:x}),i}const{headers:o}=t;if(o.get("x-redirect"))return n({url:o.get("x-redirect"),...e});const l=o.get("content-type"),A=l&&l.startsWith("application/json");let a;if(e.method!=="HEAD")try{A?a=await t.json():a=await t.text()}catch(i){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:l,error:i.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let i;throw a?A&&a.status&&a.status.message?i=a.status.message:typeof a=="string"?i=a:i=t.statusText||"Request failed":i=t.statusText||"Request failed",new Error(i)}return A&&a&&a.hasOwnProperty("status")&&a.hasOwnProperty("response")?a.response:a}function p(e,r,t){return u({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function E(e,r,t){return u({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function y(e,r,t){return u({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function d(e,r,t){return u({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function c(e,r,t){return u({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function m(e,r,t){return u({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
