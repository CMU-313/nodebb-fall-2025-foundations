"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,3097,13417,17205,34271,34405,38395,49897,99127],{16227:(x,k,d)=>{var E,w;E=[d(52473)],w=function(m){const c={};let P;c.pids=[];let p=!1;c.init=function(r,o){c.pids.length=0,P=r,o=o||{},p=o.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',i),y()};function i(r){r.stopPropagation();const o=$(this).attr("data-pid"),a=$('[component="topic"] [data-pid="'+o+'"]');!p&&parseInt($(this).attr("data-index"),10)===0||c.togglePostSelection(a,o)}c.disable=function(){c.pids.forEach(function(r){m.get("post","pid",r).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',i),A()},c.togglePostSelection=function(r,o){if(o){const a=c.pids.indexOf(o);a===-1?(c.pids.push(o),r.toggleClass("selected",!0)):(c.pids.splice(a,1),r.toggleClass("selected",!1)),c.pids.length&&c.pids.sort(function(e,t){return e-t}),typeof P=="function"&&P()}};function l(){return!1}function y(){$("#content").on("click",'[component="post"] button, [component="post"] a',l)}function A(){$("#content").off("click",'[component="post"] button, [component="post"] a',l)}return c}.apply(k,E),w!==void 0&&(x.exports=w)},17205:(x,k,d)=>{var E,w;E=[d(16227),d(34405),d(29930)],w=function(m,c,P){const p={};let i,l,y=0;p.init=function(t){i||app.parseAndTranslate("modals/change-owner",{},function(n){i=n,l=i.find("#change_owner_commit"),$("body").append(i),i.find("#change_owner_cancel").on("click",e),i.find("#username").on("keyup",r),m.init(o,{allowMainPostSelect:!0}),A(),t&&m.togglePostSelection(t,t.attr("data-pid")),l.on("click",function(){a()}),c.user(i.find("#username"),{filters:["notbanned"]},function(u,s){y=s.item.user.uid,r()})})};function A(){m.pids.length?i.find("#pids").translateHtml("[[topic:fork-pid-count, "+m.pids.length+"]]"):i.find("#pids").translateHtml("[[topic:fork-no-pids]]")}function r(){y&&i.find("#username").length&&i.find("#username").val().length&&m.pids.length?l.removeAttr("disabled"):l.attr("disabled",!0)}function o(){r(),A()}function a(){y&&socket.emit("posts.changeOwner",{pids:m.pids,toUid:y},function(t){if(t)return P.error(t);ajaxify.go(`/post/${m.pids[0]}`),e()})}function e(){i&&(i.remove(),i=null,m.disable())}return p}.apply(k,E),w!==void 0&&(x.exports=w)},34405:(x,k,d)=>{var E,w;E=[d(49897),d(29930),d(36e3),d(9787),d(35786)],w=function(m,c,{Textcomplete:P},{TextareaEditor:p},{ContenteditableEditor:i}){const l={},y={delay:200,appendTo:null};l.init=r=>{const o={...y,...r},{input:a,onSelect:e}=o;app.loadJQueryUI(function(){a.autocomplete({...o,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(t,n){A(a,e,t,n)}})})},l.user=function(r,o,a){typeof o=="function"&&(a=o,o={}),o=o||{},l.init({input:r,onSelect:a,source:(e,t)=>{o.query=e.term,m.get("/api/users",o,function(n,u){if(n)return c.error(n);if(u&&u.users){const s=u.users.map(function(h){const f=$("<div></div>").html(h.username).text();return h&&{label:f,value:f,user:{uid:h.uid,name:h.username,slug:h.userslug,username:h.username,userslug:h.userslug,displayname:h.displayname,picture:h.picture,banned:h.banned,"icon:text":h["icon:text"],"icon:bgColor":h["icon:bgColor"]}}});t(s)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},l.group=function(r,o){l.init({input:r,onSelect:o,source:(a,e)=>{socket.emit("groups.search",{query:a.term},function(t,n){if(t)return c.error(t);if(n&&n.length){const u=n.map(function(s){return s&&{label:s.name,value:s.name,group:s}});e(u)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},l.tag=function(r,o){l.init({input:r,onSelect:o,delay:100,source:(a,e)=>{socket.emit("topics.autocompleteTags",{query:a.term,cid:ajaxify.data.cid||0},function(t,n){if(t)return c.error(t);n&&e(n),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function A(r,o,a,e){o=o||function(){};const t=jQuery.Event("keypress");t.which=13,t.keyCode=13,setTimeout(function(){r.trigger(t)},100),o(a,e)}return l.setup=function({element:r,strategies:o,options:a}){const e=r.get(0);if(e){var t;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?t=new p(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(t=new i(e)),!t)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new P(t,o,{dropdown:a});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},l}.apply(k,E),w!==void 0&&(x.exports=w)},49897:(x,k,d)=>{d.r(k),d.d(k,{del:()=>a,get:()=>l,head:()=>y,patch:()=>r,post:()=>A,put:()=>o});var E=d(91749),w=d.n(E),m=d(33530),c=d.n(m);const P=config.relative_path+"/api/v3";async function p(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:P+e.url,typeof t=="function"){i(e).then(n=>t(null,n),n=>{let u=n;n instanceof Error||(u=new Error(String(n)));const s=u.message||String(u);if(s&&!s.startsWith("[[error:")&&(s.toLowerCase()==="fetch failed"||s.toLowerCase()==="failed to fetch"||s.toLowerCase().includes("networkerror")||s.toLowerCase().includes("network")&&s.toLowerCase().includes("failed"))){const f=new Error("[[error:no-connection]]");f.originalError=u,u=f}t(u)});return}try{return await i(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:u}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",s=>{s&&ajaxify.go(u)})}throw n}}async function i(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(g){console.error("[API] Error in filter:api.options hook:",g)}e.data&&(e.body=e.data,delete e.data);let n;try{n=await fetch(t,e)}catch(g){const C=g.message||g.toString()||String(g),T=g.name||"Error";if(T==="TypeError"&&(C.toLowerCase().includes("fetch")||C.toLowerCase().includes("network")||C.toLowerCase().includes("failed to fetch")||C.toLowerCase().includes("load failed"))||C.toLowerCase().includes("cors")||C.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:C,name:T});const _=new Error("[[error:no-connection]]");throw _.originalError=g,_}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:C,name:T}),g}const{headers:u}=n;if(u.get("x-redirect"))return i({url:u.get("x-redirect"),...e});const s=u.get("content-type"),h=s&&s.startsWith("application/json");let f;if(e.method!=="HEAD")try{h?f=await n.json():f=await n.text()}catch(g){throw console.error("[API] Error parsing response:",{url:t,status:n.status,statusText:n.statusText,contentType:s,error:g.message}),new Error("[[error:invalid-json]]")}if(!n.ok){let g;throw f?h&&f.status&&f.status.message?g=f.status.message:typeof f=="string"?g=f:g=n.statusText||"Request failed":g=n.statusText||"Request failed",new Error(g)}return h&&f&&f.hasOwnProperty("status")&&f.hasOwnProperty("response")?f.response:f}function l(e,t,n){return p({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n)}function y(e,t,n){return p({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},n)}function A(e,t,n){return p({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function r(e,t,n){return p({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function o(e,t,n){return p({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function a(e,t,n){return p({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
