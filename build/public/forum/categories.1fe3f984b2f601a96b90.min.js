(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,67109,69185,86198,93806,99127],{49897:(v,A,l)=>{"use strict";l.r(A),l.d(A,{del:()=>d,get:()=>r,head:()=>c,patch:()=>n,post:()=>i,put:()=>m});var p=l(91749),h=l.n(p),x=l(33530),b=l.n(x);const E=config.relative_path+"/api/v3";async function C(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:E+t.url,typeof a=="function"){s(t).then(e=>a(null,e),e=>{let o=e;e instanceof Error||(o=new Error(String(e)));const u=o.message||String(o);if(u&&!u.startsWith("[[error:")&&(u.toLowerCase()==="fetch failed"||u.toLowerCase()==="failed to fetch"||u.toLowerCase().includes("networkerror")||u.toLowerCase().includes("network")&&u.toLowerCase().includes("failed"))){const g=new Error("[[error:no-connection]]");g.originalError=o,o=g}a(o)});return}try{return await s(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:o}=await(0,p.fire)("filter:admin.reauth",{url:"login"});return(0,x.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go(o)})}throw e}}async function s(t){const{url:a}=t;delete t.url,t.headers||(t.headers={}),t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8");try{({options:t}=await(0,p.fire)("filter:api.options",{options:t}))}catch(f){console.error("[API] Error in filter:api.options hook:",f)}t.data&&(t.body=t.data,delete t.data);let e;try{e=await fetch(a,t)}catch(f){const w=f.message||f.toString()||String(f),P=f.name||"Error";if(P==="TypeError"&&(w.toLowerCase().includes("fetch")||w.toLowerCase().includes("network")||w.toLowerCase().includes("failed to fetch")||w.toLowerCase().includes("load failed"))||w.toLowerCase().includes("cors")||w.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:a,method:t.method||"GET",error:w,name:P});const D=new Error("[[error:no-connection]]");throw D.originalError=f,D}throw console.error("[API] Unexpected fetch error:",{url:a,method:t.method||"GET",error:w,name:P}),f}const{headers:o}=e;if(o.get("x-redirect"))return s({url:o.get("x-redirect"),...t});const u=o.get("content-type"),y=u&&u.startsWith("application/json");let g;if(t.method!=="HEAD")try{y?g=await e.json():g=await e.text()}catch(f){throw console.error("[API] Error parsing response:",{url:a,status:e.status,statusText:e.statusText,contentType:u,error:f.message}),new Error("[[error:invalid-json]]")}if(!e.ok){let f;throw g?y&&g.status&&g.status.message?f=g.status.message:typeof g=="string"?f=g:f=e.statusText||"Request failed":f=e.statusText||"Request failed",new Error(f)}return y&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function r(t,a,e){return C({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},e)}function c(t,a,e){return C({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},e)}function i(t,a,e){return C({url:t,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function n(t,a,e){return C({url:t,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function m(t,a,e){return C({url:t,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function d(t,a,e){return C({url:t,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}},65348:(v,A,l)=>{"use strict";var p,h;p=[l(96349),l(33530),l(91749),l(17459)],h=function(x,b,E,C){const s={};return s.init=function(r,c){if(!r||!r.length)return;c=c||{};const i=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",E.fire("action:category.selector.options",{el:r,options:c}),x.init(r,c);const n={el:r,selectedCategory:null};r.on("click","[data-cid]",function(){const d=$(this);return d.hasClass("disabled")?!1:(n.selectCategory(d.attr("data-cid")),i(n.selectedCategory))});let m=n.el.find('[component="category-selector-selected"]').html();return C.translate(m,d=>{m=d}),n.selectCategory=function(d){const t=n.el.find('[data-cid="'+d+'"]');n.selectedCategory={cid:d,name:t.attr("data-name")},t.length?n.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(m)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(d){n.el.find('[component="category-selector-selected"]').html(d.find('[component="category-selector-selected"]').html())}),n},s.modal=function(r){r=r||{},r.onSelect=r.onSelect||function(){},r.onSubmit=r.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:r.message},function(c){const i=b.dialog({title:r.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:m}}}),n=s.init(i.find('[component="category-selector"]'),r);function m(d){return d.preventDefault(),n.selectedCategory&&(r.onSubmit(n.selectedCategory),i.modal("hide")),!1}r.openOnLoad&&i.on("shown.bs.modal",function(){i.find(".dropdown-toggle").dropdown("toggle")}),i.find("form").on("submit",m)})},s}.apply(A,p),h!==void 0&&(v.exports=h)},78048:(v,A,l)=>{"use strict";var p,h;p=[l(33530),l(49897),l(29930),l(17459)],h=function(x,b,E,C){const s={};return s.init=function(){$(document).on("click",".edit-category-btn",function(r){r.preventDefault(),r.stopPropagation();const c=$(this),i=c.data("cid"),n=c.data("name")||"";s.showEditModal(i,n)})},s.showEditModal=function(r,c){x.dialog({title:"Edit Category",message:`
				<form id="edit-category-form">
					<div class="mb-3">
						<label for="category-name" class="form-label">Category Name</label>
						<input type="text" class="form-control" id="category-name" name="name" value="${C.escape(c)}" required>
					</div>
				</form>
			`,buttons:{cancel:{label:"Cancel",className:"btn-secondary"},save:{label:"Save Changes",className:"btn-primary",callback:function(){const i=document.getElementById("edit-category-form"),m=new FormData(i).get("name"),d=s.validateCategoryName(m);if(d)return E.alert({type:"danger",title:"Invalid Category Name",message:d,timeout:5e3}),!1;const t={name:m};return s.updateCategory(r,t),!1}}}})},s.validateCategoryName=function(r){if(!r||r.trim()==="")return"Category name cannot be empty.";if(typeof r!="string")return"Category name must be text.";if(r.length>50)return"Category name cannot be longer than 50 characters.";if(r.includes("/")||r.includes(":"))return'Category name cannot contain "/" or ":" characters.';const c=[];return $(".edit-category-btn").each(function(){const i=$(this).data("name");i&&i.toLowerCase()===r.toLowerCase()&&c.push(i)}),c.length>0?"A category with this name already exists.":null},s.updateCategory=function(r,c){b.put(`/categories/${r}`,c).then(function(){E.alert({type:"success",title:"Success",message:"Category updated successfully!",timeout:3e3}),$(".bootbox").modal("hide");const i=$(`.edit-category-btn[data-cid="${r}"]`);i.data("name",c.name);const n=i.closest('[component="categories/category"]'),m=n.find(".title");if(m.length){const t=m.find("a");t.length?t.text(c.name):m.text(c.name)}const d=n.find('meta[itemprop="name"]');d.length&&d.attr("content",c.name)}).catch(function(i){E.alert({type:"danger",title:"Error",message:i.message||"Failed to update category",timeout:5e3})})},s}.apply(A,p),h!==void 0&&(v.exports=h)},89067:(v,A,l)=>{var p,h;p=[l(65348),l(49897),l(33530),l(17459),l(29930),l(81335),l(78048)],h=function(x,b,E,C,s,r,c){const i={};function n(){$("body").off("click.purge").on("click.purge",'[data-action="purge"][data-cid]',function(d){d.preventDefault();const t=$(this),a=t.closest("li[data-cid]"),e=t.attr("data-cid")||a.length&&a.attr("data-cid"),o=a.length&&a.find(".title").text().trim()||"";b.get(`/categories/${encodeURIComponent(e)}/count`).then(function(u){const y=u&&u.count?u.count:0;r.render("admin/partials/categories/purge",{name:o,topic_count:y}).then(function(g){const f=E.dialog({title:"[[admin/manage/categories:purge]]",message:g,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){f.find(".modal-footer button").prop("disabled",!0);const w=setInterval(async function(){try{const{count:P}=await b.get(`/categories/${encodeURIComponent(e)}/count`);let L=0;y>0&&(L=Math.max(0,1-P/y)*100),f.find(".progress-bar").css({width:L+"%"})}catch(P){clearInterval(w),s.error(P)}},1e3);return b.del("/categories/"+e).then(function(){w&&clearInterval(w),f.modal("hide"),s.success("[[admin/manage/categories:alert.purge-success]]"),a.remove()}).catch(function(P){clearInterval(w),s.error(P)}),!1}}}})}).catch(s.error)}).catch(s.error)})}return i.init=function(){app.enterRoom("categories"),x.init($('[component="category-selector"]'),{privilege:"find",onSelect:function(e){ajaxify.go("/category/"+e.cid)}}),c.init();const m=$("#btn-new-category");if(!m.length)return;m.on("click",function(){E.prompt({title:C.translate("[[categories:create-prompt]]")||"Enter category name:",callback:function(e){e&&b.post("/categories",{name:e}).then(o=>{E.alert(`Category "${o.name}" created!`,function(){ajaxify.refresh()})}).catch(o=>{E.alert(`Error creating category: ${o.message||o}`)})}})});try{n()}catch(e){console.error("bindPurgeHandlers error",e)}function d(){document.querySelectorAll('li[component="categories/category"]').forEach(function(e){if(e.querySelector('[data-action="purge"]'))return;const o=e.getAttribute("data-cid")||e.dataset.cid;if(!o)return;const u=e.querySelector(".d-flex.align-items-start.justify-content-end")||e.querySelector(".d-flex.align-items-start")||e,y=document.createElement("button");y.className="btn btn-danger btn-sm ms-2",y.setAttribute("data-action","purge"),y.setAttribute("data-cid",o),y.title="[[admin/manage/categories:purge]]",y.innerHTML='<i class="fa fa-fw fa-trash"></i>',u.appendChild(y)})}async function t(){try{if(typeof window<"u"&&window.app&&app.user)try{if(app.user.isAdmin||app.user.isGlobalModerator||app.user.allowPurge){d();return}}catch{}if(typeof ajaxify<"u"&&ajaxify.data){if(ajaxify.data.isAdmin||ajaxify.data.isGlobalModerator||ajaxify.data.allowPurge){d();return}if(ajaxify.data.loggedIn&&ajaxify.data.loggedInUser&&ajaxify.data.loggedInUser.uid){const e=ajaxify.data.loggedInUser.uid;try{const o=await b.get(`/users/${encodeURIComponent(e)}`);o&&(o.isAdmin||o.isGlobalModerator||o.allowPurge)&&d()}catch{}}}}catch(e){console.error("ensurePurgeButtonsForAdmin error",e)}}try{t()}catch(e){console.error("ensurePurgeButtonsForAdmin init error",e)}try{setTimeout(()=>{try{t()}catch{}},50)}catch{}try{setTimeout(()=>{try{t()}catch{}},150)}catch{}try{$(window).off("action:ajaxify.end.ensurePurge").on("action:ajaxify.end.ensurePurge",function(){try{n()}catch(e){console.error("bindPurgeHandlers error (ajaxify)",e)}try{t()}catch(e){console.error("ensurePurgeButtonsForAdmin error (ajaxify)",e)}});try{$(window).off("action:ajaxify.dataLoaded.ensurePurge").on("action:ajaxify.dataLoaded.ensurePurge",function(){try{n()}catch(e){console.error("bindPurgeHandlers error (dataLoaded)",e)}try{t()}catch(e){console.error("ensurePurgeButtonsForAdmin error (dataLoaded)",e)}}),$(window).off("action:ajaxify.coldLoad.ensurePurge").on("action:ajaxify.coldLoad.ensurePurge",function(){try{n()}catch(e){console.error("bindPurgeHandlers error (coldLoad)",e)}try{t()}catch(e){console.error("ensurePurgeButtonsForAdmin error (coldLoad)",e)}})}catch(e){console.error("ajaxify data/cold hook attach error",e)}}catch(e){console.error("ajaxify hook attach error",e)}try{if(document.querySelectorAll&&document.querySelectorAll('li[component="categories/category"]').length){try{t()}catch(e){console.error("ensurePurgeButtonsForAdmin fast-path error",e)}try{n()}catch(e){console.error("bindPurgeHandlers fast-path error",e)}}}catch{}try{let o=function(){e||(e=new MutationObserver(function(u){let y=!1;for(const g of u)if(g.addedNodes)for(const f of g.addedNodes)f instanceof Element&&(f.matches&&f.matches('li[component="categories/category"]')&&(y=!0),f.querySelector&&f.querySelector('li[component="categories/category"]')&&(y=!0));if(y){try{d()}catch{}try{n()}catch{}}}),e.observe(document.documentElement||document.body,{childList:!0,subtree:!0}))};var a=o;let e;o()}catch{}},i}.apply(A,p),h!==void 0&&(v.exports=h)},96349:(v,A,l)=>{"use strict";var p,h;p=[l(29930),l(89336),l(49897)],h=function(x,b,E){const C={};return C.init=function(s,r){let c=r.defaultCategories||null;r=r||{},r.privilege=r.privilege||"topics:read",r.states=r.states||["watching","tracking","notwatching","ignoring"],r.cacheList=r.hasOwnProperty("cacheList")?r.cacheList:!0;let i=[];Array.isArray(r.localCategories)&&(i=r.localCategories.map(a=>({...a})),c&&(c=[...i,...c])),r.selectedCids=r.selectedCids||ajaxify.data.selectedCids||[];const n=s.find('[component="category-selector-search"]');if(!n.length)return;const m=n.parents('[component="category/dropdown"]').length>0||n.parents('[component="category-selector"]').length>0;s.on("show.bs.dropdown",function(){m&&n.removeClass("hidden");function a(){const e=n.find("input").val();e.length>1||!e&&!c?d(e,function(o){c=r.cacheList&&(c||o),t(o)}):!e&&c&&t(c)}n.on("click",function(e){e.preventDefault(),e.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),s.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),s.on("hide.bs.dropdown",function(){m&&n.addClass("hidden"),n.off("click"),n.find("input").off("keyup")});function d(a,e){E.get("/search/categories",{search:a,query:utils.params(),parentCid:r.parentCid||0,selectedCids:r.selectedCids,privilege:r.privilege,states:r.states,showLinks:r.showLinks},function(o,{categories:u}){if(o)return x.error(o);e(i.concat(u))})}function t(a){const e=r.selectedCids.map(String);a.forEach(function(o){o.selected=e.includes(String(o.cid))}),app.parseAndTranslate(r.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(o){s.find('[component="category/list"]').html(o.find('[component="category/list"]').html()),s.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const u=b.Dropdown.getInstance(s.find(".dropdown-toggle").get(0));u&&u.update()})}},C}.apply(A,p),h!==void 0&&(v.exports=h)}}]);
