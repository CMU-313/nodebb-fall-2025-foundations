"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,79587,86198,99127],{49897:(A,C,c)=>{c.r(C),c.d(C,{del:()=>u,get:()=>t,head:()=>o,patch:()=>n,post:()=>h,put:()=>E});var m=c(91749),y=c.n(m),w=c(33530),L=c.n(w);const P=config.relative_path+"/api/v3";async function g(e,a){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:P+e.url,typeof a=="function"){l(e).then(r=>a(null,r),r=>{let s=r;r instanceof Error||(s=new Error(String(r)));const i=s.message||String(s);if(i&&!i.startsWith("[[error:")&&(i.toLowerCase()==="fetch failed"||i.toLowerCase()==="failed to fetch"||i.toLowerCase().includes("networkerror")||i.toLowerCase().includes("network")&&i.toLowerCase().includes("failed"))){const d=new Error("[[error:no-connection]]");d.originalError=s,s=d}a(s)});return}try{return await l(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,w.confirm)("[[error:api.reauth-required]]",i=>{i&&ajaxify.go(s)})}throw r}}async function l(e){const{url:a}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,m.fire)("filter:api.options",{options:e}))}catch(f){console.error("[API] Error in filter:api.options hook:",f)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(a,e)}catch(f){const p=f.message||f.toString()||String(f),v=f.name||"Error";if(v==="TypeError"&&(p.toLowerCase().includes("fetch")||p.toLowerCase().includes("network")||p.toLowerCase().includes("failed to fetch")||p.toLowerCase().includes("load failed"))||p.toLowerCase().includes("cors")||p.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:a,method:e.method||"GET",error:p,name:v});const k=new Error("[[error:no-connection]]");throw k.originalError=f,k}throw console.error("[API] Unexpected fetch error:",{url:a,method:e.method||"GET",error:p,name:v}),f}const{headers:s}=r;if(s.get("x-redirect"))return l({url:s.get("x-redirect"),...e});const i=s.get("content-type"),D=i&&i.startsWith("application/json");let d;if(e.method!=="HEAD")try{D?d=await r.json():d=await r.text()}catch(f){throw console.error("[API] Error parsing response:",{url:a,status:r.status,statusText:r.statusText,contentType:i,error:f.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let f;throw d?D&&d.status&&d.status.message?f=d.status.message:typeof d=="string"?f=d:f=r.statusText||"Request failed":f=r.statusText||"Request failed",new Error(f)}return D&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function t(e,a,r){return g({url:e+(a&&Object.keys(a).length?"?"+$.param(a):"")},r)}function o(e,a,r){return g({url:e+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},r)}function h(e,a,r){return g({url:e,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}function n(e,a,r){return g({url:e,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}function E(e,a,r){return g({url:e,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}function u(e,a,r){return g({url:e,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},r)}},65348:(A,C,c)=>{var m,y;m=[c(96349),c(33530),c(91749),c(17459)],y=function(w,L,P,g){const l={};return l.init=function(t,o){if(!t||!t.length)return;o=o||{};const h=o.onSelect||function(){};o.states=o.states||["watching","tracking","notwatching","ignoring"],o.template=o.template||"partials/category/selector-dropdown-left",P.fire("action:category.selector.options",{el:t,options:o}),w.init(t,o);const n={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const u=$(this);return u.hasClass("disabled")?!1:(n.selectCategory(u.attr("data-cid")),h(n.selectedCategory))});let E=n.el.find('[component="category-selector-selected"]').html();return g.translate(E,u=>{E=u}),n.selectCategory=function(u){const e=n.el.find('[data-cid="'+u+'"]');n.selectedCategory={cid:u,name:e.attr("data-name")},e.length?n.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(E)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},o.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(o.template,{selectedCategory:o.selectedCategory},function(u){n.el.find('[component="category-selector-selected"]').html(u.find('[component="category-selector-selected"]').html())}),n},l.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(o){const h=L.dialog({title:t.title||"[[modules:composer.select-category]]",message:o,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:E}}}),n=l.init(h.find('[component="category-selector"]'),t);function E(u){return u.preventDefault(),n.selectedCategory&&(t.onSubmit(n.selectedCategory),h.modal("hide")),!1}t.openOnLoad&&h.on("shown.bs.modal",function(){h.find(".dropdown-toggle").dropdown("toggle")}),h.find("form").on("submit",E)})},l}.apply(C,m),y!==void 0&&(A.exports=y)},78489:(A,C,c)=>{c.r(C),c.d(C,{init:()=>P});var m=c(49897),y=c(29930),w=c(65348),L=c.n(w);function P(){w.init($('[component="category-selector"]'),{onSelect:function(g){ajaxify.go("admin/manage/categories/"+g.cid+"/federation")},showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),$("#site-settings").on("click","[data-action]",function(){switch($(this).attr("data-action")){case"follow":{const l=$("#syncing-add").val();(0,m.put)(`/categories/${ajaxify.data.cid}/follow`,{actor:l}).then(ajaxify.refresh).catch(y.error);break}case"unfollow":{const l=$(this).attr("data-actor");(0,m.del)(`/categories/${ajaxify.data.cid}/follow`,{actor:l}).then(ajaxify.refresh).catch(y.error);break}case"autofill":{const l=$(this).parents("[data-uid]").attr("data-uid");$("#syncing-add").val(l)}}})}},96349:(A,C,c)=>{var m,y;m=[c(29930),c(89336),c(49897)],y=function(w,L,P){const g={};return g.init=function(l,t){let o=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let h=[];Array.isArray(t.localCategories)&&(h=t.localCategories.map(a=>({...a})),o&&(o=[...h,...o])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const n=l.find('[component="category-selector-search"]');if(!n.length)return;const E=n.parents('[component="category/dropdown"]').length>0||n.parents('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){E&&n.removeClass("hidden");function a(){const r=n.find("input").val();r.length>1||!r&&!o?u(r,function(s){o=t.cacheList&&(o||s),e(s)}):!r&&o&&e(o)}n.on("click",function(r){r.preventDefault(),r.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),l.on("hide.bs.dropdown",function(){E&&n.addClass("hidden"),n.off("click"),n.find("input").off("keyup")});function u(a,r){P.get("/search/categories",{search:a,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(s,{categories:i}){if(s)return w.error(s);r(h.concat(i))})}function e(a){const r=t.selectedCids.map(String);a.forEach(function(s){s.selected=r.includes(String(s.cid))}),app.parseAndTranslate(t.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){l.find('[component="category/list"]').html(s.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const i=L.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));i&&i.update()})}},g}.apply(C,m),y!==void 0&&(A.exports=y)}}]);
