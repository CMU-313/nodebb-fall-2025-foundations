"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,42289,49897,99127],{28061:(T,y,l)=>{var E,b;E=[l(81335),l(49897),l(33530),l(29930)],b=function(A,w,P,f){const d={};d.banAccount=function(n,s){n=n||ajaxify.data.theirid,g({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(u){const m=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;w.put("/users/"+n+"/ban",{until:m,reason:u.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(f.error)}})},d.unbanAccount=function(n){g({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(s){w.del("/users/"+n+"/ban",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(f.error)}})},d.muteAccount=function(n,s){n=n||ajaxify.data.theirid,g({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(u){const m=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;w.put("/users/"+n+"/mute",{until:m,reason:u.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(f.error)}})},d.unmuteAccount=function(n){g({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(s){w.del("/users/"+n+"/mute",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(f.error)}})};function g(n){A.render(n.tpl,{}).then(function(s){const u=P.dialog({title:n.title,message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:n.title,callback:function(){const m=u.find("form").serializeArray().reduce(function(x,e){return x[e.name]=e.value,x},{});n.onSubmit(m)}}}})})}return d}.apply(y,E),b!==void 0&&(T.exports=b)},49897:(T,y,l)=>{l.r(y),l.d(y,{del:()=>x,get:()=>g,head:()=>n,patch:()=>u,post:()=>s,put:()=>m});var E=l(91749),b=l.n(E),A=l(33530),w=l.n(A);const P=config.relative_path+"/api/v3";async function f(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:P+e.url,typeof t=="function"){d(e).then(r=>t(null,r),r=>{let i=r;r instanceof Error||(i=new Error(String(r)));const c=i.message||String(i);if(c&&!c.startsWith("[[error:")&&(c.toLowerCase()==="fetch failed"||c.toLowerCase()==="failed to fetch"||c.toLowerCase().includes("networkerror")||c.toLowerCase().includes("network")&&c.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=i,i=o}t(i)});return}try{return await d(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,A.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(i)})}throw r}}async function d(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(a){console.error("[API] Error in filter:api.options hook:",a)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(a){const h=a.message||a.toString()||String(a),C=a.name||"Error";if(C==="TypeError"&&(h.toLowerCase().includes("fetch")||h.toLowerCase().includes("network")||h.toLowerCase().includes("failed to fetch")||h.toLowerCase().includes("load failed"))||h.toLowerCase().includes("cors")||h.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:h,name:C});const p=new Error("[[error:no-connection]]");throw p.originalError=a,p}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:h,name:C}),a}const{headers:i}=r;if(i.get("x-redirect"))return d({url:i.get("x-redirect"),...e});const c=i.get("content-type"),k=c&&c.startsWith("application/json");let o;if(e.method!=="HEAD")try{k?o=await r.json():o=await r.text()}catch(a){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:c,error:a.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let a;throw o?k&&o.status&&o.status.message?a=o.status.message:typeof o=="string"?a=o:a=r.statusText||"Request failed":a=r.statusText||"Request failed",new Error(a)}return k&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function g(e,t,r){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function n(e,t,r){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function s(e,t,r){return f({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function u(e,t,r){return f({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function m(e,t,r){return f({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function x(e,t,r){return f({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}}}]);
