(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,34229,97082],{18675:()=>{(function(g){var b=g(window),a=function(n,o,t,e){if(arguments.length===3||e){if(t<n)return n;if(t>o)return o}return t},m=function(n){n.clientX=n.originalEvent.touches[0].clientX,n.clientY=n.originalEvent.touches[0].clientY},f=function(n){var o=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(o){var t={width:0,height:0},e=new Image;return e.onload=function(){if(n.css("background-size")=="cover"){var c=n.innerWidth(),i=n.innerHeight(),u=c/i,s=e.width/e.height,r=1;s>=u?r=i/e.height:r=c/e.width,t.width=e.width*r,t.height=e.height*r}else t.width=e.width,t.height=e.height},e.src=o,t}};function v(n,o){this.element=n,this.options=o,this.init()}v.prototype.init=function(){var n=g(this.element),o=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t=this.options;if(o){var e={width:0,height:0};(t.bound||t.units=="percent")&&(e=f(n)),g(window).on("keydown.dbg",c=>{var i=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],u=parseInt(i[1])||0,s=parseInt(i[2])||0;t.units=="percent"&&(u=Math.round(u/-200*e.width),s=Math.round(s/-200*e.height));var r=0,d=0;return c.which===37?r=-5:c.which===39?r=5:c.which===38?d=-5:c.which===40&&(d=5),t.units==="percent"?(u=t.axis==="y"?u:a(-e.width/2,0,u+r,t.bound),s=t.axis==="x"?s:a(-e.height/2,0,s+d,t.bound),n.css("background-position",u/e.width*-200+"% "+s/e.height*-200+"%")):(u=t.axis==="y"?u:a(n.innerWidth()-e.width,0,u+r,t.bound),s=t.axis==="x"?s:a(n.innerHeight()-e.height,0,s+d,t.bound)),[37,38,39,40].includes(c.which)?!1:void 0}),n.on("mousedown.dbg touchstart.dbg",function(c){if(c.target===n[0]){if(c.preventDefault(),c.originalEvent.touches)m(c);else if(c.which!==1)return;var i=c.clientX,u=c.clientY,s=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],r=parseInt(s[1])||0,d=parseInt(s[2])||0;t.units=="percent"&&(r=Math.round(r/-200*e.width),d=Math.round(d/-200*e.height)),b.on("mousemove.dbg touchmove.dbg",function(h){h.preventDefault(),h.originalEvent.touches&&m(h);var x=h.clientX,k=h.clientY;t.units=="percent"?(r=t.axis==="y"?r:a(-e.width/2,0,r+x-i,t.bound),d=t.axis==="x"?d:a(-e.height/2,0,d+k-u,t.bound),n.css("background-position",r/e.width*-200+"% "+d/e.height*-200+"%")):(r=t.axis==="y"?r:a(n.innerWidth()-e.width,0,r+x-i,t.bound),d=t.axis==="x"?d:a(n.innerHeight()-e.height,0,d+k-u,t.bound),n.css("background-position",r+"px "+d+"px")),i=x,u=k}),b.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){t.done&&t.done(),b.off("mousemove.dbg touchmove.dbg"),b.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},v.prototype.disable=function(){var n=g(this.element);n.off("mousedown.dbg touchstart.dbg"),b.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},g.fn.backgroundDraggable=function(n){var o=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=g(this),e;typeof n>"u"||typeof n=="object"?(n=g.extend({},g.fn.backgroundDraggable.defaults,n),e=new v(this,n),t.data("dbg",e)):typeof n=="string"&&t.data("dbg")&&(e=t.data("dbg"),v.prototype[n].apply(e,o))})},g.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(g,b,a)=>{"use strict";var m,f;m=[a(81335),a(49897),a(33530),a(29930)],f=function(v,n,o,t){const e={};e.banAccount=function(i,u){i=i||ajaxify.data.theirid,c({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(s){const r=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;n.put("/users/"+i+"/ban",{until:r,reason:s.reason||""}).then(()=>{if(typeof u=="function")return u();ajaxify.refresh()}).catch(t.error)}})},e.unbanAccount=function(i){c({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(u){n.del("/users/"+i+"/ban",{reason:u.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})},e.muteAccount=function(i,u){i=i||ajaxify.data.theirid,c({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(s){const r=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;n.put("/users/"+i+"/mute",{until:r,reason:s.reason||""}).then(()=>{if(typeof u=="function")return u();ajaxify.refresh()}).catch(t.error)}})},e.unmuteAccount=function(i){c({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(u){n.del("/users/"+i+"/mute",{reason:u.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})};function c(i){v.render(i.tpl,{}).then(function(u){const s=o.dialog({title:i.title,message:u,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:i.title,callback:function(){const r=s.find("form").serializeArray().reduce(function(d,h){return d[h.name]=h.value,d},{});i.onSubmit(r)}}}})})}return e}.apply(b,m),f!==void 0&&(g.exports=f)},36684:(g,b,a)=>{"use strict";var m,f;m=[a(29930),a(18675)],f=function(v){const n={coverEl:null,saveFn:null};n.init=function(t,e,c,i){n.coverEl=t,n.saveFn=e,t.find(".upload").on("click",c),t.find(".resize").on("click",function(){o(t)}),t.find(".remove").on("click",i),t.on("dragover",n.onDragOver).on("drop",n.onDrop),t.find(".save").on("click",n.save),t.addClass("initialised")},n.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},n.onDrop=function(t){t.stopPropagation(),t.preventDefault();const e=t.originalEvent.dataTransfer.files,c=new FileReader;e.length&&e[0].type.match("image.*")&&(c.onload=function(i){n.coverEl.css("background-image","url("+i.target.result+")"),n.newCover=i.target.result},c.readAsDataURL(e[0]),o(n.coverEl))};function o(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),v.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return n.save=function(){n.coverEl.addClass("saving"),n.saveFn(n.newCover||void 0,n.coverEl.css("background-position"),function(t){t?v.error(t):(n.coverEl.toggleClass("active",0),n.coverEl.backgroundDraggable("disable"),n.coverEl.off("dragover",n.onDragOver),n.coverEl.off("drop",n.onDrop),v.success("[[modules:cover.saved]]")),n.coverEl.removeClass("saving")})},n}.apply(b,m),f!==void 0&&(g.exports=f)},47283:(g,b,a)=>{"use strict";var m,f;m=[a(49897),a(33530),a(29930)],f=function(v,n,o){const t={};t.account=function(c,i){e(c,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",i)},t.content=function(c,i){e(c,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",i)},t.purge=function(c,i){e(c,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",i)};function e(c,i,u,s,r){n.confirm(i,function(d){d&&v.del(`/users/${encodeURIComponent(c)}${u}`,{}).then(()=>{if(o.success(s),typeof r=="function")return r()}).catch(o.error)})}return t}.apply(b,m),f!==void 0&&(g.exports=f)},60089:(g,b,a)=>{"use strict";var m,f;m=[a(67910),a(49897),a(91749),a(29930)],f=function(v,n,o,t){const e={};e.init=function(){v.init();const i=$('[component="blocks/search/list"]'),u=i.find('[component="blocks/start-typing"]'),s=i.find('[component="blocks/no-users"]');$("#user-search").on("keyup",utils.debounce(function(){const r=this.value;if(!r){i.find('[component="blocks/search/match"]').remove(),u.removeClass("hidden"),s.addClass("hidden");return}u.addClass("hidden"),n.get("/api/users",{query:r,searchBy:"username",paginate:!1},function(d,h){if(d)return t.error(d);if(!h.users.length){i.find('[component="blocks/search/match"]').remove(),s.removeClass("hidden");return}s.addClass("hidden"),h.matchCount>10&&(h.users.length=10),app.parseAndTranslate("account/blocks","edit",{edit:h.users},function(x){i.find('[component="blocks/search/match"]').remove(),x.insertAfter(s)})})},200)),$(".block-edit").on("click",'[data-action="block"], [data-action="unblock"]',async function(){const r=parseInt(this.getAttribute("data-uid"),10),d=$(this).attr("data-action"),h=$(this);await c(r,d),h.addClass("hidden").siblings("[data-action]").removeClass("hidden"),e.refreshList()}),$("#users-container").on("click",'[data-action="unblock"]',async function(){await c($(this).attr("data-uid"),$(this).attr("data-action")),e.refreshList()})};async function c(i,u){return socket.emit("user.toggleBlock",{blockeeUid:i,blockerUid:ajaxify.data.uid,action:u}).catch(t.error)}return e.refreshList=function(){$.get(config.relative_path+"/api/"+ajaxify.currentPage).done(function(i){app.parseAndTranslate("account/blocks","users",i,function(u){u.find(".timeago").timeago(),$("#users-container").html(u),$("#users-container").siblings("div.alert")[u.length?"hide":"show"]()}),o.fire("action:user.blocks.toggle",{data:i})}).fail(function(){ajaxify.go(ajaxify.currentPage)})},e}.apply(b,m),f!==void 0&&(g.exports=f)},67910:(g,b,a)=>{"use strict";var m,f;m=[a(36684),a(72254),a(52473),a(17459),a(47283),a(28061),a(7524),a(49897),a(33530),a(29930)],f=function(v,n,o,t,e,c,i,u,s,r){const d={};let h;d.init=function(){h=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,x(),k(),h&&C(),o.get("account/follow").on("click",()=>A("follow")),o.get("account/unfollow").on("click",()=>A("unfollow")),o.get("account/chat").on("click",async function(){const{roomId:l}=await u.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),p=await app.require("chat");l?p.openChat(l):p.newChat(ajaxify.data.uid)}),o.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){o.get("account/chat").parent().removeClass("hidden")})}),o.get("account/ban").on("click",()=>c.banAccount(ajaxify.data.theirid)),o.get("account/mute").on("click",()=>c.muteAccount(ajaxify.data.theirid)),o.get("account/unban").on("click",()=>c.unbanAccount(ajaxify.data.theirid)),o.get("account/unmute").on("click",()=>c.unmuteAccount(ajaxify.data.theirid)),o.get("account/delete-account").on("click",()=>e.account(ajaxify.data.theirid)),o.get("account/delete-content").on("click",()=>e.content(ajaxify.data.theirid)),o.get("account/delete-all").on("click",()=>e.purge(ajaxify.data.theirid)),o.get("account/flag").on("click",w),o.get("account/already-flagged").on("click",D),o.get("account/block").on("click",()=>E("block")),o.get("account/unblock").on("click",()=>E("unblock"))};function x(){$(".account-sub-links li a").removeClass("active").each(function(){const l=$(this).attr("href");if(decodeURIComponent(l)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function k(){$('[component="profile/change/picture"]').on("click",function(){return i.openChangeModal(),!1})}function C(){v.init(o.get("account/cover"),function(l,p,y){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:l,position:p},y)},function(){n.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(l){l=(l.startsWith("http")?"":config.relative_path)+l+"?"+Date.now(),o.get("account/cover").css("background-image","url("+l+")")})},j)}function A(l){const p=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return u[l==="follow"?"put":"del"]("/users/"+p+"/follow",void 0,function(y){if(y)return r.error(y);o.get("account/follow").toggleClass("hide",l==="follow"),o.get("account/unfollow").toggleClass("hide",l==="unfollow"),r.success("[[global:alert."+l+", "+ajaxify.data.username+"]]")}),!1}function w(){a.e(6574).then(function(){var l=[a(6574)];(function(p){p.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,l)}).catch(a.oe)}function D(){const l=$(this).data("flag-id");a.e(6574).then(function(){var p=[a(6574)];(function(y){s.confirm("[[flags:modal-confirm-rescind]]",function(R){R&&y.rescind(l)})}).apply(null,p)}).catch(a.oe)}function E(l){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:l},function(p,y){if(p)return r.error(p);o.get("account/block").toggleClass("hidden",y),o.get("account/unblock").toggleClass("hidden",!y)}),!1}function j(){t.translate("[[user:remove-cover-picture-confirm]]",function(l){s.confirm(l,function(p){p&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(y){y?r.error(y):ajaxify.refresh()})})})}return d}.apply(b,m),f!==void 0&&(g.exports=f)}}]);
