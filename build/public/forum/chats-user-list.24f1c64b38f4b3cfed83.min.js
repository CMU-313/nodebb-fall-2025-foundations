"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,56227,99127],{49897:(P,k,d)=>{d.r(k),d.d(k,{del:()=>p,get:()=>T,head:()=>c,patch:()=>o,post:()=>a,put:()=>w});var E=d(91749),C=d.n(E),m=d(33530),y=d.n(m);const f=config.relative_path+"/api/v3";async function u(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:f+e.url,typeof r=="function"){g(e).then(t=>r(null,t),t=>{let l=t;t instanceof Error||(l=new Error(String(t)));const i=l.message||String(l);if(i&&!i.startsWith("[[error:")&&(i.toLowerCase()==="fetch failed"||i.toLowerCase()==="failed to fetch"||i.toLowerCase().includes("networkerror")||i.toLowerCase().includes("network")&&i.toLowerCase().includes("failed"))){const n=new Error("[[error:no-connection]]");n.originalError=l,l=n}r(l)});return}try{return await g(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:l}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",i=>{i&&ajaxify.go(l)})}throw t}}async function g(e){const{url:r}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,E.fire)("filter:api.options",{options:e}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}e.data&&(e.body=e.data,delete e.data);let t;try{t=await fetch(r,e)}catch(s){const h=s.message||s.toString()||String(s),x=s.name||"Error";if(x==="TypeError"&&(h.toLowerCase().includes("fetch")||h.toLowerCase().includes("network")||h.toLowerCase().includes("failed to fetch")||h.toLowerCase().includes("load failed"))||h.toLowerCase().includes("cors")||h.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:r,method:e.method||"GET",error:h,name:x});const A=new Error("[[error:no-connection]]");throw A.originalError=s,A}throw console.error("[API] Unexpected fetch error:",{url:r,method:e.method||"GET",error:h,name:x}),s}const{headers:l}=t;if(l.get("x-redirect"))return g({url:l.get("x-redirect"),...e});const i=l.get("content-type"),_=i&&i.startsWith("application/json");let n;if(e.method!=="HEAD")try{_?n=await t.json():n=await t.text()}catch(s){throw console.error("[API] Error parsing response:",{url:r,status:t.status,statusText:t.statusText,contentType:i,error:s.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let s;throw n?_&&n.status&&n.status.message?s=n.status.message:typeof n=="string"?s=n:s=t.statusText||"Request failed":s=t.statusText||"Request failed",new Error(s)}return _&&n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n}function T(e,r,t){return u({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},t)}function c(e,r,t){return u({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},t)}function a(e,r,t){return u({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function o(e,r,t){return u({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function w(e,r,t){return u({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}function p(e,r,t){return u({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},t)}},72513:(P,k,d)=>{var E,C;E=[d(49897)],C=function(m){const y={};let f=0;y.init=function(c,a){const o=a.find('[component="chat/user/list"]');if(!o.length)return;const w=a.find('[component="chat/messages/pinned/container"]');a.find('[component="chat/user/list/btn"]').on("click",()=>{o.toggleClass("hidden"),o.hasClass("hidden")?g():(w.addClass("hidden"),u(c,o))}),$(window).off("action:ajaxify.start",g).one("action:ajaxify.start",g),y.addInfiniteScrollHandler(c,o,async(p,e)=>{p.append(await app.parseAndTranslate("partials/chats/user-list","users",e))})};function u(c,a){f&&clearInterval(f),f=setInterval(()=>{T(c,a)},5e3)}function g(){f&&(clearInterval(f),f=0)}async function T(c,a){if(ajaxify.data.template.chats&&app.isFocused&&a.scrollTop()===0&&!a.hasClass("hidden")){const o=await m.get(`/chats/${c}/users`,{start:0});a.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),a.html(await app.parseAndTranslate("partials/chats/user-list","users",o)),a.find('[data-bs-toggle="tooltip"]').tooltip()}}return y.addInfiniteScrollHandler=function(c,a,o){a.on("scroll",utils.debounce(async()=>{const w=(a[0].scrollHeight-a.height())*.85;if(a.scrollTop()>w){const p=a.find("[data-index]").last().attr("data-index"),e=await m.get(`/chats/${c}/users`,{start:parseInt(p,10)+1});e&&e.users.length&&o(a,e)}},200))},y.addSearchHandler=function(c,a,o){a.on("keyup",utils.debounce(async()=>{const w=a.val(),p=await m.get(`/search/chats/${c}/users`,{query:w});o(p)},200))},y}.apply(k,E),C!==void 0&&(P.exports=C)}}]);
