"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,53020,99127],{49897:(C,d,l)=>{l.r(d),l.d(d,{del:()=>b,get:()=>E,head:()=>g,patch:()=>L,post:()=>A,put:()=>x});var f=l(91749),h=l.n(f),m=l(33530),P=l.n(m);const y=config.relative_path+"/api/v3";async function i(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:y+e.url,typeof t=="function"){u(e).then(r=>t(null,r),r=>{let s=r;r instanceof Error||(s=new Error(String(r)));const o=s.message||String(s);if(o&&!o.startsWith("[[error:")&&(o.toLowerCase()==="fetch failed"||o.toLowerCase()==="failed to fetch"||o.toLowerCase().includes("networkerror")||o.toLowerCase().includes("network")&&o.toLowerCase().includes("failed"))){const n=new Error("[[error:no-connection]]");n.originalError=s,s=n}t(s)});return}try{return await u(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go(s)})}throw r}}async function u(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,f.fire)("filter:api.options",{options:e}))}catch(a){console.error("[API] Error in filter:api.options hook:",a)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(a){const c=a.message||a.toString()||String(a),k=a.name||"Error";if(k==="TypeError"&&(c.toLowerCase().includes("fetch")||c.toLowerCase().includes("network")||c.toLowerCase().includes("failed to fetch")||c.toLowerCase().includes("load failed"))||c.toLowerCase().includes("cors")||c.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:c,name:k});const T=new Error("[[error:no-connection]]");throw T.originalError=a,T}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:c,name:k}),a}const{headers:s}=r;if(s.get("x-redirect"))return u({url:s.get("x-redirect"),...e});const o=s.get("content-type"),w=o&&o.startsWith("application/json");let n;if(e.method!=="HEAD")try{w?n=await r.json():n=await r.text()}catch(a){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:o,error:a.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let a;throw n?w&&n.status&&n.status.message?a=n.status.message:typeof n=="string"?a=n:a=r.statusText||"Request failed":a=r.statusText||"Request failed",new Error(a)}return w&&n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n}function E(e,t,r){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function g(e,t,r){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function A(e,t,r){return i({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function L(e,t,r){return i({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function x(e,t,r){return i({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function b(e,t,r){return i({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}},86296:(C,d,l)=>{var f,h;f=[l(49897),l(33530),l(29930)],h=function(m,P,y){const i={};return i.init=function(u){const E=P.dialog({message:`
				<label class="form-label">[[admin/manage/users:new-email]]</label>
				<input id="newEmail" class="form-control" type="text" value="${utils.escapeHTML(u.email||"")}">
			`,title:"[[admin/manage/users:change-email]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){const g=E.find("#newEmail").val();return m.post("/users/"+u.uid+"/emails",{skipConfirmation:!0,email:g}).then(()=>{E.modal("hide"),u.onSuccess(g)}).catch(y.error),!1}}}})},i}.apply(d,f),h!==void 0&&(C.exports=h)}}]);
