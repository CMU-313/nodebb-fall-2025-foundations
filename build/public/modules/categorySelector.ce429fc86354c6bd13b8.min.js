"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,86198,99127],{49897:(k,w,f)=>{f.r(w),f.d(w,{del:()=>u,get:()=>t,head:()=>o,patch:()=>a,post:()=>g,put:()=>m});var y=f(91749),C=f.n(y),p=f(33530),L=f.n(p);const A=config.relative_path+"/api/v3";async function h(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:A+e.url,typeof n=="function"){l(e).then(r=>n(null,r),r=>{let s=r;r instanceof Error||(s=new Error(String(r)));const c=s.message||String(s);if(c&&!c.startsWith("[[error:")&&(c.toLowerCase()==="fetch failed"||c.toLowerCase()==="failed to fetch"||c.toLowerCase().includes("networkerror")||c.toLowerCase().includes("network")&&c.toLowerCase().includes("failed"))){const i=new Error("[[error:no-connection]]");i.originalError=s,s=i}n(s)});return}try{return await l(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(s)})}throw r}}async function l(e){const{url:n}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,y.fire)("filter:api.options",{options:e}))}catch(d){console.error("[API] Error in filter:api.options hook:",d)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(n,e)}catch(d){const E=d.message||d.toString()||String(d),D=d.name||"Error";if(D==="TypeError"&&(E.toLowerCase().includes("fetch")||E.toLowerCase().includes("network")||E.toLowerCase().includes("failed to fetch")||E.toLowerCase().includes("load failed"))||E.toLowerCase().includes("cors")||E.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:n,method:e.method||"GET",error:E,name:D});const S=new Error("[[error:no-connection]]");throw S.originalError=d,S}throw console.error("[API] Unexpected fetch error:",{url:n,method:e.method||"GET",error:E,name:D}),d}const{headers:s}=r;if(s.get("x-redirect"))return l({url:s.get("x-redirect"),...e});const c=s.get("content-type"),P=c&&c.startsWith("application/json");let i;if(e.method!=="HEAD")try{P?i=await r.json():i=await r.text()}catch(d){throw console.error("[API] Error parsing response:",{url:n,status:r.status,statusText:r.statusText,contentType:c,error:d.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let d;throw i?P&&i.status&&i.status.message?d=i.status.message:typeof i=="string"?d=i:d=r.statusText||"Request failed":d=r.statusText||"Request failed",new Error(d)}return P&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function t(e,n,r){return h({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},r)}function o(e,n,r){return h({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},r)}function g(e,n,r){return h({url:e,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function a(e,n,r){return h({url:e,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function m(e,n,r){return h({url:e,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function u(e,n,r){return h({url:e,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}},65348:(k,w,f)=>{var y,C;y=[f(96349),f(33530),f(91749),f(17459)],C=function(p,L,A,h){const l={};return l.init=function(t,o){if(!t||!t.length)return;o=o||{};const g=o.onSelect||function(){};o.states=o.states||["watching","tracking","notwatching","ignoring"],o.template=o.template||"partials/category/selector-dropdown-left",A.fire("action:category.selector.options",{el:t,options:o}),p.init(t,o);const a={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const u=$(this);return u.hasClass("disabled")?!1:(a.selectCategory(u.attr("data-cid")),g(a.selectedCategory))});let m=a.el.find('[component="category-selector-selected"]').html();return h.translate(m,u=>{m=u}),a.selectCategory=function(u){const e=a.el.find('[data-cid="'+u+'"]');a.selectedCategory={cid:u,name:e.attr("data-name")},e.length?a.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):a.el.find('[component="category-selector-selected"]').html(m)},a.getSelectedCategory=function(){return a.selectedCategory},a.getSelectedCid=function(){return a.selectedCategory?a.selectedCategory.cid:0},o.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(o.template,{selectedCategory:o.selectedCategory},function(u){a.el.find('[component="category-selector-selected"]').html(u.find('[component="category-selector-selected"]').html())}),a},l.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(o){const g=L.dialog({title:t.title||"[[modules:composer.select-category]]",message:o,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:m}}}),a=l.init(g.find('[component="category-selector"]'),t);function m(u){return u.preventDefault(),a.selectedCategory&&(t.onSubmit(a.selectedCategory),g.modal("hide")),!1}t.openOnLoad&&g.on("shown.bs.modal",function(){g.find(".dropdown-toggle").dropdown("toggle")}),g.find("form").on("submit",m)})},l}.apply(w,y),C!==void 0&&(k.exports=C)},96349:(k,w,f)=>{var y,C;y=[f(29930),f(89336),f(49897)],C=function(p,L,A){const h={};return h.init=function(l,t){let o=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let g=[];Array.isArray(t.localCategories)&&(g=t.localCategories.map(n=>({...n})),o&&(o=[...g,...o])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const a=l.find('[component="category-selector-search"]');if(!a.length)return;const m=a.parents('[component="category/dropdown"]').length>0||a.parents('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){m&&a.removeClass("hidden");function n(){const r=a.find("input").val();r.length>1||!r&&!o?u(r,function(s){o=t.cacheList&&(o||s),e(s)}):!r&&o&&e(o)}a.on("click",function(r){r.preventDefault(),r.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(n,300)),n()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||a.find("input").focus()}),l.on("hide.bs.dropdown",function(){m&&a.addClass("hidden"),a.off("click"),a.find("input").off("keyup")});function u(n,r){A.get("/search/categories",{search:n,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(s,{categories:c}){if(s)return p.error(s);r(g.concat(c))})}function e(n){const r=t.selectedCids.map(String);n.forEach(function(s){s.selected=r.includes(String(s.cid))}),app.parseAndTranslate(t.template,{categoryItems:n.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){l.find('[component="category/list"]').html(s.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!n.length);const c=L.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));c&&c.update()})}},h}.apply(w,y),C!==void 0&&(k.exports=C)}}]);
