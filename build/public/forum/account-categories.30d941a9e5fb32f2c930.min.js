(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,38747,97082],{18675:()=>{(function(h){var y=h(window),r=function(n,i,t,e){if(arguments.length===3||e){if(t<n)return n;if(t>i)return i}return t},m=function(n){n.clientX=n.originalEvent.touches[0].clientX,n.clientY=n.originalEvent.touches[0].clientY},g=function(n){var i=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(i){var t={width:0,height:0},e=new Image;return e.onload=function(){if(n.css("background-size")=="cover"){var u=n.innerWidth(),o=n.innerHeight(),c=u/o,d=e.width/e.height,a=1;d>=c?a=o/e.height:a=u/e.width,t.width=e.width*a,t.height=e.height*a}else t.width=e.width,t.height=e.height},e.src=i,t}};function p(n,i){this.element=n,this.options=i,this.init()}p.prototype.init=function(){var n=h(this.element),i=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t=this.options;if(i){var e={width:0,height:0};(t.bound||t.units=="percent")&&(e=g(n)),h(window).on("keydown.dbg",u=>{var o=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],c=parseInt(o[1])||0,d=parseInt(o[2])||0;t.units=="percent"&&(c=Math.round(c/-200*e.width),d=Math.round(d/-200*e.height));var a=0,s=0;return u.which===37?a=-5:u.which===39?a=5:u.which===38?s=-5:u.which===40&&(s=5),t.units==="percent"?(c=t.axis==="y"?c:r(-e.width/2,0,c+a,t.bound),d=t.axis==="x"?d:r(-e.height/2,0,d+s,t.bound),n.css("background-position",c/e.width*-200+"% "+d/e.height*-200+"%")):(c=t.axis==="y"?c:r(n.innerWidth()-e.width,0,c+a,t.bound),d=t.axis==="x"?d:r(n.innerHeight()-e.height,0,d+s,t.bound)),[37,38,39,40].includes(u.which)?!1:void 0}),n.on("mousedown.dbg touchstart.dbg",function(u){if(u.target===n[0]){if(u.preventDefault(),u.originalEvent.touches)m(u);else if(u.which!==1)return;var o=u.clientX,c=u.clientY,d=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],a=parseInt(d[1])||0,s=parseInt(d[2])||0;t.units=="percent"&&(a=Math.round(a/-200*e.width),s=Math.round(s/-200*e.height)),y.on("mousemove.dbg touchmove.dbg",function(f){f.preventDefault(),f.originalEvent.touches&&m(f);var x=f.clientX,w=f.clientY;t.units=="percent"?(a=t.axis==="y"?a:r(-e.width/2,0,a+x-o,t.bound),s=t.axis==="x"?s:r(-e.height/2,0,s+w-c,t.bound),n.css("background-position",a/e.width*-200+"% "+s/e.height*-200+"%")):(a=t.axis==="y"?a:r(n.innerWidth()-e.width,0,a+x-o,t.bound),s=t.axis==="x"?s:r(n.innerHeight()-e.height,0,s+w-c,t.bound),n.css("background-position",a+"px "+s+"px")),o=x,c=w}),y.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){t.done&&t.done(),y.off("mousemove.dbg touchmove.dbg"),y.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},p.prototype.disable=function(){var n=h(this.element);n.off("mousedown.dbg touchstart.dbg"),y.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},h.fn.backgroundDraggable=function(n){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=h(this),e;typeof n>"u"||typeof n=="object"?(n=h.extend({},h.fn.backgroundDraggable.defaults,n),e=new p(this,n),t.data("dbg",e)):typeof n=="string"&&t.data("dbg")&&(e=t.data("dbg"),p.prototype[n].apply(e,i))})},h.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(h,y,r)=>{"use strict";var m,g;m=[r(81335),r(49897),r(33530),r(29930)],g=function(p,n,i,t){const e={};e.banAccount=function(o,c){o=o||ajaxify.data.theirid,u({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(d){const a=d.length>0?Date.now()+d.length*1e3*60*60*(parseInt(d.unit,10)?24:1):0;n.put("/users/"+o+"/ban",{until:a,reason:d.reason||""}).then(()=>{if(typeof c=="function")return c();ajaxify.refresh()}).catch(t.error)}})},e.unbanAccount=function(o){u({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(c){n.del("/users/"+o+"/ban",{reason:c.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})},e.muteAccount=function(o,c){o=o||ajaxify.data.theirid,u({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(d){const a=d.length>0?Date.now()+d.length*1e3*60*60*(parseInt(d.unit,10)?24:1):0;n.put("/users/"+o+"/mute",{until:a,reason:d.reason||""}).then(()=>{if(typeof c=="function")return c();ajaxify.refresh()}).catch(t.error)}})},e.unmuteAccount=function(o){u({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(c){n.del("/users/"+o+"/mute",{reason:c.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})};function u(o){p.render(o.tpl,{}).then(function(c){const d=i.dialog({title:o.title,message:c,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:o.title,callback:function(){const a=d.find("form").serializeArray().reduce(function(s,f){return s[f.name]=f.value,s},{});o.onSubmit(a)}}}})})}return e}.apply(y,m),g!==void 0&&(h.exports=g)},36684:(h,y,r)=>{"use strict";var m,g;m=[r(29930),r(18675)],g=function(p){const n={coverEl:null,saveFn:null};n.init=function(t,e,u,o){n.coverEl=t,n.saveFn=e,t.find(".upload").on("click",u),t.find(".resize").on("click",function(){i(t)}),t.find(".remove").on("click",o),t.on("dragover",n.onDragOver).on("drop",n.onDrop),t.find(".save").on("click",n.save),t.addClass("initialised")},n.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},n.onDrop=function(t){t.stopPropagation(),t.preventDefault();const e=t.originalEvent.dataTransfer.files,u=new FileReader;e.length&&e[0].type.match("image.*")&&(u.onload=function(o){n.coverEl.css("background-image","url("+o.target.result+")"),n.newCover=o.target.result},u.readAsDataURL(e[0]),i(n.coverEl))};function i(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),p.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return n.save=function(){n.coverEl.addClass("saving"),n.saveFn(n.newCover||void 0,n.coverEl.css("background-position"),function(t){t?p.error(t):(n.coverEl.toggleClass("active",0),n.coverEl.backgroundDraggable("disable"),n.coverEl.off("dragover",n.onDragOver),n.coverEl.off("drop",n.onDrop),p.success("[[modules:cover.saved]]")),n.coverEl.removeClass("saving")})},n}.apply(y,m),g!==void 0&&(h.exports=g)},47283:(h,y,r)=>{"use strict";var m,g;m=[r(49897),r(33530),r(29930)],g=function(p,n,i){const t={};t.account=function(u,o){e(u,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",o)},t.content=function(u,o){e(u,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",o)},t.purge=function(u,o){e(u,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",o)};function e(u,o,c,d,a){n.confirm(o,function(s){s&&p.del(`/users/${encodeURIComponent(u)}${c}`,{}).then(()=>{if(i.success(d),typeof a=="function")return a()}).catch(i.error)})}return t}.apply(y,m),g!==void 0&&(h.exports=g)},49859:(h,y,r)=>{"use strict";var m,g;m=[r(67910),r(29930),r(49897)],g=function(p,n,i){const t={};t.init=function(){p.init(),ajaxify.data.categories.forEach(function(o){e(o.cid)}),$('[component="category/watch/all"]').find('[component="category/watching"], [component="category/tracking"], [component="category/ignoring"], [component="category/notwatching"]').on("click",async o=>{const c=[],d=o.currentTarget.getAttribute("data-state"),{uid:a}=ajaxify.data;$('[data-parent-cid="0"]').each(function(f,x){c.push($(x).attr("data-cid"))});let s=await Promise.all(c.map(async f=>i.put(`/categories/${f}/watch`,{state:d,uid:a})));s=s.reduce((f,x)=>f.concat(x.modified),[]).filter((f,x,w)=>w.indexOf(f)===x),u(s,d)})};function e(o){$('[data-cid="'+o+'"]').find('[component="category/watching"], [component="category/tracking"], [component="category/ignoring"], [component="category/notwatching"]').on("click",async d=>{const a=d.currentTarget.getAttribute("data-state"),{uid:s}=ajaxify.data,{modified:f}=await i.put(`/categories/${o}/watch`,{state:a,uid:s});u(f,a),n.success("[[category:"+a+".message]]")})}function u(o,c){o.forEach(function(d){const a=$('[data-cid="'+d+'"]');a.find('[component="category/watching/menu"]').toggleClass("hidden",c!=="watching"),a.find('[component="category/watching/check"]').toggleClass("fa-check",c==="watching"),a.find('[component="category/tracking/menu"]').toggleClass("hidden",c!=="tracking"),a.find('[component="category/tracking/check"]').toggleClass("fa-check",c==="tracking"),a.find('[component="category/notwatching/menu"]').toggleClass("hidden",c!=="notwatching"),a.find('[component="category/notwatching/check"]').toggleClass("fa-check",c==="notwatching"),a.find('[component="category/ignoring/menu"]').toggleClass("hidden",c!=="ignoring"),a.find('[component="category/ignoring/check"]').toggleClass("fa-check",c==="ignoring")})}return t}.apply(y,m),g!==void 0&&(h.exports=g)},67910:(h,y,r)=>{"use strict";var m,g;m=[r(36684),r(72254),r(52473),r(17459),r(47283),r(28061),r(7524),r(49897),r(33530),r(29930)],g=function(p,n,i,t,e,u,o,c,d,a){const s={};let f;s.init=function(){f=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,x(),w(),f&&C(),i.get("account/follow").on("click",()=>E("follow")),i.get("account/unfollow").on("click",()=>E("unfollow")),i.get("account/chat").on("click",async function(){const{roomId:l}=await c.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),v=await app.require("chat");l?v.openChat(l):v.newChat(ajaxify.data.uid)}),i.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){i.get("account/chat").parent().removeClass("hidden")})}),i.get("account/ban").on("click",()=>u.banAccount(ajaxify.data.theirid)),i.get("account/mute").on("click",()=>u.muteAccount(ajaxify.data.theirid)),i.get("account/unban").on("click",()=>u.unbanAccount(ajaxify.data.theirid)),i.get("account/unmute").on("click",()=>u.unmuteAccount(ajaxify.data.theirid)),i.get("account/delete-account").on("click",()=>e.account(ajaxify.data.theirid)),i.get("account/delete-content").on("click",()=>e.content(ajaxify.data.theirid)),i.get("account/delete-all").on("click",()=>e.purge(ajaxify.data.theirid)),i.get("account/flag").on("click",k),i.get("account/already-flagged").on("click",D),i.get("account/block").on("click",()=>A("block")),i.get("account/unblock").on("click",()=>A("unblock"))};function x(){$(".account-sub-links li a").removeClass("active").each(function(){const l=$(this).attr("href");if(decodeURIComponent(l)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function w(){$('[component="profile/change/picture"]').on("click",function(){return o.openChangeModal(),!1})}function C(){p.init(i.get("account/cover"),function(l,v,b){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:l,position:v},b)},function(){n.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(l){l=(l.startsWith("http")?"":config.relative_path)+l+"?"+Date.now(),i.get("account/cover").css("background-image","url("+l+")")})},j)}function E(l){const v=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return c[l==="follow"?"put":"del"]("/users/"+v+"/follow",void 0,function(b){if(b)return a.error(b);i.get("account/follow").toggleClass("hide",l==="follow"),i.get("account/unfollow").toggleClass("hide",l==="unfollow"),a.success("[[global:alert."+l+", "+ajaxify.data.username+"]]")}),!1}function k(){r.e(6574).then(function(){var l=[r(6574)];(function(v){v.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,l)}).catch(r.oe)}function D(){const l=$(this).data("flag-id");r.e(6574).then(function(){var v=[r(6574)];(function(b){d.confirm("[[flags:modal-confirm-rescind]]",function(R){R&&b.rescind(l)})}).apply(null,v)}).catch(r.oe)}function A(l){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:l},function(v,b){if(v)return a.error(v);i.get("account/block").toggleClass("hidden",b),i.get("account/unblock").toggleClass("hidden",!b)}),!1}function j(){t.translate("[[user:remove-cover-picture-confirm]]",function(l){d.confirm(l,function(v){v&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(b){b?a.error(b):ajaxify.refresh()})})})}return s}.apply(y,m),g!==void 0&&(h.exports=g)}}]);
