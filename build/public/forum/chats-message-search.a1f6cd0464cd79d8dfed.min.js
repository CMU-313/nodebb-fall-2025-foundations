"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,89393,99127],{49897:(P,w,i)=>{i.r(w),i.d(w,{del:()=>p,get:()=>l,head:()=>d,patch:()=>E,post:()=>f,put:()=>C});var m=i(91749),y=i.n(m),k=i(33530),T=i.n(k);const v=config.relative_path+"/api/v3";async function h(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:v+e.url,typeof t=="function"){g(e).then(r=>t(null,r),r=>{let a=r;r instanceof Error||(a=new Error(String(r)));const s=a.message||String(a);if(s&&!s.startsWith("[[error:")&&(s.toLowerCase()==="fetch failed"||s.toLowerCase()==="failed to fetch"||s.toLowerCase().includes("networkerror")||s.toLowerCase().includes("network")&&s.toLowerCase().includes("failed"))){const o=new Error("[[error:no-connection]]");o.originalError=a,a=o}t(a)});return}try{return await g(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:a}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,k.confirm)("[[error:api.reauth-required]]",s=>{s&&ajaxify.go(a)})}throw r}}async function g(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,m.fire)("filter:api.options",{options:e}))}catch(n){console.error("[API] Error in filter:api.options hook:",n)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(n){const u=n.message||n.toString()||String(n),A=n.name||"Error";if(A==="TypeError"&&(u.toLowerCase().includes("fetch")||u.toLowerCase().includes("network")||u.toLowerCase().includes("failed to fetch")||u.toLowerCase().includes("load failed"))||u.toLowerCase().includes("cors")||u.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:u,name:A});const L=new Error("[[error:no-connection]]");throw L.originalError=n,L}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:u,name:A}),n}const{headers:a}=r;if(a.get("x-redirect"))return g({url:a.get("x-redirect"),...e});const s=a.get("content-type"),c=s&&s.startsWith("application/json");let o;if(e.method!=="HEAD")try{c?o=await r.json():o=await r.text()}catch(n){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:s,error:n.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let n;throw o?c&&o.status&&o.status.message?n=o.status.message:typeof o=="string"?n=o:n=r.statusText||"Request failed":n=r.statusText||"Request failed",new Error(n)}return c&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function l(e,t,r){return h({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function d(e,t,r){return h({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function f(e,t,r){return h({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function E(e,t,r){return h({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function C(e,t,r){return h({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function p(e,t,r){return h({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}},65161:(P,w,i)=>{var m,y;m=[i(52473),i(29930),i(60419)],y=function(k,T,v){const h={};let g=0,l,d,f,E,C,p;h.init=function(s,c){g=s,d=c.find('[component="chat/message/search/results"]'),f=c.find('[component="chat/message/content"]'),E=c.find('[component="chat/room/search/clear"]'),p=c.find('[component="chat/room/search/container"]'),C=c.find('[component="chat/room/search/toggle"'),l=c.find('[component="chat/room/search"]'),l.on("keyup",utils.debounce(t,250)).on("focus",()=>{l.val()&&t()}),c.find('[component="chat/input"]').on("focus",()=>{d.addClass("hidden"),f.removeClass("hidden")}),E.on("click",e),C.on("click",()=>{p.removeClass("hidden"),C.addClass("hidden"),l.trigger("focus")}),l.on("blur",()=>{l.val()||e()})};function e(){l.val(""),r(),d.addClass("hidden"),E.addClass("hidden"),p.addClass("hidden"),f.removeClass("hidden"),C.removeClass("hidden")}async function t(){const s=l.val();!s||s.length<=2||(E.removeClass("hidden"),socket.emit("modules.chats.searchMessages",{content:s,roomId:g}).then(a).catch(T.error))}function r(){d.children("[data-mid]").remove()}async function a(s){if(r(),!s.messages.length)return d.removeClass("hidden"),f.addClass("hidden"),d.find('[component="chat/message/search/no-results"]').removeClass("hidden");d.find('[component="chat/message/search/no-results"]').addClass("hidden");const c=await app.parseAndTranslate("partials/chats/messages",{messages:s.messages,isAdminOrGlobalMod:app.user.isAdmin||app.user.isGlobalMod});d.append(c),v.onMessagesAddedToDom(d.find('[component="chat/message"]')),f.addClass("hidden"),d.removeClass("hidden")}return h}.apply(w,m),y!==void 0&&(P.exports=y)}}]);
