(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,49016,97082],{18675:()=>{(function(p){var b=p(window),c=function(n,a,t,o){if(arguments.length===3||o){if(t<n)return n;if(t>a)return a}return t},m=function(n){n.clientX=n.originalEvent.touches[0].clientX,n.clientY=n.originalEvent.touches[0].clientY},g=function(n){var a=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(a){var t={width:0,height:0},o=new Image;return o.onload=function(){if(n.css("background-size")=="cover"){var i=n.innerWidth(),e=n.innerHeight(),s=i/e,u=o.width/o.height,r=1;u>=s?r=e/o.height:r=i/o.width,t.width=o.width*r,t.height=o.height*r}else t.width=o.width,t.height=o.height},o.src=a,t}};function v(n,a){this.element=n,this.options=a,this.init()}v.prototype.init=function(){var n=p(this.element),a=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t=this.options;if(a){var o={width:0,height:0};(t.bound||t.units=="percent")&&(o=g(n)),p(window).on("keydown.dbg",i=>{var e=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],s=parseInt(e[1])||0,u=parseInt(e[2])||0;t.units=="percent"&&(s=Math.round(s/-200*o.width),u=Math.round(u/-200*o.height));var r=0,l=0;return i.which===37?r=-5:i.which===39?r=5:i.which===38?l=-5:i.which===40&&(l=5),t.units==="percent"?(s=t.axis==="y"?s:c(-o.width/2,0,s+r,t.bound),u=t.axis==="x"?u:c(-o.height/2,0,u+l,t.bound),n.css("background-position",s/o.width*-200+"% "+u/o.height*-200+"%")):(s=t.axis==="y"?s:c(n.innerWidth()-o.width,0,s+r,t.bound),u=t.axis==="x"?u:c(n.innerHeight()-o.height,0,u+l,t.bound)),[37,38,39,40].includes(i.which)?!1:void 0}),n.on("mousedown.dbg touchstart.dbg",function(i){if(i.target===n[0]){if(i.preventDefault(),i.originalEvent.touches)m(i);else if(i.which!==1)return;var e=i.clientX,s=i.clientY,u=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],r=parseInt(u[1])||0,l=parseInt(u[2])||0;t.units=="percent"&&(r=Math.round(r/-200*o.width),l=Math.round(l/-200*o.height)),b.on("mousemove.dbg touchmove.dbg",function(d){d.preventDefault(),d.originalEvent.touches&&m(d);var E=d.clientX,h=d.clientY;t.units=="percent"?(r=t.axis==="y"?r:c(-o.width/2,0,r+E-e,t.bound),l=t.axis==="x"?l:c(-o.height/2,0,l+h-s,t.bound),n.css("background-position",r/o.width*-200+"% "+l/o.height*-200+"%")):(r=t.axis==="y"?r:c(n.innerWidth()-o.width,0,r+E-e,t.bound),l=t.axis==="x"?l:c(n.innerHeight()-o.height,0,l+h-s,t.bound),n.css("background-position",r+"px "+l+"px")),e=E,s=h}),b.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){t.done&&t.done(),b.off("mousemove.dbg touchmove.dbg"),b.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},v.prototype.disable=function(){var n=p(this.element);n.off("mousedown.dbg touchstart.dbg"),b.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},p.fn.backgroundDraggable=function(n){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=p(this),o;typeof n>"u"||typeof n=="object"?(n=p.extend({},p.fn.backgroundDraggable.defaults,n),o=new v(this,n),t.data("dbg",o)):typeof n=="string"&&t.data("dbg")&&(o=t.data("dbg"),v.prototype[n].apply(o,a))})},p.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},22410:(p,b,c)=>{"use strict";var m,g;m=[c(91749),c(29930),c(49897)],g=function(v,n,a){const t={};let o,i=0,e=!1,s,u=0;t.init=function(d,E){const h=$("body");typeof d=="function"?(o=d,s=h):(o=E,s=d||h),i=$(window).scrollTop(),$(window).off("scroll",r).on("scroll",r),h.height()<=$(window).height()&&(!ajaxify.data.hasOwnProperty("pageCount")||ajaxify.data.pageCount>1)&&o(1)};function r(){u&&clearTimeout(u),u=setTimeout(function(){u=0,l()},60)}function l(){const d=utils.findBootstrapEnvironment(),E=(d==="xs"||d==="sm")&&$("html").hasClass("composing");if(e||E||app.flags._glance)return;const h=$(window).scrollTop(),y=$(window).height(),A=s.height()-y,D=s.offset()?s.offset().top:0,C=100*(h-D)/(A<=0?y:A),k=15,j=85,f=h>i?1:-1;(C<k&&h<i||C>j&&h>i||C<0&&f>0&&A<0)&&o(f),i=h}return t.loadMore=function(d,E,h){if(e)return;e=!0;const y={method:d,data:E};v.fire("action:infinitescroll.loadmore",y),(y.method.startsWith("/")?a.get:socket.emit)(y.method,y.data,function(D,C){if(D)return e=!1,n.error(D);h(C,function(){e=!1})})},t.loadMoreXhr=function(d,E){if(e)return;e=!0;const h=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),y={url:h,data:d};v.fire("action:infinitescroll.loadmore.xhr",y),$.get(h,d,function(A){E(A,function(){e=!1})}).fail(function(A){e=!1,n.error(String(A.responseJSON||"[[error:no-connection]]"))})},t.removeExtra=function(d,E,h){let y=$();if(d.length<=h)return y;const A=d.length-h;if(E>0){const D=$(document).height(),C=$(window).scrollTop();y=d.slice(0,A).remove(),$(window).scrollTop(C+($(document).height()-D))}else y=d.slice(d.length-A).remove();return y},t}.apply(b,m),g!==void 0&&(p.exports=g)},28061:(p,b,c)=>{"use strict";var m,g;m=[c(81335),c(49897),c(33530),c(29930)],g=function(v,n,a,t){const o={};o.banAccount=function(e,s){e=e||ajaxify.data.theirid,i({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(u){const r=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;n.put("/users/"+e+"/ban",{until:r,reason:u.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(t.error)}})},o.unbanAccount=function(e){i({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(s){n.del("/users/"+e+"/ban",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})},o.muteAccount=function(e,s){e=e||ajaxify.data.theirid,i({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(u){const r=u.length>0?Date.now()+u.length*1e3*60*60*(parseInt(u.unit,10)?24:1):0;n.put("/users/"+e+"/mute",{until:r,reason:u.reason||""}).then(()=>{if(typeof s=="function")return s();ajaxify.refresh()}).catch(t.error)}})},o.unmuteAccount=function(e){i({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(s){n.del("/users/"+e+"/mute",{reason:s.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})};function i(e){v.render(e.tpl,{}).then(function(s){const u=a.dialog({title:e.title,message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:e.title,callback:function(){const r=u.find("form").serializeArray().reduce(function(l,d){return l[d.name]=d.value,l},{});e.onSubmit(r)}}}})})}return o}.apply(b,m),g!==void 0&&(p.exports=g)},36684:(p,b,c)=>{"use strict";var m,g;m=[c(29930),c(18675)],g=function(v){const n={coverEl:null,saveFn:null};n.init=function(t,o,i,e){n.coverEl=t,n.saveFn=o,t.find(".upload").on("click",i),t.find(".resize").on("click",function(){a(t)}),t.find(".remove").on("click",e),t.on("dragover",n.onDragOver).on("drop",n.onDrop),t.find(".save").on("click",n.save),t.addClass("initialised")},n.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},n.onDrop=function(t){t.stopPropagation(),t.preventDefault();const o=t.originalEvent.dataTransfer.files,i=new FileReader;o.length&&o[0].type.match("image.*")&&(i.onload=function(e){n.coverEl.css("background-image","url("+e.target.result+")"),n.newCover=e.target.result},i.readAsDataURL(o[0]),a(n.coverEl))};function a(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),v.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return n.save=function(){n.coverEl.addClass("saving"),n.saveFn(n.newCover||void 0,n.coverEl.css("background-position"),function(t){t?v.error(t):(n.coverEl.toggleClass("active",0),n.coverEl.backgroundDraggable("disable"),n.coverEl.off("dragover",n.onDragOver),n.coverEl.off("drop",n.onDrop),v.success("[[modules:cover.saved]]")),n.coverEl.removeClass("saving")})},n}.apply(b,m),g!==void 0&&(p.exports=g)},47283:(p,b,c)=>{"use strict";var m,g;m=[c(49897),c(33530),c(29930)],g=function(v,n,a){const t={};t.account=function(i,e){o(i,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",e)},t.content=function(i,e){o(i,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",e)},t.purge=function(i,e){o(i,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",e)};function o(i,e,s,u,r){n.confirm(e,function(l){l&&v.del(`/users/${encodeURIComponent(i)}${s}`,{}).then(()=>{if(a.success(u),typeof r=="function")return r()}).catch(a.error)})}return t}.apply(b,m),g!==void 0&&(p.exports=g)},63984:(p,b,c)=>{"use strict";var m,g;m=[c(67910),c(22410),c(91749)],g=function(v,n,a){const t={};let o,i=1;t.init=function(){v.init(),$('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),t.handleInfiniteScroll("account/posts")},t.handleInfiniteScroll=function(u){o=u,i=ajaxify.data.pagination.currentPage,config.usePagination||n.init(e)};function e(u){if(u<0)return;const r=utils.params();i+=1,r.page=i,n.loadMoreXhr(r,function(l,d){l.posts&&l.posts.length?s(l.posts,d):d()})}function s(u,r){app.parseAndTranslate(o,"posts",{posts:u},function(l){$('[component="posts"]').append(l),l.find("img:not(.not-responsive)").addClass("img-fluid"),l.find(".timeago").timeago(),a.fire("action:posts.loaded",{posts:u}),r()})}return t}.apply(b,m),g!==void 0&&(p.exports=g)},67910:(p,b,c)=>{"use strict";var m,g;m=[c(36684),c(72254),c(52473),c(17459),c(47283),c(28061),c(7524),c(49897),c(33530),c(29930)],g=function(v,n,a,t,o,i,e,s,u,r){const l={};let d;l.init=function(){d=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,E(),h(),d&&y(),a.get("account/follow").on("click",()=>A("follow")),a.get("account/unfollow").on("click",()=>A("unfollow")),a.get("account/chat").on("click",async function(){const{roomId:f}=await s.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),x=await app.require("chat");f?x.openChat(f):x.newChat(ajaxify.data.uid)}),a.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){a.get("account/chat").parent().removeClass("hidden")})}),a.get("account/ban").on("click",()=>i.banAccount(ajaxify.data.theirid)),a.get("account/mute").on("click",()=>i.muteAccount(ajaxify.data.theirid)),a.get("account/unban").on("click",()=>i.unbanAccount(ajaxify.data.theirid)),a.get("account/unmute").on("click",()=>i.unmuteAccount(ajaxify.data.theirid)),a.get("account/delete-account").on("click",()=>o.account(ajaxify.data.theirid)),a.get("account/delete-content").on("click",()=>o.content(ajaxify.data.theirid)),a.get("account/delete-all").on("click",()=>o.purge(ajaxify.data.theirid)),a.get("account/flag").on("click",D),a.get("account/already-flagged").on("click",C),a.get("account/block").on("click",()=>k("block")),a.get("account/unblock").on("click",()=>k("unblock"))};function E(){$(".account-sub-links li a").removeClass("active").each(function(){const f=$(this).attr("href");if(decodeURIComponent(f)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function h(){$('[component="profile/change/picture"]').on("click",function(){return e.openChangeModal(),!1})}function y(){v.init(a.get("account/cover"),function(f,x,w){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:f,position:x},w)},function(){n.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(f){f=(f.startsWith("http")?"":config.relative_path)+f+"?"+Date.now(),a.get("account/cover").css("background-image","url("+f+")")})},j)}function A(f){const x=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return s[f==="follow"?"put":"del"]("/users/"+x+"/follow",void 0,function(w){if(w)return r.error(w);a.get("account/follow").toggleClass("hide",f==="follow"),a.get("account/unfollow").toggleClass("hide",f==="unfollow"),r.success("[[global:alert."+f+", "+ajaxify.data.username+"]]")}),!1}function D(){c.e(6574).then(function(){var f=[c(6574)];(function(x){x.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,f)}).catch(c.oe)}function C(){const f=$(this).data("flag-id");c.e(6574).then(function(){var x=[c(6574)];(function(w){u.confirm("[[flags:modal-confirm-rescind]]",function(R){R&&w.rescind(f)})}).apply(null,x)}).catch(c.oe)}function k(f){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:f},function(x,w){if(x)return r.error(x);a.get("account/block").toggleClass("hidden",w),a.get("account/unblock").toggleClass("hidden",!w)}),!1}function j(){t.translate("[[user:remove-cover-picture-confirm]]",function(f){u.confirm(f,function(x){x&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(w){w?r.error(w):ajaxify.refresh()})})})}return l}.apply(b,m),g!==void 0&&(p.exports=g)}}]);
