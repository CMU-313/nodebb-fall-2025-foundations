"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,88655,98463,99127],{4649:(k,A,c)=>{var g,w;g=[c(49897),c(33530),c(29930),c(24187)],w=function(f,P,m,d){const E={};return E.init=function(){$("#upload").on("click",function(){d.show({title:"[[admin/manage/uploads:upload-file]]",route:config.relative_path+"/api/admin/upload/file",params:{folder:ajaxify.data.currentFolder}},function(){ajaxify.refresh()})}),$(".delete").on("click",function(){const e=$(this).parents("[data-path]");P.confirm("[[admin/manage/uploads:confirm-delete]]",function(s){s&&f.del("/files",{path:e.attr("data-path")}).then(()=>{e.remove()}).catch(m.error)})}),$("#new-folder").on("click",async function(){P.prompt("[[admin/manage/uploads:name-new-folder]]",e=>{!e||!e.trim()||f.put("/files/folder",{path:ajaxify.data.currentFolder,folderName:e}).then(()=>{ajaxify.refresh()}).catch(m.error)})})},E}.apply(A,g),w!==void 0&&(k.exports=w)},24187:(k,A,c)=>{var g,w;g=[c(64061)],w=function(){const f={};f.show=function(e,s){const h=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:h,title:e.title||"[[global:upload-file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(n){n.modal("show"),n.on("hidden.bs.modal",function(){n.remove()});const p=n.find("#uploadForm");p.attr("action",e.route),p.find("#params").val(JSON.stringify(e.params)),n.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),p.submit()}),p.submit(function(){return P(n,h,s),!1})})},f.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function P(e,s,h){m(e,"status","[[uploads:uploading-file]]"),e.find("#upload-progress-bar").css("width","0%"),e.find("#upload-progress-box").show().removeClass("hide");const n=e.find("#fileInput");if(!n.val())return m(e,"error","[[uploads:select-file-to-upload]]");if(!E(n[0],s))return m(e,"error","[[error:file-too-big, "+s+"]]");f.ajaxSubmit(e,h)}function m(e,s,h){f.hideAlerts(e),s==="error"&&e.find("#fileUploadSubmitBtn").removeClass("disabled"),h=h.replace(/&amp;#44/g,"&#44"),e.find("#alert-"+s).translateText(h).removeClass("hide")}f.ajaxSubmit=function(e,s){e.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(n){n=d(n),m(e,"error",n.responseJSON?.status?.message||n.responseJSON?.error||`[[error:upload-error-fallback, ${n.status} ${n.statusText}]]`)},uploadProgress:function(n,p,b,r){e.find("#upload-progress-bar").css("width",r+"%")},success:function(n){let p=d(n);n.hasOwnProperty("response")&&n.hasOwnProperty("status")&&n.status.code==="ok"&&(p=n.response.images),s(p[0].url),m(e,"success","[[uploads:upload-success]]"),setTimeout(function(){f.hideAlerts(e),e.modal("hide")},750)}})};function d(e){if(typeof e=="string")try{return JSON.parse(e)}catch(s){return console.error(s),{error:"[[error:parse-error]]"}}return e}function E(e,s){return window.FileReader&&s?e.files[0].size<=s*1e3:!0}return f}.apply(A,g),w!==void 0&&(k.exports=w)},49897:(k,A,c)=>{c.r(A),c.d(A,{del:()=>b,get:()=>e,head:()=>s,patch:()=>n,post:()=>h,put:()=>p});var g=c(91749),w=c.n(g),f=c(33530),P=c.n(f);const m=config.relative_path+"/api/v3";async function d(r,o){if(r.url=r.url.startsWith("/api")?config.relative_path+r.url:m+r.url,typeof o=="function"){E(r).then(t=>o(null,t),t=>{let u=t;t instanceof Error||(u=new Error(String(t)));const l=u.message||String(u);if(l&&!l.startsWith("[[error:")&&(l.toLowerCase()==="fetch failed"||l.toLowerCase()==="failed to fetch"||l.toLowerCase().includes("networkerror")||l.toLowerCase().includes("network")&&l.toLowerCase().includes("failed"))){const i=new Error("[[error:no-connection]]");i.originalError=u,u=i}o(u)});return}try{return await E(r)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:u}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,f.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(u)})}throw t}}async function E(r){const{url:o}=r;delete r.url,r.headers||(r.headers={}),r.data&&!(r.data instanceof FormData)&&(r.data=JSON.stringify(r.data||{}),r.headers["content-type"]="application/json; charset=utf-8");try{({options:r}=await(0,g.fire)("filter:api.options",{options:r}))}catch(a){console.error("[API] Error in filter:api.options hook:",a)}r.data&&(r.body=r.data,delete r.data);let t;try{t=await fetch(o,r)}catch(a){const y=a.message||a.toString()||String(a),_=a.name||"Error";if(_==="TypeError"&&(y.toLowerCase().includes("fetch")||y.toLowerCase().includes("network")||y.toLowerCase().includes("failed to fetch")||y.toLowerCase().includes("load failed"))||y.toLowerCase().includes("cors")||y.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:o,method:r.method||"GET",error:y,name:_});const T=new Error("[[error:no-connection]]");throw T.originalError=a,T}throw console.error("[API] Unexpected fetch error:",{url:o,method:r.method||"GET",error:y,name:_}),a}const{headers:u}=t;if(u.get("x-redirect"))return E({url:u.get("x-redirect"),...r});const l=u.get("content-type"),C=l&&l.startsWith("application/json");let i;if(r.method!=="HEAD")try{C?i=await t.json():i=await t.text()}catch(a){throw console.error("[API] Error parsing response:",{url:o,status:t.status,statusText:t.statusText,contentType:l,error:a.message}),new Error("[[error:invalid-json]]")}if(!t.ok){let a;throw i?C&&i.status&&i.status.message?a=i.status.message:typeof i=="string"?a=i:a=t.statusText||"Request failed":a=t.statusText||"Request failed",new Error(a)}return C&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function e(r,o,t){return d({url:r+(o&&Object.keys(o).length?"?"+$.param(o):"")},t)}function s(r,o,t){return d({url:r+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"HEAD"},t)}function h(r,o,t){return d({url:r,method:"POST",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}function n(r,o,t){return d({url:r,method:"PATCH",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}function p(r,o,t){return d({url:r,method:"PUT",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}function b(r,o,t){return d({url:r,method:"DELETE",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
