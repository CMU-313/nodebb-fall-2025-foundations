"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,86198,90479,99127],{29195:(P,x,g)=>{var E,b;E=[g(17459),g(81335),g(65348),g(49897),g(10246),g(33530),g(29930)],b=function(v,I,A,m,u,a,r){u=u.default;const l={};let o=-1,C;(function(){const t='[data-action="purge"][data-cid]';$(document).off("click.adminPurge",t).on("click.adminPurge",t,function(c){c.preventDefault();const d=$(this),s=d.closest("li[data-cid]"),h=d.attr("data-cid")||s.length&&s.attr("data-cid"),f=s.length&&s.find(".title").text().trim()||"";if(!h){console.error("admin/manage/categories: purge clicked but no cid",this);return}m.get(`/categories/${encodeURIComponent(h)}/count`).then(function(y){const w=y&&y.count?y.count:0;I.render("admin/partials/categories/purge",{name:f,topic_count:w}).then(function(D){const k=a.dialog({title:"[[admin/manage/categories:purge]]",message:D,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){k.find(".modal-footer button").prop("disabled",!0);const L=setInterval(async function(){try{const{count:S}=await m.get(`/categories/${encodeURIComponent(h)}/count`);let T=0;w>0&&(T=Math.max(0,1-S/w)*100),k.find(".progress-bar").css({width:T+"%"})}catch(S){clearInterval(L),r.error(S)}},1e3);return m.del("/categories/"+h).then(function(){L&&clearInterval(L),k.modal("hide"),r.success("[[admin/manage/categories:alert.purge-success]]"),s&&s.length&&s.remove()}).catch(function(S){clearInterval(L),r.error(S)}),!1}}}})})}).catch(r.error)})})(),l.init=function(){A.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(t){ajaxify.go("/admin/manage/categories"+(t.cid?"?cid="+t.cid:""))},cacheList:!1,localCategories:[],template:"admin/partials/category/selector-dropdown-right"}),l.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",l.throwCreateModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const t=$(this),c=t.attr("data-disable-cid"),d=t.parents('li[data-cid="'+c+'"]'),s=d.hasClass("disabled"),f=d.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();l.toggle([c].concat(f),!s)}),$(".categories").on("click",".toggle",function(){const t=$(this);t.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),t.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden");const c=t.closest("[data-cid]").find("> ul.has-more-categories");parseInt(c.attr("data-hasmore"),10)===1&&c.toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const t=$(this).attr("data-cid"),c=$(this).attr("data-order"),d=a.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+c+' /><p class="form-text">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const s=d.find("input").val();if(s&&t){const h={};h[t]={order:Math.max(1,parseInt(s,10))},m.put("/categories/"+t,h[t]).then(function(){ajaxify.refresh()}).catch(r.error)}else return!1}}}})}),$("#toggle-collapse-all").on("click",function(){const t=$(this),c=parseInt(t.attr("data-collapsed"),10)===1;e(c),t.attr("data-collapsed",c?0:1).translateText(c?"[[admin/manage/categories:collapse-all]]":"[[admin/manage/categories:expand-all]]")});function e(t){const c=$(".categories .toggle");c.find("i").toggleClass("fa-chevron-down",t).toggleClass("fa-chevron-right",!t),c.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!t)}},l.throwCreateModal=function(){I.render("admin/partials/categories/create",{}).then(function(e){const t=a.dialog({title:"[[admin/manage/categories:alert.create]]",message:e,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:h}}}),c={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}],template:"admin/partials/category/selector-dropdown-left"},d=A.init(t.find('#parentCidGroup [component="category-selector"]'),c),s=A.init(t.find('#cloneFromCidGroup [component="category-selector"]'),c);function h(){const f=t.find("form").serializeObject();return f.description="",f.icon="fa-comments",f.uid=app.user.uid,f.parentCid=d.getSelectedCid(),f.cloneFromCid=s.getSelectedCid(),l.create(f),t.modal("hide"),!1}$("#cloneChildren").on("change",function(){const f=$(this),y=t.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');f.prop("checked")?(y.attr("disabled","disabled"),d.selectCategory(0)):y.removeAttr("disabled")}),t.find("form").on("submit",h)})},l.create=function(e){m.post("/categories",e,function(t,c){if(t)return r.error(t);r.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+c.cid)})},l.render=function(e){const t=$(".categories");!e||!e.length?v.translate("[[admin/manage/categories:alert.none-active]]",function(c){$("<div></div>").addClass("alert alert-info text-center").text(c).appendTo(t)}):(C={},i(e,t,{cid:0}))},l.toggle=function(e,t){const c=document.querySelector('.categories [data-cid="0"]');Promise.all(e.map(d=>m.put("/categories/"+d,{disabled:t?1:0}).then(()=>{const s=c.querySelector(`li[data-cid="${d}"]`);s.classList[t?"add":"remove"]("disabled"),$(s).find('li a[data-action="toggle"]').first().translateText(t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(r.error)))};function p(e){o=e.to.dataset.cid}function n(e){const t=parseInt(o,10)!==-1;if(e.newIndex!=null&&parseInt(e.oldIndex,10)!==parseInt(e.newIndex,10)||t){const c=e.item.dataset.cid,d={},s=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(d[c]={order:s+e.newIndex+1},t){d[c].parentCid=o;const h=parseInt(e.from.getAttribute("data-cid"),10),f=parseInt(e.to.getAttribute("data-cid"),10);if(h!==f){const y=document.querySelector(`.categories li[data-cid="${f}"] .toggle`);if(y&&y.classList.toggle("invisible",!1),!document.querySelectorAll(`.categories li[data-cid="${h}"] ul[data-cid] li[data-cid]`).length){const D=document.querySelector(`.categories li[data-cid="${h}"] .toggle`);D&&D.classList.toggle("invisible",!0)}e.item.dataset.parentCid=f}}o=-1,m.put("/categories/"+c,d[c]).catch(r.error)}}function i(e,t,c){let d=0;const s=c.cid;e.forEach(function(f,y,w){v.translate(f.name,function(D){f.name!==D&&(f.name=D),d+=1,d===w.length&&h()})}),e.length||h();function h(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:c.cid,categories:e,parentCategory:c},function(f){t.find(".category-row").length?t.find(".category-row").after(f):t.append(f),e.length||t.get(0).querySelector(".toggle").classList.toggle("invisible",!0);for(let y=0,w=e.length;y<w;y+=1)i(e[y].children,$('li[data-cid="'+e[y].cid+'"]'),e[y]);C[s]=u.create($('ul[data-cid="'+s+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:p,onEnd:n})})}}return l}.apply(x,E),b!==void 0&&(P.exports=b)},49897:(P,x,g)=>{g.r(x),g.d(x,{del:()=>p,get:()=>a,head:()=>r,patch:()=>o,post:()=>l,put:()=>C});var E=g(91749),b=g.n(E),v=g(33530),I=g.n(v);const A=config.relative_path+"/api/v3";async function m(n,i){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:A+n.url,typeof i=="function"){u(n).then(e=>i(null,e),e=>i(e));return}try{return await u(n)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:t}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(t)})}throw e}}async function u(n){const{url:i}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,E.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const e=await fetch(i,n),{headers:t}=e;if(t.get("x-redirect"))return u({url:t.get("x-redirect"),...n});const c=t.get("content-type"),d=c&&c.startsWith("application/json");let s;if(n.method!=="HEAD"&&(d?s=await e.json():s=await e.text()),!e.ok)throw s?new Error(d?s.status.message:s):new Error(e.statusText);return d&&s&&s.hasOwnProperty("status")&&s.hasOwnProperty("response")?s.response:s}function a(n,i,e){return m({url:n+(i&&Object.keys(i).length?"?"+$.param(i):"")},e)}function r(n,i,e){return m({url:n+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},e)}function l(n,i,e){return m({url:n,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}function o(n,i,e){return m({url:n,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}function C(n,i,e){return m({url:n,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}function p(n,i,e){return m({url:n,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}},65348:(P,x,g)=>{var E,b;E=[g(96349),g(33530),g(91749),g(17459)],b=function(v,I,A,m){const u={};return u.init=function(a,r){if(!a||!a.length)return;r=r||{};const l=r.onSelect||function(){};r.states=r.states||["watching","tracking","notwatching","ignoring"],r.template=r.template||"partials/category/selector-dropdown-left",A.fire("action:category.selector.options",{el:a,options:r}),v.init(a,r);const o={el:a,selectedCategory:null};a.on("click","[data-cid]",function(){const p=$(this);return p.hasClass("disabled")?!1:(o.selectCategory(p.attr("data-cid")),l(o.selectedCategory))});let C=o.el.find('[component="category-selector-selected"]').html();return m.translate(C,p=>{C=p}),o.selectCategory=function(p){const n=o.el.find('[data-cid="'+p+'"]');o.selectedCategory={cid:p,name:n.attr("data-name")},n.length?o.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):o.el.find('[component="category-selector-selected"]').html(C)},o.getSelectedCategory=function(){return o.selectedCategory},o.getSelectedCid=function(){return o.selectedCategory?o.selectedCategory.cid:0},r.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(r.template,{selectedCategory:r.selectedCategory},function(p){o.el.find('[component="category-selector-selected"]').html(p.find('[component="category-selector-selected"]').html())}),o},u.modal=function(a){a=a||{},a.onSelect=a.onSelect||function(){},a.onSubmit=a.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:a.message},function(r){const l=I.dialog({title:a.title||"[[modules:composer.select-category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:C}}}),o=u.init(l.find('[component="category-selector"]'),a);function C(p){return p.preventDefault(),o.selectedCategory&&(a.onSubmit(o.selectedCategory),l.modal("hide")),!1}a.openOnLoad&&l.on("shown.bs.modal",function(){l.find(".dropdown-toggle").dropdown("toggle")}),l.find("form").on("submit",C)})},u}.apply(x,E),b!==void 0&&(P.exports=b)},96349:(P,x,g)=>{var E,b;E=[g(29930),g(89336),g(49897)],b=function(v,I,A){const m={};return m.init=function(u,a){let r=a.defaultCategories||null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","tracking","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let l=[];Array.isArray(a.localCategories)&&(l=a.localCategories.map(i=>({...i})),r&&(r=[...l,...r])),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const o=u.find('[component="category-selector-search"]');if(!o.length)return;const C=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){C&&o.removeClass("hidden");function i(){const e=o.find("input").val();e.length>1||!e&&!r?p(e,function(t){r=a.cacheList&&(r||t),n(t)}):!e&&r&&n(r)}o.on("click",function(e){e.preventDefault(),e.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(i,300)),i()}),u.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),u.on("hide.bs.dropdown",function(){C&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function p(i,e){A.get("/search/categories",{search:i,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(t,{categories:c}){if(t)return v.error(t);e(l.concat(c))})}function n(i){const e=a.selectedCids.map(String);i.forEach(function(t){t.selected=e.includes(String(t.cid))}),app.parseAndTranslate(a.template,{categoryItems:i.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){u.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!i.length);const c=I.Dropdown.getInstance(u.find(".dropdown-toggle").get(0));c&&c.update()})}},m}.apply(x,E),b!==void 0&&(P.exports=b)}}]);
