(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,3452,34271,49897,99127],{4812:(k,g,o)=>{"use strict";o.r(g),o.d(g,{init:()=>y});var f=o(49897),v=o(29930);async function y(){const w=document.querySelector(".account"),c=await navigator.serviceWorker.ready;let a=await c.pushManager.getSubscription();const l=O(config["web-push"].vapidKey);w.addEventListener("click",async p=>{const m=p.target.closest("[data-action]");if(m)switch(p.target.getAttribute("data-action")){case"test":{a?(await(0,f.post)("/plugins/web-push/test",{subscription:a}),(0,v.success)("[[web-push:toast.test_success]]")):(0,v.warning)("[[web-push:toast.test_unavailable]]");break}case"toggle":{const e=document.querySelector("#deviceCount strong");if(a){await a.unsubscribe(),await(0,f.del)("/plugins/web-push/subscription",{subscription:a.toJSON()});let t=parseInt(e.textContent,10);t-=1,e.innerText=t,a=null}else try{a=await c.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l}),await(0,f.post)("/plugins/web-push/subscription",{subscription:a.toJSON()});let t=parseInt(e.textContent,10);t+=1,e.innerText=t}catch{m.checked=!1}break}}});const E=document.getElementById("enabled");a&&(E.checked=!0),await c.pushManager.permissionState({userVisibleOnly:!0,applicationServerKey:l})==="denied"&&document.getElementById("permission-warning").classList.remove("d-none")}function O(w){for(var c="=".repeat((4-w.length%4)%4),a=(w+c).replace(/-/g,"+").replace(/_/g,"/"),l=window.atob(a),E=new Uint8Array(l.length),h=0;h<l.length;++h)E[h]=l.charCodeAt(h);return E}},43586:(k,g,o)=>{k.exports=o(4812)},49897:(k,g,o)=>{"use strict";o.r(g),o.d(g,{del:()=>P,get:()=>l,head:()=>E,patch:()=>p,post:()=>h,put:()=>m});var f=o(91749),v=o.n(f),y=o(33530),O=o.n(y);const w=config.relative_path+"/api/v3";async function c(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:w+e.url,typeof t=="function"){a(e).then(r=>t(null,r),r=>{let u=r;r instanceof Error||(u=new Error(String(r)));const i=u.message||String(u);if(i&&!i.startsWith("[[error:")&&(i.toLowerCase()==="fetch failed"||i.toLowerCase()==="failed to fetch"||i.toLowerCase().includes("networkerror")||i.toLowerCase().includes("network")&&i.toLowerCase().includes("failed"))){const n=new Error("[[error:no-connection]]");n.originalError=u,u=n}t(u)});return}try{return await a(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:u}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,y.confirm)("[[error:api.reauth-required]]",i=>{i&&ajaxify.go(u)})}throw r}}async function a(e){const{url:t}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,f.fire)("filter:api.options",{options:e}))}catch(s){console.error("[API] Error in filter:api.options hook:",s)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(t,e)}catch(s){const d=s.message||s.toString()||String(s),C=s.name||"Error";if(C==="TypeError"&&(d.toLowerCase().includes("fetch")||d.toLowerCase().includes("network")||d.toLowerCase().includes("failed to fetch")||d.toLowerCase().includes("load failed"))||d.toLowerCase().includes("cors")||d.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:t,method:e.method||"GET",error:d,name:C});const T=new Error("[[error:no-connection]]");throw T.originalError=s,T}throw console.error("[API] Unexpected fetch error:",{url:t,method:e.method||"GET",error:d,name:C}),s}const{headers:u}=r;if(u.get("x-redirect"))return a({url:u.get("x-redirect"),...e});const i=u.get("content-type"),b=i&&i.startsWith("application/json");let n;if(e.method!=="HEAD")try{b?n=await r.json():n=await r.text()}catch(s){throw console.error("[API] Error parsing response:",{url:t,status:r.status,statusText:r.statusText,contentType:i,error:s.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let s;throw n?b&&n.status&&n.status.message?s=n.status.message:typeof n=="string"?s=n:s=r.statusText||"Request failed":s=r.statusText||"Request failed",new Error(s)}return b&&n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n}function l(e,t,r){return c({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function E(e,t,r){return c({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function h(e,t,r){return c({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function p(e,t,r){return c({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function m(e,t,r){return c({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function P(e,t,r){return c({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}}}]);
