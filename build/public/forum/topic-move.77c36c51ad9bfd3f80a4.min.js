"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,28310,34271,49888,49897,69185,86198,99127],{28310:(k,C,d)=>{var p,y;p=[d(65348),d(29930),d(91749)],y=function(E,w,A){const a={};let c,t;a.init=function(e,n,r){c||(a.tids=e,a.currentCid=n,a.onComplete=r,a.moveAll=!e,s())};function s(){app.parseAndTranslate("modals/move-topic",{},function(e){c=e,$("body").append(c),(a.moveAll||a.tids&&a.tids.length>1)&&c.find(".card-header").translateText("[[topic:move-topics]]");const n=c.find('[component="category-selector"]');n.addClass("dropup"),E.init(n,{onSelect:m,privilege:"moderate"}),c.find("#move_thread_commit").on("click",o),c.find("#move_topic_cancel").on("click",f)})}function m(e){t=e,c.find("#move_thread_commit").prop("disabled",!1)}function o(){const e=c.find("#move_thread_commit");if(!e.prop("disabled")&&t&&t.cid){e.prop("disabled",!0),f();let n="[[topic:topic-move-success, "+t.name+"]]";a.tids&&a.tids.length>1?n="[[topic:topic-move-multiple-success, "+t.name+"]]":a.tids||(n="[[topic:topic-move-all-success, "+t.name+"]]");const r={tids:a.tids?a.tids.slice():null,cid:t.cid,currentCid:a.currentCid,onComplete:a.onComplete};if(config.undoTimeout>0)return w.alert({alert_id:"tids_move_"+(a.tids?a.tids.join("-"):"all"),title:"[[topic:thread-tools.move]]",message:n,type:"success",timeout:config.undoTimeout,timeoutfn:function(){h(r)},clickfn:function(i,l){delete l.timeoutfn,w.success("[[topic:topic-move-undone]]")}});h(r)}}function h(e){A.fire("action:topic.move",e),socket.emit(e.tids?"topics.move":"topics.moveAll",e,function(n){if(n)return w.error(n);typeof e.onComplete=="function"&&e.onComplete()})}function f(){c&&(c.remove(),c=null)}return a}.apply(C,p),y!==void 0&&(k.exports=y)},49897:(k,C,d)=>{d.r(C),d.d(C,{del:()=>f,get:()=>t,head:()=>s,patch:()=>o,post:()=>m,put:()=>h});var p=d(91749),y=d.n(p),E=d(33530),w=d.n(E);const A=config.relative_path+"/api/v3";async function a(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:A+e.url,typeof n=="function"){c(e).then(r=>n(null,r),r=>{let i=r;r instanceof Error||(i=new Error(String(r)));const l=i.message||String(i);if(l&&!l.startsWith("[[error:")&&(l.toLowerCase()==="fetch failed"||l.toLowerCase()==="failed to fetch"||l.toLowerCase().includes("networkerror")||l.toLowerCase().includes("network")&&l.toLowerCase().includes("failed"))){const u=new Error("[[error:no-connection]]");u.originalError=i,i=u}n(i)});return}try{return await c(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,p.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(i)})}throw r}}async function c(e){const{url:n}=e;delete e.url,e.headers||(e.headers={}),e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8");try{({options:e}=await(0,p.fire)("filter:api.options",{options:e}))}catch(g){console.error("[API] Error in filter:api.options hook:",g)}e.data&&(e.body=e.data,delete e.data);let r;try{r=await fetch(n,e)}catch(g){const v=g.message||g.toString()||String(g),T=g.name||"Error";if(T==="TypeError"&&(v.toLowerCase().includes("fetch")||v.toLowerCase().includes("network")||v.toLowerCase().includes("failed to fetch")||v.toLowerCase().includes("load failed"))||v.toLowerCase().includes("cors")||v.toLowerCase().includes("networkerror")){console.error("[API] Network error:",{url:n,method:e.method||"GET",error:v,name:T});const D=new Error("[[error:no-connection]]");throw D.originalError=g,D}throw console.error("[API] Unexpected fetch error:",{url:n,method:e.method||"GET",error:v,name:T}),g}const{headers:i}=r;if(i.get("x-redirect"))return c({url:i.get("x-redirect"),...e});const l=i.get("content-type"),L=l&&l.startsWith("application/json");let u;if(e.method!=="HEAD")try{L?u=await r.json():u=await r.text()}catch(g){throw console.error("[API] Error parsing response:",{url:n,status:r.status,statusText:r.statusText,contentType:l,error:g.message}),new Error("[[error:invalid-json]]")}if(!r.ok){let g;throw u?L&&u.status&&u.status.message?g=u.status.message:typeof u=="string"?g=u:g=r.statusText||"Request failed":g=r.statusText||"Request failed",new Error(g)}return L&&u&&u.hasOwnProperty("status")&&u.hasOwnProperty("response")?u.response:u}function t(e,n,r){return a({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},r)}function s(e,n,r){return a({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},r)}function m(e,n,r){return a({url:e,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function o(e,n,r){return a({url:e,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function h(e,n,r){return a({url:e,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function f(e,n,r){return a({url:e,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}},65348:(k,C,d)=>{var p,y;p=[d(96349),d(33530),d(91749),d(17459)],y=function(E,w,A,a){const c={};return c.init=function(t,s){if(!t||!t.length)return;s=s||{};const m=s.onSelect||function(){};s.states=s.states||["watching","tracking","notwatching","ignoring"],s.template=s.template||"partials/category/selector-dropdown-left",A.fire("action:category.selector.options",{el:t,options:s}),E.init(t,s);const o={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const f=$(this);return f.hasClass("disabled")?!1:(o.selectCategory(f.attr("data-cid")),m(o.selectedCategory))});let h=o.el.find('[component="category-selector-selected"]').html();return a.translate(h,f=>{h=f}),o.selectCategory=function(f){const e=o.el.find('[data-cid="'+f+'"]');o.selectedCategory={cid:f,name:e.attr("data-name")},e.length?o.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):o.el.find('[component="category-selector-selected"]').html(h)},o.getSelectedCategory=function(){return o.selectedCategory},o.getSelectedCid=function(){return o.selectedCategory?o.selectedCategory.cid:0},s.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(s.template,{selectedCategory:s.selectedCategory},function(f){o.el.find('[component="category-selector-selected"]').html(f.find('[component="category-selector-selected"]').html())}),o},c.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(s){const m=w.dialog({title:t.title||"[[modules:composer.select-category]]",message:s,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:h}}}),o=c.init(m.find('[component="category-selector"]'),t);function h(f){return f.preventDefault(),o.selectedCategory&&(t.onSubmit(o.selectedCategory),m.modal("hide")),!1}t.openOnLoad&&m.on("shown.bs.modal",function(){m.find(".dropdown-toggle").dropdown("toggle")}),m.find("form").on("submit",h)})},c}.apply(C,p),y!==void 0&&(k.exports=y)},96349:(k,C,d)=>{var p,y;p=[d(29930),d(89336),d(49897)],y=function(E,w,A){const a={};return a.init=function(c,t){let s=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let m=[];Array.isArray(t.localCategories)&&(m=t.localCategories.map(n=>({...n})),s&&(s=[...m,...s])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const o=c.find('[component="category-selector-search"]');if(!o.length)return;const h=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;c.on("show.bs.dropdown",function(){h&&o.removeClass("hidden");function n(){const r=o.find("input").val();r.length>1||!r&&!s?f(r,function(i){s=t.cacheList&&(s||i),e(i)}):!r&&s&&e(s)}o.on("click",function(r){r.preventDefault(),r.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(n,300)),n()}),c.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),c.on("hide.bs.dropdown",function(){h&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function f(n,r){A.get("/search/categories",{search:n,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(i,{categories:l}){if(i)return E.error(i);r(m.concat(l))})}function e(n){const r=t.selectedCids.map(String);n.forEach(function(i){i.selected=r.includes(String(i.cid))}),app.parseAndTranslate(t.template,{categoryItems:n.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(i){c.find('[component="category/list"]').html(i.find('[component="category/list"]').html()),c.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!n.length);const l=w.Dropdown.getInstance(c.find(".dropdown-toggle").get(0));l&&l.update()})}},a}.apply(C,p),y!==void 0&&(k.exports=y)}}]);
