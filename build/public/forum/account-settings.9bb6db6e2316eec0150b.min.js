(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,34405,92380,97082],{18030:(b,E,c)=>{"use strict";var A,m;A=[c(67910),c(52473),c(49897),c(29930),c(91749),c(34405)],m=function(x,n,u,t,o,a){const s={};let l="";$(window).on("action:ajaxify.start",function(){const e=$("#bootswatchSkin");ajaxify.data.template.name==="account/settings"&&e.length&&e.val()!==l&&g(l)}),s.init=function(){l=$("#bootswatchSkin").length&&$("#bootswatchSkin").val(),x.init(),$("#submitBtn").on("click",function(){const e=r();return e.homePageRoute==="custom"&&e.homePageCustom?$.get(config.relative_path+"/"+e.homePageCustom,function(){i(e)}).fail(function(){t.error("[[error:invalid-home-page-route]]")}):i(e),!1}),$("#bootswatchSkin").on("change",function(){g($(this).val())}),$('[data-property="homePageRoute"]').on("change",d),d(),n.get("user/sessions").find(".timeago").timeago(),h()};function r(){const e={};$(".account").find("input, textarea, select").each(function(f,p){p=$(p);const k=p.attr("data-property");if(k){if(p.is("select")){e[k]=p.val();return}switch(p.attr("type")){case"checkbox":e[k]=p.is(":checked")?1:0;break;default:e[k]=p.val();break}}});const w=$('[component="chat/allow/list/user"][data-uid]').map((f,p)=>$(p).data("uid")).get(),v=$('[component="chat/deny/list/user"][data-uid]').map((f,p)=>$(p).data("uid")).get();return e.chatAllowList=JSON.stringify(w),e.chatDenyList=JSON.stringify(v),e}function i(e){u.put(`/users/${ajaxify.data.uid}/settings`,{settings:e}).then(w=>{t.success("[[success:settings-saved]]");let v=!1;for(const[f,p]of Object.entries(w))f==="userLang"&&config.userLang!==w.userLang&&(v=!0),f==="bootswatchSkin"?(l=w.bootswatchSkin,config.bootswatchSkin=l==="noskin"?"":l):config.hasOwnProperty(f)&&(config[f]=p);v&&parseInt(app.user.uid,10)===parseInt(ajaxify.data.theirid,10)&&window.location.reload()})}function d(){$('[data-property="homePageRoute"]').val()==="custom"?$("#homePageCustomContainer").show():($("#homePageCustomContainer").hide(),$('[data-property="homePageCustom"]').val(""))}function g(e){const w=Array.prototype.filter.call(document.querySelectorAll('link[rel="stylesheet"]'),function(j){return j.href.indexOf(config.relative_path+"/assets/client")!==-1})[0]||null;if(!w)return;e===""?e=config.defaultBootswatchSkin||"":e==="noskin"&&(e="");const v=$("body").attr("class").split(/\s+/).filter(function(j){return j.startsWith("skin-")});if(!v[0])return;let f=v[0].slice(5);if(f=f!=="noskin"?f:"",e===f){o.fire("action:skin.change",{skin:e,currentSkin:f});return}const p=$("html").attr("data-dir"),k=document.createElement("link");k.rel="stylesheet",k.type="text/css",k.href=config.relative_path+"/assets/client"+(e?"-"+e:"")+(p==="rtl"?"-rtl":"")+".css?"+config["cache-buster"],k.onload=function(){w.parentNode.removeChild(w),$("body").removeClass(v.join(" ")),$("body").addClass("skin-"+(e||"noskin")),o.fire("action:skin.change",{skin:e,currentSkin:f})},document.head.appendChild(k)}s.changeSkin=async function(e){app.user.uid&&await u.put(`/users/${app.user.uid}/settings`,{settings:{bootswatchSkin:e}}),config.bootswatchSkin=e==="noskin"?"":e,l=e,g(e)};function h(){a.user($("#chatAllowListAdd"),async function(w,v){const{user:f}=v.item;if(!f||String(f.uid)===String(app.user.uid))return;if($(`[component="chat/allow/list/user"][data-uid="${f.uid}"]`).length)return t.error("[[error:chat-allow-list-user-already-added]]");const p=await app.parseAndTranslate("account/settings","settings.chatAllowListUsers",{settings:{chatAllowListUsers:[v.item.user]}});$('[component="chat/allow/list"]').append(p),$("#chatAllowListAdd").val(""),e()}),a.user($("#chatDenyListAdd"),async function(w,v){const{user:f}=v.item;if(!f||String(f.uid)===String(app.user.uid))return;if($(`[component="chat/deny/list/user"][data-uid="${f.uid}"]`).length)return t.error("[[error:chat-deny-list-user-already-added]]");const p=await app.parseAndTranslate("account/settings","settings.chatDenyListUsers",{settings:{chatDenyListUsers:[v.item.user]}});$('[component="chat/deny/list"]').append(p),$("#chatDenyListAdd").val(""),e()}),$('[component="chat/allow/list"]').on("click",'[component="chat/allow/delete"]',function(){$(this).parent().remove(),e()}),$('[component="chat/deny/list"]').on("click",'[component="chat/deny/delete"]',function(){$(this).parent().remove(),e()});function e(){$('[component="chat/allow/list/no-users"]').toggleClass("hidden",!!$('[component="chat/allow/list/user"]').length),$('[component="chat/deny/list/no-users"]').toggleClass("hidden",!!$('[component="chat/deny/list/user"]').length)}}return s}.apply(E,A),m!==void 0&&(b.exports=m)},18675:()=>{(function(b){var E=b(window),c=function(n,u,t,o){if(arguments.length===3||o){if(t<n)return n;if(t>u)return u}return t},A=function(n){n.clientX=n.originalEvent.touches[0].clientX,n.clientY=n.originalEvent.touches[0].clientY},m=function(n){var u=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(u){var t={width:0,height:0},o=new Image;return o.onload=function(){if(n.css("background-size")=="cover"){var a=n.innerWidth(),s=n.innerHeight(),l=a/s,r=o.width/o.height,i=1;r>=l?i=s/o.height:i=a/o.width,t.width=o.width*i,t.height=o.height*i}else t.width=o.width,t.height=o.height},o.src=u,t}};function x(n,u){this.element=n,this.options=u,this.init()}x.prototype.init=function(){var n=b(this.element),u=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t=this.options;if(u){var o={width:0,height:0};(t.bound||t.units=="percent")&&(o=m(n)),b(window).on("keydown.dbg",a=>{var s=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],l=parseInt(s[1])||0,r=parseInt(s[2])||0;t.units=="percent"&&(l=Math.round(l/-200*o.width),r=Math.round(r/-200*o.height));var i=0,d=0;return a.which===37?i=-5:a.which===39?i=5:a.which===38?d=-5:a.which===40&&(d=5),t.units==="percent"?(l=t.axis==="y"?l:c(-o.width/2,0,l+i,t.bound),r=t.axis==="x"?r:c(-o.height/2,0,r+d,t.bound),n.css("background-position",l/o.width*-200+"% "+r/o.height*-200+"%")):(l=t.axis==="y"?l:c(n.innerWidth()-o.width,0,l+i,t.bound),r=t.axis==="x"?r:c(n.innerHeight()-o.height,0,r+d,t.bound)),[37,38,39,40].includes(a.which)?!1:void 0}),n.on("mousedown.dbg touchstart.dbg",function(a){if(a.target===n[0]){if(a.preventDefault(),a.originalEvent.touches)A(a);else if(a.which!==1)return;var s=a.clientX,l=a.clientY,r=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],i=parseInt(r[1])||0,d=parseInt(r[2])||0;t.units=="percent"&&(i=Math.round(i/-200*o.width),d=Math.round(d/-200*o.height)),E.on("mousemove.dbg touchmove.dbg",function(g){g.preventDefault(),g.originalEvent.touches&&A(g);var h=g.clientX,e=g.clientY;t.units=="percent"?(i=t.axis==="y"?i:c(-o.width/2,0,i+h-s,t.bound),d=t.axis==="x"?d:c(-o.height/2,0,d+e-l,t.bound),n.css("background-position",i/o.width*-200+"% "+d/o.height*-200+"%")):(i=t.axis==="y"?i:c(n.innerWidth()-o.width,0,i+h-s,t.bound),d=t.axis==="x"?d:c(n.innerHeight()-o.height,0,d+e-l,t.bound),n.css("background-position",i+"px "+d+"px")),s=h,l=e}),E.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){t.done&&t.done(),E.off("mousemove.dbg touchmove.dbg"),E.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},x.prototype.disable=function(){var n=b(this.element);n.off("mousedown.dbg touchstart.dbg"),E.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},b.fn.backgroundDraggable=function(n){var u=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=b(this),o;typeof n>"u"||typeof n=="object"?(n=b.extend({},b.fn.backgroundDraggable.defaults,n),o=new x(this,n),t.data("dbg",o)):typeof n=="string"&&t.data("dbg")&&(o=t.data("dbg"),x.prototype[n].apply(o,u))})},b.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(b,E,c)=>{"use strict";var A,m;A=[c(81335),c(49897),c(33530),c(29930)],m=function(x,n,u,t){const o={};o.banAccount=function(s,l){s=s||ajaxify.data.theirid,a({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(r){const i=r.length>0?Date.now()+r.length*1e3*60*60*(parseInt(r.unit,10)?24:1):0;n.put("/users/"+s+"/ban",{until:i,reason:r.reason||""}).then(()=>{if(typeof l=="function")return l();ajaxify.refresh()}).catch(t.error)}})},o.unbanAccount=function(s){a({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(l){n.del("/users/"+s+"/ban",{reason:l.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})},o.muteAccount=function(s,l){s=s||ajaxify.data.theirid,a({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(r){const i=r.length>0?Date.now()+r.length*1e3*60*60*(parseInt(r.unit,10)?24:1):0;n.put("/users/"+s+"/mute",{until:i,reason:r.reason||""}).then(()=>{if(typeof l=="function")return l();ajaxify.refresh()}).catch(t.error)}})},o.unmuteAccount=function(s){a({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(l){n.del("/users/"+s+"/mute",{reason:l.reason||""}).then(()=>{ajaxify.refresh()}).catch(t.error)}})};function a(s){x.render(s.tpl,{}).then(function(l){const r=u.dialog({title:s.title,message:l,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:s.title,callback:function(){const i=r.find("form").serializeArray().reduce(function(d,g){return d[g.name]=g.value,d},{});s.onSubmit(i)}}}})})}return o}.apply(E,A),m!==void 0&&(b.exports=m)},34405:(b,E,c)=>{"use strict";var A,m;A=[c(49897),c(29930),c(36e3),c(9787),c(35786)],m=function(x,n,{Textcomplete:u},{TextareaEditor:t},{ContenteditableEditor:o}){const a={},s={delay:200,appendTo:null};a.init=r=>{const i={...s,...r},{input:d,onSelect:g}=i;app.loadJQueryUI(function(){d.autocomplete({...i,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(h,e){l(d,g,h,e)}})})},a.user=function(r,i,d){typeof i=="function"&&(d=i,i={}),i=i||{},a.init({input:r,onSelect:d,source:(g,h)=>{i.query=g.term,x.get("/api/users",i,function(e,w){if(e)return n.error(e);if(w&&w.users){const v=w.users.map(function(f){const p=$("<div></div>").html(f.username).text();return f&&{label:p,value:p,user:{uid:f.uid,name:f.username,slug:f.userslug,username:f.username,userslug:f.userslug,displayname:f.displayname,picture:f.picture,banned:f.banned,"icon:text":f["icon:text"],"icon:bgColor":f["icon:bgColor"]}}});h(v)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.group=function(r,i){a.init({input:r,onSelect:i,source:(d,g)=>{socket.emit("groups.search",{query:d.term},function(h,e){if(h)return n.error(h);if(e&&e.length){const w=e.map(function(v){return v&&{label:v.name,value:v.name,group:v}});g(w)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.tag=function(r,i){a.init({input:r,onSelect:i,delay:100,source:(d,g)=>{socket.emit("topics.autocompleteTags",{query:d.term,cid:ajaxify.data.cid||0},function(h,e){if(h)return n.error(h);e&&g(e),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function l(r,i,d,g){i=i||function(){};const h=jQuery.Event("keypress");h.which=13,h.keyCode=13,setTimeout(function(){r.trigger(h)},100),i(d,g)}return a.setup=function({element:r,strategies:i,options:d}){const g=r.get(0);if(g){var h;if(g.nodeName==="TEXTAREA"||g.nodeName==="INPUT"?h=new t(g):g.nodeName==="DIV"&&g.getAttribute("contenteditable")==="true"&&(h=new o(g)),!h)throw new Error("unknown target element type");g.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var e=new u(h,i,{dropdown:d});return e.on("rendered",function(){e.dropdown.items.length&&e.dropdown.items[0].activate()}),e}},a}.apply(E,A),m!==void 0&&(b.exports=m)},36684:(b,E,c)=>{"use strict";var A,m;A=[c(29930),c(18675)],m=function(x){const n={coverEl:null,saveFn:null};n.init=function(t,o,a,s){n.coverEl=t,n.saveFn=o,t.find(".upload").on("click",a),t.find(".resize").on("click",function(){u(t)}),t.find(".remove").on("click",s),t.on("dragover",n.onDragOver).on("drop",n.onDrop),t.find(".save").on("click",n.save),t.addClass("initialised")},n.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},n.onDrop=function(t){t.stopPropagation(),t.preventDefault();const o=t.originalEvent.dataTransfer.files,a=new FileReader;o.length&&o[0].type.match("image.*")&&(a.onload=function(s){n.coverEl.css("background-image","url("+s.target.result+")"),n.newCover=s.target.result},a.readAsDataURL(o[0]),u(n.coverEl))};function u(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),x.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return n.save=function(){n.coverEl.addClass("saving"),n.saveFn(n.newCover||void 0,n.coverEl.css("background-position"),function(t){t?x.error(t):(n.coverEl.toggleClass("active",0),n.coverEl.backgroundDraggable("disable"),n.coverEl.off("dragover",n.onDragOver),n.coverEl.off("drop",n.onDrop),x.success("[[modules:cover.saved]]")),n.coverEl.removeClass("saving")})},n}.apply(E,A),m!==void 0&&(b.exports=m)},47283:(b,E,c)=>{"use strict";var A,m;A=[c(49897),c(33530),c(29930)],m=function(x,n,u){const t={};t.account=function(a,s){o(a,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",s)},t.content=function(a,s){o(a,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",s)},t.purge=function(a,s){o(a,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",s)};function o(a,s,l,r,i){n.confirm(s,function(d){d&&x.del(`/users/${encodeURIComponent(a)}${l}`,{}).then(()=>{if(u.success(r),typeof i=="function")return i()}).catch(u.error)})}return t}.apply(E,A),m!==void 0&&(b.exports=m)},67910:(b,E,c)=>{"use strict";var A,m;A=[c(36684),c(72254),c(52473),c(17459),c(47283),c(28061),c(7524),c(49897),c(33530),c(29930)],m=function(x,n,u,t,o,a,s,l,r,i){const d={};let g;d.init=function(){g=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,h(),e(),g&&w(),u.get("account/follow").on("click",()=>v("follow")),u.get("account/unfollow").on("click",()=>v("unfollow")),u.get("account/chat").on("click",async function(){const{roomId:y}=await l.get(`/users/${encodeURIComponent(ajaxify.data.uid)}/chat`),C=await app.require("chat");y?C.openChat(y):C.newChat(ajaxify.data.uid)}),u.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){u.get("account/chat").parent().removeClass("hidden")})}),u.get("account/ban").on("click",()=>a.banAccount(ajaxify.data.theirid)),u.get("account/mute").on("click",()=>a.muteAccount(ajaxify.data.theirid)),u.get("account/unban").on("click",()=>a.unbanAccount(ajaxify.data.theirid)),u.get("account/unmute").on("click",()=>a.unmuteAccount(ajaxify.data.theirid)),u.get("account/delete-account").on("click",()=>o.account(ajaxify.data.theirid)),u.get("account/delete-content").on("click",()=>o.content(ajaxify.data.theirid)),u.get("account/delete-all").on("click",()=>o.purge(ajaxify.data.theirid)),u.get("account/flag").on("click",f),u.get("account/already-flagged").on("click",p),u.get("account/block").on("click",()=>k("block")),u.get("account/unblock").on("click",()=>k("unblock"))};function h(){$(".account-sub-links li a").removeClass("active").each(function(){const y=$(this).attr("href");if(decodeURIComponent(y)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function e(){$('[component="profile/change/picture"]').on("click",function(){return s.openChangeModal(),!1})}function w(){x.init(u.get("account/cover"),function(y,C,D){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:y,position:C},D)},function(){n.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(y){y=(y.startsWith("http")?"":config.relative_path)+y+"?"+Date.now(),u.get("account/cover").css("background-image","url("+y+")")})},j)}function v(y){const C=isFinite(ajaxify.data.uid)?ajaxify.data.uid:encodeURIComponent(ajaxify.data.userslug);return l[y==="follow"?"put":"del"]("/users/"+C+"/follow",void 0,function(D){if(D)return i.error(D);u.get("account/follow").toggleClass("hide",y==="follow"),u.get("account/unfollow").toggleClass("hide",y==="unfollow"),i.success("[[global:alert."+y+", "+ajaxify.data.username+"]]")}),!1}function f(){c.e(6574).then(function(){var y=[c(6574)];(function(C){C.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,y)}).catch(c.oe)}function p(){const y=$(this).data("flag-id");c.e(6574).then(function(){var C=[c(6574)];(function(D){r.confirm("[[flags:modal-confirm-rescind]]",function(R){R&&D.rescind(y)})}).apply(null,C)}).catch(c.oe)}function k(y){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:y},function(C,D){if(C)return i.error(C);u.get("account/block").toggleClass("hidden",D),u.get("account/unblock").toggleClass("hidden",!D)}),!1}function j(){t.translate("[[user:remove-cover-picture-confirm]]",function(y){r.confirm(y,function(C){C&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(D){D?i.error(D):ajaxify.refresh()})})})}return d}.apply(E,A),m!==void 0&&(b.exports=m)}}]);
